const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./index-l1QRJpTW.js","./index-DGoMKXoD.js","./index-DXYXO7bI.js","./index-DbeBRm09.js","./index-BWoUE4Yb.js"])))=>i.map(i=>d[i]);
(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))i(o);new MutationObserver(o=>{for(const n of o)if(n.type==="childList")for(const s of n.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&i(s)}).observe(document,{childList:!0,subtree:!0});function a(o){const n={};return o.integrity&&(n.integrity=o.integrity),o.referrerPolicy&&(n.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?n.credentials="include":o.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(o){if(o.ep)return;o.ep=!0;const n=a(o);fetch(o.href,n)}})();const ms="modulepreload",ys=function(e,t){return new URL(e,t).href},zo={},De=function(t,a,i){let o=Promise.resolve();if(a&&a.length>0){let f=function(c){return Promise.all(c.map(p=>Promise.resolve(p).then(h=>({status:"fulfilled",value:h}),h=>({status:"rejected",reason:h}))))};const s=document.getElementsByTagName("link"),r=document.querySelector("meta[property=csp-nonce]"),d=r?.nonce||r?.getAttribute("nonce");o=f(a.map(c=>{if(c=ys(c,i),c in zo)return;zo[c]=!0;const p=c.endsWith(".css"),h=p?'[rel="stylesheet"]':"";if(i)for(let g=s.length-1;g>=0;g--){const u=s[g];if(u.href===c&&(!p||u.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${c}"]${h}`))return;const m=document.createElement("link");if(m.rel=p?"stylesheet":ms,p||(m.as="script"),m.crossOrigin="",m.href=c,d&&m.setAttribute("nonce",d),document.head.appendChild(m),p)return new Promise((g,u)=>{m.addEventListener("load",g),m.addEventListener("error",()=>u(new Error(`Unable to preload CSS for ${c}`)))})}))}function n(s){const r=new Event("vite:preloadError",{cancelable:!0});if(r.payload=s,window.dispatchEvent(r),!r.defaultPrevented)throw s}return o.then(s=>{for(const r of s||[])r.status==="rejected"&&n(r.reason);return t().catch(n)})},Gt=document.getElementById("gameCanvas"),C=Gt.getContext("2d",{alpha:!1,desynchronized:!0}),Be=document.getElementById("start-screen"),na=document.getElementById("start-content"),ke=document.getElementById("score"),Ht=document.getElementById("score-plus"),nt=document.getElementById("coin-display"),oi=document.getElementById("coin-container"),Ti=document.getElementById("coin-icon"),ma=document.getElementById("coin-plus"),ue=document.getElementById("feedback"),Ct=document.getElementById("pitch-indicator"),bi=document.getElementById("debug-console"),Me=document.getElementById("pause-btn"),$t=document.getElementById("pause-overlay"),dt=document.getElementById("tutorial-volume"),yt=document.getElementById("message-overlay"),vi=document.getElementById("message-text"),Wo=document.getElementById("message-subtext"),Ci=document.getElementById("transition-overlay"),No=document.getElementById("transition-title"),$o=document.getElementById("transition-subtitle"),tt=document.getElementById("feedback-btn"),qe=document.getElementById("settings-btn"),ea=document.getElementById("settings-modal"),vt=document.getElementById("restart-game"),ut=document.getElementById("home-btn"),je=document.getElementById("unlockables-btn"),ni=document.getElementById("unlockables-modal"),Ss=document.getElementById("close-unlockables"),Yo=document.getElementById("stadium-grid"),qo=document.getElementById("bat-grid"),Ts=document.getElementById("unlockables-coin-display"),bs=document.getElementById("close-settings"),Xo=document.getElementById("toggle-release"),Zo=document.getElementById("toggle-vibration"),Ko=document.getElementById("toggle-music"),jo=document.getElementById("toggle-sound"),Jo=document.getElementById("toggle-colorblind"),Qo=document.getElementById("toggle-noflash"),gt=document.getElementById("leaderboard-btn"),Ba=document.getElementById("leaderboard-modal"),vs=document.getElementById("close-leaderboard"),Pi=document.getElementById("leaderboard-list"),Ia=document.getElementById("leaderboard-loading"),Ja=document.getElementById("personal-best-display"),Qa=document.getElementById("name-entry-container"),Ut=document.getElementById("player-name-input"),Cs=document.getElementById("submit-name-btn"),Da=document.getElementById("tab-all-time"),ka=document.getElementById("tab-daily"),Ri=document.getElementById("daily-section"),sa=document.getElementById("daily-challenge-btn"),Fa=document.getElementById("daily-cost-container"),Vi=document.getElementById("daily-cost-value"),la=document.getElementById("daily-cost-icon"),zi=document.getElementById("daily-streak-value"),xo=document.getElementById("daily-date"),Qi=document.getElementById("daily-list"),Ya=document.createElement("canvas"),zn=Ya.getContext("2d"),ba=document.createElement("canvas"),Ps=ba.getContext("2d"),Wt=document.createElement("canvas"),Rs=Wt.getContext("2d"),Oi=document.createElement("canvas"),lt=Oi.getContext("2d"),Wi=document.createElement("canvas"),Fe=Wi.getContext("2d"),Rt=document.createElement("canvas"),To=Rt.getContext("2d");let Z=600,de=800;const en=800,As=680;function Es(e,t){Z=e,de=t}let Oe=0;function tn(e){Oe=e}const ri={},Ke=80,Wa=20,ci=20,ws=13,Ha=32;function Aa(e){e?(Me.style.opacity="1",Me.style.pointerEvents="auto",Me.style.cursor="pointer"):(Me.style.opacity="0",Me.style.pointerEvents="none",Me.style.cursor="default")}const ct=document.getElementById("daily-retry-modal"),Lt=document.getElementById("retry-cost-display"),xi=document.getElementById("retry-cancel-btn"),Ie=document.getElementById("retry-confirm-btn"),an=document.getElementById("daily-prev-btn"),Ai=document.getElementById("daily-next-btn"),Kt=document.getElementById("security-modal"),on=document.getElementById("security-title"),nn=document.getElementById("security-message"),Ms=document.getElementById("security-close-btn");document.getElementById("confirmation-modal");document.getElementById("confirm-ok-btn");document.getElementById("confirm-cancel-btn");const _s=600,Is=60,La=1e3/Is,eo=-Math.PI/2,Ei=-1,wi=-2.2,F={FASTBALL:"fastball",CURVEBALL:"curveball",CHANGEUP:"changeup",SPLITTER:"splitter",SUPER_FASTBALL:"super_fastball",SUPER_SPLITTER:"super_splitter",GHOSTBALL:"ghostball",STOPBALL:"stopball",STOP_CURVE:"STOP_CURVE",GHOST_CURVE:"GHOST_CURVE",SUPER_CURVE:"SUPER_CURVE",SUPER_ZIGZAG:"super_zigzag",STOP_SPLITTER:"stop_splitter",STOP_ZIGZAG:"stop_zigzag",GHOST_SPLITTER:"ghost_splitter",GHOST_ZIGZAG:"ghost_zigzag",GHOST_CHANGEUP:"ghost_changeup",CURVE_SPLITTER:"curve_splitter",ZIGZAG_SPLITTER:"zigzag_splitter",CURVE_CHANGEUP:"curve_changeup",SPLITTER_CHANGEUP:"splitter_changeup",ZIGZAG_CHANGEUP:"zigzag_changeup",GHOST_STOP:"ghost_stop",GHOST_SUPER:"ghost_super",STOP_SUPER:"stop_super",STOP_CHANGEUP:"stop_changeup",ZIGZAG:"zigzag"},Ae=Object.freeze({IDLE:"idle",WINDUP:"windup",PITCHING:"pitching",WALK_OFF:"walk_off",WALK_ON:"walk_on",BACKFLIP:"backflip"}),rt=Object.freeze({BASE_MULTIPLIER:.9,LOG_FACTOR:.6,DAILY_SCORE_OFFSET:150,TRANSITION_SCORE:150,POWER_EXPONENT:.8,POWER_FACTOR:.015}),ot=Object.freeze({BAT_LENGTH:50,BAT_WIDTH:12}),Ds={TIME_SCALE:1},Wn=["#ffccaa","#e0ac69","#d2b48c","#8d5524"],Nn=["#ffffff","#e74c3c","#3498db","#f1c40f","#95a5a6","#2ecc71","#9b59b6","#34495e"],va=function(e){function t(w,D){return w>>>D|w<<32-D}for(var a=Math.pow,i=a(2,32),o="",n=[],s=e.length*8,r=va.h=va.h||[],d=va.k=va.k||[],f=d.length,c={},p=2;f<64;p++)if(!c[p]){for(var h=0;h<313;h+=p)c[h]=p;r[f]=a(p,.5)*i|0,d[f++]=a(p,1/3)*i|0}for(e+="Â€";e.length%64-56;)e+="\0";for(var h=0;h<e.length;h++){var m=e.charCodeAt(h);if(m>>8)return;n[h>>2]|=m<<(3-h)%4*8}n[n.length]=s/i|0,n[n.length]=s;for(var m=0;m<n.length;){var g=n.slice(m,m+=16),u=r;r=r.slice(0,8);for(var h=0;h<64;h++){var T=g[h-15],b=g[h-2],y=r[0],S=r[4],A=r[7]+(t(S,6)^t(S,11)^t(S,25))+(S&r[5]^~S&r[6])+d[h]+(g[h]=h<16?g[h]:g[h-16]+(t(T,7)^t(T,18)^T>>>3)+g[h-7]+(t(b,17)^t(b,19)^b>>>10)|0),v=(t(y,2)^t(y,13)^t(y,22))+(y&r[1]^y&r[2]^r[1]&r[2]);r=[A+v|0].concat(r),r[4]=r[4]+A|0}for(var h=0;h<8;h++)r[h]=r[h]+u[h]|0}for(var h=0;h<8;h++)for(var m=3;m+1;m--){var P=r[h]>>m*8&255;o+=(P<16?0:"")+P.toString(16)}return o},ks="94a08da1",Ls="fecbb6e8",Gs="b4699053",Os="8c7b50b2",Bs="super_baseball_secret_salt_v1_",Fs=()=>navigator.userAgent+(window.screen.width+"x"+window.screen.height);class q{static getSecret(){return ks+Ls+Gs+Os}static hash(t,a,i=null){const o=i||this.getSecret(),n=`${t}|${a}|${o}`;return va(n)}static setItem(t,a){const i=String(a),o=this.hash(t,i),n={d:i,s:o};try{localStorage.setItem(t,JSON.stringify(n))}catch(s){console.warn("SecureStorage: Write failed",s)}}static getItem(t,a=null){const i=localStorage.getItem(t);if(!i)return a;try{const o=JSON.parse(i);if(!o.s||o.d===void 0)return console.warn(`SecureStorage: Invalid envelope for ${t}.`),a;const n=this.hash(t,o.d);if(o.s===n)return o.d;const s=this.hash(t,o.d,Bs);if(o.s===s)return console.log(`SecureStorage: Upgrading ${t} from V1 to V2...`),this.upgrade(t,o.d),o.d;const r=`${t}|${o.d}|${this.getSecret()}|${Fs()}`,d=va(r);return o.s===d?(console.log(`SecureStorage: Recovered ${t} from device-bound payload. Upgrading...`),this.upgrade(t,o.d),o.d):(console.error(`SecureStorage: TAMPER DETECTED for ${t}. Signature mismatch.`),a)}catch{return a}}static upgrade(t,a){setTimeout(()=>{this.setItem(t,a)},0)}static removeItem(t){localStorage.removeItem(t)}static migrate(t){const a=localStorage.getItem(t);if(!a)return;let i=!1;try{const o=JSON.parse(a);o&&o.s&&o.d!==void 0&&(i=!0)}catch{}if(!i){if(t==="baseball_coins"||t==="baseball_local_delta"){const o=parseInt(a),n=1e3;if(isNaN(o)||o>n){console.warn(`SecureStorage: Migration BLOCKED for ${t}. Value ${o} exceeds legacy safety limit (${n}). Resetting to 0.`),this.setItem(t,"0");return}if(o<0){this.setItem(t,"0");return}}console.log(`SecureStorage: Migrating raw legacy data for ${t}...`),this.setItem(t,a)}}static signPayload(t,a,i,o){const n=this.getSecret(),s=`${t}|${a}|${i}|${o}|${n}`;return va(s)}}const l={gameActive:!1,isPaused:!1,isLoading:!0,showTutorial:!0,tutorialSeen:!1,needsUnlockablesGlow:!1,pendingUnlockablesGlow:!1,settings:{swingOnRelease:!1,vibration:!0,noFlash:!1,muteMusic:!1,muteSound:!1,colorBlindMode:!1},showFireworks:!1,score:0,coins:parseInt(q.getItem("baseball_coins","0"))||0,highScore:parseInt(q.getItem("baseball_high_score_s1","0"))||0,initialHighScore:0,totalPitches:0,consecutiveFouls:0,lastTime:0,accumulator:0,isGameOver:!1,lastPitchResult:null,lastSwingTime:0,lastStaticRenderMode:null,bossModeActive:!1,monitorEntranceStartTime:0,isDailyChallenge:!1,dailyRetries:0,dailyStreak:parseInt(q.getItem("baseball_daily_streak","0"))||0,lastDailyDate:q.getItem("baseball_last_daily_date")||null,startMessage:{text:"",color:"#ffffff",active:!1,timer:0},pitcher:{id:"ROOKIE",x:0,y:150,width:32,height:32,baseColor:"#ffffff",color:"#ffffff",state:Ae.IDLE,timer:0,idleDuration:1e3,windupDuration:1e3,nextPitch:F.FASTBALL,chargeSoundPlayed:!1},bat:{x:0,y:0,angle:Math.PI,swinging:!1,swingSpeed:-.3,pivotX:0,pivotY:0},balls:[]},to=Object.freeze(Object.defineProperty({__proto__:null,gameState:l},Symbol.toStringTag,{value:"Module"}));class Mo{constructor(t,a,i=10){this.createFn=t,this.resetFn=a,this.pool=[];for(let o=0;o<i;o++)this.pool.push(this.createFn())}get(...t){let a;return this.pool.length>0?a=this.pool.pop():a=this.createFn(),this.resetFn&&this.resetFn(a,...t),a}release(t){this.pool.push(t)}clear(){this.pool=[]}}class x{static playSwing(t,a){const i=t.currentTime,o=t.createOscillator(),n=t.createGain();o.type="sawtooth",o.frequency.setValueAtTime(200,i),o.frequency.exponentialRampToValueAtTime(100,i+.1),n.gain.setValueAtTime(.15,i),n.gain.exponentialRampToValueAtTime(.01,i+.1),o.connect(n),n.connect(a),o.start(i),o.stop(i+.1)}static playHit(t,a){const i=t.currentTime,o=t.createOscillator(),n=t.createGain();o.type="square",o.frequency.setValueAtTime(800,i),o.frequency.exponentialRampToValueAtTime(200,i+.15),n.gain.setValueAtTime(.3,i),n.gain.exponentialRampToValueAtTime(.01,i+.15),o.connect(n),n.connect(a),o.start(i),o.stop(i+.15)}static playPerfectHit(t,a){const i=t.currentTime,o=[523.25,659.25,783.99,1046.5],n=.1,s=.08;o.forEach((c,p)=>{const h=t.createOscillator(),m=t.createGain(),g=i+p*s;h.type="square",h.frequency.value=c,m.gain.setValueAtTime(.2,g),m.gain.exponentialRampToValueAtTime(.01,g+n),h.connect(m),m.connect(a),h.start(g),h.stop(g+n)});const r=t.createOscillator(),d=t.createGain(),f=i+o.length*s;r.type="triangle",r.frequency.setValueAtTime(1200,f),r.frequency.linearRampToValueAtTime(2e3,f+.3),d.gain.setValueAtTime(.1,f),d.gain.linearRampToValueAtTime(.01,f+.3),r.connect(d),d.connect(a),r.start(f),r.stop(f+.3)}static playFoul(t,a){const i=t.currentTime,o=t.createOscillator(),n=t.createGain();o.type="sawtooth",o.frequency.setValueAtTime(150,i),o.frequency.exponentialRampToValueAtTime(50,i+.3),n.gain.setValueAtTime(.2,i),n.gain.linearRampToValueAtTime(.01,i+.3),o.connect(n),n.connect(a),o.start(i),o.stop(i+.3)}static playPause(t,a,i){const o=t.currentTime,n=t.createOscillator(),s=t.createGain();n.type="square",i?(n.frequency.setValueAtTime(660,o),n.frequency.setValueAtTime(440,o+.1)):(n.frequency.setValueAtTime(440,o),n.frequency.setValueAtTime(660,o+.1)),s.gain.setValueAtTime(.1,o),s.gain.linearRampToValueAtTime(.01,o+.2),n.connect(s),s.connect(a),n.start(o),n.stop(o+.2)}static playSettingsToggle(t,a){const i=t.currentTime,o=t.createOscillator(),n=t.createGain();o.type="square",o.frequency.setValueAtTime(800,i),o.frequency.exponentialRampToValueAtTime(1200,i+.05),n.gain.setValueAtTime(.05,i),n.gain.exponentialRampToValueAtTime(.01,i+.05),o.connect(n),n.connect(a),o.start(i),o.stop(i+.05)}static playSettingsOpen(t,a){const i=t.currentTime,o=t.createOscillator(),n=t.createGain();o.type="square",o.frequency.setValueAtTime(500,i),o.frequency.linearRampToValueAtTime(300,i+.1),n.gain.setValueAtTime(.1,i),n.gain.linearRampToValueAtTime(.01,i+.1),o.connect(n),n.connect(a),o.start(i),o.stop(i+.1)}static playSettingsClose(t,a){const i=t.currentTime,o=t.createOscillator(),n=t.createGain();o.type="square",o.frequency.setValueAtTime(300,i),o.frequency.linearRampToValueAtTime(500,i+.1),n.gain.setValueAtTime(.1,i),n.gain.linearRampToValueAtTime(.01,i+.1),o.connect(n),n.connect(a),o.start(i),o.stop(i+.1)}static playPurchase(t,a){const i=t.currentTime;[1200,1500,1800,2200].forEach((s,r)=>{const d=t.createOscillator(),f=t.createGain(),c=i+r*.05;d.type="sine",d.frequency.setValueAtTime(s,c),f.gain.setValueAtTime(.1,c),f.gain.exponentialRampToValueAtTime(.01,c+.1),d.connect(f),f.connect(a),d.start(c),d.stop(c+.1)}),[523.25,659.25,783.99,1046.5].forEach((s,r)=>{const d=t.createOscillator(),f=t.createGain();d.type="triangle",d.frequency.setValueAtTime(s,i),f.gain.setValueAtTime(0,i),f.gain.linearRampToValueAtTime(.1,i+.1),f.gain.exponentialRampToValueAtTime(.01,i+.6),d.connect(f),f.connect(a),d.start(i),d.stop(i+.6)})}static playError(t,a){const i=t.currentTime,o=t.createOscillator(),n=t.createGain();o.type="sawtooth",o.frequency.setValueAtTime(150,i),o.frequency.linearRampToValueAtTime(100,i+.15),n.gain.setValueAtTime(.2,i),n.gain.exponentialRampToValueAtTime(.01,i+.15),o.connect(n),n.connect(a),o.start(i),o.stop(i+.15)}static playUnlockablesOpen(t,a){this.playSettingsOpen(t,a)}static playUnlockablesClose(t,a){this.playSettingsClose(t,a)}static playItemAlreadyEquipped(t,a){const i=t.currentTime,o=t.createOscillator(),n=t.createGain();o.type="sine",o.frequency.setValueAtTime(150,i),o.frequency.exponentialRampToValueAtTime(100,i+.1),n.gain.setValueAtTime(.1,i),n.gain.linearRampToValueAtTime(.01,i+.1),o.connect(n),n.connect(a),o.start(i),o.stop(i+.1)}static playStrike(t,a){const i=t.currentTime,o=t.createOscillator(),n=t.createGain();o.type="sawtooth",o.frequency.setValueAtTime(100,i),o.frequency.linearRampToValueAtTime(80,i+.2),n.gain.setValueAtTime(.25,i),n.gain.exponentialRampToValueAtTime(.01,i+.2),o.connect(n),n.connect(a),o.start(i),o.stop(i+.2)}static playStrikesCleared(t,a){const i=t.currentTime,o=t.createOscillator(),n=t.createGain(),s=[349.23,440,523.25,659.25],r=.08;o.type="triangle",s.forEach((d,f)=>{o.frequency.setValueAtTime(d,i+f*r)}),n.gain.setValueAtTime(.1,i),n.gain.setValueAtTime(.1,i+s.length*r),n.gain.exponentialRampToValueAtTime(.01,i+s.length*r+.3),o.connect(n),n.connect(a),o.start(i),o.stop(i+s.length*r+.3)}static playLevelUp(t,a){const i=t.currentTime,o=[440,554,659,880,1108,1318],n=.1,s=.08;o.forEach((r,d)=>{const f=t.createOscillator(),c=t.createGain(),p=i+d*s;f.type="square",f.frequency.value=r,c.gain.setValueAtTime(.1,p),c.gain.linearRampToValueAtTime(.01,p+n),f.connect(c),c.connect(a),f.start(p),f.stop(p+n)})}static playPitch(t,a){const i=t.currentTime,o=t.createOscillator(),n=t.createGain();o.type="sawtooth",o.frequency.setValueAtTime(300,i),o.frequency.exponentialRampToValueAtTime(150,i+.08),n.gain.setValueAtTime(.12,i),n.gain.exponentialRampToValueAtTime(.01,i+.08),o.connect(n),n.connect(a),o.start(i),o.stop(i+.08)}static playCurveCharge(t,a){const i=t.currentTime,o=t.createOscillator(),n=t.createGain(),s=t.createOscillator(),r=t.createGain();o.type="triangle",o.frequency.setValueAtTime(200,i),o.frequency.linearRampToValueAtTime(400,i+.8),s.frequency.value=10,r.gain.value=20,s.connect(r),r.connect(o.frequency),n.gain.setValueAtTime(.1,i),n.gain.linearRampToValueAtTime(.01,i+.8),o.connect(n),n.connect(a),o.start(i),s.start(i),o.stop(i+.8),s.stop(i+.8)}static playChangeCharge(t,a){const i=t.currentTime,o=t.createOscillator(),n=t.createGain();o.type="square",o.frequency.setValueAtTime(100,i),o.frequency.linearRampToValueAtTime(200,i+.8),n.gain.setValueAtTime(.05,i),n.gain.linearRampToValueAtTime(.01,i+.8),o.connect(n),n.connect(a),o.start(i),o.stop(i+.8)}static playSuperCharge(t,a){const i=t.currentTime,o=t.createOscillator(),n=t.createGain();o.type="sawtooth",o.frequency.setValueAtTime(400,i),o.frequency.exponentialRampToValueAtTime(1200,i+.8),n.gain.setValueAtTime(.1,i),n.gain.linearRampToValueAtTime(.01,i+.8),o.connect(n),n.connect(a),o.start(i),o.stop(i+.8)}static playSplitterCharge(t,a){const i=t.currentTime,o=t.createOscillator(),n=t.createGain(),s=t.createOscillator(),r=t.createGain();o.type="sawtooth",o.frequency.setValueAtTime(400,i),o.frequency.exponentialRampToValueAtTime(40,i+.8),s.type="square",s.frequency.setValueAtTime(15,i),s.frequency.linearRampToValueAtTime(60,i+.8),r.gain.value=100,s.connect(r),r.connect(o.frequency),n.gain.setValueAtTime(.2,i),n.gain.linearRampToValueAtTime(.01,i+.8),o.connect(n),n.connect(a),o.start(i),s.start(i),o.stop(i+.8),s.stop(i+.8)}static playZigZagCharge(t,a){const i=t.currentTime,o=t.createOscillator(),n=t.createGain(),s=t.createOscillator(),r=t.createGain();o.type="sine",o.frequency.setValueAtTime(400,i),o.frequency.linearRampToValueAtTime(600,i+.8),s.type="square",s.frequency.value=12,r.gain.value=50,s.connect(r),r.connect(o.frequency),n.gain.setValueAtTime(.15,i),n.gain.linearRampToValueAtTime(.01,i+.8),o.connect(n),n.connect(a),o.start(i),s.start(i),o.stop(i+.8),s.stop(i+.8)}static playStopCharge(t,a){const i=t.currentTime,o=t.createOscillator(),n=t.createGain();o.type="sawtooth",o.frequency.setValueAtTime(100,i),o.frequency.exponentialRampToValueAtTime(300,i+1),n.gain.setValueAtTime(.15,i),n.gain.linearRampToValueAtTime(.01,i+1),o.connect(n),n.connect(a),o.start(i),o.stop(i+1)}static playEvilLaugh(t,a){const i=t.currentTime;[0,.2,.4].forEach((o,n)=>{const s=t.createOscillator(),r=t.createGain();s.type="sawtooth",s.frequency.setValueAtTime(400-n*50,i+o),s.frequency.linearRampToValueAtTime(300-n*50,i+o+.15),r.gain.setValueAtTime(.2,i+o),r.gain.exponentialRampToValueAtTime(.01,i+o+.15),s.connect(r),r.connect(a),s.start(i+o),s.stop(i+o+.15)})}static playGhostCharge(t,a){const i=t.currentTime,o=t.createOscillator(),n=t.createOscillator(),s=t.createGain();o.type="sine",n.type="triangle",o.frequency.setValueAtTime(300,i),o.frequency.linearRampToValueAtTime(600,i+.8),n.frequency.setValueAtTime(305,i),n.frequency.linearRampToValueAtTime(605,i+.8),s.gain.setValueAtTime(.1,i),s.gain.linearRampToValueAtTime(.01,i+.8),o.connect(s),n.connect(s),s.connect(a),o.start(i),n.start(i),o.stop(i+.8),n.stop(i+.8)}static playThud(t,a){const i=t.currentTime;[45,48,90].forEach(r=>{const d=t.createOscillator(),f=t.createGain(),c=t.createBiquadFilter();d.type="sawtooth",d.frequency.value=r,c.type="lowpass",c.frequency.value=200,f.gain.setValueAtTime(0,i),f.gain.linearRampToValueAtTime(.6,i+.05),f.gain.exponentialRampToValueAtTime(.01,i+.25),d.connect(c),c.connect(f),f.connect(a),d.start(i),d.stop(i+.3)});const n=t.createOscillator(),s=t.createGain();n.type="sine",n.frequency.value=30,s.gain.setValueAtTime(.8,i),s.gain.exponentialRampToValueAtTime(.01,i+.3),n.connect(s),s.connect(a),n.start(i),n.stop(i+.3)}static playNormalStep(t,a,i){const o=t.currentTime;if(i){const r=t.createBufferSource();r.buffer=i;const d=t.createBiquadFilter();d.type="lowpass",d.frequency.value=2500;const f=t.createGain();f.gain.setValueAtTime(.5,o),f.gain.exponentialRampToValueAtTime(.01,o+.15),r.connect(d),d.connect(f),f.connect(a),r.start(o),r.stop(o+.15)}const n=t.createOscillator(),s=t.createGain();n.type="triangle",n.frequency.setValueAtTime(100,o),n.frequency.exponentialRampToValueAtTime(50,o+.1),s.gain.setValueAtTime(.5,o),s.gain.exponentialRampToValueAtTime(.01,o+.1),n.connect(s),s.connect(a),n.start(o),n.stop(o+.1)}static playRoar(t,a,i){const o=t.currentTime,n=t.createOscillator(),s=t.createOscillator(),r=t.createGain(),d=t.createGain();n.type="sawtooth",n.frequency.setValueAtTime(150,o),n.frequency.exponentialRampToValueAtTime(50,o+1.5),s.type="square",s.frequency.value=45,r.gain.setValueAtTime(200,o),r.gain.exponentialRampToValueAtTime(50,o+1.5),s.connect(r),r.connect(n.frequency),d.gain.setValueAtTime(0,o),d.gain.linearRampToValueAtTime(.6,o+.1),d.gain.exponentialRampToValueAtTime(.01,o+1.5),n.connect(d),d.connect(a),n.start(o),s.start(o),n.stop(o+1.5),s.stop(o+1.5)}static playBatBreak(t,a){const i=t.currentTime,o=t.createOscillator(),n=t.createGain();o.type="sawtooth",o.frequency.setValueAtTime(150,i),o.frequency.exponentialRampToValueAtTime(50,i+.1),n.gain.setValueAtTime(.5,i),n.gain.exponentialRampToValueAtTime(.01,i+.1),o.connect(n),n.connect(a),o.start(i),o.stop(i+.1);const s=t.createOscillator(),r=t.createGain();s.type="square",s.frequency.value=1e3,r.gain.setValueAtTime(.3,i),r.gain.exponentialRampToValueAtTime(.01,i+.2),s.connect(r),r.connect(a),s.start(i),s.stop(i+.2)}static playFirework(t,a,i){const o=t.currentTime,n=t.createOscillator(),s=t.createGain();if(n.type="square",n.frequency.setValueAtTime(600,o),n.frequency.exponentialRampToValueAtTime(150,o+.4),s.gain.setValueAtTime(.3,o),s.gain.exponentialRampToValueAtTime(.01,o+.3),n.connect(s),s.connect(a),n.start(o),n.stop(o+.4),i){const r=t.createBufferSource();r.buffer=i;const d=t.createGain();d.gain.setValueAtTime(.4,o),d.gain.exponentialRampToValueAtTime(.01,o+.3);const f=t.createBiquadFilter();f.type="lowpass",f.frequency.value=5e3,r.connect(f),f.connect(d),d.connect(a),r.start(o),r.stop(o+.3)}}static playThunder(t,a,i,o=1){if(!i)return;const n=t.currentTime,s=t.createBufferSource();s.buffer=i;const r=t.createBiquadFilter(),d=t.createGain();r.type="lowpass",r.frequency.setValueAtTime(800,n),r.frequency.exponentialRampToValueAtTime(100,n+1.5),d.gain.setValueAtTime(o,n),d.gain.exponentialRampToValueAtTime(.01,n+1.5),s.connect(r),r.connect(d),d.connect(a),s.start(n),s.stop(n+1.5)}static playFanfare(t,a){const i=t.currentTime;[{f:523.25,t:0,d:.15},{f:523.25,t:.15,d:.15},{f:523.25,t:.3,d:.15},{f:659.25,t:.45,d:.3},{f:523.25,t:.75,d:.15},{f:783.99,t:.9,d:.6}].forEach(n=>{const s=t.createOscillator(),r=t.createGain();s.type="sawtooth",s.frequency.setValueAtTime(n.f,i+n.t),r.gain.setValueAtTime(0,i+n.t),r.gain.linearRampToValueAtTime(.2,i+n.t+.05),r.gain.linearRampToValueAtTime(.15,i+n.t+n.d-.05),r.gain.linearRampToValueAtTime(0,i+n.t+n.d),s.connect(r),r.connect(a),s.start(i+n.t),s.stop(i+n.t+n.d)})}static playDigitalEntrance(t,a){const i=t.currentTime,o=1,n=t.createOscillator(),s=t.createGain();n.type="square",n.frequency.setValueAtTime(400,i),n.frequency.exponentialRampToValueAtTime(800,i+.5),n.frequency.exponentialRampToValueAtTime(100,i+1);const r=t.createOscillator(),d=t.createGain();r.type="square",r.frequency.value=30,d.gain.value=50,r.connect(d),d.connect(n.frequency),s.gain.setValueAtTime(0,i),s.gain.linearRampToValueAtTime(.15,i+.1),s.gain.linearRampToValueAtTime(.1,i+.5),s.gain.exponentialRampToValueAtTime(.01,i+o),n.connect(s),s.connect(a),n.start(i),r.start(i),n.stop(i+o),r.stop(i+o);const f=t.createOscillator(),c=t.createGain();f.type="square",f.frequency.setValueAtTime(2e3,i),f.frequency.setValueAtTime(3e3,i+.1),f.frequency.setValueAtTime(2500,i+.2),c.gain.setValueAtTime(.05,i),c.gain.exponentialRampToValueAtTime(.01,i+.3),f.connect(c),c.connect(a),f.start(i),f.stop(i+.3)}static playCheer(t,a,i){if(!i)return;const o=t.currentTime,n=t.createBufferSource();n.buffer=i;const s=t.createBiquadFilter(),r=t.createGain();s.type="bandpass",s.frequency.setValueAtTime(1e3,o),s.Q.value=.5,r.gain.setValueAtTime(0,o),r.gain.linearRampToValueAtTime(.4,o+.5),r.gain.exponentialRampToValueAtTime(.01,o+2),n.connect(s),s.connect(r),r.connect(a),n.start(o),n.stop(o+2)}static playLightStep(t,a){const i=t.currentTime,o=t.createOscillator(),n=t.createGain();o.type="triangle",o.frequency.setValueAtTime(800,i),o.frequency.exponentialRampToValueAtTime(400,i+.05),n.gain.setValueAtTime(.1,i),n.gain.exponentialRampToValueAtTime(.01,i+.05),o.connect(n),n.connect(a),o.start(i),o.stop(i+.05)}static playAceStep(t,a,i){const o=t.currentTime;if(i){const r=t.createBufferSource();r.buffer=i;const d=t.createBiquadFilter();d.type="lowpass",d.frequency.value=1200;const f=t.createGain();f.gain.setValueAtTime(.4,o),f.gain.exponentialRampToValueAtTime(.01,o+.12),r.connect(d),d.connect(f),f.connect(a),r.start(o),r.stop(o+.12)}const n=t.createOscillator(),s=t.createGain();n.type="sine",n.frequency.setValueAtTime(80,o),n.frequency.exponentialRampToValueAtTime(40,o+.1),s.gain.setValueAtTime(.3,o),s.gain.exponentialRampToValueAtTime(.01,o+.1),n.connect(s),s.connect(a),n.start(o),n.stop(o+.1)}static playAceEntrance(t,a){const i=t.currentTime;[261.63,329.63,392,493.88,587.33].forEach((n,s)=>{const r=t.createOscillator(),d=t.createGain(),f=t.createOscillator(),c=t.createGain();f.type="sine",f.frequency.value=n*.5,c.gain.value=100,f.connect(c),c.connect(r.frequency),r.type="sine",r.frequency.setValueAtTime(n,i),d.gain.setValueAtTime(0,i),d.gain.linearRampToValueAtTime(.1,i+.2),d.gain.exponentialRampToValueAtTime(.01,i+1.5),r.connect(d),d.connect(a),r.start(i),f.start(i),r.stop(i+1.5),f.stop(i+1.5)})}static playWoosh(t,a,i){if(!i)return;const o=t.currentTime,n=t.createBufferSource();n.buffer=i;const s=t.createBiquadFilter(),r=t.createGain();s.type="bandpass",s.frequency.setValueAtTime(400,o),s.frequency.exponentialRampToValueAtTime(1200,o+.3),s.frequency.exponentialRampToValueAtTime(200,o+.8),s.Q.value=1,r.gain.setValueAtTime(0,o),r.gain.linearRampToValueAtTime(.4,o+.2),r.gain.linearRampToValueAtTime(.01,o+.8),n.connect(s),s.connect(r),r.connect(a),n.start(o),n.stop(o+.8)}static playKick(t,a,i){const o=t.createOscillator(),n=t.createGain();o.frequency.setValueAtTime(150,i),o.frequency.exponentialRampToValueAtTime(.01,i+.5),n.gain.setValueAtTime(.8,i),n.gain.exponentialRampToValueAtTime(.01,i+.5),o.connect(n),n.connect(a),o.start(i),o.stop(i+.5)}static playSnare(t,a,i,o){if(!o)return;const n=t.createBufferSource();n.buffer=o;const s=t.createGain();s.gain.setValueAtTime(.4,i),s.gain.exponentialRampToValueAtTime(.01,i+.2),n.connect(s),s.connect(a),n.start(i),n.stop(i+.2);const r=t.createOscillator(),d=t.createGain();r.frequency.setValueAtTime(250,i),r.frequency.exponentialRampToValueAtTime(100,i+.1),d.gain.setValueAtTime(.3,i),d.gain.exponentialRampToValueAtTime(.01,i+.1),r.connect(d),d.connect(a),r.start(i),r.stop(i+.1)}static playHiHat(t,a,i,o){if(!o)return;const n=t.createBufferSource();n.buffer=o;const s=t.createBiquadFilter();s.type="highpass",s.frequency.value=8e3;const r=t.createGain();r.gain.setValueAtTime(.15,i),r.gain.exponentialRampToValueAtTime(.01,i+.05),n.connect(s),s.connect(r),r.connect(a),n.start(i),n.stop(i+.05)}static playBassNote(t,a,i,o,n){const s=t.createOscillator(),r=t.createGain();s.type="triangle",s.frequency.setValueAtTime(i,o),r.gain.setValueAtTime(.5,o),r.gain.exponentialRampToValueAtTime(.01,o+n),s.connect(r),r.connect(a),s.start(o),s.stop(o+n)}static playMelodyNote(t,a,i,o,n){const s=t.createOscillator(),r=t.createGain();s.type="square",s.frequency.setValueAtTime(i,o),r.gain.setValueAtTime(.05,o),r.gain.exponentialRampToValueAtTime(.01,o+n-.05);const d=t.createOscillator(),f=t.createGain();d.type="sawtooth",d.frequency.setValueAtTime(i-2,o),f.gain.setValueAtTime(.03,o),f.gain.exponentialRampToValueAtTime(.01,o+n-.05),s.connect(r),r.connect(a),s.start(o),s.stop(o+n),d.connect(f),f.connect(a),d.start(o),d.stop(o+n)}static _playBopSound(t,a,i,o){const n=t.createOscillator(),s=t.createGain();n.type="sine",n.frequency.setValueAtTime(400,i),n.frequency.exponentialRampToValueAtTime(300,i+.3),s.gain.setValueAtTime(o,i),s.gain.exponentialRampToValueAtTime(.01,i+.3),n.connect(s),s.connect(a),n.start(i),n.stop(i+.35)}static playEquip(t,a){this._playBopSound(t,a,t.currentTime,.3)}static playPurchase(t,a){const i=t.currentTime;[1200,1500,1800,2200].forEach((s,r)=>{const d=t.createOscillator(),f=t.createGain(),c=i+r*.05;d.type="sine",d.frequency.setValueAtTime(s,c),f.gain.setValueAtTime(.1,c),f.gain.exponentialRampToValueAtTime(.01,c+.1),d.connect(f),f.connect(a),d.start(c),d.stop(c+.1)}),[523.25,659.25,783.99,1046.5].forEach((s,r)=>{const d=t.createOscillator(),f=t.createGain();d.type="triangle",d.frequency.setValueAtTime(s,i),f.gain.setValueAtTime(0,i),f.gain.linearRampToValueAtTime(.1,i+.1),f.gain.exponentialRampToValueAtTime(.01,i+.6),d.connect(f),f.connect(a),d.start(i),d.stop(i+.6)})}static playZigZag(t,a){const i=t.currentTime,o=t.createOscillator(),n=t.createGain(),s=t.createOscillator(),r=t.createGain();o.type="square",o.frequency.setValueAtTime(800,i),o.frequency.exponentialRampToValueAtTime(100,i+.5),s.type="sawtooth",s.frequency.value=60,r.gain.value=500,s.connect(r),r.connect(o.frequency),n.gain.setValueAtTime(.3,i),n.gain.exponentialRampToValueAtTime(.01,i+.5),o.connect(n),n.connect(a),o.start(i),o.stop(i+.5),s.start(i),s.stop(i+.5)}static playKick(t,a,i){const o=t.createOscillator(),n=t.createGain();o.frequency.setValueAtTime(150,i),o.frequency.exponentialRampToValueAtTime(.01,i+.5),n.gain.setValueAtTime(.8,i),n.gain.exponentialRampToValueAtTime(.01,i+.5),o.connect(n),n.connect(a),o.start(i),o.stop(i+.5)}static playSnare(t,a,i,o){if(!o)return;const n=t.createBufferSource();n.buffer=o;const s=t.createGain();s.gain.setValueAtTime(.4,i),s.gain.exponentialRampToValueAtTime(.01,i+.2),n.connect(s),s.connect(a),n.start(i),n.stop(i+.2);const r=t.createOscillator(),d=t.createGain();r.frequency.setValueAtTime(250,i),r.frequency.exponentialRampToValueAtTime(100,i+.1),d.gain.setValueAtTime(.3,i),d.gain.exponentialRampToValueAtTime(.01,i+.1),r.connect(d),d.connect(a),r.start(i),r.stop(i+.1)}static playHiHat(t,a,i,o){if(!o)return;const n=t.createBufferSource();n.buffer=o;const s=t.createBiquadFilter();s.type="highpass",s.frequency.value=8e3;const r=t.createGain();r.gain.setValueAtTime(.15,i),r.gain.exponentialRampToValueAtTime(.01,i+.05),n.connect(s),s.connect(r),r.connect(a),n.start(i),n.stop(i+.05)}static playBassNote(t,a,i,o,n){const s=t.createOscillator(),r=t.createGain();s.type="triangle",s.frequency.setValueAtTime(i,o),r.gain.setValueAtTime(.5,o),r.gain.exponentialRampToValueAtTime(.01,o+n),s.connect(r),r.connect(a),s.start(o),s.stop(o+n)}static playMelodyNote(t,a,i,o,n){const s=t.createOscillator(),r=t.createGain();s.type="square",s.frequency.setValueAtTime(i,o),r.gain.setValueAtTime(.05,o),r.gain.exponentialRampToValueAtTime(.01,o+n-.05);const d=t.createOscillator(),f=t.createGain();d.type="sawtooth",d.frequency.setValueAtTime(i-2,o),f.gain.setValueAtTime(.03,o),f.gain.exponentialRampToValueAtTime(.01,o+n-.05),s.connect(r),r.connect(a),s.start(o),s.stop(o+n),d.connect(f),f.connect(a),d.start(o),d.stop(o+n)}static playTheme(t,a,i){const s=.6382978723404256/4,r=261.63,d=293.66,f=329.63,c=392,p=440,h=523.25,m=65.41,g=87.31,u=98,T=110,b={K:[1,0,0,1,0,0,1,0,0,0,1,0,0,1,0,0],S:[0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0],H:[1,0,1,0,1,0,1,0,1,0,1,0,1,1,1,0]},y={0:{note:r,len:2},2:{note:h,len:2},4:{note:p,len:2},6:{note:c,len:2},8:{note:f,len:2},10:{note:c,len:2},12:{note:d,len:8},32:{note:r,len:2},34:{note:h,len:2},36:{note:p,len:2},38:{note:c,len:2},40:{note:f,len:2},42:{note:c,len:2},44:{note:p,len:8}},S={0:{note:m,len:3},3:{note:m,len:1},4:{note:m,len:2},7:{note:g,len:1},8:{note:u,len:4},14:{note:u,len:2},16:{note:m,len:3},20:{note:m,len:2},24:{note:u,len:4},30:{note:T,len:2},32:{note:g,len:3},36:{note:g,len:2},40:{note:m,len:4},46:{note:m,len:2},48:{note:u,len:3},52:{note:u,len:2},56:{note:m,len:4},62:{note:m,len:2}};let A=0,v=t.currentTime;const P=typeof i=="object"?i:null;return(function w(){for(v<t.currentTime-.2&&(v=t.currentTime);v<t.currentTime+.1;){const D=A%16,k=A%64;if(b.K[D]&&x.playKick(t,a,v),b.S[D]&&x.playSnare(t,a,v,P),b.H[D]&&x.playHiHat(t,a,v,P),y[k]){const I=y[k];x.playMelodyNote(t,a,I.note,v,I.len*s)}if(S[k]){const I=S[k];x.playBassNote(t,a,I.note,v,I.len*s)}v+=s,A++}return setTimeout(w,25)})()}static playHauntedTheme(t,a,i){const s=.6382978723404256/4,r=261.63,d=293.66,f=311.13,c=392,p=415.3,h=523.25,m=65.41,g=98,u=87.31,T={0:{note:r,len:4},4:{note:h,len:4},8:{note:p,len:4},12:{note:c,len:4},16:{note:f,len:4},20:{note:c,len:4},24:{note:d,len:12},48:{note:r,len:4},52:{note:h,len:4},56:{note:p,len:4},60:{note:c,len:4},64:{note:f,len:4},68:{note:c,len:4},72:{note:p,len:12}},b={0:{note:m,len:6},12:{note:g,len:6},24:{note:g,len:6},36:{note:m,len:6},48:{note:m,len:6},60:{note:m,len:6},72:{note:u,len:6},84:{note:g,len:6}};let y=0,S=t.currentTime;const A=typeof i=="object"?i:null,v=(D,k,I)=>{const _=t.createOscillator(),H=t.createGain(),M=t.createOscillator(),L=t.createGain();_.type="triangle",_.frequency.setValueAtTime(D,k),M.frequency.value=4.5,L.gain.value=6,M.connect(L),L.connect(_.frequency),H.gain.setValueAtTime(0,k),H.gain.linearRampToValueAtTime(.12,k+.05),H.gain.exponentialRampToValueAtTime(.08,k+I-.1),H.gain.linearRampToValueAtTime(0,k+I),_.connect(H),H.connect(a),_.start(k),M.start(k),_.stop(k+I),M.stop(k+I)},P=(D,k,I)=>{const _=t.createOscillator(),H=t.createGain();_.type="sawtooth",_.frequency.setValueAtTime(D,k);const M=t.createBiquadFilter();M.type="lowpass",M.frequency.value=150,H.gain.setValueAtTime(.15,k),H.gain.exponentialRampToValueAtTime(.01,k+I),_.connect(M),M.connect(H),H.connect(a),_.start(k),_.stop(k+I)},w=D=>{if(!A)return;const k=t.createBufferSource();k.buffer=A;const I=t.createBiquadFilter();I.type="lowpass",I.frequency.setValueAtTime(200,D),I.frequency.linearRampToValueAtTime(600,D+2),I.frequency.linearRampToValueAtTime(100,D+4);const _=t.createGain();_.gain.setValueAtTime(0,D),_.gain.linearRampToValueAtTime(.1,D+1),_.gain.linearRampToValueAtTime(0,D+4),k.connect(I),I.connect(_),_.connect(a),k.start(D),k.stop(D+4)};return(function D(){for(S<t.currentTime-.2&&(S=t.currentTime);S<t.currentTime+.1;){const k=y%96;if(k%48===0&&w(S),T[k]){const I=T[k];v(I.note,S,I.len*s)}if(b[k]){const I=b[k];P(I.note,S,I.len*s)}S+=s,y++}return setTimeout(D,25)})()}static playIntroReveal(t,a){this.playPerfectHit(t,a)}static playIntroImpact(t,a){const i=t.currentTime,o=t.createOscillator(),n=t.createGain();o.type="sine",o.frequency.setValueAtTime(120,i),o.frequency.exponentialRampToValueAtTime(30,i+.5),n.gain.setValueAtTime(.8,i),n.gain.exponentialRampToValueAtTime(.01,i+.5),o.connect(n),n.connect(a),o.start(i),o.stop(i+.5);const s=t.sampleRate*.2,r=t.createBuffer(1,s,t.sampleRate),d=r.getChannelData(0);for(let h=0;h<s;h++)d[h]=Math.random()*2-1;const f=t.createBufferSource();f.buffer=r;const c=t.createBiquadFilter();c.type="lowpass",c.frequency.setValueAtTime(800,i),c.frequency.exponentialRampToValueAtTime(100,i+.2);const p=t.createGain();p.gain.setValueAtTime(.6,i),p.gain.exponentialRampToValueAtTime(.01,i+.2),f.connect(c),c.connect(p),p.connect(a),f.start(i)}static playIntroSlam(t,a){const i=t.currentTime,o=t.createOscillator(),n=t.createGain();o.type="sine",o.frequency.setValueAtTime(60,i),o.frequency.exponentialRampToValueAtTime(30,i+.4),n.gain.setValueAtTime(.8,i),n.gain.exponentialRampToValueAtTime(.01,i+.4),o.connect(n),n.connect(a),o.start(i),o.stop(i+.4),[261.63,329.63,392].forEach((f,c)=>{const p=t.createOscillator(),h=t.createGain();p.type="sawtooth",p.frequency.value=f+c*1.5,h.gain.setValueAtTime(0,i),h.gain.linearRampToValueAtTime(.2,i+.02),h.gain.exponentialRampToValueAtTime(.01,i+.5);const m=t.createBiquadFilter();m.type="lowpass",m.frequency.setValueAtTime(3e3,i),m.frequency.linearRampToValueAtTime(500,i+.3),p.connect(m),m.connect(h),h.connect(a),p.start(i),p.stop(i+.5)});const r=t.createOscillator(),d=t.createGain();r.type="triangle",r.frequency.setValueAtTime(2e3,i),r.frequency.exponentialRampToValueAtTime(4e3,i+.2),d.gain.setValueAtTime(.05,i),d.gain.exponentialRampToValueAtTime(.01,i+.2),r.connect(d),d.connect(a),r.start(i),r.stop(i+.2)}}class Hs{constructor(){this.audioContext=null,this.initialized=!1,this.themeOscillators=[],this.themeTimer=null,this.themePlaying=!1,this.noiseBuffer=null,this.masterGain=null,this.themeGain=null}init(){return this.initialized?Promise.resolve():(document.addEventListener("visibilitychange",()=>this._handleVisibilityChange()),window.addEventListener("pageshow",()=>this._handleVisibilityChange()),document.addEventListener("touchstart",()=>this._handleInteraction()),document.addEventListener("click",()=>this._handleInteraction()),new Promise(t=>{try{this.audioContext=new(window.AudioContext||window.webkitAudioContext),this.masterGain=this.audioContext.createGain(),this.masterGain.connect(this.audioContext.destination),this.audioContext.resume().catch(()=>{}),this._finishInit(),t()}catch{console.warn("Web Audio API not supported"),t()}}))}_handleVisibilityChange(){document.hidden?this.suspendAudio():this._checkAndResume()}_handleInteraction(){this._checkAndResume()}_checkAndResume(){this.audioContext&&this.audioContext.state==="running"||this.audioContext&&(this.audioContext.state==="suspended"||this.audioContext.state==="interrupted")&&this.audioContext.resume().catch(()=>{})}suspendAudio(){this.audioContext&&this.audioContext.state==="running"&&this.audioContext.suspend().catch(()=>{})}_finishInit(){if(this.initialized)return;const t=this.audioContext.createBuffer(1,1,22050),a=this.audioContext.createBufferSource();a.buffer=t,a.connect(this.audioContext.destination),a.start(0);const i=this.audioContext.createOscillator(),o=this.audioContext.createGain();i.type="sine",i.frequency.value=1,o.gain.value=1e-4,i.connect(o),o.connect(this.audioContext.destination),i.start(0),this.initialized=!0}_createNoiseBuffer(){if(this.noiseBuffer)return;const t=this.audioContext.sampleRate*2,a=this.audioContext.createBuffer(1,t,this.audioContext.sampleRate),i=a.getChannelData(0);for(let o=0;o<t;o++)i[o]=Math.random()*2-1;this.noiseBuffer=a}warmup(){if(!this.initialized)return;const t=this.audioContext,a=t.currentTime;console.log("[SoundManager] Warming up DSP (Safe Mode)..."),["sawtooth","square","triangle","sine"].forEach(i=>{const o=t.createOscillator(),n=t.createGain();o.type=i,o.frequency.value=440,n.gain.value=0,o.connect(n),n.connect(this.masterGain),o.start(a),o.stop(a+.05)});for(let i=0;i<5;i++){const o=t.createOscillator(),n=t.createGain();o.type="square",n.gain.value=0,o.connect(n),n.connect(this.masterGain),o.start(a),o.stop(a+.05)}this.noiseBuffer||this._createNoiseBuffer()}playSwing(){l.settings?.muteSound||!this.initialized||x.playSwing(this.audioContext,this.masterGain)}playPause(t){l.settings?.muteSound||!this.initialized||x.playPause(this.audioContext,this.masterGain,t)}playHit(){l.settings?.muteSound||!this.initialized||x.playHit(this.audioContext,this.masterGain)}playPerfectHit(){l.settings?.muteSound||!this.initialized||x.playPerfectHit(this.audioContext,this.masterGain)}playFoul(){l.settings?.muteSound||!this.initialized||x.playFoul(this.audioContext,this.masterGain)}playStrike(){l.settings?.muteSound||!this.initialized||x.playStrike(this.audioContext,this.masterGain)}playStrikesCleared(){l.settings?.muteSound||!this.initialized||x.playStrikesCleared(this.audioContext,this.masterGain)}playLevelUp(){l.settings?.muteSound||!this.initialized||x.playLevelUp(this.audioContext,this.masterGain)}playPitch(){l.settings?.muteSound||!this.initialized||x.playPitch(this.audioContext,this.masterGain)}playCurveCharge(){l.settings?.muteSound||!this.initialized||x.playCurveCharge(this.audioContext,this.masterGain)}playChangeCharge(){l.settings?.muteSound||!this.initialized||x.playChangeCharge(this.audioContext,this.masterGain)}playSuperCharge(){l.settings?.muteSound||!this.initialized||x.playSuperCharge(this.audioContext,this.masterGain)}playSplitterCharge(){l.settings?.muteSound||!this.initialized||x.playSplitterCharge(this.audioContext,this.masterGain)}playZigZagCharge(){l.settings?.muteSound||!this.initialized||x.playZigZagCharge(this.audioContext,this.masterGain)}playStopCharge(){l.settings?.muteSound||!this.initialized||x.playStopCharge(this.audioContext,this.masterGain)}stopTheme(){if(this.themePlaying=!1,this.themeTimer&&(clearTimeout(this.themeTimer),this.themeTimer=null),this.themeGain){const t=this.audioContext.currentTime;this.themeGain.gain.cancelScheduledValues(t),this.themeGain.gain.setValueAtTime(this.themeGain.gain.value,t),this.themeGain.gain.linearRampToValueAtTime(0,t+.05),setTimeout(()=>{!this.themePlaying&&this.themeGain&&(this.themeGain.disconnect(),this.themeGain=null)},100)}}playEvilLaugh(){l.settings?.muteSound||!this.initialized||x.playEvilLaugh(this.audioContext,this.masterGain)}playGhostCharge(){l.settings?.muteSound||!this.initialized||x.playGhostCharge(this.audioContext,this.masterGain)}playThud(){l.settings?.muteSound||!this.initialized||x.playThud(this.audioContext,this.masterGain)}playNormalStep(){l.settings?.muteSound||!this.initialized||(this.noiseBuffer||this._createNoiseBuffer(),x.playNormalStep(this.audioContext,this.masterGain,this.noiseBuffer))}playRoar(){l.settings?.muteSound||!this.initialized||(this.noiseBuffer||this._createNoiseBuffer(),x.playRoar(this.audioContext,this.masterGain,this.noiseBuffer))}playBatBreak(){l.settings?.muteSound||!this.initialized||x.playBatBreak(this.audioContext,this.masterGain)}playFirework(){l.settings?.muteSound||!this.initialized||(this.noiseBuffer||this._createNoiseBuffer(),x.playFirework(this.audioContext,this.masterGain,this.noiseBuffer))}playSettingsOpen(){l.settings?.muteSound||!this.initialized||x.playSettingsOpen(this.audioContext,this.masterGain)}playSettingsClose(){l.settings?.muteSound||!this.initialized||x.playSettingsClose(this.audioContext,this.masterGain)}playSettingsToggle(){l.settings?.muteSound||!this.initialized||x.playSettingsToggle(this.audioContext,this.masterGain)}playUnlockablesOpen(){l.settings?.muteSound||!this.initialized||x.playUnlockablesOpen(this.audioContext,this.masterGain)}playUnlockablesClose(){l.settings?.muteSound||!this.initialized||x.playUnlockablesClose(this.audioContext,this.masterGain)}playItemAlreadyEquipped(){l.settings?.muteSound||!this.initialized||(this.audioContext.state==="suspended"&&this.audioContext.resume(),x.playItemAlreadyEquipped(this.audioContext,this.masterGain))}playEquip(){if(l.settings?.muteSound||!this.audioContext&&!this.initialized)return;const t=this.audioContext;t&&t.state==="suspended"&&t.resume(),t&&x.playEquip(t,this.masterGain)}playZigZag(){l.settings?.muteSound||!this.initialized||x.playZigZag(this.audioContext,this.masterGain)}playPurchase(){l.settings?.muteSound||!this.initialized||x.playPurchase(this.audioContext,this.masterGain)}playError(){l.settings?.muteSound||!this.initialized||x.playError(this.audioContext,this.masterGain)}playThunder(t=1){l.settings?.muteSound||!this.initialized||(this.noiseBuffer||this._createNoiseBuffer(),x.playThunder(this.audioContext,this.masterGain,this.noiseBuffer,t))}playFanfare(){l.settings?.muteSound||!this.initialized||x.playFanfare(this.audioContext,this.masterGain)}playCheer(){l.settings?.muteSound||!this.initialized||(this.noiseBuffer||this._createNoiseBuffer(),x.playCheer(this.audioContext,this.masterGain,this.noiseBuffer))}playLightStep(){l.settings?.muteSound||!this.initialized||x.playLightStep(this.audioContext,this.masterGain)}playAceStep(){l.settings?.muteSound||!this.initialized||(this.noiseBuffer||this._createNoiseBuffer(),x.playAceStep(this.audioContext,this.masterGain,this.noiseBuffer))}playAceEntrance(){l.settings?.muteSound||!this.initialized||x.playAceEntrance(this.audioContext,this.masterGain)}playWoosh(){l.settings?.muteSound||!this.initialized||(this.noiseBuffer||this._createNoiseBuffer(),x.playWoosh(this.audioContext,this.masterGain,this.noiseBuffer))}playDigitalEntrance(){l.settings?.muteSound||!this.initialized||x.playDigitalEntrance(this.audioContext,this.masterGain)}playTheme(){l.settings?.muteMusic||!this.initialized||this.themePlaying||(this.themePlaying=!0,this.themeGain&&this.themeGain.disconnect(),this.themeGain=this.audioContext.createGain(),this.themeGain.gain.value=1,this.themeGain.connect(this.masterGain),this.noiseBuffer||this._createNoiseBuffer(),this.themeTimer=x.playTheme(this.audioContext,this.themeGain,this.noiseBuffer))}playHauntedTheme(){l.settings?.muteMusic||!this.initialized||this.themePlaying||(this.themePlaying=!0,this.themeGain&&this.themeGain.disconnect(),this.themeGain=this.audioContext.createGain(),this.themeGain.gain.value=.8,this.themeGain.connect(this.masterGain),this.noiseBuffer||this._createNoiseBuffer(),this.themeTimer=x.playHauntedTheme(this.audioContext,this.themeGain,this.noiseBuffer))}playIntroSlam(){l.settings?.muteSound||!this.initialized||x.playIntroSlam(this.audioContext,this.masterGain)}playIntroReveal(){l.settings?.muteSound||!this.initialized||x.playIntroReveal(this.audioContext,this.masterGain)}playIntroImpact(){l.settings?.muteSound||!this.initialized||x.playIntroImpact(this.audioContext,this.masterGain)}}const G=new Hs,sn={[F.STOPBALL]:(e,t)=>{const a=l.bat.pivotY-e.startY,o=(e.y-e.startY)/a;return!e.hasPaused&&o>=.5&&(e.hasPaused=!0,e.pauseTimer=400),e.pauseTimer>0?(e.pauseTimer-=t,e.prevX=e.x,e.prevY=e.y,e.prevRotationAngle=e.rotationAngle,!0):!1},[F.GHOSTBALL]:(e,t)=>{const a=l.bat.pivotY-e.startY,o=(e.y-e.startY)/a;return o>.4&&o<.7?e.invisible=!0:e.invisible=!1,!1},[F.STOP_CURVE]:(e,t)=>{const a=l.bat.pivotY-e.startY,i=e.y-e.startY,o=i/a;if(!e.hasPaused&&o>=.5&&(e.hasPaused=!0,e.pauseTimer=400),e.pauseTimer>0)return e.pauseTimer-=t,e.prevX=e.x,e.prevY=e.y,e.prevRotationAngle=e.rotationAngle,!0;const n=Math.max(0,Math.min(1,i/a));let s=0;if(n<.75){const r=n/.75*Math.PI;s=Math.sin(r)*50,s=s*e.curveDirection}return e.x=e.startX+s,!1},[F.GHOST_CURVE]:(e,t)=>{const a=l.bat.pivotY-e.startY,i=e.y-e.startY,o=i/a;o>.4&&o<.7?e.invisible=!0:e.invisible=!1;const n=Math.max(0,Math.min(1,i/a));let s=0;if(n<.75){const r=n/.75*Math.PI;s=Math.sin(r)*50,s=s*e.curveDirection}return e.x=e.startX+s,!1},[F.SPLITTER]:(e,t)=>{const a=l.bat.pivotY-e.startY;return(e.y-e.startY)/a>.2?e.speedY=e.baseSpeedY*2.6:e.speedY=e.baseSpeedY*.6,!1},[F.CURVEBALL]:(e,t)=>{const a=l.bat.pivotY-e.startY,i=e.y-e.startY,o=Math.max(0,Math.min(1,i/a));let n=0;if(o<.75){const s=o/.75*Math.PI;n=Math.sin(s)*50,n=n*e.curveDirection}return e.x=e.startX+n,!1},[F.ZIGZAG]:(e,t)=>{const a=l.bat.pivotY-e.startY,i=e.y-e.startY,o=Math.max(0,Math.min(1,i/a));let n=0;return o<.25?n=o/.25*75:o<.5?n=75-(o-.25)/.25*150:o<.75?n=-75+(o-.5)/.25*75:n=0,e.x=e.startX+n*e.curveDirection,!1},[F.SUPER_CURVE]:(e,t)=>{const a=l.bat.pivotY-e.startY,i=e.y-e.startY,o=Math.max(0,Math.min(1,i/a));let n=0;if(o<.75){const s=o/.75*Math.PI;n=Math.sin(s)*75,n=n*e.curveDirection}return e.x=e.startX+n,!1},[F.SUPER_ZIGZAG]:(e,t)=>{const a=l.bat.pivotY-e.startY,i=e.y-e.startY,o=Math.max(0,Math.min(1,i/a));let n=0;return o<.25?n=o/.25*75:o<.5?n=75-(o-.25)/.25*150:o<.75?n=-75+(o-.5)/.25*75:n=0,e.x=e.startX+n*e.curveDirection,!1},[F.SUPER_SPLITTER]:(e,t)=>{const a=l.bat.pivotY-e.startY;return(e.y-e.startY)/a>.2?e.speedY=e.baseSpeedY*2.6:e.speedY=e.baseSpeedY*.6,!1},[F.STOP_SPLITTER]:(e,t)=>{const a=l.bat.pivotY-e.startY,o=(e.y-e.startY)/a;return!e.hasPaused&&o>=.5&&(e.hasPaused=!0,e.pauseTimer=400),e.pauseTimer>0?(e.pauseTimer-=t,e.prevX=e.x,e.prevY=e.y,e.prevRotationAngle=e.rotationAngle,!0):(o>.2?e.speedY=e.baseSpeedY*2.6:e.speedY=e.baseSpeedY*.6,!1)},[F.STOP_ZIGZAG]:(e,t)=>{const a=l.bat.pivotY-e.startY,i=e.y-e.startY,o=Math.max(0,Math.min(1,i/a));if(!e.hasPaused&&o>=.5&&(e.hasPaused=!0,e.pauseTimer=400),e.pauseTimer>0)return e.pauseTimer-=t,e.prevX=e.x,e.prevY=e.y,e.prevRotationAngle=e.rotationAngle,!0;let n=0;o<.25?n=o/.25*75:o<.5?n=75-(o-.25)/.25*150:o<.75?n=-75+(o-.5)/.25*75:n=0,e.x=e.startX+n*e.curveDirection},[F.GHOST_SPLITTER]:(e,t)=>{const a=l.bat.pivotY-e.startY,o=(e.y-e.startY)/a;return o>.4&&o<.7?e.invisible=!0:e.invisible=!1,o>.2?e.speedY=e.baseSpeedY*2.6:e.speedY=e.baseSpeedY*.6,!1},[F.GHOST_ZIGZAG]:(e,t)=>{const a=l.bat.pivotY-e.startY,i=e.y-e.startY,o=Math.max(0,Math.min(1,i/a));o>.4&&o<.7?e.invisible=!0:e.invisible=!1;let n=0;return o<.25?n=o/.25*75:o<.5?n=75-(o-.25)/.25*150:o<.75?n=-75+(o-.5)/.25*75:n=0,e.x=e.startX+n*e.curveDirection,!1},[F.GHOST_CHANGEUP]:(e,t)=>{const a=l.bat.pivotY-e.startY,o=(e.y-e.startY)/a;return o>.4&&o<.7?e.invisible=!0:e.invisible=!1,!1},[F.CURVE_SPLITTER]:(e,t)=>{const a=l.bat.pivotY-e.startY,i=e.y-e.startY,o=Math.max(0,Math.min(1,i/a));let n=0;if(o<.75){const s=o/.75*Math.PI;n=Math.sin(s)*50,n=n*e.curveDirection}return e.x=e.startX+n,o>.2?e.speedY=e.baseSpeedY*2.6:e.speedY=e.baseSpeedY*.6,!1},[F.ZIGZAG_SPLITTER]:(e,t)=>{const a=l.bat.pivotY-e.startY,i=e.y-e.startY,o=Math.max(0,Math.min(1,i/a));let n=0;return o<.25?n=o/.25*75:o<.5?n=75-(o-.25)/.25*150:o<.75?n=-75+(o-.5)/.25*75:n=0,e.x=e.startX+n*e.curveDirection,o>.2?e.speedY=e.baseSpeedY*2.6:e.speedY=e.baseSpeedY*.6,!1},[F.CURVE_CHANGEUP]:(e,t)=>{const a=l.bat.pivotY-e.startY,i=e.y-e.startY,o=Math.max(0,Math.min(1,i/a));let n=0;if(o<.75){const s=o/.75*Math.PI;n=Math.sin(s)*50,n=n*e.curveDirection}return e.x=e.startX+n,!1},[F.SPLITTER_CHANGEUP]:(e,t)=>{const a=l.bat.pivotY-e.startY;return(e.y-e.startY)/a>.2?e.speedY=e.baseSpeedY*2.5:e.speedY=e.baseSpeedY*.6,!1},[F.ZIGZAG_CHANGEUP]:(e,t)=>{const a=l.bat.pivotY-e.startY,i=e.y-e.startY,o=Math.max(0,Math.min(1,i/a));let n=0;return o<.25?n=o/.25*75:o<.5?n=75-(o-.25)/.25*150:o<.75?n=-75+(o-.5)/.25*75:n=0,e.x=e.startX+n*e.curveDirection,!1},[F.GHOST_STOP]:(e,t)=>{const a=l.bat.pivotY-e.startY,i=e.y-e.startY,o=Math.max(0,Math.min(1,i/a));return o>.4&&o<.7?e.invisible=!0:e.invisible=!1,!e.hasPaused&&o>=.5&&(e.hasPaused=!0,e.pauseTimer=400),e.pauseTimer>0?(e.pauseTimer-=t,e.prevX=e.x,e.prevY=e.y,e.prevRotationAngle=e.rotationAngle,!0):!1},[F.GHOST_SUPER]:(e,t)=>{const a=l.bat.pivotY-e.startY,i=e.y-e.startY,o=Math.max(0,Math.min(1,i/a));return o>.4&&o<.7?e.invisible=!0:e.invisible=!1,!1},[F.STOP_SUPER]:(e,t)=>{const a=l.bat.pivotY-e.startY,i=e.y-e.startY,o=Math.max(0,Math.min(1,i/a));return!e.hasPaused&&o>=.5&&(e.hasPaused=!0,e.pauseTimer=400),e.pauseTimer>0?(e.pauseTimer-=t,e.prevX=e.x,e.prevY=e.y,e.prevRotationAngle=e.rotationAngle,!0):!1},[F.STOP_CHANGEUP]:(e,t)=>{const a=l.bat.pivotY-e.startY,i=e.y-e.startY,o=Math.max(0,Math.min(1,i/a));return!e.hasPaused&&o>=.5&&(e.hasPaused=!0,e.pauseTimer=400),e.pauseTimer>0?(e.pauseTimer-=t,e.prevX=e.x,e.prevY=e.y,e.prevRotationAngle=e.rotationAngle,!0):!1}};let xa=null,ln=0;function Us(e){const i=Math.ceil(140*e),o=Math.ceil(180*e);let n;typeof OffscreenCanvas<"u"?n=new OffscreenCanvas(i,o):(n=document.createElement("canvas"),n.width=i,n.height=o);const s=n.getContext("2d");s.translate(i/2,40*e),s.scale(e,e);const r="#1a1d23",d="#2c3036";s.fillStyle=r,s.fillRect(-80/2,0,80,120),s.fillStyle="#111",s.fillRect(-25,10,8,100),s.fillRect(17,10,8,100),s.fillRect(-4,15,8,90),s.fillStyle=d,s.fillRect(-80/2-10,100,100,20),s.beginPath(),s.moveTo(-80/2-15,0),s.lineTo(80/2+15,0),s.lineTo(80/2+5,25),s.lineTo(-80/2-5,25),s.fill();const f=-5;s.fillStyle="#0a0a0a",s.beginPath(),s.arc(0,f,35,0,Math.PI,!1),s.fill(),s.strokeStyle="#000",s.lineWidth=4,s.beginPath(),s.moveTo(-35,f),s.lineTo(-45,f-40),s.moveTo(35,f),s.lineTo(45,f-40),s.stroke(),s.save();const c=g=>{let u=g+=1831565813;return u=Math.imul(u^u>>>15,u|1),u^=u+Math.imul(u^u>>>7,u|61),((u^u>>>14)>>>0)/4294967296};s.fillStyle="rgba(0,0,0,0.15)";const p=150,h=-80/2,m=0;for(let g=0;g<p;g++){const u=h+c(g*11)*80,T=m+c(g*33)*120,b=c(g*55)*3+1;s.fillRect(u,T,b,b)}return s.fillStyle="rgba(0,0,0,0.3)",s.fillRect(-26,10,2,100),s.fillRect(16,10,2,100),s.restore(),n}function $n(e,t,a,i=1,o=!1,n=0,s=!1){(!xa||ln!==i)&&(xa=Us(i),ln=i);const r=xa.width;xa.height,e.drawImage(xa,t-r/2,a-40*i);const d=l.isGameOver&&!s,f=n,m=(d?"RED":"CYAN")==="RED"?{core:"#fbe9e7",mid:"#ff7043",outer:"#b71c1c",glow:"rgba(255, 87, 34, 0.4)",text:"#3e2723"}:{core:"#e0f7fa",mid:"#4dd0e1",outer:"#006064",text:"#006064"};e.save(),e.translate(t,a),e.scale(i,i);const u=-5-60,T=Date.now()/1e3,b=Math.sin(T*3)*.1+1;e.save(),e.shadowColor=m.mid,e.shadowBlur=80*b,e.fillStyle="rgba(0,0,0,0)",e.beginPath(),e.arc(0,u,60,0,Math.PI*2),e.fill(),e.restore();const y=(P,w,D,k,I)=>{e.save(),e.globalAlpha=I*.6,e.fillStyle=D,e.beginPath();const _=40*P,H=Math.sin(T*10)*3*w,M=u-75*w+H;e.moveTo(-_,u+30);const L=(Math.sin(T*k)*10+Math.cos(T*k*1.5)*5)*P;e.quadraticCurveTo(-_*1.2+Math.cos(T*2)*8,u,L,M),e.quadraticCurveTo(_*1.2+Math.sin(T*2.3)*8,u,_,u+30),e.shadowColor=D,e.shadowBlur=20,e.fill(),e.restore()};y(1.3,1.1,m.outer,1.5,.3),y(1,1,m.mid,2.5,.4),y(.6,.85,m.core,4,.5),e.save(),e.fillStyle=m.core,e.shadowColor="#fff",e.shadowBlur=10;for(let P=0;P<8;P++){const w=P*13,D=40+w%40,k=w%60-30,I=120,_=(T*D+w*100)%I,H=u+20-_,M=k+Math.sin(T*5+w)*5,L=1-_/I;if(L>0){e.globalAlpha=L;const z=1+w%2;e.fillRect(M,H,z,z)}}e.restore(),e.textAlign="center";let S="HIGH SCORE",A="#90a4ae",v=m.text;l.isDailyChallenge&&(S="DAILY BEST",A="#ffea00",v="#ffea00"),e.font='10px "PressStart2PLocal"',e.fillStyle=A,e.fillText(S,0,60),e.font='32px "PressStart2PLocal"',e.fillStyle=v,e.fillText(f,0,u+20),e.restore()}let da=null,rn=0,cn=0,dn=null;function Vs(e,t,a,i=null){if(!da||t!==rn||a!==cn||i!==dn){rn=t,cn=a,dn=i;const h=a/t>1.2,m=Math.min(t,a)*(h?.08:.1),g=Math.ceil(m*8+20);typeof OffscreenCanvas<"u"?da=new OffscreenCanvas(g,g):(da=document.createElement("canvas"),da.width=g,da.height=g);const u=da.getContext("2d"),T=g/2,b=g/2,y=i||"#ffffe0",S=u.createRadialGradient(T,b,m,T,b,m*4);i?(S.addColorStop(0,"rgba(255, 0, 0, 0.4)"),S.addColorStop(.5,"rgba(100, 0, 0, 0.1)")):(S.addColorStop(0,"rgba(255, 255, 230, 0.4)"),S.addColorStop(.5,"rgba(200, 200, 255, 0.1)")),S.addColorStop(1,"rgba(0, 0, 0, 0)"),u.fillStyle=S,u.beginPath(),u.arc(T,b,m*4,0,Math.PI*2),u.fill(),u.fillStyle=y,u.shadowColor=y,u.shadowBlur=20,u.beginPath(),u.arc(T,b,m,0,Math.PI*2),u.fill(),u.shadowBlur=0,u.fillStyle=i?"rgba(50, 0, 0, 0.3)":"rgba(200, 200, 210, 0.5)";const A=(v,P,w)=>{u.beginPath(),u.arc(v,P,w,0,Math.PI*2),u.fill()};A(T-m*.3,b-m*.2,m*.2),A(T+m*.4,b+m*.3,m*.15)}const n=t*.85,s=a/t>1.2,r=s?45:a*.1,d=Math.min(t,a)*(s?.08:.1),f=Math.ceil(d*8+20),c=n-f/2,p=r-f/2;e.drawImage(da,c,p)}function Yn(e,t,a,i=!1){const o=e.createLinearGradient(0,0,0,a);o.addColorStop(0,"#0a0520"),o.addColorStop(.5,"#1a0f35"),o.addColorStop(1,"#151020"),e.fillStyle=o,e.fillRect(0,0,t,a);const n=l.isGameOver?"#ff4444":null;Vs(e,t,a,n),(pt.length===0||t>Ni+50)&&Xn(t,a,!0),e.save();for(let s=0;s<pt.length;s++){const r=pt[s];r.isDynamic||(e.globalAlpha=r.baseAlpha,e.fillStyle=r.color,e.fillRect(r.x,r.y,r.size,r.size))}e.restore()}let fa=null,ha=null,fn=0,hn=0,un=0,Ga={flash1:!1,flash2:!1};function zs(e,t,a){let i=0;const o=V.consecutivePerfectHits>=1&&l.perfectHitTimer>0;if(o){const g=l.perfectHitTimer;g>1300?(i=1,Ga.flash1||(G.playThunder(.3),Ga.flash1=!0)):g>850&&g<1e3&&(i=.8,Ga.flash2||(G.playThunder(.15),Ga.flash2=!0))}else Ga.flash1=!1,Ga.flash2=!1;e.save(),i>.5&&(e.globalCompositeOperation="screen",e.fillStyle=`rgba(180, 220, 255, ${.4*i})`,e.fillRect(0,0,t,a),e.globalCompositeOperation="source-over",e.strokeStyle=`rgba(255, 255, 255, ${i})`,e.lineWidth=3,e.lineCap="round",e.lineJoin="round",(i>.9?0:1)===0?(e.beginPath(),e.moveTo(t*.5,0),e.lineTo(t*.48,a*.15),e.lineTo(t*.52,a*.3),e.lineTo(t*.5,a*.5),e.stroke()):(e.beginPath(),e.moveTo(t*.7,0),e.lineTo(t*.68,a*.2),e.lineTo(t*.72,a*.35),e.lineTo(t*.7,a*.5),e.stroke()));const n=4096,s=2160,r=Math.floor(Math.min(t,n)),d=Math.floor(Math.min(a,s)),f=r!==fn||d!==hn,c=Date.now(),p=f&&c-un<200;if(!fa||!ha||f&&!p){t>n&&console.warn(`[HauntedRenderer] Clamping Storm Cache Width: ${t} -> ${n}`),console.log(`[HauntedRenderer] Storm Cache UPDATE: ${r}x${d}`),typeof OffscreenCanvas<"u"?(fa=new OffscreenCanvas(r,d),ha=new OffscreenCanvas(r,d)):(fa=document.createElement("canvas"),fa.width=r,fa.height=d,ha=document.createElement("canvas"),ha.width=r,ha.height=d);const g=fa.getContext("2d"),u=ha.getContext("2d");di(g,r,d,0,"FULL"),di(u,r,d,1,"WINDOWS_ONLY"),fn=r,hn=d,un=c}const m=Date.now()/1e3;e.save();for(let g=0;g<pt.length;g++){const u=pt[g];if(u.isDynamic){const b=.7+Math.sin(m*u.speed+u.phase)*.3;e.globalAlpha=u.baseAlpha*b,e.fillStyle=u.color,e.fillRect(u.x,u.y,u.size,u.size)}}if(e.restore(),e.drawImage(fa,0,0,t,a),o){const g=Date.now(),T=.5+(Math.sin(g*.008)+1)/4;e.globalAlpha=T,e.globalCompositeOperation="screen",e.drawImage(ha,0,0,t,a),e.globalCompositeOperation="source-over",e.globalAlpha=1}e.restore()}function Ue(e){const t=Math.sin(e)*1e4;return t-Math.floor(t)}const pt=[];let ta=null,Ni=0,qn=0;function Xn(e,t,a=!1){if(!a&&pt.length>0)return;a&&(pt.length=0,ta=null);const i=150/600,o=Math.ceil(e*i);for(let n=0;n<o;n++){const s=Math.random()>.9;pt.push({x:Math.random()*e,y:Math.random()*t*.7,size:s?2:1,baseAlpha:.3+Math.random()*.7,phase:Math.random()*Math.PI*2,speed:.5+Math.random()*1.5,color:Math.random()>.8?"#a0c0ff":Math.random()>.8?"#fffacd":"#ffffff",isDynamic:s})}Ni=e,qn=t}function Ws(e,t,a,i){if((pt.length===0||t>Ni+50)&&Xn(t,a,!0),!ta||t!==Ni||a!==qn){typeof OffscreenCanvas<"u"?ta=new OffscreenCanvas(t,a):(ta=document.createElement("canvas"),ta.width=t,ta.height=a);const o=ta.getContext("2d");o.clearRect(0,0,t,a);for(let n=0;n<pt.length;n++){const s=pt[n];s.isDynamic||(o.globalAlpha=s.baseAlpha,o.fillStyle=s.color,o.fillRect(s.x,s.y,s.size,s.size))}}e.drawImage(ta,0,0),e.save();for(let o=0;o<pt.length;o++){const n=pt[o];if(n.isDynamic){const r=.7+Math.sin(i*n.speed+n.phase)*.3;e.globalAlpha=n.baseAlpha*r,e.fillStyle=n.color,e.fillRect(n.x,n.y,n.size,n.size)}}e.restore()}const Ns=(e,t,a,i,o,n,s)=>{const r=c=>{const p=Math.sin(c)*1e4;return p-Math.floor(p)};e.lineWidth=n,e.strokeStyle="#0a0f14",e.lineCap="square",e.lineJoin="bevel",e.beginPath(),e.moveTo(t,a);const d=(t+i)/2+(r(s)-.5)*10,f=(a+o)/2+(r(s+1)-.5)*10;e.lineTo(d,f),e.lineTo(i,o),e.stroke()};class pn{constructor(t){this.m=2147483648,this.a=1103515245,this.c=12345,this.state=t||Math.floor(Math.random()*(this.m-1))}nextInt(){return this.state=(this.a*this.state+this.c)%this.m,this.state}nextFloat(){return this.nextInt()/(this.m-1)}range(t,a){return t+this.nextFloat()*(a-t)}}const ao=new Map,$s=(e,t,a)=>`${e}-${t?"d":"l"}-${a.toFixed(1)}`,Ys=(e,t,a,i,o,n,s=!1,r=1)=>{const d=b=>{const y=Math.sin(b)*1e4;return y-Math.floor(y)},f=b=>d(b),c=i*.5;e.save(),e.globalAlpha=r;const p=(b,y,S,A)=>{e.save();const v=3+Math.floor(f(A)*3);for(let P=0;P<v;P++){const w=(f(A+P)-.5)*S*1.8,D=(f(A+P*2)-.5)*S*1.2,k=S*(.4+f(A+P*3)*.3);e.beginPath(),e.arc(b+w,y+D,k,0,Math.PI*2);const I=f(A+P*4);I>.8?e.fillStyle="#1b262c":I<.4?e.fillStyle="#05070a":e.fillStyle="#0f171a",e.fill()}e.restore()},h=(b,y,S,A,v,P,w)=>{if(A<2||P>6){if(!s&&P>2){const M=Math.max(1,15*c*Math.max(.5,6-P));p(b,y,M,w)}return}let D=b+Math.cos(S)*A,k=y+Math.sin(S)*A;Ns(e,b,y,D,k,v*.8,w),!s&&P>3&&f(w*99)>.7&&p(b,y,10*c,w+10);const I=w*13.1,_=w*17.5,H=1-P*.05;if(f(I)<H){if(h(D,k,S+(f(I)-.5)*.8,A*.7,v*.6,P+1,I+1),f(_)>.3){const M=f(_)>.5?1:-1;h(D,k,S+.6*M,A*.5,v*.5,P+1,_+2)}}else h(D,k,S+(f(I)-.5)*.4,A*.8,v*.7,P+1,I+1)},m=(s?15:25)*c,g=(s?220:180)*c;e.fillStyle="rgba(0,0,0,0.5)",e.beginPath(),e.ellipse(t,a+2,m*1.5,6,0,0,Math.PI*2),e.fill();const u=e.createLinearGradient(t-m,0,t+m,0);u.addColorStop(0,"#020305"),u.addColorStop(.4,"#1b262c"),u.addColorStop(1,"#000000"),e.fillStyle=u,e.beginPath(),e.moveTo(t-m,a+5),e.quadraticCurveTo(t-m*.2,a-g*.5,t-m*.4,a-g),e.lineTo(t+m*.4,a-g),e.quadraticCurveTo(t+m*.2,a-g*.5,t+m,a+5),e.closePath(),e.fill();const T=(s?140:120)*c;h(t,a-g,-Math.PI/2+o*.1,T,8*c,0,n),f(n)>.5&&h(t,a-g*.6,-Math.PI/2+o*.8,T*.7,6*c,0,n+50),e.restore()},Zn=(e,t,a,i)=>{const o=$s(e,t,i);if(ao.has(o))return ao.get(o);const n=100*i,s=300*i+n,r=400*i+n,d=document.createElement("canvas");d.width=Math.ceil(s),d.height=Math.ceil(r);const f=d.getContext("2d");return Ys(f,s/2,r-50*i,i,a,e,t,1),ao.set(o,d),d};function gn(e,t,a){e.shadowBlur=0;const{cx:i,baseY:o,scaleX:n,wingsPerSide:s}=qa(t,a),r=(p,h,m,g,u,T)=>{const b=Zn(u,T,g,m),y=b.width/2,S=b.height-50*m;e.drawImage(b,p-y,h-S)},d=(60+s*90)*n,f=d+20*n,c=d+120*n;r(i-f,o+20,.7,.2,1e3,!1),r(i-c,o+10,.5,.1,1050,!0),r(i+f,o+20,.7,-.2,2e3,!1),r(i+(c+40*n),o+15,.6,-.1,2050,!0)}let io=null,oo={w:0,h:0};function qs(e,t){const a=[],{cx:i,baseY:o,scaleX:n,horizonY:s,wingsPerSide:r}=qa(e,t),d=10,f=s+180,c=t,p=new pn(12345),h=t*.85,g=70/1.8,u=1.5*g,T=i-g,b=h-u,y=i+g,S=h-u,A=(P,w,D,k,I)=>{const _=I<0?1.5:-1.5,H=_,M=-1,L=k-_*D;return Math.abs(H*P+M*w+L)/Math.sqrt(H*H+M*M)};let v=0;for(;a.length<d&&v<600;){v++;let P=p.nextFloat()*e,w=f+p.nextFloat()*(c-f);const k=55+(w-s)/(c-s)*50,I=A(P,w,T,b,-1),_=A(P,w,y,S,1);if(I<k||_<k||Math.abs(P-i)<60)continue;const H=45,M=(60+r*90)*n,L=240*n,ne=Math.min(M,L)+H;if(Math.abs(P-i)<ne)continue;const W=a.length,X=777+W*1337,K=new pn(X).nextFloat()>.4,oe=.5+(w-s)/(t-s)*.5,J=P<i?.4:-.4;a.push({x:P,y:w,scale:oe,lean:J,isDead:K,id:W})}return a.sort((P,w)=>P.y-w.y),a}let mn=0,yn=0,Mi=0;function Xs(e,t,a){const{horizonY:i}=qa(t,a),o=Date.now();Mi===0&&(Mi=o);const n=(o-Mi)/1e3;Mi=o,l.isPaused||(yn+=n);const s=yn,d=t*.15+Math.sin(s*.25)*30;no(e,d,i+(a-i)*.3,1.2,s);const c=t*.85+Math.sin(s*.3+2)*25;no(e,c,i+(a-i)*.4,1.3,s+1);const h=t*.25+Math.cos(s*.2+1)*40;no(e,h,i+(a-i)*.6,1.8,s+2)}function Kn(e,t,a,i){const o=Date.now(),n=oo.w!==t||oo.h!==a;(!io||n&&o-mn>200)&&(io=qs(t,a),oo={w:t,h:a},mn=o),io.forEach(r=>{const f=Zn(5e3+r.id,r.isDead,r.lean,r.scale);e.save(),e.globalAlpha=1;const c=f.width/2,p=f.height-50*r.scale;e.drawImage(f,r.x-c,r.y-p),e.restore()})}const Sn=(e,t,a,i,o,n)=>{e.save();const s=Math.abs(i-t),r=Math.sign(i-t),f=Math.ceil(s/100),c=s/f,p=20,h=o+15,m="#2d3436",g="#636e72",u="#15181c",T="#050505",b=100;for(let v=0;v<f;v++){if(v>=b){console.warn("[HauntedRenderer] Max Fence Sections Reached. Stopping generation.");break}const P=t+v*c*r,w=t+(v+1)*c*r,D=P,k=Math.min(D,w)+p/2,_=Math.max(D,w)-p/2-k;if(_>0){e.fillStyle=T;const W=a-o*.85,X=a-o*.15;e.fillRect(k,W,_,6),e.fillRect(k,X,_,6);const N=16,K=Math.floor(_/N),pe=k+(_-K*N)/2;for(let oe=0;oe<=K;oe++){const J=pe+oe*N,ye=a-o;e.fillRect(J-2,ye,4,o);const Pe=ye;e.beginPath(),e.moveTo(J,Pe-15),e.lineTo(J+5,Pe),e.lineTo(J-5,Pe),e.fill(),e.beginPath(),e.arc(J,Pe+5,3,0,Math.PI*2),e.fill(),oe%2===0&&(e.beginPath(),e.arc(J,a-o*.5,5,0,Math.PI*2),e.fill())}}e.fillStyle=u,e.fillRect(D-p/2,a-h,p,h),e.fillStyle=m,e.fillRect(D-p/2+2,a-h,p-2,h),e.fillStyle=u;const H=14;for(let W=a-h+10;W<a-5;W+=H)e.fillRect(D-p/2+2,W,p-2,1),e.fillStyle="rgba(255,255,255,0.1)",e.fillRect(D-p/2+2,W+1,p-2,1),e.fillStyle=u;for(let W=0;W<8;W++){const X=D-p/2+3+Math.abs(Math.sin(P+W)*(p-6)),N=a-h+Math.abs(Math.cos(P*W)*h);e.fillStyle=W%2===0?"#111":"#555",e.fillRect(X,N,1,1)}const M=6,L=10,z=a-h;e.fillStyle=g,e.beginPath(),e.moveTo(D-p/2-M,z+L),e.lineTo(D+p/2+M,z+L),e.lineTo(D+p/2+M-2,z),e.lineTo(D-p/2-M+2,z),e.fill(),e.fillStyle="rgba(255,255,255,0.2)",e.fillRect(D-p/2-M+3,z,p+M*2-6,2);for(let W=0;W<5;W++){const X=D*.13+W*5.7,N=Math.abs(Math.sin(X)),K=Math.abs(Math.cos(X*2.1)),pe=Math.abs(Math.sin(X*3.3)),oe=D-p/2-M+N*(p+M*2),J=z+K*L;e.fillStyle=pe>.5?"rgba(0,0,0,0.3)":"rgba(255,255,255,0.2)",e.fillRect(oe,J,1,1)}e.fillStyle=u,e.fillRect(D-p/2-2,a-10,p+4,10),Math.abs(Math.sin(P*.1+n))>.7&&(e.fillStyle="#111",e.fillRect(D-2,a-h+30,3,15))}const y=i,S=a-h;e.fillStyle=u,e.fillRect(y-p/2,a-h,p,h),e.fillStyle=m,e.fillRect(y-p/2+2,a-h,p-2,h),e.fillStyle=u;const A=14;for(let v=a-h+10;v<a-5;v+=A)e.fillRect(y-p/2+2,v,p-2,1),e.fillStyle="rgba(255,255,255,0.1)",e.fillRect(y-p/2+2,v+1,p-2,1),e.fillStyle=u;e.fillStyle=g,e.beginPath(),e.moveTo(y-p/2-4,S+10),e.lineTo(y+p/2+4,S+10),e.lineTo(y+p/2+2,S),e.lineTo(y-p/2-2,S),e.fill(),e.fillStyle="rgba(255,255,255,0.2)",e.fillRect(y-p/2,S,p,2);for(let v=0;v<5;v++){const P=y*.13+v*5.7,w=Math.abs(Math.sin(P)),D=Math.abs(Math.cos(P*2.1)),k=Math.abs(Math.sin(P*3.3)),I=y-p/2-4+w*(p+8),_=S+D*10;e.fillStyle=k>.5?"rgba(0,0,0,0.3)":"rgba(255,255,255,0.2)",e.fillRect(I,_,1,1)}e.restore()},Zs=(e,t,a,i,o)=>{e.save(),e.translate(t,a),e.scale(i,i),e.strokeStyle="#050505",e.lineWidth=1;const n=3+Math.floor(Math.abs(Math.sin(o)*3));for(let s=0;s<n;s++){const r=-Math.PI/2+Math.sin(o+s)*.5,d=5+Math.abs(Math.cos(o*s)*6);e.beginPath(),e.moveTo(0,0),e.quadraticCurveTo(Math.cos(r)*d*.5,Math.sin(r)*d*.5,Math.cos(r)*d,Math.sin(r)*d),e.stroke()}e.restore()};function di(e,t,a,i=0,o="FULL",n=0,s=null,r=null){const d=o!=="WINDOWS_ONLY",f=o!=="STRUCTURE_ONLY",{cx:c,baseY:p,scaleX:h,scaleY:m,wingsPerSide:g}=s||qa(t,a);e.save(),e.translate(c,p),e.scale(h,m);const u="#4a4e57",T="#1a1d23",b="#6c757d",y=6,S=4,A=i>.5,v=A?"#e0f7fa":"#feca57",P=(E,R,B,O)=>{const j=E,$=j-y,ee=R,te=R+O,se=ee-S,ce=te-S;e.beginPath(),e.moveTo(j,te),e.lineTo(j,ee),e.lineTo($,se),e.lineTo($,ce),e.closePath();const ie=e.createLinearGradient(j,0,$,0);ie.addColorStop(0,"#050508"),ie.addColorStop(1,"#000000"),e.fillStyle=ie,e.fill(),e.strokeStyle="#111",e.lineWidth=1,e.beginPath(),e.moveTo(j,ee),e.lineTo(j,te),e.stroke()},w=(E,R,B,O,j)=>{e.fillStyle=j,A&&j===v&&(e.shadowColor="#00e5ff",e.shadowBlur=40),e.fillRect(E,R,B,O),e.shadowBlur=0},D=(E,R,B,O)=>{for(let $=R;$>R-O;$-=6){const ee=25+Ue($)*5,te=`rgb(${ee}, ${ee}, ${ee+10})`;e.fillStyle=te,e.fillRect(E-B,$-6,B*2,6),e.fillStyle="rgba(0,0,0,0.4)",e.fillRect(E-B,$,B*2,1);const se=8,ce=Math.abs($)/6%2*(se/2);for(let ie=E-B+ce;ie<E+B;ie+=se){const Ce=Ue(ie*$);if(Ce>.96){e.fillStyle="#050505",e.fillRect(ie+1,$-6+1,se-2,5);continue}Ce>.75?(e.fillStyle="rgba(255,255,255,0.06)",e.fillRect(ie,$-6,se,5)):Ce<.2&&(e.fillStyle="rgba(0,0,0,0.3)",e.fillRect(ie,$-6,se,5)),e.fillStyle="rgba(0,0,0,0.5)",e.fillRect(ie+se-1,$-6,1,6)}}},k=(E,R,B,O,j=!1)=>{e.save(),e.beginPath(),e.rect(E,R,B,O),e.clip(),j||(e.fillStyle="#2c2c2c",e.fillRect(E,R,B,O));const $=10,ee=14;for(let te=R;te<R+O;te+=$){const se=Math.floor((te-R)/$)%2===1;let ce=E-(se?ee/2:0);for(;ce<E+B;){const ie=ee,Ce=Math.sin(ce*te)*1e4;let le;const fe=Ce-Math.floor(Ce);fe>.8?le="#5a5e68":fe>.4?le="#4a4e57":le="#3e4249",e.fillStyle="#636e72",e.fillRect(ce,te,ie-1,1),e.fillStyle=le,e.fillRect(ce,te+1,ie-1,$-3),e.fillStyle="#2d3436",e.fillRect(ce,te+$-2,ie-1,1),ce+=ie}}e.restore()},I=90,_=60,H=I+(g-1)*_,M=({x:E,y:R,w:B,h:O,arched:j,lit:$,phase:ee=0,ignoreStorm:te=!1})=>{if(e.save(),d&&(e.fillStyle="#05070a",j?(e.beginPath(),e.moveTo(E,R+O),e.lineTo(E+B,R+O),e.lineTo(E+B,R+O*.3),e.quadraticCurveTo(E+B/2,R-O*.1,E,R+O*.3),e.fill()):e.fillRect(E,R,B,O),e.strokeStyle="rgba(0,0,0,0.6)",e.lineWidth=2,e.beginPath(),j?(e.moveTo(E+B,R+O*.3),e.moveTo(E,R+O),e.lineTo(E,R+O*.3),e.quadraticCurveTo(E+B/2,R-O*.1,E+B,R+O*.3),e.stroke()):(e.beginPath(),e.moveTo(E+B,R),e.lineTo(E,R),e.lineTo(E,R+O),e.stroke())),f){const ce=E+2,ie=R+2,Ce=B-4,le=O-4;let fe=0;if(A&&!te)if($=!0,n>0){fe=(Math.sin(ee+n*.008)+1)/2;const be=Math.floor(40+215*fe),We=Math.floor(100+155*fe),Ze=255;e.fillStyle=`rgb(${be},${We},${Ze})`}else e.fillStyle="#e0f7fa";else if($)if(r)e.fillStyle=r,e.shadowColor=r,e.shadowBlur=20;else{const he=e.createRadialGradient(E+B/2,R+O/2,2,E+B/2,R+O/2,B);he.addColorStop(0,"#ffca28"),he.addColorStop(1,"#ff6f00"),e.fillStyle=he}else e.fillStyle="#15181c";$&&A&&!te?(e.shadowColor="#00e5ff",e.shadowBlur=20+30*fe):e.shadowBlur=0,e.beginPath(),j?(e.moveTo(ce,R+O-2),e.lineTo(ce+Ce,R+O-2),e.lineTo(ce+Ce,R+O*.3),e.quadraticCurveTo(E+B/2,R-O*.1+2,ce,R+O*.3),e.fill()):e.fillRect(ce,ie,Ce,le),e.shadowBlur=0}if(d&&(e.strokeStyle="#636e72",e.lineWidth=1,e.beginPath(),j?(e.moveTo(E+B,R+O*.3),e.quadraticCurveTo(E+B/2,R-O*.1,E,R+O*.3),e.lineTo(E,R+O)):(e.moveTo(E+B,R),e.lineTo(E,R),e.lineTo(E,R+O)),e.stroke(),e.strokeStyle="#000",e.beginPath(),j?(e.moveTo(E+B,R+O*.3),e.lineTo(E+B,R+O),e.lineTo(E,R+O)):(e.moveTo(E+B,R),e.lineTo(E+B,R+O),e.lineTo(E,R+O)),e.stroke()),d||f){e.save(),e.beginPath();const se=2,ce=E+se,ie=B-se*2;j?(e.moveTo(ce,R+O-se),e.lineTo(ce+ie,R+O-se),e.lineTo(ce+ie,R+O*.3),e.quadraticCurveTo(E+B/2,R-O*.1+se,ce,R+O*.3)):e.rect(ce,R+se,ie,O-se*2),e.clip(),e.strokeStyle="#000",e.lineWidth=1,e.beginPath(),e.moveTo(E+B/2,R),e.lineTo(E+B/2,R+O),e.moveTo(E,R+O/2),e.lineTo(E+B,R+O/2),e.stroke(),e.restore()}e.restore()},L=(E,R,B,O)=>{const $=B*.6;e.fillStyle=T,e.beginPath(),e.moveTo(E-B/2-8,R),e.lineTo(E+B/2+8,R),e.lineTo(E+$/2,R-O),e.lineTo(E-$/2,R-O),e.fill(),e.save(),e.clip(),D(E,R,B+16,O),e.restore();const ee=5,te=B+16,se=E-te/2;e.fillStyle="#1a1c21",e.fillRect(se,R,te,ee),e.fillStyle="#3e4249",e.fillRect(se,R,te,1),e.fillStyle="#08090a",e.fillRect(se,R+ee-1,te,1),e.fillStyle="#1a1c21",e.fillRect(E-$/2-2,R-O-2,$+4,3),e.fillStyle="#3e4249",e.fillRect(E-$/2-2,R-O-2,$+4,1),e.fillStyle="#050508",e.beginPath();const ce=E-$/2-2;e.moveTo(ce,R-O-2),e.lineTo(ce-y,R-O-2-S),e.lineTo(ce-y,R-O+1-S),e.lineTo(ce,R-O+1),e.fill(),e.strokeStyle="#0a0a0d",e.fillStyle="#0a0a0d",e.lineWidth=1.5,e.beginPath(),e.moveTo(E-$/2,R-O),e.lineTo(E+$/2,R-O),e.moveTo(E-$/2,R-O-5),e.lineTo(E+$/2,R-O-5),e.stroke();const ie=6;for(let fe=0;fe<=$;fe+=ie){const he=E-$/2+fe;e.beginPath(),e.moveTo(he,R-O),e.lineTo(he,R-O-10),e.stroke(),e.beginPath(),e.arc(he,R-O-11,1.5,0,Math.PI*2),e.fill()}e.fillStyle="#050508",e.beginPath();const Ce=E-B/2-8,le=E-$/2;e.moveTo(Ce,R),e.lineTo(Ce-y,R-S),e.lineTo(le-y,R-O-S),e.lineTo(le,R-O),e.closePath(),e.fill(),e.strokeStyle="#3e4249",e.lineWidth=1,e.beginPath(),e.moveTo(Ce,R),e.lineTo(le,R-O),e.stroke()},z=(E,R,B,O)=>{if(e.save(),d){e.fillStyle="rgba(0,0,0,0.5)",e.beginPath(),e.ellipse(E,R+2,B/2+4,3,0,0,Math.PI*2),e.fill(),w(E-B/2,R-O,B,O,u),k(E-B/2,R-O,B,O),e.fillStyle="#1a1d22",e.beginPath();const $=E-B/2;e.moveTo($,R-O),e.lineTo($-y,R-O-S),e.lineTo($-y,R-S),e.lineTo($,R),e.fill(),e.strokeStyle="#000",e.lineWidth=.5,e.stroke(),e.fillStyle=T,e.beginPath(),e.moveTo(E-B/2-4,R-O),e.lineTo(E+B/2+4,R-O),e.lineTo(E,R-O-12),e.fill(),e.fillStyle="rgba(0,0,0,0.4)",e.beginPath(),e.moveTo(E-B/2,R-O),e.lineTo(E+B/2,R-O),e.lineTo(E,R-O+4),e.fill(),e.save(),e.clip(),D(E,R-O,B+8,12),e.restore()}M({x:E-B/2+2,y:R-O+3,w:B-4,h:O-5,arched:!0,lit:!0}),e.restore()},ne=(E,R,B,O)=>{const $=E*(R?1:-1),ee=60;e.save(),e.translate($,0);const te=50,se=6,ie=ee-3*2,Ce=40,le=-te-se,fe=-ee/2;d&&(B&&!R&&P(fe,-te,ee,te),w(fe,-te,ee,te,u),k(fe,-te,ee,te),e.fillStyle="rgba(0,0,0,0.35)",e.fillRect(fe+4,-te,ee-4,6),w(fe-2,-te,ee+4,5,b));const he=ee+4,be=-he/2,We=-ie/2,Ze=le-Ce;if(d){if(B&&!R){P(be,le+se,he,se),e.fillStyle="#050508";const ve=be;e.beginPath(),e.moveTo(ve,le),e.lineTo(ve,le+se),e.lineTo(ve-y,le+se-S),e.lineTo(ve-y,le-S),e.closePath(),e.fill();const Bt=We;e.beginPath(),e.moveTo(Bt,le),e.lineTo(ve,le),e.lineTo(ve-y,le-S),e.lineTo(Bt-y,le-S),e.closePath(),e.fill()}w(be,le,he,se,b),e.fillStyle="rgba(255,255,255,0.4)",e.fillRect(be,le,he,1),e.fillStyle="rgba(0,0,0,0.6)",e.fillRect(be,le+se-1,he,1),e.fillStyle="#6a6e75",e.fillRect(be,le,he,2),B&&!R&&P(We,Ze,ie,Ce),w(We,Ze,ie,Ce,u),k(We,Ze,ie,Ce);{const ve=e.createLinearGradient(0,Ze,0,Ze+12);ve.addColorStop(0,"rgba(0,0,0,0.8)"),ve.addColorStop(1,"rgba(0,0,0,0.0)"),e.fillStyle=ve,e.fillRect(We+4,Ze,ie-4,12)}w(We-2,le-3,ie+4,4,b)}const Je=ie+8,wa=40,St=-Je/2,Ot=Ze-wa;if(d){{const ve=R?St:St+Je,Bt=Je*.55,Ft=(Je-Bt)/2,Za=R?St+Ft:St+Je-Ft,mi=y*.8,qt=ve-mi,Ma=Za-mi;e.beginPath(),e.moveTo(ve,Ze),e.lineTo(Za,Ot),e.lineTo(Ma,Ot-S),e.lineTo(qt,Ze-S),e.closePath();const Xt=e.createLinearGradient(ve,0,qt,0);Xt.addColorStop(0,"#050508"),Xt.addColorStop(1,"#000000"),e.fillStyle=Xt,e.fill(),e.save(),e.clip();const _a=Ze-(Ot-S)+20;D(Math.min(ve,qt)-50,Ze,200,_a),e.fillStyle="rgba(0,0,0,0.2)",e.fill(),e.restore(),e.strokeStyle="#3e4249",e.lineWidth=1,e.stroke()}L(0,Ze,Je,wa)}const Yt=Ue(O*11+(R?100:0)),Re=Ue(O*13+(R?200:0)),xe=Ue(O*17+(R?300:0)),ft=!B||Yt>.5,Tt=Re>.3,Xa=Math.abs($)*.015;if(M({x:-10,y:-40,w:20,h:25,arched:!0,lit:ft,phase:Xa}),M({x:-9,y:Ze+12,w:18,h:18,arched:!1,lit:Tt,phase:Xa}),!B||xe>.5){const ve=Ze-25;z(0,ve+12,16,12)}e.restore()},W=54,X=60,N=-90,K=66,pe=8,oe=N-X-pe,J=-2,ye=54,Pe=50,me=oe;if(d){const E=J-W/2;P(E,N,W,X),e.fillStyle="#050508",e.beginPath(),e.moveTo(E,N),e.lineTo(E,N-X),e.lineTo(E-y,N-X-S),e.lineTo(E-y,N-S),e.fill();const R=J-W/2;w(R,N-X,W,X,"#2d3138"),k(R,N-X,W,X);const B=J-K/2;e.fillStyle="#0a0c0e",e.beginPath(),e.moveTo(B,oe+pe),e.lineTo(B,oe),e.lineTo(B-6,oe-2),e.lineTo(B-6,oe+pe-2),e.fill(),w(J-K/2,oe,K,pe,b),e.fillStyle="rgba(255,255,255,0.4)",e.fillRect(J-K/2,oe,K,1),e.fillStyle="rgba(0,0,0,0.6)",e.fillRect(J-K/2,oe+pe-1,K,1);const O=J-ye/2;e.fillStyle="#050508",e.beginPath(),e.moveTo(O,me),e.lineTo(O,me-Pe),e.lineTo(O-y,me-Pe-S),e.lineTo(O-y,me-S),e.fill(),w(J-ye/2,me-Pe,ye,Pe,"#2d3138"),k(J-ye/2,me-Pe,ye,Pe),L(J,me-Pe,60,50);const j=me-Pe-54;e.strokeStyle="#000",e.lineWidth=2,e.beginPath(),e.moveTo(J,j),e.lineTo(J,j-30),e.stroke(),e.lineWidth=1,e.beginPath(),e.moveTo(J-10,j-20),e.lineTo(J+10,j-20),e.stroke(),e.fillStyle="#c0a060",e.beginPath(),e.arc(J,j-30,3,0,Math.PI*2),e.fill();const $=j;e.strokeStyle="#0a0a0d",e.lineWidth=2,e.beginPath(),e.moveTo(J-20,$-10),e.lineTo(J+20,$-10);for(let ee=-18;ee<=18;ee+=6)e.moveTo(J+ee,$),e.lineTo(J+ee,$-12);e.stroke()}M({x:J-10,y:me-Pe+10,w:20,h:30,arched:!0,lit:!0,ignoreStorm:!0});const ge=120,Le=50,Ve=8,ze=-Le-Ve,Xe=ge-5*2,Q=40,re=ze,Se=re-Q;if(d){e.fillStyle="#050508";const E=-ge/2;e.beginPath(),e.moveTo(E,0),e.lineTo(E,-Le),e.lineTo(E-y,-Le-S),e.lineTo(E-y,0-S),e.closePath(),e.fill(),w(-ge/2,-Le,ge,Le,u),k(-ge/2,-Le,ge,Le);for(let O=-Le;O<-4;O+=16)e.fillStyle=Math.abs(O)%32===0?u:"#3b3f46",e.fillRect(-ge/2,O,6,8),e.fillRect(ge/2-6,O,6,8);const R=-ge/2-4;e.fillStyle="#050508",e.beginPath(),e.moveTo(R,ze+Ve),e.lineTo(R,ze),e.lineTo(R-y,ze-S),e.lineTo(R-y,ze+Ve-S),e.closePath(),e.fill(),w(-ge/2-4,ze,ge+8,Ve,b),e.fillStyle="#5a5e68",e.fillRect(-ge/2,re,ge,2);const B=-Xe/2;e.fillStyle="#050508",e.beginPath(),e.moveTo(B,re),e.lineTo(B,Se),e.lineTo(B-y,Se-S),e.lineTo(B-y,re-S),e.closePath(),e.fill(),w(-Xe/2,Se,Xe,Q,u),k(-Xe/2,Se,Xe,Q),w(-Xe/2-2,re-4,Xe+4,4,b)}M({x:-40,y:Se+10,w:14,h:20,arched:!0,lit:!0,ignoreStorm:!0}),M({x:-7,y:Se+10,w:14,h:20,arched:!0,lit:!0,ignoreStorm:!0}),M({x:26,y:Se+10,w:14,h:20,arched:!0,lit:!0,ignoreStorm:!0});const Te=40,Ye=35;if(d){w(-Te/2,-Ye,Te,Ye,"#2d3436"),e.beginPath(),e.moveTo(-Te/2-6,-Ye),e.lineTo(0,-Ye-12),e.lineTo(Te/2+6,-Ye),e.closePath(),e.fillStyle="#111",e.fill(),e.strokeStyle="#444",e.lineWidth=2,e.stroke(),e.fillStyle="rgba(0,0,0,0.6)",e.fillRect(-Te/2+2,-Ye,Te-4,6),e.fillStyle="#050505";const E=24,R=25;e.fillRect(-E/2,-R,E,R),e.fillStyle="#1a0f0f";const B=2;e.fillRect(-E/2+B,-R+B,E-B*2,R-B),e.fillStyle="#2b1b1b",e.fillRect(-E/2+4,-R+4,6,8),e.fillRect(E/2-10,-R+4,6,8),e.fillRect(-E/2+4,-R+14,6,8),e.fillRect(E/2-10,-R+14,6,8),e.fillStyle="#e1b12c",e.beginPath(),e.arc(E/2-6,-R/2+2,1.5,0,Math.PI*2),e.fill(),e.strokeStyle="#3a3a3a",e.lineWidth=1,e.strokeRect(-E/2,-R,E,R)}M({x:-45,y:-35,w:12,h:20,arched:!1,lit:!0,ignoreStorm:!0}),M({x:33,y:-35,w:12,h:20,arched:!1,lit:!0,ignoreStorm:!0}),d&&(w(-25,-25,6,25,b),w(19,-25,6,25,b),w(-30,-32,60,8,b),e.beginPath(),e.moveTo(-32,-32),e.lineTo(32,-32),e.lineTo(0,-50),e.fill());for(let E=1;E<=g;E++){const R=I+(E-1)*_;ne(R,!1,E===g,E)}for(let E=g;E>=1;E--){const R=I+(E-1)*_;ne(R,!0,E===g,E)}if(d){const E=H+60,R=-c/h,B=(t-c)/h,O=0,j=120,$=1200,ee=Math.max(R-50,-E-$),te=Math.min(B+50,E+$);Sn(e,-E+5,O,ee,j,100),Sn(e,E-5,O,te,j,200)}e.restore()}function qa(e,t){const a=e/2,i=150+(Oe||0),o=Math.max(i-40,t*.2);let n=(o-30)/290*1.5,s=0;e>t*1.2?(n*=1.5,s=1):t>e&&(n*=.75);const r=n,d=300*r,f=(e-d)/2;let c=0;f>0?c=Math.ceil(f/(90*r))+1:c=1;const p=1+Math.min(c,6)+s;return{cx:a,baseY:o,scaleX:r,scaleY:n,horizonY:o,wingsPerSide:p}}function Ks(e,t,a){const{cx:i,baseY:o,scaleX:n,scaleY:s}=qa(t,a);e.save(),e.translate(i,o),e.scale(n,s);const r=(c,p,h,m,g)=>{e.fillStyle=g,e.fillRect(c,p,h,m)},d="#2a2e35",f="#1a1d23";r(-25,0,50,3,d),r(-25,3,50,2,f),r(-30,5,60,3,d),r(-30,8,60,2,f),r(-35,10,70,3,d),r(-35,13,70,2,f),e.restore()}const js=(e,t,a,i,o,n,s,r)=>{e.save(),e.beginPath(),e.moveTo(t-i/2,a),e.lineTo(t+i/2,a),e.lineTo(t+n/2,o),e.lineTo(t-n/2,o),e.closePath(),e.fillStyle="#1a1a1a",e.fill(),e.restore();const d=(p,h,m,g)=>{e.save(),e.translate(p,h),e.scale(-m,1),e.strokeStyle="rgba(255, 255, 255, 0.9)",e.lineWidth=1.3,e.lineCap="butt",e.beginPath();let u=g;const T=()=>Ue(u+=17.1),b=30+T()*25,y=5,S=0,A=Math.PI*.55,v=[];for(let w=0;w<y;w++){const D=w/(y-1),k=S+D*(A-S),I=b*(.8+T()*.4),_=Math.cos(k)*I,H=Math.sin(k)*I;v.push({x:_,y:H}),e.moveTo(0,0),e.lineTo(_,H)}const P=3;for(let w=1;w<=P;w++){const D=w/(P+.2);for(let k=0;k<y-1;k++){const I=v[k],_=v[k+1],H=I.x*D,M=I.y*D,L=_.x*D,z=_.y*D;e.moveTo(H,M);const ne=(H+L)*.5,W=(M+z)*.5,X=.85;e.quadraticCurveTo(ne*X,W*X,L,z)}}e.stroke(),e.restore()},f=16,c=o-a;if(c>0){const p=Math.floor(c/f),h=[];let m=-999,g=Ue(p)>.5;for(let u=0;u<p;u++){const T=a+u*f,b=u/p,y=i+(n-i)*b,S=t-y/2,A=u*1337;let v=y,P=S,w=0;for(;v>0;){let k=20+Math.floor(Ue(A+v)*30);k>v&&(k=v);let I=P,_=k-2;if(I<S&&(_-=S-I,I=S),I+_>S+y&&(_=S+y-I),_>1){const H=60+Math.floor(Ue(A+w)*30),M=`rgb(${H}, ${H}, ${H})`,L=`rgb(${H+40}, ${H+40}, ${H+40})`,z=`rgb(${H-30}, ${H-30}, ${H-30})`;e.fillStyle=M,e.fillRect(I,T,_,f-2),e.fillStyle=L,e.fillRect(I,T,_,1),e.fillRect(I,T,1,f-2),e.fillStyle=z,e.fillRect(I,T+f-3,_,1),e.fillRect(I+_-1,T,1,f-2)}v-=k,P+=k,w++}if(r&&T>r-80&&T<r+85||T>o-80||T<a+40||u-m<5)continue;const D=u*999;if(Ue(D)>.82){const k=g?-1:1,I=D+(g?0:100);h.push({x:g?S+2:S+y-2,y:T+5,side:k,seed:I}),g=!g,m=u}}h.forEach(u=>d(u.x,u.y,u.side,u.seed))}};function Js(e,t,a,i){e.save(),e.beginPath(),e.arc(t,a,i,0,Math.PI*2),e.fillStyle="#1a1a1a",e.fill();const o=18,n=Math.floor(i/o);for(let s=0;s<n;s++){const r=i-s*o,d=2*Math.PI*r,f=Math.floor(d/25),c=Math.PI*2/f,p=s*.5;for(let h=0;h<f;h++){const m=p+h*c,g=p+(h+1)*c-.1,u=r,T=r-o+2,b=70+h%3*20;e.fillStyle=`rgb(${b}, ${b}, ${b})`,e.beginPath(),e.arc(t,a,u,m,g),e.arc(t,a,T,g,m,!0),e.closePath(),e.fill()}}e.beginPath(),e.arc(t,a,i-n*o,0,Math.PI*2),e.fillStyle="#555",e.fill(),e.restore()}function Tn(e,t,a,i,o){const n=i-t,s=o-a,r=Math.sqrt(n*n+s*s),d=Math.atan2(s,n),f=24,c=22,p=0,h=Math.ceil(r/(f+p));e.save(),e.translate(t,a),e.rotate(d);const g=c*2+2+4;e.fillStyle="#1a1a1a",e.fillRect(0,-g/2,r,g);for(let u=0;u<2;u++){const T=u===0?0:f/2;for(let b=0;b<h;b++){const y=b*(f+p)-T;if(y+f<0||y>r)continue;const S=f,A=c,v=u===0?-c:0,P=(b+u*1e3)*1.1,w=60+Math.floor(Ue(P)*30),D=`rgb(${w}, ${w}, ${w})`,k=`rgb(${w+40}, ${w+40}, ${w+40})`,I=`rgb(${w-30}, ${w-30}, ${w-30})`,_=1;e.fillStyle=D,e.fillRect(y,v+_,S-_,A-_),e.fillStyle=k,e.fillRect(y,v+_,S-_,1),e.fillRect(y,v+_,1,A-_),e.fillStyle=I,e.fillRect(y,v+A-1,S-_,1),e.fillRect(y+S-_-1,v+_,1,A-_)}}e.restore()}function Qs(e,t,a,i,o){e.save(),e.translate(t,a);const n=.9+o*.3,s=1.1-o*.2;e.scale(i*n,i*s);const r="#616161",d="#424242",f="#212121";e.lineWidth=2,e.strokeStyle=f,e.fillStyle=d,e.beginPath(),e.moveTo(10,-14),e.lineTo(14,-14),e.lineTo(14,0),e.lineTo(10,0),e.fill(),e.stroke(),e.fillStyle=r,e.beginPath(),e.arc(0,-18,10,Math.PI,0),e.lineTo(10,0),e.lineTo(-10,0),e.lineTo(-10,-18),e.fill(),e.stroke(),e.fillStyle="rgba(0,0,0,0.15)";for(let p=0;p<6;p++){const h=(Ue(o+p)-.5)*16,m=-4-Ue(o*p)*20;e.fillRect(h,m,2,2)}e.fillStyle=d,o>.5?(e.beginPath(),e.moveTo(4,-24),e.lineTo(7,-18),e.stroke()):(e.fillStyle=d,e.fillRect(-10,-18,4,4)),e.fillStyle="#424242",e.fillRect(-4,-14,8,2),e.fillRect(-3,-10,6,2),e.fillStyle="rgba(0,0,0,0.5)",e.beginPath(),e.ellipse(0,2,12,4,0,0,Math.PI*2),e.fill(),e.strokeStyle="#0f1a13",e.lineWidth=1;const c=5+Math.floor(o*4);for(let p=0;p<c;p++){const h=-12+p/c*24+(Ue(p)-.5)*4,m=3+Ue(p*2)*4;e.beginPath(),e.moveTo(h,2),e.quadraticCurveTo(h+1,2-m/2,h+(p%2==0?2:-2),2-m),e.stroke()}e.restore()}let jt=null;function xs(){if(jt)return jt;const e=128,t=2;typeof OffscreenCanvas<"u"?jt=new OffscreenCanvas(e,e):(jt=document.createElement("canvas"),jt.width=e,jt.height=e);const a=jt.getContext("2d");a.translate(e/2,e/2),a.scale(t,t);const i=a.createRadialGradient(-4,-8,2,0,0,18);return i.addColorStop(0,"#ffffff"),i.addColorStop(.5,"#e1f5fe"),i.addColorStop(1,"#b3e5fc"),a.fillStyle=i,a.beginPath(),a.arc(0,-12,8,Math.PI,0),a.lineTo(8,10),a.lineTo(4,8),a.lineTo(0,12),a.lineTo(-4,8),a.lineTo(-8,10),a.lineTo(-8,-12),a.fill(),a.fillStyle="#e1f5fe",a.beginPath(),a.moveTo(-8,-4),a.lineTo(-12,-8),a.lineTo(-10,-2),a.lineTo(-8,0),a.fill(),a.beginPath(),a.moveTo(8,-4),a.lineTo(12,-2),a.lineTo(10,2),a.lineTo(8,-2),a.fill(),a.fillStyle="#1a237e",a.save(),a.translate(-3,-10),a.rotate(-.2),a.fillRect(-1.5,-2,3,5),a.restore(),a.save(),a.translate(3,-10),a.rotate(.2),a.fillRect(-1.5,-2,3,5),a.restore(),a.fillRect(-2,-4,4,6),jt}function no(e,t,a,i,o=0){e.save(),e.save(),e.translate(t,a+20*i),e.scale(i,i*.3),e.fillStyle="rgba(0,0,0,0.4)",e.beginPath(),e.arc(0,0,10,0,Math.PI*2),e.fill(),e.restore();const n=Math.sin(o*.8)*(5*i),s=xs(),r=32*i;e.save(),e.translate(t,a+n),e.globalAlpha=.7,e.drawImage(s,-r,-r,r*2,r*2),e.restore(),e.restore()}let Jt=null,bn=0,vn=0,Cn=!1,Pn=0;function el(e,t,a,i=!0){const{cx:o,horizonY:n,scaleX:s,wingsPerSide:r}=qa(t,a),d=l.bat&&l.bat.pivotY?l.bat.pivotY:a*.85;if(!(!Jt||Math.floor(t)!==Math.floor(bn)||Math.floor(a)!==Math.floor(vn)||i!==Cn||Math.abs(d-Pn)>2)){e.drawImage(Jt,0,0);return}bn=t,vn=a,Cn=i,Pn=d,typeof OffscreenCanvas<"u"?Jt=new OffscreenCanvas(t,a):(Jt=document.createElement("canvas"),Jt.width=t,Jt.height=a);const c=Jt.getContext("2d");c.clearRect(0,0,t,a),c.clearRect(0,0,t,n),c.save(),c.beginPath(),c.rect(0,n,t,a-n),c.clip();const p=(Q,re)=>{const Ye=document.createElement("canvas");Ye.width=1024,Ye.height=1024;const E=Ye.getContext("2d");E.imageSmoothingEnabled=!0;const R="#0b1214",B="#162a26",O="#2f4f48",j="#4a6b63";E.fillStyle=R,E.fillRect(0,0,1024,1024);const $=[],ee=25;for(let ie=0;ie<ee;ie++)$.push({x:Math.random()*1024,y:Math.random()*1024,r:10+Math.random()*20});const te=(ie,Ce)=>{for(let le of $){const fe=ie-le.x,he=Ce-le.y;if(fe*fe+he*he<le.r*le.r)return!0}return!1},se=150,ce=1024/se;for(let ie=0;ie<se;ie++){const Ce=ie/se,le=ie*ce,fe=.5+Math.pow(Ce,2.2)*3,he=200*(1.1-Ce*.3);for(let be=0;be<he;be++){const We=Math.random()*1024,Ze=(Math.random()-.5)*ce*1.5,Je=le+Ze;if(te(We,Je))continue;const wa=Math.random(),St=(15+Math.random()*20)*fe;E.lineWidth=1*fe,E.lineCap="round";let Ot=B;if(Math.random()>.6&&(Ot=O),Math.random()>.9&&(Ot=j),E.strokeStyle=Ot,E.beginPath(),wa<.4){const Yt=2+Math.floor(Math.random()*2),Re=(Math.random()-.5)*10*fe,xe=4*fe;for(let ft=0;ft<Yt;ft++){const Tt=We+ft*xe;E.moveTo(Tt,Je),E.quadraticCurveTo(Tt+Re,Je-St*.7,Tt+Re*1.2,Je-St)}}else if(wa<.8)for(let Re=0;Re<3;Re++){const xe=We+(Math.random()-.5)*10*fe,ft=(Math.random()-.5)*30*fe,Tt=St*(.8+Math.random()*.4);E.moveTo(xe,Je),E.quadraticCurveTo(xe+ft*.5,Je-Tt/2,xe+ft,Je-Tt)}else{const Yt=(Math.random()-.5)*15*fe,Re=St*1.3;E.moveTo(We,Je),E.quadraticCurveTo(We+Yt,Je-Re*.8,We+Yt*2.5,Je-Re)}E.stroke()}}return Ye},h=a-n,m=1037;(!l.hauntedPatternCanvas||l.hauntedPatternCanvas._cacheId!==m)&&(l.hauntedPatternCanvas=p(),l.hauntedPatternCanvas._cacheId=m),c.save(),c.drawImage(l.hauntedPatternCanvas,0,n,t,h),c.restore(),c.save(),c.globalCompositeOperation="overlay";const g=c.createRadialGradient(o,n,50,o,n+200,600);g.addColorStop(0,"rgba(255, 200, 50, 0.4)"),g.addColorStop(.3,"rgba(100, 100, 50, 0.1)"),g.addColorStop(1,"rgba(0, 0, 0, 0)"),c.fillStyle=g,c.transform(1,0,0,.3,0,n*.7),c.fillRect(0,n,t,a),c.restore();const u=[],T=32,b=35;let y=0;for(;u.length<T&&y<200;){y++;const Q=y*13,re=Math.pow(Ue(Q),.8),Se=n+20+re*(a-n-100),Te=90+re*320,Ye=(t-Te)/2,E=Ue(Q+7)>.5?1:-1,R=Ue(Q+3)*(Ye-40),B=o+E*(Te/2+20+R);let O=!1;for(let j of u){const $=j.x-B,ee=j.y-Se,te=Math.sqrt($*$+ee*ee),se=b*(.6+re*.4);if(te<se){O=!0;break}}O||u.push({x:B,y:Se,z:re,id:u.length})}u.sort((Q,re)=>Q.y-re.y),u.forEach(Q=>{const re=.6+Q.z*1,Se=Ue(Q.id+50);c.fillStyle="rgba(0, 0, 0, 0.5)",c.beginPath(),c.ellipse(Q.x,Q.y+5*re,15*re,6*re,0,0,Math.PI*2),c.fill(),Qs(c,Q.x,Q.y,re,Se)});const S=70,v=d-30,P=70,w=150+(typeof Oe<"u"?Oe:0)+32;js(c,o,n,P,v,P,i,w);const D=S/1.8027,k=1.5*D,I=o-D,_=d-k,H=-t,M=_+1.5*(H-I);Tn(c,I,_,H,M);const L=o+D,z=d-k,ne=t*2,W=z-1.5*(ne-L);Tn(c,L,z,ne,W),Js(c,o,d,S),c.save(),c.strokeStyle="#FFFFFF",c.lineWidth=4,c.lineWidth=3,c.strokeRect(o-70,d-30,30,60),c.strokeRect(o+40,d-30,30,60),c.fillStyle="#FFFFFF",c.beginPath(),c.moveTo(o,d+10),c.lineTo(o+10,d),c.lineTo(o+10,d-10),c.lineTo(o-10,d-10),c.lineTo(o-10,d),c.fill(),c.restore();const X=75,N=18;c.save(),c.translate(o,w);const K="#212121",pe=3,oe=N/pe;c.fillStyle=K,c.beginPath(),c.ellipse(0,N,X,X*.4,0,0,Math.PI*2),c.rect(-X,0,X*2,N),c.fill(),c.save();for(let Q=0;Q<pe;Q++){const re=Q*oe,Se=(Q+1)*oe,Te=12,Ye=Q%2*(Math.PI/Te);for(let E=0;E<Te/2+2;E++){const R=E*(Math.PI/(Te/2))+Ye,B=R+Math.PI/(Te/2)-.1;if(R>Math.PI-.1)continue;const O=(ie,Ce)=>({x:Math.cos(ie)*X,y:Math.sin(ie)*(X*.4)+Ce}),j=O(R,re),$=O(B,re),ee=O(R,Se),te=O(B,Se);c.beginPath(),c.moveTo(j.x,j.y),c.lineTo($.x,$.y),c.lineTo(te.x,te.y),c.lineTo(ee.x,ee.y),c.closePath();const se=Q*99+E*13,ce=60+Ue(se)*20;c.fillStyle=`rgb(${ce}, ${ce}, ${ce})`,c.fill(),c.strokeStyle="#151515",c.lineWidth=1,c.stroke(),c.strokeStyle="rgba(255,255,255,0.4)",c.lineWidth=1,c.beginPath(),c.moveTo(j.x,j.y),c.lineTo($.x,$.y),c.moveTo(j.x,j.y),c.lineTo(ee.x,ee.y),c.stroke(),c.strokeStyle="rgba(0,0,0,0.5)",c.beginPath(),c.moveTo(ee.x,ee.y),c.lineTo(te.x,te.y),c.lineTo($.x,$.y),c.stroke()}}c.restore(),c.strokeStyle="#000000",c.lineWidth=2,c.beginPath(),c.ellipse(0,N,X,X*.4,0,Math.PI,0),c.stroke(),c.save(),c.scale(1,.4);const J=15,ye=X,Pe=X*.6,me=12,ge=Math.PI*2/me;for(let Q=0;Q<me;Q++){const re=Q*ge,Se=(Q+1)*ge,Te=90+Ue(Q)*20;c.fillStyle=`rgb(${Te}, ${Te}, ${Te})`,c.beginPath(),c.arc(0,0,ye,re,Se),c.arc(0,0,Pe,Se,re,!0),c.closePath(),c.fill(),c.stroke()}const Le=J,Ve=8,ze=Math.PI*2/Ve,$e=ze/2;for(let Q=0;Q<Ve;Q++){const re=$e+Q*ze,Se=$e+(Q+1)*ze,Te=95+Ue(Q+50)*20;c.fillStyle=`rgb(${Te}, ${Te}, ${Te})`,c.beginPath(),c.arc(0,0,Pe,re,Se),c.arc(0,0,Le,Se,re,!0),c.closePath(),c.fill(),c.stroke()}c.fillStyle="#757575",c.beginPath(),c.arc(0,0,J,0,Math.PI*2),c.fill(),c.stroke(),c.restore(),c.strokeStyle="#121212",c.lineWidth=2.5,c.beginPath(),c.ellipse(0,0,X,X*.4,0,0,Math.PI*2),c.stroke();const Xe=5;for(let Q=0;Q<Xe;Q++){const re=Q/Xe*Math.PI*2+.5;if(Math.sin(re)<-.2)continue;const Se=Math.cos(re)*X,Te=Math.sin(re)*(X*.4);c.save(),c.translate(Se,Te),c.scale(.6,.6),c.rotate(Math.PI/4+Math.random()*.3),c.beginPath(),c.strokeStyle="rgba(255,255,255,0.25)",c.lineWidth=1,c.moveTo(0,0),c.lineTo(10,25),c.moveTo(0,0),c.lineTo(-12,22),c.moveTo(-6,12),c.lineTo(6,14),c.stroke(),c.restore()}c.restore(),c.save(),c.strokeStyle="#FFFFFF",c.lineWidth=3,c.strokeRect(o-70,d-30,30,60),c.strokeRect(o+40,d-30,30,60),c.fillStyle="#FFFFFF",c.beginPath(),c.moveTo(o,d+10),c.lineTo(o+10,d),c.lineTo(o+10,d-10),c.lineTo(o-10,d-10),c.lineTo(o-10,d),c.fill(),c.restore(),Ks(c,t,a),typeof gn=="function"&&gn(c,t,a),c.restore(),e.drawImage(Jt,0,0)}let _i=0,Rn=0;function tl(e,t,a){const i=Date.now();_i===0&&(_i=i),Rn+=i-_i,_i=i;const o=Rn,n=[{id:0,xBase:t*.3,yBase:a*.2,r:60,speed:.002},{id:1,xBase:t*.7,yBase:a*.25,r:50,speed:-.002},{id:2,xBase:t*.4,yBase:a*.18,r:70,speed:.0015},{id:3,xBase:t*.5,yBase:a*.15,r:80,speed:.001},{id:4,xBase:t*.2,yBase:a*.3,r:30,speed:.003}];e.save(),e.fillStyle="#000",n.forEach(s=>{const r=o*s.speed+s.id*100,d=s.xBase+Math.cos(r)*s.r,f=s.yBase+Math.sin(r*1.5)*(s.r*.5),c=Math.sin(o*.015+s.id),p=9;e.beginPath(),e.moveTo(d,f),e.lineTo(d-p*2,f-p*c),e.lineTo(d-p,f+p/2),e.lineTo(d,f+p),e.lineTo(d+p,f+p/2),e.lineTo(d+p*2,f-p*c),e.fill()}),e.restore()}let zt=null,ya=null,Sa=null,Bi=0,bo=0;function jn(e,t,a){e.save(),e.globalAlpha=1,e.globalCompositeOperation="source-over",e.clearRect(0,0,t,a),e.restore();const i=l.isGameOver;Yn(e,t,a,!0);const o=Date.now()/1e3;Ws(e,t,a,o);const n=t<600?1.4:2.5,s=t/a,r=.5,f=Math.max(0,Math.min(1,(s-r)/(1.8-r))),c=a*(.7+f*.2),p=t*1.2,h=-t*.1,m=4096,g=2160,u=64,T=Math.min(t,m),b=Math.min(a,g),y=Math.ceil(T/u)*u,S=Math.ceil(b/u)*u;if(!zt||Bi!==y||bo!==S){t>m&&console.warn(`[HauntedRenderer] Clamping Cache Width: ${t} -> ${m}`),(!zt||Math.abs(y-Bi)>u)&&console.log(`[HauntedRenderer] Regenerating Start Screen Cache ${y}x${S} (Bucket Aligned)`),typeof OffscreenCanvas<"u"?(zt=new OffscreenCanvas(y,S),ya=new OffscreenCanvas(y,S),Sa=new OffscreenCanvas(y,S)):(zt=document.createElement("canvas"),zt.width=y,zt.height=S,ya=document.createElement("canvas"),ya.width=y,ya.height=S,Sa=document.createElement("canvas"),Sa.width=y,Sa.height=S);const N=zt.getContext("2d"),K=ya.getContext("2d"),pe=Sa.getContext("2d");N.save();const oe=N.createLinearGradient(0,c,0,a);oe.addColorStop(0,"#151515"),oe.addColorStop(1,"#000000"),N.fillStyle=oe,N.fillRect(h,c-2,p,a-c+2),N.strokeStyle="rgba(10, 10, 10, 0.5)",N.lineWidth=2,N.beginPath();const J=20*n,ye=40*n;for(let $e=c;$e<a;$e+=J){const Xe=Math.floor(($e-c)/J),Q=Xe%2===0?0:ye/2;for(let re=h-ye;re<h+p;re+=ye){const Se=Math.floor((re-h)/ye);$e-c<(a-c)*.7&&(N.strokeRect(re+Q,$e,ye,J),Math.sin(Xe*12.9898+Se*78.233)>.8&&(N.fillStyle="rgba(0,0,0,0.3)",N.fillRect(re+Q,$e,ye,J)))}}N.stroke();const Pe=N.createLinearGradient(0,a*.75,0,a);Pe.addColorStop(0,"rgba(0,0,0,0)"),Pe.addColorStop(1,"rgba(0,0,0,0.8)"),N.fillStyle=Pe,N.fillRect(0,a*.75,t,a*.25),N.fillStyle="#222",N.fillRect(h,c-5,p,10),N.restore();const me=300*n,ge=(t-me)/2;let Le=0;ge>0&&(Le=Math.ceil(ge/(90*n)));const Ve=Math.min(Math.max(3,1+Le),7),ze={cx:y/2,baseY:c,scaleX:n,scaleY:n,wingsPerSide:Ve};di(N,y,S,0,"STRUCTURE_ONLY",0,ze),di(K,y,S,0,"WINDOWS_ONLY",0,ze),di(pe,y,S,0,"WINDOWS_ONLY",0,ze,"#ff0000"),Bi=y,bo=S}e.drawImage(zt,0,0,t,a),tl(e,t,a),e.save();const A=Math.sin(Date.now()/1e3)*.1+.9;e.globalAlpha=A,e.globalCompositeOperation="screen";const v=i?Sa:ya;v&&e.drawImage(v,0,0,t,a),e.restore();const P=a*.82,w=e.createLinearGradient(0,P,0,a);w.addColorStop(0,"#121010"),w.addColorStop(1,"#000000"),e.fillStyle=w,e.beginPath(),e.moveTo(0,a),e.lineTo(0,P+40);const D=t*.3,k=t*.7;e.quadraticCurveTo(t*.15,P+10,D,P),e.lineTo(k,P),e.quadraticCurveTo(t*.85,P+10,t,P+40),e.lineTo(t,a),e.fill(),e.save();const I=400,_=N=>{let K=N+=1831565813;return K=Math.imul(K^K>>>15,K|1),K^=K+Math.imul(K^K>>>7,K|61),((K^K>>>14)>>>0)/4294967296};for(let N=0;N<I;N++){const K=_(N*123),pe=_(N*456),oe=_(N*789),J=K*t,ye=P+pe*(a-P),Pe=oe*3+1;e.fillStyle=_(N*999)>.5?"#1a1a1a":"#050505",e.fillRect(J,ye,Pe,Pe)}e.restore(),e.fillStyle="#050505";const H=Math.floor(t/30),M=N=>{const K=Math.sin(N)*1e4;return K-Math.floor(K)};for(let N=0;N<H;N++){const K=N/H,pe=t*K;let oe=P;if(pe<D){const J=pe/D;oe=(P+40)*(1-J)+P*J}else if(pe>k){const J=(pe-k)/(t-k);oe=P*(1-J)+(P+40)*J}M(N*99)>.4&&Zs(e,pe,oe+5,.6+M(N)*.4)}const L=t/2,z=P-50,ne=!1,W=l.isDailyChallenge?V.dailyHighScore:V.highScore;$n(e,L,z,1.4,!0,W,ne),e.save();const X=e.createLinearGradient(0,a*.7,0,a);if(X.addColorStop(0,"rgba(0,0,0,0)"),i?(X.addColorStop(.5,"rgba(40, 10, 10, 0.4)"),X.addColorStop(1,"rgba(20, 0, 0, 0.9)")):(X.addColorStop(.5,"rgba(10, 20, 30, 0.3)"),X.addColorStop(1,"rgba(0, 0, 0, 0.8)")),e.fillStyle=X,e.fillRect(0,a*.7,t,a*.3),e.restore(),e.textAlign="center",e.shadowColor="transparent",e.shadowOffsetX=0,e.shadowOffsetY=0,e.shadowBlur=0,i){const N=l.consecutiveFouls>=4;let K="GAME OVER",pe="#6200ea";N&&(K="BAT BROKEN!"),e.save(),e.font='40px "PressStart2PLocal"',e.strokeStyle="#000000",e.lineWidth=4,e.strokeText(K,t/2,a*.45),e.fillStyle=pe,e.fillText(K,t/2,a*.45),e.restore(),e.font='20px "PressStart2PLocal"',e.fillStyle="#eceff1",e.fillText(`SCORE: ${V.score}`,t/2,a*.52),Math.floor(Date.now()/800)%2===0&&(e.font='16px "PressStart2PLocal"',e.fillStyle="#ffffff",e.fillText("TAP TO RETRY",t/2,a*.6))}else{e.save();const N=Math.sin(Date.now()/300);e.globalAlpha=.6+(N+1)*.2,e.font='40px "PressStart2PLocal"',e.fillStyle="#80d8ff",e.strokeStyle="#000000",e.lineWidth=6,e.lineJoin="round",window.innerWidth<=600||window.innerHeight<=600?(e.strokeText("TAP TO",t/2,a*.48),e.fillText("TAP TO",t/2,a*.48),e.strokeText("START",t/2,a*.48+50),e.fillText("START",t/2,a*.48+50)):(e.strokeText("TAP TO START",t/2,a*.48),e.fillText("TAP TO START",t/2,a*.48)),e.restore()}}function pi(e,t){if(!(typeof document>"u"))try{console.log(`[HauntedRenderer] Warming up caches for ${e}x${t}...`);const a=document.createElement("canvas");a.width=1,a.height=1;const i=a.getContext("2d");jn(i,e,t);const o=e<600?.6:.8;$n(i,0,0,o),Kn(i,e,t),console.log("[HauntedRenderer] Warmup Complete.")}catch(a){console.warn("[HauntedRenderer] Warmup Failed:",a)}}function al(){console.log("[HauntedRenderer] Cleaning up Start Screen caches to free memory."),zt=null,ya=null,Sa=null,Bi=0,bo=0}const Ua={[F.FASTBALL]:{name:"Fastball",colorName:"WHITE",colors:["#ffffff"],baseSpeed:.6,rotationSpeed:.15,windupDuration:1e3,chargeSound:null,specialLogic:null},[F.CURVEBALL]:{name:"Curveball",colorName:"PINK",colors:["#ff69b4"],baseSpeed:.5,rotationSpeed:.3,windupDuration:1e3,chargeSound:"playCurveCharge",specialLogic:"curve"},[F.CHANGEUP]:{name:"Changeup",colorName:"GOLD",colors:["#ffd700"],baseSpeed:.45,rotationSpeed:.05,windupDuration:1e3,chargeSound:"playChangeCharge",specialLogic:null},super_fastball:{name:"Super Fastball",colorName:"RED",colors:["#ff0000"],baseSpeed:.85,rotationSpeed:.4,windupDuration:1e3,chargeSound:"playSuperCharge",specialLogic:null},[F.STOPBALL]:{name:"Stopball",colorName:"PURPLE",colors:["#800080"],baseSpeed:.65,rotationSpeed:.2,windupDuration:1e3,chargeSound:"playEvilLaugh",specialLogic:"stop"},[F.GHOSTBALL]:{name:"Ghostball",colorName:"CYAN",colors:["#00ffff"],baseSpeed:.55,rotationSpeed:.2,windupDuration:1e3,chargeSound:"playGhostCharge",specialLogic:"ghost"},[F.STOP_CURVE]:{name:"Stop-Curve",colorName:"PURPLE/PINK",colors:["#800080","#ff69b4"],baseSpeed:.55,rotationSpeed:.3,windupDuration:2500,chargeSound:"playEvilLaugh",specialLogic:"stop_curve"},[F.GHOST_CURVE]:{name:"Ghost-Curve",colorName:"CYAN/PINK",colors:["#00ffff","#ff69b4"],baseSpeed:.55,rotationSpeed:.3,windupDuration:2500,chargeSound:"playGhostCharge",specialLogic:"ghost_curve"},[F.SPLITTER]:{name:"Splitter",colorName:"BLUE",colors:["#00008b"],baseSpeed:.35,rotationSpeed:.1,windupDuration:1e3,chargeSound:"playSplitterCharge",specialLogic:"splitter"},[F.ZIGZAG]:{name:"ZigZag",colorName:"Lime Green",colors:["#32CD32"],baseSpeed:.55,rotationSpeed:.2,windupDuration:1e3,chargeSound:"playZigZagCharge",throwSound:null,specialLogic:"zigzag"},[F.SUPER_CURVE]:{name:"Super-Curve",colorName:"RED/PINK",colors:["#ff0000","#ff69b4"],baseSpeed:.85,rotationSpeed:.4,windupDuration:2500,chargeSound:"playSuperCharge",specialLogic:"super_curve"},[F.SUPER_ZIGZAG]:{name:"Super-ZigZag",colorName:"RED/GREEN",colors:["#ff0000","#32CD32"],baseSpeed:.85,rotationSpeed:.4,windupDuration:2500,chargeSound:"playSuperCharge",throwSound:null,specialLogic:"super_zigzag"},[F.SUPER_SPLITTER]:{name:"Super-Splitter",colorName:"RED/BLUE",colors:["#ff0000","#00008b"],baseSpeed:.38,rotationSpeed:.4,windupDuration:2500,chargeSound:"playSuperCharge",throwSound:"playSplitter",specialLogic:"super_splitter"},[F.STOP_SPLITTER]:{name:"Stop-Splitter",colorName:"PURPLE/BLUE",colors:["#800080","#00008b"],baseSpeed:.35,rotationSpeed:.3,windupDuration:2500,chargeSound:"playEvilLaugh",throwSound:"playSplitter",specialLogic:"stop_splitter"},[F.STOP_ZIGZAG]:{name:"Stop-ZigZag",colorName:"PURPLE/GREEN",colors:["#800080","#32CD32"],baseSpeed:.55,rotationSpeed:.3,windupDuration:2500,chargeSound:"playEvilLaugh",throwSound:null,specialLogic:"stop_zigzag"},[F.GHOST_SPLITTER]:{name:"Ghost-Splitter",colorName:"CYAN/BLUE",colors:["#00FFFF","#00008b"],baseSpeed:.35,rotationSpeed:.3,windupDuration:2500,chargeSound:"playGhostCharge",throwSound:"playSplitter",specialLogic:"ghost_splitter"},[F.GHOST_ZIGZAG]:{name:"Ghost-ZigZag",colorName:"CYAN/GREEN",colors:["#00FFFF","#32CD32"],baseSpeed:.55,rotationSpeed:.3,windupDuration:2500,chargeSound:"playGhostCharge",throwSound:null,specialLogic:"ghost_zigzag"},[F.GHOST_CHANGEUP]:{name:"Ghost-Changeup",colorName:"CYAN/GOLD",colors:["#00FFFF","#ffd700"],baseSpeed:.35,rotationSpeed:.3,windupDuration:2500,chargeSound:"playGhostCharge",throwSound:"playPitch",specialLogic:"ghost_changeup"},[F.CURVE_SPLITTER]:{name:"Curve-Splitter",colorName:"PINK/BLUE",colors:["#ff69b4","#00008b"],baseSpeed:.35,rotationSpeed:.3,windupDuration:2500,chargeSound:"playCurveCharge",throwSound:"playSplitter",specialLogic:"curve_splitter"},[F.ZIGZAG_SPLITTER]:{name:"ZigZag-Splitter",colorName:"GREEN/BLUE",colors:["#32CD32","#00008b"],baseSpeed:.35,rotationSpeed:.3,windupDuration:2500,chargeSound:"playZigZagCharge",throwSound:"playSplitter",specialLogic:"zigzag_splitter"},[F.CURVE_CHANGEUP]:{name:"Curve-Changeup",colorName:"PINK/GOLD",colors:["#ff69b4","#ffd700"],baseSpeed:.35,rotationSpeed:.3,windupDuration:2500,chargeSound:"playCurveCharge",throwSound:"playPitch",specialLogic:"curve_changeup"},[F.SPLITTER_CHANGEUP]:{name:"Splitter-Changeup",colorName:"BLUE/GOLD",colors:["#00008b","#ffd700"],baseSpeed:.22,rotationSpeed:.3,windupDuration:2500,chargeSound:"playSplitterCharge",throwSound:"playSplitter",specialLogic:"splitter_changeup"},[F.ZIGZAG_CHANGEUP]:{name:"ZigZag-Changeup",colorName:"GREEN/GOLD",colors:["#32CD32","#ffd700"],baseSpeed:.35,rotationSpeed:.3,windupDuration:2500,chargeSound:"playZigZagCharge",throwSound:null,specialLogic:"zigzag_changeup"},[F.GHOST_STOP]:{name:"Ghost-Stop",colorName:"CYAN/PURPLE",colors:["#00FFFF","#800080"],baseSpeed:.55,rotationSpeed:.2,windupDuration:2500,chargeSound:"playGhostCharge",throwSound:null,specialLogic:"ghost_stop"},[F.GHOST_SUPER]:{name:"Ghost-Super",colorName:"CYAN/RED",colors:["#00FFFF","#ff0000"],baseSpeed:.85,rotationSpeed:.4,windupDuration:2500,chargeSound:"playGhostCharge",throwSound:null,specialLogic:"ghost_super"},[F.STOP_SUPER]:{name:"Stop-Super",colorName:"PURPLE/RED",colors:["#800080","#ff0000"],baseSpeed:.85,rotationSpeed:.4,windupDuration:2500,chargeSound:"playEvilLaugh",throwSound:null,specialLogic:"stop_super"},[F.STOP_CHANGEUP]:{name:"Stop-Changeup",colorName:"PURPLE/GOLD",colors:["#800080","#ffd700"],baseSpeed:.35,rotationSpeed:.2,windupDuration:2500,chargeSound:"playEvilLaugh",throwSound:null,specialLogic:"stop_changeup"}};function il(){for(const e in ri)delete ri[e]}function vo(e,t,a,i,o,n={}){const s=l.pitcher.gender||"MALE",r=n&&Object.keys(n).length>0?n:l.pitcher.props||{},d=`${r.sunglasses?"sg":""}${r.beard?"bd":""}${r.goldChain?"gc":""}${r.spaceHelmet?"sh":""}`;let f="";l.pitcher.id==="MONITOR"&&l.perfectHitTimer>0&&(f="_sad");const p=(l.pitcher.id==="ROOKIE"||!l.pitcher.id)&&(t==="#ff0000"||t==="#FF0000")?`_red_${Math.floor(Date.now()/100)}`:"",h=`${e}_${t}_${a||"none"}_${i!==void 0?i:"full"}_${o||"default"}_${s}_${d}${f}_${l.pitcher.id||"NONE"}${p}`;if(ri[h])return ri[h];Oi.width=Ke,Oi.height=Ke,lt.clearRect(0,0,Ke,Ke);const m=s==="FEMALE",g=o==="#000000";if(An(lt,Wa,ci,e,"#ffffff",null,"UNIFORM",m,g,o,r),lt.globalCompositeOperation="source-atop",i!==void 0){const b=Ke*i,y=Ke-b;lt.fillStyle=t,lt.fillRect(0,y,Ke,b)}else a?(lt.fillStyle=t,lt.fillRect(0,0,Ke/2,Ke),lt.fillStyle=a,lt.fillRect(Ke/2,0,Ke/2,Ke)):(lt.fillStyle=t,lt.fillRect(0,0,Ke,Ke));lt.globalCompositeOperation="source-over",An(lt,Wa,ci,e,"#ffffff",null,"SKIN",m,g,o,r),Co(lt,Wa,ci,e,r);const u=document.createElement("canvas");return u.width=Ke,u.height=Ke,u.getContext("2d").drawImage(Oi,0,0),ri[h]=u,u}function Co(e,t,a,i,o={}){const n=(p,h,m,g,u)=>{e.fillStyle=u,e.fillRect(p,h,m,g)};if(l.pitcher.id==="MONITOR"){Y.currentTheme.id,Y.currentTheme.id;let p=t,h=a-14,m=32,g=26;i==="THROW"&&(p=t+5,h=a-12),e.fillStyle="#111111",e.fillRect(p+3,h+3,m-6,g-6),e.fillStyle="#00ff00",l.perfectHitTimer>0?(e.fillStyle="#00ff00",e.fillRect(p+10,h+6,4,4),e.fillRect(p+18,h+6,4,4),e.strokeStyle="#00ff00",e.lineWidth=2,e.strokeRect(p+13,h+15,6,6)):(e.fillRect(p+10,h+6,4,4),e.fillRect(p+18,h+6,4,4),e.fillRect(p+10,h+13,2,2),e.fillRect(p+20,h+13,2,2),e.fillRect(p+12,h+15,8,2));return}let s=a-10,r=t+8;if(i==="THROW"&&(r=t+13,s=a-8),l.pitcher.id==="SCARY"){e.save(),e.translate(t+16,a+32);const p=e.createRadialGradient(0,0,5,0,0,25);p.addColorStop(0,"rgba(0, 0, 0, 0.8)"),p.addColorStop(1,"rgba(0, 0, 0, 0)"),e.fillStyle=p,e.beginPath(),e.arc(0,0,25,0,Math.PI*2),e.fill(),e.restore()}const d=l.pitcher.gender==="FEMALE",f=l.pitcher.skinColor||"#ffccaa";if(d){const p=f==="#000000"||f==="#1a1a1a"||f==="#808080",h=p?f:"#FFD54F";e.fillStyle=h,e.beginPath(),e.arc(r+8,s+6,8.2,0,Math.PI*2),e.fill(),e.fillStyle=f,e.beginPath(),e.ellipse?e.ellipse(r+8,s+9,7,8.5,0,0,Math.PI*2):e.arc(r+8,s+9,7,0,Math.PI*2),e.fill(),p||(e.fillStyle="#1E88E5",e.beginPath(),e.arc(r+5,s+9,1.5,0,Math.PI*2),e.fill(),e.beginPath(),e.arc(r+11,s+9,1.5,0,Math.PI*2),e.fill(),e.strokeStyle="#D81B60",e.lineWidth=1.5,e.beginPath(),e.arc(r+8,s+10,3,.2*Math.PI,.8*Math.PI),e.stroke()),e.fillStyle=h,e.beginPath(),e.moveTo(r+1,s+4),e.bezierCurveTo(r,s-2,r+6,s-4,r+15,s+5),e.lineTo(r+15,s+9),e.bezierCurveTo(r+8,s+2,r+4,s+2,r+1,s+7),e.fill()}else l.pitcher.id==="SCARY"&&(e.fillStyle="#ff0000",e.fillRect(r+4,s+6,2,2),e.fillRect(r+10,s+6,2,2));l.bossModeActive,d||l.pitcher.id==="SCARY"&&(e.fillStyle="#ff0000",e.shadowColor="#ff0000",e.shadowBlur=10,e.fillRect(r+4,s+5,2,2),e.fillRect(r+10,s+5,2,2),e.shadowBlur=0),o.spaceHelmet&&(e.fillStyle="rgba(173, 216, 230, 0.5)",e.strokeStyle="rgba(255, 255, 255, 0.8)",e.lineWidth=2,e.beginPath(),e.arc(r+8,s+8,12,0,Math.PI*2),e.fill(),e.stroke(),e.beginPath(),e.arc(r+12,s+4,3,0,Math.PI*2),e.fillStyle="rgba(255, 255, 255, 0.9)",e.fill());const c=d?"#FF69B4":"#000000";i==="SET"?(n(t+2,a+32,10,4,c),n(t+20,a+32,10,4,c),n(t+10,a+12,12,10,"#ffffff")):i==="KICK"?(n(t+20,a+32,10,4,c),n(t-8,a+22,10,4,c),n(t+20,a+12,8,8,"#ffffff")):i==="THROW"?(n(t+35,a+32,10,4,c),n(t+5,a+32,10,4,c),n(t-5,a+10,8,8,"#ffffff")):(n(t+2,a+32,10,4,c),n(t+20,a+32,10,4,c))}function An(e,t,a,i,o,n,s="ALL",r=null,d=!1,f=null,c={}){const h=r!==null?r:l.pitcher.gender==="FEMALE",m=c.sunglasses||!1,g=c.beard||!1,u=c.goldChain||!1,T=c.hatColor||null,b=d,y=f||l.pitcher.skinColor||"#ffccaa",S=s==="ALL"||s==="UNIFORM",A=s==="ALL"||s==="SKIN",v=(M,L,z,ne)=>{S&&(e.fillStyle=o,e.fillRect(M,L,z,ne))},P=(M,L,z,ne,W)=>{A&&(e.fillStyle=W,e.fillRect(M,L,z,ne))},w=(M,L)=>{if(A){if(l.pitcher.id==="MONITOR"){e.fillStyle="#d0d0c0",e.fillRect(M-8,L-4,32,26);return}if(h)e.fillStyle=y,e.beginPath(),e.arc(M+8,L+8,8,0,Math.PI*2),e.fill();else{const z=T||(b?"#ffffff":"#e74c3c");if(b)e.fillStyle=z,e.fillRect(M-2,L-4,20,6),e.fillStyle=y,e.fillRect(M,L,16,16);else if(e.fillStyle=y,e.fillRect(M,L,16,16),l.pitcher.id==="ACE")e.fillStyle="#000000",e.fillRect(M+1,L-8,14,8),e.fillRect(M,L-5,16,5),e.fillRect(M-1,L-1,2,8),e.fillRect(M+15,L-1,2,8);else if(l.pitcher.id==="ROOKIE"||T){const ne=T||"#e74c3c";e.fillStyle=ne,e.fillRect(M-2,L-4,20,6),e.fillStyle=ne,e.fillRect(M,L-6,16,4)}g&&(e.fillStyle="#000000",e.fillRect(M+2,L+12,12,1),e.fillRect(M-1,L+6,2,9),e.fillRect(M+15,L+6,2,9),e.fillRect(M,L+13,5,5),e.fillRect(M+11,L+13,5,5),e.fillRect(M+2,L+16,12,2),e.fillRect(M+7,L+14,2,2)),m&&(e.fillStyle="#000000",e.fillRect(M+1,L+4,6,5),e.fillRect(M+9,L+4,6,5),e.fillRect(M+7,L+4,2,1),e.fillRect(M+7,L+5,1,1),e.fillRect(M+8,L+5,1,1),e.fillStyle="#222222",e.fillRect(M+2,L+5,4,3),e.fillRect(M+10,L+5,4,3))}}},D=(M,L)=>{A&&u&&(e.strokeStyle="#B8860B",e.lineWidth=4,e.lineCap="round",e.beginPath(),e.moveTo(M+10,L+2),e.bezierCurveTo(M+10,L+14,M+22,L+14,M+22,L+2),e.stroke(),e.strokeStyle="#FFD700",e.lineWidth=3,e.setLineDash([2,1]),e.beginPath(),e.moveTo(M+10,L+2),e.bezierCurveTo(M+10,L+14,M+22,L+14,M+22,L+2),e.stroke(),e.setLineDash([]),e.shadowBlur=0)};let k=t+2,I=t+20,_=10;const H=c.shoeColor||l.pitcher.shoeColor||(h?"#FF69B4":"#000000");if(i==="SET")v(t,a,32,20),D(t,a),v(k,a+20,_,12),v(I,a+20,_,12),P(k,a+32,_,4,H),P(I,a+32,_,4,H),P(t+10,a+12,12,10,"#ffffff"),w(t+8,a-10);else if(i==="KICK")v(t,a,32,20),D(t,a),v(I,a+20,_,12),P(I,a+32,_,4,H),v(t-8,a+10,_,12),P(t-8,a+22,_,4,H),P(t+20,a+12,8,8,"#ffffff"),w(t+8,a-10);else if(i==="THROW"){v(t+5,a+2,32,20),D(t+5,a+2);let M=t+35,L=t+5;v(M,a+22,_,10),P(M,a+32,_,4,H),v(L,a+22,_,10),P(L,a+32,_,4,H),w(t+13,a-8),v(t+35,a+5,12,6),P(t-5,a+10,8,8,"#ffffff")}else v(t,a,32,20),D(t,a),v(k,a+20,_,12),v(I,a+20,_,12),P(k,a+32,_,4,H),P(I,a+32,_,4,H),w(t+8,a-10)}function ol(){let e=l.pitcher.baseColor,t=null,a;if(l.pitcher.state===Ae.WINDUP){let u=Ua[l.pitcher.nextPitch];if(!u&&typeof l.pitcher.nextPitch=="string"&&(u=Ua[l.pitcher.nextPitch.trim().toLowerCase()]),l.showTutorial)l.settings?.noFlash||Math.floor(l.pitcher.timer/200)%2===0?e="#FF69B4":e="#FFFFFF";else if(u&&u.windupStyle==="fill"){e=u.colors[0];const T=l.pitcher.timer/l.pitcher.windupDuration;a=Math.floor(T*10)/10,a=Math.max(.1,Math.min(1,a))}else if(u&&u.colors)if(l.settings?.noFlash)u.colors.length>1?(e=u.colors[0],t=u.colors[1]):e=u.colors[0];else{const T=Math.floor(l.pitcher.timer/200)%2===0;u.colors.length>1?T?(e=u.colors[0],t=u.colors[1]):t=null:T?e=u.colors[0]:e="#FFFFFF"}}Array.isArray(e)&&(e=e[0]),Array.isArray(t)&&(t=t[0]);let i="IDLE";if(l.pitcher.state===Ae.WINDUP){const u=l.pitcher.timer/l.pitcher.windupDuration;u<.3?i="SET":u<.7?i="KICK":i="THROW"}const n=!(l.pitcher.id==="SCARY")&&Y.currentTheme?.pitcherAccessories?Y.currentTheme.pitcherAccessories:{},r={...l.pitcher.props||{},...n};l.pitcher.id==="ACE"&&(r.sunglasses=!0,r.beard=!0,r.goldChain=!0);const d=vo(i,e,t,a,l.pitcher.skinColor,r),f=l.pitcher.scale||1,c=Ke*f,p=Ke*f,h=(Ke/2-Wa)*(f-1),m=l.pitcher.x-Wa*f-h,g=l.pitcher.y-ci*f;if(C.save(),l.pitcher.rotation){const u=m+c/2,T=g+p/2;C.translate(u,T),C.rotate(l.pitcher.rotation),C.translate(-u,-T)}l.pitcher.gender==="FEMALE"&&nl(C,m,g,f,l.pitcher.skinColor,i),C.drawImage(d,m,g,c,p),C.restore()}function nl(e,t,a,i,o,n="IDLE"){const r=o==="#000000"||o==="#1a1a1a"?o:"#FFD54F";let d=t+(Wa+8)*i,f=a+(ci-2)*i;n==="THROW"&&(d+=5*i,f+=2*i);const c=d+12*i,p=f-9*i,h=(l.pitcher.timer||0)/200;let m=0;(l.pitcher.state===Ae.WALK_ON||l.pitcher.state===Ae.WALK_OFF)&&(m=Math.sin(h)*(2*i)),e.fillStyle=r,e.beginPath(),e.moveTo(c,p),e.quadraticCurveTo(c+8*i,p-2*i+m,c+14*i,p+12*i+m),e.quadraticCurveTo(c+8*i,p+6*i+m,c+2*i,p+4*i),e.fill(),e.beginPath(),e.arc(c+1*i,p+2*i,4*i,0,Math.PI*2),e.fill()}const oa={STANDARD:{id:"STANDARD",name:"Pink Bat",color:"#ff69b4",type:"wood",draw(e,t,a){e.fillStyle=this.color,e.fillRect(0,-t/2,15,t),e.fillRect(15,-t/2-2,a,t+4)}},BLUE:{id:"BLUE",name:"Blue Bat",color:"#0000FF",type:"wood",pattern:"camo",draw(e,t,a){e.fillStyle=this.color,e.fillRect(0,-t/2,15,t),e.fillRect(15,-t/2-2,a,t+4)}},GOLD:{id:"GOLD",name:"Golden Glory",color:"#FFD700",type:"metal",draw(e,t,a){e.fillStyle="#B8860B",e.fillRect(0,-t/2,15,t);const i=e.createLinearGradient(15,-t/2,15,t/2);i.addColorStop(0,"#DAA520"),i.addColorStop(.3,"#FFD700"),i.addColorStop(.5,"#FFFFFF"),i.addColorStop(.7,"#FFD700"),i.addColorStop(1,"#DAA520"),e.fillStyle=i,e.fillRect(15,-t/2-2,a,t+4)}},LASER:{id:"LASER",name:"Neon Bat",color:"#00ffff",type:"energy"}},Pt={currentBat:oa.STANDARD,setBat(e){oa[e]&&(this.currentBat=oa[e])}};class He{constructor(t){this.setSeed(t)}setSeed(t){if(typeof t=="string"){let a=2166136261;for(let i=0;i<t.length;i++)a=Math.imul(a^t.charCodeAt(i),16777619);this.seed=a>>>0}else this.seed=t>>>0}random(){let t=this.seed+=1831565813;return t=Math.imul(t^t>>>15,t|1),t^=t+Math.imul(t^t>>>7,t|61),((t^t>>>14)>>>0)/4294967296}range(t,a){return this.random()*(a-t)+t}rangeInt(t,a){return Math.floor(this.random()*(a-t+1))+t}shuffle(t){for(let a=t.length-1;a>0;a--){const i=Math.floor(this.random()*(a+1));[t[a],t[i]]=[t[i],t[a]]}return t}choice(t){return t[Math.floor(this.random()*t.length)]}static getDailySeed(t=new Date){const a=t,i=a.getUTCFullYear(),o=String(a.getUTCMonth()+1).padStart(2,"0"),n=String(a.getUTCDate()).padStart(2,"0");return`${i}-${o}-${n}`}}const Ra=new He(Date.now()),Qt=256;class sl{constructor(){this.cache={},this.ctx=null,this.canvas=null,this.rng=new He(12345)}init(){this.canvas||(this.canvas=document.createElement("canvas"),this.canvas.width=Qt,this.canvas.height=Qt,this.ctx=this.canvas.getContext("2d",{willReadFrequently:!0}))}generate(t){this.init();const a=this.ctx,i=ot.BAT_WIDTH,o=ot.BAT_LENGTH,n=Qt/2,s=Qt/2;a.clearRect(0,0,Qt,Qt),a.save(),a.translate(n,s),t.id==="GOLD"?this.drawGoldBat(a,i,o):t.id==="LASER"?this.drawLaserBat(a,i,o):t.id==="MAGMA"?this.drawMagmaBat(a,i,o):t.id==="ZEUS"?this.drawZeusBat(a,i,o):t.id==="BLUE"?this.drawCamoBat(a,i,o):this.drawStandardBat(a,i,o,t.color),a.restore();const r=document.createElement("canvas");return r.width=Qt,r.height=Qt,r.getContext("2d").drawImage(this.canvas,0,0),r}generateIcon(t){const i=document.createElement("canvas");i.width=80,i.height=80;const o=i.getContext("2d"),n=ot.BAT_WIDTH,s=ot.BAT_LENGTH;return o.translate(80/2,80/2),o.rotate(-45*Math.PI/180),o.scale(1,1),o.translate(-32.5,0),t.id==="GOLD"?this.drawGoldBat(o,n,s):t.id==="LASER"?this.drawLaserBat(o,n,s):t.id==="MAGMA"?this.drawMagmaBat(o,n,s):t.id==="ZEUS"?this.drawZeusBat(o,n,s):t.id==="BLUE"?this.drawCamoBat(o,n,s):this.drawStandardBat(o,n,s,t.color),i}drawStandardBat(t,a,i,o){t.fillStyle=o,t.fillRect(0,-a/2,15,a),t.fillRect(15,-a/2-2,i,a+4)}drawCamoBat(t,a,i){this.rng.setSeed("BlueCamoBatPatternFlatV1"),t.beginPath(),t.rect(0,-a/2,15,a),t.rect(15,-a/2-2,i,a+4),t.clip(),t.fillStyle="#b0c4de",t.fillRect(0,-a/2-2,i+20,a+4),[{color:"#6495ed",count:8,sizeMin:10,sizeMax:20},{color:"#4169e1",count:8,sizeMin:8,sizeMax:18},{color:"#191970",count:6,sizeMin:6,sizeMax:15}].forEach(n=>{t.fillStyle=n.color;for(let s=0;s<n.count;s++){t.beginPath();const r=this.rng.random()*(i+20)-5,d=(this.rng.random()-.5)*a*4,f=this.rng.range(n.sizeMin,n.sizeMax),c=this.rng.range(n.sizeMin*.8,n.sizeMax),p=this.rng.random()*Math.PI*2;t.save(),t.translate(r,d),t.rotate(p),t.moveTo(0,-c/2),t.bezierCurveTo(f/2,-c/2,f,0,f/2,c/2),t.bezierCurveTo(0,c,-f/2,c/2,-f/2,0),t.bezierCurveTo(-f,-c/2,-f/2,-c/2,0,-c/2),t.fill(),t.restore()}}),t.fillStyle="rgba(0,0,0,0.4)";for(let n=0;n<15;n+=3)t.fillRect(n,-a/2,2,a)}drawGoldBat(t,a,i){t.fillStyle="#B8860B",t.fillRect(0,-a/2,15,a),t.fillStyle="rgba(0,0,0,0.2)",t.fillRect(2,-a/2,2,a),t.fillRect(6,-a/2,2,a),t.fillRect(10,-a/2,2,a);const o=t.createLinearGradient(15,-a/2,15,a/2);o.addColorStop(0,"#DAA520"),o.addColorStop(.3,"#FFD700"),o.addColorStop(.5,"#FFFFFF"),o.addColorStop(.7,"#FFD700"),o.addColorStop(1,"#DAA520"),t.fillStyle=o,t.fillRect(15,-a/2-2,i,a+4),t.fillStyle="#fff",t.globalAlpha=.8,t.beginPath(),t.arc(30,-5,1,0,Math.PI*2),t.fill(),t.beginPath(),t.arc(50,2,1.5,0,Math.PI*2),t.fill(),t.globalAlpha=1}drawLaserBat(t,a,i){t.shadowBlur=20,t.shadowColor="#00ffff",t.fillStyle="#00ffff",t.fillRect(0,-a/2,15,a),t.fillRect(15,-a/2-2,i,a+4),t.fillStyle="#e0ffff",t.shadowBlur=5,t.fillRect(15,-a/4,i,a/2),t.shadowBlur=0}drawMagmaBat(t,a,i){t.fillStyle="#2d2d2d",t.fillRect(0,-a/2,i+15,a),t.fillStyle="#ff4500";for(let o=0;o<15;o++){const n=Math.random()*i+10,s=(Math.random()-.5)*a,r=Math.random()*4+2,d=Math.random()*4+2;t.fillRect(n,s,r,d)}t.fillStyle="rgba(255, 69, 0, 0.3)",t.shadowBlur=10,t.shadowColor="#ff4500",t.fillRect(15,-a/2-2,i,a+4),t.shadowBlur=0}drawZeusBat(t,a,i){t.fillStyle="#dfe6e9",t.fillRect(0,-a/2,i+15,a),t.strokeStyle="#00d2d3",t.lineWidth=2,t.beginPath(),[10,20,30,40,50,60].forEach(n=>{t.moveTo(n,(Math.random()-.5)*a),t.lineTo(n+10,(Math.random()-.5)*a)}),t.stroke(),t.shadowBlur=8,t.shadowColor="#54a0ff",t.strokeStyle="#fff",t.lineWidth=1,t.stroke(),t.shadowBlur=0}}const Jn=new sl,fi={},Va=200;function ll(){si=null,Ro=-1,Po=null;for(const e in fi)delete fi[e]}function rl(e){const t=Pt.currentBat.id+"_"+e;if(fi[t])return fi[t];const a=document.createElement("canvas");a.width=Va,a.height=Va;const i=a.getContext("2d"),o=Va/2,n=Va/2;i.translate(o,n);const s=Jn.generate(Pt.currentBat);if(i.drawImage(s,-s.width/2,-s.height/2),e==="damaged"||e==="broken"){let r="#500000";Pt.currentBat.id==="GOLD"&&(r="#B8860B"),Pt.currentBat.id==="BLUE"&&(r="#000000"),i.fillStyle=r,i.fillRect(20,-4,2,2),i.fillRect(22,-2,2,2),i.fillRect(24,0,2,2),i.fillRect(35,4,2,2),i.fillRect(37,2,2,2),i.fillRect(39,0,2,2),i.fillRect(41,-2,2,2),i.fillRect(55,-4,2,2),i.fillRect(57,-2,2,2),i.fillRect(59,0,2,2)}if(e==="broken"){let r="#500000";Pt.currentBat.id==="GOLD"&&(r="#B8860B"),Pt.currentBat.id==="BLUE"&&(r="#000000"),i.fillStyle=r;for(let d=25;d<65;d+=3){const f=d%4===0?2:-2;i.fillRect(d,f,2,2)}i.fillRect(30,-6,4,2),i.fillRect(45,6,4,2),i.fillRect(60,-5,2,4)}if(e==="severed"){i.clearRect(15,-ot.BAT_WIDTH/2-2,ot.BAT_LENGTH+20,ot.BAT_WIDTH+4),i.fillStyle=Pt.currentBat.color||"#ff0000",i.fillRect(15,-ot.BAT_WIDTH/2-2,10,ot.BAT_WIDTH+4);const d=45+15;i.fillRect(d,-ot.BAT_WIDTH/2-2+-10,25,ot.BAT_WIDTH+4)}return fi[t]=a,a}let Po=null,Ro=-1,si=null;function cl(){const e=l.consecutiveFouls,t=Pt.currentBat.id;if(e!==Ro||t!==Po||!si){let a="normal";e>=4?a="severed":e>=3?a="broken":e>=2&&(a="damaged"),si=rl(a),Ro=e,Po=t}si&&(C.save(),C.translate(l.bat.pivotX,l.bat.pivotY),C.rotate(l.bat.angle),C.drawImage(si,-Va/2,-Va/2),C.restore())}function dl(){Wi.width=Ha,Wi.height=Ha;const e=Ha/2,t=Ha/2,a=ws/2;Fe.beginPath(),Fe.arc(e,t,a,0,Math.PI*2),Fe.fillStyle="#ffffff",Fe.fill(),Fe.save(),Fe.beginPath(),Fe.arc(e,t,a,0,Math.PI*2),Fe.clip(),Fe.strokeStyle="#ff0000",Fe.lineWidth=2,Fe.beginPath(),Fe.arc(e-a*1.2,t,a,-1,1),Fe.stroke(),Fe.beginPath(),Fe.arc(e+a*1.2,t,a,Math.PI-1,Math.PI+1),Fe.stroke(),Fe.restore(),Fe.beginPath(),Fe.arc(e,t,a,0,Math.PI*2),Fe.strokeStyle="#000000",Fe.lineWidth=1,Fe.stroke()}dl();function fl(e,t=1){if(e.invisible)return;let a=e.x,i=e.y,o=e.rotationAngle;typeof e.prevX<"u"&&typeof e.prevY<"u"&&(a=e.prevX+(e.x-e.prevX)*t,i=e.prevY+(e.y-e.prevY)*t),typeof e.prevRotationAngle<"u"&&(o=e.prevRotationAngle+(e.rotationAngle-e.prevRotationAngle)*t);const n=a+e.size/2,s=i+e.size/2;e.invisible||(C.fillStyle="rgba(0, 0, 0, 0.5)",C.beginPath(),C.ellipse(n,s+e.size*1.2,e.size*.7,e.size*.25,0,0,Math.PI*2),C.fill()),C.save(),C.translate(n,s),C.rotate(o),C.drawImage(Wi,-Ha/2,-Ha/2),C.restore()}function hl(){const e=Z/2+120,a=(l.bat?l.bat.pivotY:de*.85)+60,i=80,o=40;C.fillStyle="#d2b48c",C.beginPath(),C.roundRect(e,a,i,o,5),C.fill(),C.strokeStyle="#5a3a22",C.lineWidth=2,C.stroke();const n=8,s=24,r=e+16,d=a+o/2;for(let f=0;f<3;f++){const c=r+f*s;C.beginPath(),C.arc(c,d,n,0,Math.PI*2),f<V.strikes?(C.fillStyle="#ff0000",C.fill(),C.beginPath(),C.arc(c-2,d-2,2,0,Math.PI*2),C.fillStyle="#ffffff",C.fill()):(C.strokeStyle="#000000",C.lineWidth=2,C.stroke()),C.beginPath(),C.arc(c,d,n,0,Math.PI*2),C.strokeStyle="#000000",C.lineWidth=2,C.stroke()}}let ua=null;const ei=60,ul=30;function Qn(){if(!l.showTutorial){dt&&dt.style.display!=="none"&&(dt.style.display="none");return}dt&&dt.style.display!=="flex"&&(dt.style.display="flex");const e=Z,t=de,a=l.pitcher.x+l.pitcher.width/2,i=l.pitcher.y+l.pitcher.height/2+12;if(C.save(),C.fillStyle="rgba(0, 0, 0, 0.6)",C.beginPath(),C.rect(0,0,e,t),C.arc(a,i,ei,0,Math.PI*2,!0),C.fill(),!ua){const f=(ei+ul)*2;ua=document.createElement("canvas"),ua.width=f,ua.height=f;const c=ua.getContext("2d"),p=f/2,h=f/2;c.shadowColor="#FFD700",c.shadowBlur=20,c.strokeStyle="#FFD700",c.lineWidth=4,c.beginPath(),c.arc(p,h,ei,0,Math.PI*2),c.stroke()}const o=ua.width;C.drawImage(ua,a-o/2,i-o/2),C.shadowBlur=0;const n=i+ei+40,s=e/2;C.font='16px "PressStart2PLocal"',C.textAlign="center",C.textBaseline="top",C.strokeStyle="#000000",C.lineWidth=4,C.strokeText("WATCH PITCHER'S COLOR!",s,n),C.fillStyle="#FFFFFF",C.fillText("WATCH PITCHER'S COLOR!",s,n);const r=i+ei+10,d=a;C.fillStyle="#FFD700",C.beginPath(),C.moveTo(d,r),C.lineTo(d-10,r+15),C.lineTo(d+10,r+15),C.fill(),C.strokeStyle="#000000",C.lineWidth=2,C.beginPath(),C.moveTo(d,r),C.lineTo(d-10,r+15),C.lineTo(d+10,r+15),C.closePath(),C.stroke(),C.restore()}let Ca=null,li=null;const Ne=1024;let pa=null,Oa=null,Ii=null,xt={w:0,h:0,isNight:null,r:0};function En(e,t,a,i){Ca||pl();const o=Math.min(t,a)*.9,n=t/2,s=a+o*.6;if(xt.w!==t||xt.h!==a||xt.isNight!==i||xt.r!==o){if(pa=e.createRadialGradient(n,s-o*.6,o*.2,n,s,o),i?(pa.addColorStop(0,"#102030"),pa.addColorStop(1,"#050a10")):(pa.addColorStop(0,"#1565c0"),pa.addColorStop(.6,"#0d47a1"),pa.addColorStop(1,"#002171")),i)Oa=null;else{const g=n-o*.3,u=s-o*.6;Oa=e.createRadialGradient(g,u,0,g,u,o*.6),Oa.addColorStop(0,"rgba(255, 255, 255, 0.2)"),Oa.addColorStop(1,"rgba(255, 255, 255, 0)")}Ii=e.createLinearGradient(0,a+50,0,a-o*1.2),Ii.addColorStop(0,"rgba(0,0,0,0.9)"),Ii.addColorStop(1,"rgba(0,0,0,0)"),xt={w:t,h:a,isNight:i,cx:n,cy:s,r:o}}const d=o*2.5,f=Date.now()*.015%d,c=Date.now()*.02%d;if(!xt.persistentGlowCache){const u=document.createElement("canvas");u.width=2e3,u.height=2e3;const T=u.getContext("2d"),b=2e3/2,y=2e3/2,S=T.createRadialGradient(b,b,y*.4,b,b,y);i?(S.addColorStop(0,"rgba(255, 30, 0, 0.6)"),S.addColorStop(1,"rgba(100, 0, 0, 0)")):(S.addColorStop(0,"rgba(100, 149, 237, 0.4)"),S.addColorStop(1,"rgba(0, 50, 255, 0)")),T.fillStyle=S,T.beginPath(),T.arc(b,b,y,0,Math.PI*2),T.fill(),xt.persistentGlowCache=u}const p=Math.sin(Date.now()/2500)*.05+.95;e.save(),e.translate(n,s);const h=o*2.2*p;e.drawImage(xt.persistentGlowCache,-h/2,-h/2,h,h),e.restore(),e.save(),e.beginPath(),e.arc(n,s,o,0,Math.PI*2),e.clip(),e.fillStyle=pa,e.fill();const m=(g,u,T,b=1)=>{if(!g)return;e.globalAlpha=b,e.save(),e.translate(n,s);const y=-T/2-u;y<o&&y+T>-o&&e.drawImage(g,y,-T/2,T,T);const S=-T/2-u+T;S<o&&S+T>-o&&e.drawImage(g,S,-T/2,T,T),e.restore(),e.globalAlpha=1};if(i?(e.globalCompositeOperation="source-over",m(Ca,f,d,.3)):(e.globalCompositeOperation="source-over",m(Ca,f,d,1)),!i&&Oa){const g=n-o*.3,u=s-o*.6;e.fillStyle=Oa,e.beginPath(),e.arc(g,u,o*.7,0,Math.PI*2),e.fill()}m(li,c,d,i?.1:.6),e.fillStyle=Ii,e.fillRect(0,0,t,a),e.restore()}function pl(){Ca=document.createElement("canvas"),Ca.width=Ne,Ca.height=Ne;const e=Ca.getContext("2d");e.clearRect(0,0,Ne,Ne);const t=7;for(let o=0;o<t;o++){let n=Math.random()*Ne,s=Math.random()*(Ne*.6)+Ne*.2;const d=Math.random()>.3?"#2e7d32":"#8d6e63";e.fillStyle=d;let f=3e3,c=n,p=s;for(let h=0;h<f;h++){let m=2+Math.random()*4;e.beginPath(),e.arc(c,p,m,0,Math.PI*2),e.fill(),c<50&&(e.beginPath(),e.arc(c+Ne,p,m,0,Math.PI*2),e.fill()),c>Ne-50&&(e.beginPath(),e.arc(c-Ne,p,m,0,Math.PI*2),e.fill()),c+=(Math.random()-.5)*8,p+=(Math.random()-.5)*8,Math.random()>.99&&(c+=(Math.random()-.5)*50,p+=(Math.random()-.5)*50),Math.hypot(c-n,p-s)>150&&(c=n+(Math.random()-.5)*50,p=s+(Math.random()-.5)*50),p=Math.max(50,Math.min(Ne-50,p))}}li=document.createElement("canvas"),li.width=Ne,li.height=Ne;const a=li.getContext("2d");a.clearRect(0,0,Ne,Ne),a.fillStyle="#ffffff";const i=20;for(let o=0;o<i;o++){let n=Math.random()*Ne,s=Math.random()*Ne,r=Math.random()*50+50;for(let d=0;d<r;d++){let f=5+Math.random()*15;a.globalAlpha=.1+Math.random()*.2,a.beginPath(),a.arc(n,s,f,0,Math.PI*2),a.fill(),n<50&&(a.beginPath(),a.arc(n+Ne,s,f,0,Math.PI*2),a.fill()),n>Ne-50&&(a.beginPath(),a.arc(n-Ne,s,f,0,Math.PI*2),a.fill()),n+=(Math.random()-.5)*60,s+=(Math.random()-.5)*20,s=Math.max(0,Math.min(Ne,s))}}}const $i=[],ti=[],Ao=10,gl=8,so=[];for(let e=0;e<Ao;e++)$i.push({active:!1,type:"FIGHTER",x:0,y:0,vx:0,size:0,color:"#fff",blinkOffset:0});for(let e=0;e<4;e++)xn(e);function xn(e){if(so[e])return so[e];const t=60,a=document.createElement("canvas");a.width=t,a.height=t;const i=a.getContext("2d"),o=[],n=8;for(let s=0;s<n;s++){const r=s/n*Math.PI*2,d=t*.4+(Math.random()-.5)*(t*.2);o.push({x:t/2+Math.cos(r)*d,y:t/2+Math.sin(r)*d})}return i.fillStyle="#4a4a4a",i.strokeStyle="#2a2a2a",i.lineWidth=2,i.beginPath(),o.forEach((s,r)=>{r===0?i.moveTo(s.x,s.y):i.lineTo(s.x,s.y)}),i.closePath(),i.fill(),i.stroke(),i.fillStyle="#3a3a3a",i.beginPath(),i.arc(t*.4,t*.4,t*.1,0,Math.PI*2),i.fill(),so[e]=a,a}function wn(e,t,a){ti.length<gl&&Math.random()>.95&&ti.push({x:Math.random()>.5?-100:t+100,y:Math.random()*a,vx:(Math.random()-.5)*.5,vy:(Math.random()-.5)*.5,size:30+Math.random()*30,rotation:Math.random()*Math.PI,rotSpeed:(Math.random()-.5)*.02,variant:Math.floor(Math.random()*4)}),e.save();for(let i=ti.length-1;i>=0;i--){let o=ti[i];if(o.x+=o.vx,o.y+=o.vy,o.rotation+=o.rotSpeed,o.x<-200||o.x>t+200||o.y<-200||o.y>a+200){ti.splice(i,1);continue}const n=xn(o.variant);e.save(),e.translate(o.x,o.y),e.rotate(o.rotation),e.drawImage(n,-o.size/2,-o.size/2,o.size,o.size),e.restore()}e.restore()}function ml(e,t,a){const i=$i.find(r=>!r.active);if(!i)return;const o=Math.random()>.6,n=Math.random()>.5?1:-1;let s=o?t*.1+Math.random()*t*.4:t*.6+Math.random()*t*.3;i.active=!0,i.type=o?"FIGHTER":"CARGO",i.x=n===1?-150:e+150,i.y=s,i.vx=n*(o?3+Math.random()*2:.5+Math.random()),i.size=o?10+Math.random()*5:40+Math.random()*30,i.color=a?"#ff4d4d":Math.random()>.5?"#00e5ff":"#ffffff",i.blinkOffset=Math.random()*1e3}function lo(e,t,a,i){const o=Date.now();$i.filter(s=>s.active).length<Ao&&Math.random()>.92&&ml(t,a,i);for(let s=0;s<Ao;s++){const r=$i[s];if(!r.active)continue;r.x+=r.vx;const d=Math.max(t+200,3e3);if(r.x<-d||r.x>d){r.active=!1;continue}e.save(),e.translate(r.x,r.y),r.vx<0&&e.scale(-1,1),r.type==="CARGO"?(e.fillStyle=i?"#0a0505":"#080810",e.fillRect(-r.size/2,-r.size/4,r.size,r.size/2),e.fillStyle=i?"#050202":"#05050a",e.fillRect(-r.size*1.5,-r.size/3,r.size,r.size*.6),Math.floor((o+r.blinkOffset)/1e3)%2===0&&(e.fillStyle="#aa0000",e.fillRect(r.size*.4,-r.size*.2,2,2))):(e.fillStyle=r.color,e.beginPath(),e.moveTo(r.size,0),e.lineTo(-r.size/2,-r.size/2),e.lineTo(-r.size/2,r.size/2),e.closePath(),e.fill(),e.strokeStyle=r.color,e.globalAlpha=.6,e.lineWidth=2,e.beginPath(),e.moveTo(-r.size/2,0),e.lineTo(-r.size*3,0),e.stroke(),e.globalAlpha=1,e.fillStyle="#fff",e.beginPath(),e.arc(0,0,2,0,Math.PI*2),e.fill()),e.restore()}}const Ge={x:-300,y:100,active:!1,hoverTimer:0};let _t=null,Mn=null,_n=null;function yl(e){const t=e?"night":"day";if(_t&&_n===t)return _t;_t||(_t=document.createElement("canvas"),_t.width=600,_t.height=400,Mn=_t.getContext("2d"));const a=Mn,i=_t.width,o=_t.height;a.clearRect(0,0,i,o),a.save(),a.translate(i/2,o/2),_n=t;const n=f=>{a.save(),a.scale(f,1),a.strokeStyle=e?"#444":"#666",a.lineWidth=4,a.beginPath(),a.moveTo(35,0),a.lineTo(80,0),a.stroke(),a.strokeStyle="#444",a.lineWidth=1,a.beginPath(),a.moveTo(40,-5),a.lineTo(75,5),a.moveTo(40,5),a.lineTo(75,-5),a.stroke();const c=e?"#001a4d":"#1a4d80",p=e?"#003366":"#2980b9",h="rgba(255, 255, 255, 0.2)";a.translate(80,0);for(let m=0;m<3;m++){const g=m*42,u=-35,T=40,b=70;a.fillStyle=c,a.fillRect(g,u,T,b),a.fillStyle=p;for(let y=0;y<4;y++)for(let S=0;S<2;S++)a.fillRect(g+2+S*19,u+2+y*17,17,15);a.fillStyle=h,a.beginPath(),a.moveTo(g,u),a.lineTo(g+T,u),a.lineTo(g,u+b/2),a.fill(),a.strokeStyle="#555",a.lineWidth=2,a.strokeRect(g,u,T,b)}a.restore()};n(1),n(-1);const s=60,r=70,d=a.createLinearGradient(0,-r/2,0,r/2);return e?(d.addColorStop(0,"#555"),d.addColorStop(.2,"#333"),d.addColorStop(.5,"#222"),d.addColorStop(.8,"#333"),d.addColorStop(1,"#555")):(d.addColorStop(0,"#bdc3c7"),d.addColorStop(.2,"#95a5a6"),d.addColorStop(.5,"#7f8c8d"),d.addColorStop(.8,"#95a5a6"),d.addColorStop(1,"#bdc3c7")),a.fillStyle=d,a.fillRect(-s/2,-r/2,s,r),a.fillStyle="rgba(0,0,0,0.3)",a.fillRect(-s/2,-r/2+20,s,2),a.fillRect(-s/2,-r/2+50,s,2),a.fillRect(-s/4,-r/2,2,20),a.fillRect(s/4,50-r/2,2,20),a.strokeStyle="#2c3e50",a.lineWidth=2,a.strokeRect(-s/2,-r/2,s,r),a.fillStyle="#444",a.fillRect(-15,-15,30,30),a.strokeStyle="#888",a.strokeRect(-15,-15,30,30),a.fillStyle="#222",a.beginPath(),a.arc(0,0,4,0,Math.PI*2),a.fill(),a.save(),a.translate(0,35),a.fillStyle="#333",a.fillRect(-15,0,30,10),a.restore(),a.restore(),_t}function In(e,t,a,i,o=!1){if(o){Ge.active||(Ge.active=!0,Ge.x=t*.5,Ge.y=a*.45);const y=t*.5,S=a*.45;Ge.hoverTimer+=.02;const A=Math.sin(Ge.hoverTimer)*10,v=Math.cos(Ge.hoverTimer*.7)*5;Ge.x+=(y+v-Ge.x)*.1,Ge.y+=(S+A-Ge.y)*.1}else{Ge.active||(Ge.active=!0,Ge.x=-200,Ge.y=a*.5);const y=t*.5,S=a*.5;Ge.x+=(y-Ge.x)*.04,Ge.y+=(S-Ge.y)*.04,Math.abs(Ge.x-y)<10&&(Ge.hoverTimer+=.02,Ge.y+=Math.sin(Ge.hoverTimer)*.5)}const n=Ge.x,s=Ge.y,r=1.2,d=Date.now();e.save(),e.translate(n,s),e.scale(r,r),e.save(),e.translate(0,-35);const f=Math.sin(d/2e3)*.5;e.rotate(f),e.fillStyle=i?"#333":"#444",e.fillRect(-3,0,6,15),e.beginPath(),e.arc(0,-10,18,0,Math.PI,!0),e.fillStyle=i?"#888":"#ccc",e.fill(),e.strokeStyle=i?"#666":"#999",e.lineWidth=2,e.stroke(),e.beginPath(),e.moveTo(0,-10),e.lineTo(0,-35),e.strokeStyle="#fff",e.stroke(),e.fillStyle="red",e.beginPath(),e.arc(0,-35,2,0,Math.PI*2),e.fill(),e.restore();const c=yl(i);e.drawImage(c,-c.width/2,-c.height/2);const p=206;Math.floor(d/500)%2===0&&(e.fillStyle="rgba(0, 255, 0, 0.4)",e.beginPath(),e.arc(p,0,8,0,Math.PI*2),e.fill(),e.fillStyle="#00ff00",e.beginPath(),e.arc(p,0,4,0,Math.PI*2),e.fill(),e.fillStyle="rgba(255, 0, 0, 0.4)",e.beginPath(),e.arc(-p,0,8,0,Math.PI*2),e.fill(),e.fillStyle="#ff0000",e.beginPath(),e.arc(-p,0,4,0,Math.PI*2),e.fill()),e.translate(0,35);const h=90,m=220,g=e.createLinearGradient(0,10,0,10+h);i?(g.addColorStop(0,"rgba(255, 0, 0, 0.6)"),g.addColorStop(.2,"rgba(255, 0, 0, 0.1)"),g.addColorStop(1,"rgba(255, 0, 0, 0)")):(g.addColorStop(0,"rgba(0, 229, 255, 0.6)"),g.addColorStop(.2,"rgba(0, 229, 255, 0.1)"),g.addColorStop(1,"rgba(0, 229, 255, 0)")),e.fillStyle=g,e.beginPath(),e.moveTo(-15,10),e.lineTo(15,10),e.lineTo(m/2,10+h),e.lineTo(-m/2,10+h),e.closePath(),e.fill(),e.strokeStyle=i?"rgba(255, 0, 0, 0.1)":"rgba(0, 229, 255, 0.1)",e.lineWidth=1;for(let y=0;y<5;y++){const S=20+y*15;e.beginPath(),e.moveTo(-m/4,S),e.lineTo(m/4,S),e.stroke()}const u=10+h-30;e.fillStyle="#ffffff",e.font='14px "PressStart2PLocal"',e.textAlign="center";const T=l.isDailyChallenge?"DAILY":"HIGH SCORE";e.fillText(T,0,u-20);let b=l.highScore||0;if(l.isDailyChallenge){const y=new Date,S=y.getUTCFullYear(),A=String(y.getUTCMonth()+1).padStart(2,"0"),v=String(y.getUTCDate()).padStart(2,"0"),P=`${S}-${A}-${v}`;b=parseInt(q.getItem(`baseball_daily_score_${P}`,"0"))||0}e.font='24px "PressStart2PLocal"',e.fillStyle=l.isDailyChallenge?"#f1c40f":"#ffffff",e.fillText(b.toString(),0,u+15),e.restore()}let It=null;const it={w:0,h:0,vignette:null,glass:null,upperBeam:null,lowerBeam:null,core:null};function es(e,t,a,i=!1){const o=e.createLinearGradient(0,0,0,a);i?(o.addColorStop(0,"#1a0000"),o.addColorStop(.5,"#000000"),o.addColorStop(1,"#220000")):(o.addColorStop(0,"#050520"),o.addColorStop(.5,"#1a0b2e"),o.addColorStop(1,"#000005")),e.fillStyle=o,e.fillRect(0,0,t,a),e.save();const n=(s,r,d,f)=>{const c=e.createRadialGradient(s,r,0,s,r,d);c.addColorStop(0,f),c.addColorStop(1,"rgba(0,0,0,0)"),e.fillStyle=c,e.beginPath(),e.arc(s,r,d,0,Math.PI*2),e.fill()};n(t*.2,a*.15,t*.25,"rgba(128, 0, 128, 0.2)"),n(t*.7,a*.2,t*.3,"rgba(255, 105, 180, 0.15)"),e.restore()}const Xi=(e,t)=>{const a=t||e*.28,i=140,o=a-i/2,n=a+i/2,s=64,r=o,d=r-s,f=d+2,c=n,p=25,h=c+p;return{floorTop:o,floorBottom:n,floorH:i,consoleTop:d,consoleBottom:r,consoleH:s,winBottom:f,cautionTop:c,cautionBottom:h,cautionH:p}},za=(e,t,a,i,o)=>{e.save(),e.globalCompositeOperation="screen";let n=o;const s=()=>(n=(n*9301+49297)%233280,n/233280);((f,c,p,h)=>{const m=e.createRadialGradient(f,c,0,f,c,p);m.addColorStop(0,h),m.addColorStop(1,"rgba(0,0,0,0)"),e.fillStyle=m,e.beginPath(),e.arc(f,c,p,0,Math.PI*2),e.fill()})(t,a,i,"rgba(40, 0, 80, 0.4)");const d=150;for(let f=0;f<d;f++){const c=s()*Math.PI*2,p=s()*i*.8,h=t+Math.cos(c)*p,m=a+Math.sin(c)*p,g=i*.1+s()*i*.15;let u;const T=s();T<.4?u=`rgba(255, 64, 129, ${.1+s()*.1})`:T<.8?u=`rgba(48, 79, 254, ${.1+s()*.1})`:u=`rgba(0, 229, 255, ${.05+s()*.05})`;const b=e.createRadialGradient(h,m,0,h,m,g);b.addColorStop(0,u),b.addColorStop(1,"rgba(0,0,0,0)"),e.fillStyle=b,e.beginPath(),e.arc(h,m,g,0,Math.PI*2),e.fill()}e.restore()};function Sl(e,t,a,i){e.save();const n=Xi(a,i).winBottom,s=n;e.beginPath(),e.rect(0,0,t,n),e.clip();const r=0,d=t*.32,f=t*.68,c=t-f;za(e,t*.2,s*.5,t*.3,101),za(e,t*.8,s*.4,t*.3,202);const p=(m,g,u,T,b)=>{e.save();const y=u*1.15,S=e.createRadialGradient(m,g,u,m,g,y);if(S.addColorStop(0,"rgba(255,255,255,0.3)"),S.addColorStop(1,"rgba(255,255,255,0)"),e.fillStyle=S,e.beginPath(),e.arc(m,g,y,0,Math.PI*2),e.fill(),e.beginPath(),e.arc(m,g,u,0,Math.PI*2),e.fillStyle=T,e.fill(),e.save(),e.clip(),b==="moon"){e.fillStyle="rgba(0,0,0,0.15)";const v=(P,w,D)=>{e.beginPath(),e.ellipse(P,w,D,D*.7,Math.random(),0,Math.PI*2),e.fill()};v(m-u*.3,g-u*.2,u*.25),v(m+u*.4,g+u*.3,u*.2),v(m+u*.1,g+u*.5,u*.15),v(m-u*.2,g+u*.6,u*.1)}else b==="earth"?(e.fillStyle="#27ae60",e.beginPath(),e.moveTo(m-u*.7,g-u*.3),e.lineTo(m-u*.4,g-u*.5),e.lineTo(m-u*.2,g-u*.1),e.lineTo(m-u*.5,g+u*.4),e.lineTo(m-u*.8,g+u*.1),e.fill(),e.beginPath(),e.moveTo(m+u*.3,g-u*.6),e.lineTo(m+u*.6,g-u*.4),e.lineTo(m+u*.5,g+u*.2),e.lineTo(m+u*.2,g+u*.5),e.lineTo(m+u*.1,g-u*.1),e.fill(),e.beginPath(),e.arc(m,g+u*.6,u*.15,0,Math.PI*2),e.fill(),e.fillStyle="#ffffff",e.beginPath(),e.arc(m,g-u*.95,u*.2,0,Math.PI*2),e.fill(),e.fillStyle="rgba(255, 255, 255, 0.3)",e.fillRect(m-u*.8,g,u*1.6,u*.05),e.fillRect(m-u*.6,g-u*.4,u*1.2,u*.04),e.fillStyle="rgba(255, 255, 255, 0.2)",e.beginPath(),e.arc(m+u*.3,g-u*.3,u*.1,0,Math.PI*2),e.fill()):b==="orange"&&(e.fillStyle="rgba(255, 255, 255, 0.15)",e.beginPath(),e.rect(m-u,g-u*.3,u*2,u*.15),e.fill(),e.beginPath(),e.rect(m-u,g+u*.1,u*2,u*.1),e.fill(),e.beginPath(),e.rect(m-u,g+u*.5,u*2,u*.05),e.fill());e.restore();const A=e.createRadialGradient(m-u*.3,g-u*.3,u*.5,m,g,u);A.addColorStop(0,"rgba(0,0,0,0)"),A.addColorStop(1,"rgba(0,0,0,0.7)"),e.fillStyle=A,e.beginPath(),e.arc(m,g,u,0,Math.PI*2),e.fill(),e.fillStyle="rgba(10, 20, 40, 0.4)",e.fill(),e.restore()},h=Math.min(d,s)*.35;p(r+d*.3,s*.4,h,"#bdc3c7","moon"),p(r+d*.7,s*.7,h*1.2,"#8d6e63","mars"),p(f+c*.3,s*.6,h*1.3,"#3498db","earth"),p(f+c*.8,s*.3,h*1.1,"#d35400","orange"),e.restore()}function ts(e,t,a,i){e.save();const s=Xi(a,i).winBottom,r=0,d=t*.32,f=t*.32,c=t*.68-f,p=t*.68,h=t-p,m=(b,y,S,A)=>{const v=e.createLinearGradient(b,y,b,y+A);v.addColorStop(0,"rgba(135, 206, 235, 0.2)"),v.addColorStop(1,"rgba(135, 206, 235, 0.05)"),e.fillStyle=v,e.fillRect(b,y,S,A)};m(r,0,d,s),m(f,0,c,s),m(p,0,h,s);const g=(b,y,S,A,v=!1)=>{const P=e.createLinearGradient(b,y,v?b+S:b,v?y:y+A);P.addColorStop(0,"#2c3e50"),P.addColorStop(.3,"#78909c"),P.addColorStop(.7,"#455a64"),P.addColorStop(1,"#2c3e50"),e.fillStyle=P,e.fillRect(b,y,S,A),e.fillStyle="rgba(0,0,0,0.5)",v?e.fillRect(b+S*.3,y,S*.4,A):e.fillRect(b,y+A*.3,S,A*.4),e.fillStyle="#111";const w=1.5;if(v)for(let D=10;D<A;D+=20)e.beginPath(),e.arc(b+S/2,y+D,w,0,Math.PI*2),e.fill();else for(let D=10;D<S;D+=40)e.beginPath(),e.arc(b+D,y+A/2,w,0,Math.PI*2),e.fill();e.fillStyle="rgba(255,255,255,0.15)",v?e.fillRect(b,y,1,A):e.fillRect(b,y,S,1)},u=16;g(f-u/2,0,u,s,!0),g(p-u/2,0,u,s,!0);const T=12;g(0,s-T,t,T,!1),g(0,0,t,12,!1),e.restore()}function Dn(e,t,a){const i=(n,s,r,d,f)=>{e.save();const c=r*1.15,p=e.createRadialGradient(n,s,r,n,s,c);if(p.addColorStop(0,"rgba(255,255,255,0.3)"),p.addColorStop(1,"rgba(255,255,255,0)"),e.fillStyle=p,e.beginPath(),e.arc(n,s,c,0,Math.PI*2),e.fill(),e.beginPath(),e.arc(n,s,r,0,Math.PI*2),e.fillStyle=d,e.fill(),e.save(),e.clip(),f==="moon"||f==="rocky"){e.fillStyle="rgba(0,0,0,0.15)";const m=(g,u,T)=>{e.beginPath(),e.ellipse(g,u,T,T*.7,Math.random(),0,Math.PI*2),e.fill()};m(n-r*.3,s-r*.2,r*.25),m(n+r*.4,s+r*.3,r*.2),m(n+r*.1,s+r*.5,r*.15),m(n-r*.2,s+r*.6,r*.1)}else f==="earth"?(e.fillStyle="#27ae60",e.beginPath(),e.moveTo(n-r*.7,s-r*.3),e.lineTo(n-r*.4,s-r*.5),e.lineTo(n-r*.2,s-r*.1),e.lineTo(n-r*.5,s+r*.4),e.lineTo(n-r*.8,s+r*.1),e.fill(),e.beginPath(),e.moveTo(n+r*.3,s-r*.6),e.lineTo(n+r*.6,s-r*.4),e.lineTo(n+r*.5,s+r*.2),e.lineTo(n+r*.2,s+r*.5),e.lineTo(n+r*.1,s-r*.1),e.fill(),e.fillStyle="rgba(255, 255, 255, 0.2)",e.beginPath(),e.arc(n+r*.3,s-r*.3,r*.1,0,Math.PI*2),e.fill()):f==="gas"&&(e.fillStyle="rgba(255, 255, 255, 0.15)",e.beginPath(),e.rect(n-r,s-r*.3,r*2,r*.15),e.fill(),e.beginPath(),e.rect(n-r,s+r*.1,r*2,r*.1),e.fill(),e.beginPath(),e.rect(n-r,s+r*.5,r*2,r*.05),e.fill());e.restore();const h=e.createRadialGradient(n-r*.3,s-r*.3,r*.1,n,s,r);h.addColorStop(0,"rgba(0,0,0,0)"),h.addColorStop(.5,"rgba(0,0,0,0.1)"),h.addColorStop(1,"rgba(0,0,0,0.8)"),e.fillStyle=h,e.beginPath(),e.arc(n,s,r,0,Math.PI*2),e.fill(),e.fillStyle="rgba(10, 20, 40, 0.4)",e.beginPath(),e.arc(n,s,r,0,Math.PI*2),e.fill(),e.restore()},o=Math.min(t,a);i(t*.15,a*.5,o*.11,"#c0392b","rocky"),i(t*.28,a*.38,o*.05,"#4fc3f7","rocky"),i(t*.85,a*.45,o*.12,"#8e44ad","rocky"),i(t*.72,a*.65,o*.07,"#f39c12","gas")}let Dt=[],Fi=null;function as(){if(Dt.length===0)return;const e=Dt.shift();if(e)try{e()}catch(t){console.error("[SpaceRenderer] Warmup Task Failed:",t)}Dt.length>0&&(Fi=setTimeout(as,16))}function is(e,t){if(It&&It.width===e&&It.height===t)return;console.log(`[SpaceRenderer] Starting Async Warmup: ${e}x${t}`),Fi&&clearTimeout(Fi),Dt=[],It||(It=document.createElement("canvas")),It.width=e,It.height=t;const a=It.getContext("2d"),i=a.createLinearGradient(0,0,0,t);i.addColorStop(0,"#050520"),i.addColorStop(.5,"#1a0b2e"),i.addColorStop(1,"#000005"),a.fillStyle=i,a.fillRect(0,0,e,t);const o=Math.min(e,t)*.6;Dn(a,e,t),Dt.push(()=>za(a,e*.1,t*.5,o,111)),Dt.push(()=>za(a,e*.9,t*.55,o,444)),Dt.push(()=>za(a,e*.2,t*.4,o*.8,222)),Dt.push(()=>za(a,e*.8,t*.45,o*.8,333)),Dt.push(()=>Dn(a,e,t)),Dt.push(()=>{const n=s=>ns(s,5,10);n("#ff0000"),n("#ffff00"),n("#00ff00"),n("#ffa500"),n("#ff8c00"),console.log("[SpaceRenderer] Surge Sprites Warmed Up")}),Fi=setTimeout(as,0)}function os(e,t,a,i,o,n,s=!1,r=!0){e.save();const d=Xi(a,n);is(t,a),It&&e.drawImage(It,0,0),s&&l.isGameOver&&(e.fillStyle="rgba(20, 0, 0, 0.6)",e.fillRect(0,0,t,a));const f=20,c="#2c3e50",p=i||t/2,h=o||a*.85,m=(U,ae,we,_e)=>{e.save();const et=Math.atan2(_e-ae,we-U),at=Math.hypot(we-U,_e-ae);e.translate(U,ae),e.rotate(et);const mt=e.createLinearGradient(0,-f/2,0,f/2);mt.addColorStop(0,"#2c3e50"),mt.addColorStop(.5,"#546e7a"),mt.addColorStop(1,"#2c3e50"),e.fillStyle=mt,e.fillRect(0,-f/2,at,f),e.strokeStyle=c,e.lineWidth=2,e.strokeRect(0,-f/2,at,f),e.fillStyle="#2c3e50";for(let Mt=30;Mt<at;Mt+=50)e.beginPath(),e.arc(Mt,0,4,0,Math.PI*2),e.fill(),e.fillStyle="rgba(255,255,255,0.3)",e.beginPath(),e.arc(Mt-1,-1,2,0,Math.PI*2),e.fill(),e.fillStyle="#2c3e50";e.restore()};m(p,h,0,h-p*1.5),m(p,h,t,h-(t-p)*1.5),m(p,h,t*.2,a),m(p,h,t*.8,a);const g=d.floorH,u=d.floorTop,T=d.floorBottom,b=d.consoleH,y=d.consoleBottom,S=d.consoleTop,A=e.createLinearGradient(0,S,0,y);A.addColorStop(0,"#2c3e50"),A.addColorStop(.5,"#546e7a"),A.addColorStop(1,"#2c3e50"),e.fillStyle=A,e.fillRect(0,S,t,b),e.strokeStyle="#1c2833",e.lineWidth=2,e.strokeRect(0,S,t,b);const v=(U,ae,we)=>{e.beginPath(),e.arc(U,ae,7,0,Math.PI*2),e.fillStyle="#111",e.fill(),e.strokeStyle="#333",e.lineWidth=1,e.stroke(),e.beginPath(),e.arc(U,ae,5,0,Math.PI*2);const _e=e.createRadialGradient(U-2,ae-2,1,U,ae,6);_e.addColorStop(0,"#444"),_e.addColorStop(.5,"#222"),_e.addColorStop(1,"#000"),e.fillStyle=_e,e.fill(),e.strokeStyle=we,e.globalAlpha=.5,e.lineWidth=1,e.stroke(),e.globalAlpha=1,e.fillStyle="rgba(255, 255, 255, 0.3)",e.beginPath(),e.arc(U-2,ae-2,1.5,0,Math.PI*2),e.fill()};v(t*.15,S+b*.3,"#500"),v(t*.18,S+b*.3,"#550"),v(t*.21,S+b*.3,"#050"),v(t*.85,S+b*.5,"#500"),v(t*.82,S+b*.5,"#530");const P=t*.35,w=S+5,D=t*.3,k=b-10;e.fillStyle="#111",e.fillRect(P-4,w-4,D+8,k+8),e.save();const I=e.createLinearGradient(0,u,0,T);I.addColorStop(0,"rgba(200, 200, 200, 0.05)"),I.addColorStop(.5,"rgba(255, 255, 255, 0.02)"),I.addColorStop(1,"rgba(200, 200, 200, 0.05)"),e.fillStyle=I,e.fillRect(0,u,t,g),e.strokeStyle="rgba(0, 255, 255, 0.15)",e.lineWidth=1,e.beginPath();for(let U=0;U<=t;U+=40)e.moveTo(U,u),e.lineTo(U,T);for(let U=u;U<=T;U+=10)e.moveTo(0,U),e.lineTo(t,U);e.stroke();const _=i||t*.5,H=n||u+g*.5,M=g*.35,L=(window.spaceRendererTime||Date.now())/500,z=.5+Math.sin(L)*.2,ne=e.createRadialGradient(_,H,0,_,H,M*.6);ne.addColorStop(0,`rgba(255, 165, 0, ${z*.3})`),ne.addColorStop(1,"rgba(0, 0, 0, 0)"),e.fillStyle=ne,e.beginPath(),e.arc(_,H,M*.6,0,Math.PI*2),e.fill(),e.fillStyle="rgba(0, 0, 0, 0.3)",e.beginPath(),e.arc(_,H,M*.6,0,Math.PI*2),e.fill(),e.strokeStyle="#1c2833",e.lineWidth=2,e.beginPath();for(let U=-M*.6;U<M*.6;U+=8){const ae=Math.sqrt(Math.pow(M*.6,2)-Math.pow(U,2));e.moveTo(_-ae,H+U),e.lineTo(_+ae,H+U)}e.stroke(),e.strokeStyle="#7f8c8d",e.lineWidth=4,e.beginPath(),e.arc(_,H,M,0,Math.PI*2),e.stroke(),e.strokeStyle="#000",e.lineWidth=1,e.beginPath(),e.arc(_,H,M-2,0,Math.PI*2),e.stroke(),e.restore();const W=T,X=a-W-a*.05;e.save(),e.fillStyle="rgba(10, 10, 15, 0.3)",e.fillRect(0,W,t,X),e.save(),e.beginPath(),e.rect(0,W,t,X),e.clip(),e.strokeStyle="rgba(0, 255, 255, 0.05)",e.lineWidth=1;const N=20,K=N*1.5,pe=N*Math.sqrt(3);for(let U=W;U<W+X+pe;U+=pe)for(let ae=0;ae<t+K;ae+=K*2){const we=(_e,et)=>{e.beginPath();for(let at=0;at<6;at++)e.lineTo(_e+N*Math.cos(at*Math.PI/3),et+N*Math.sin(at*Math.PI/3));e.closePath(),e.stroke()};we(ae,U),we(ae+K,U+pe/2)}e.restore(),e.strokeStyle="rgba(0, 255, 255, 0.3)",e.lineWidth=2,e.beginPath(),e.moveTo(0,W),e.lineTo(t,W),e.stroke(),e.restore();const oe=T,J=25,ye=oe+J,Pe=e.createLinearGradient(0,oe,0,ye);Pe.addColorStop(0,"#2c3e50"),Pe.addColorStop(.5,"#546e7a"),Pe.addColorStop(1,"#2c3e50"),e.fillStyle=Pe,e.fillRect(0,oe,t,J);const me=60,ge=oe+J/2,Le=t*.05;for(let U=20;U<t;U+=me)U<Le||U>t-Le||(e.beginPath(),e.arc(U,ge,6,0,Math.PI*2),e.fillStyle="#111",e.fill(),e.fillStyle="#442200",e.beginPath(),e.arc(U,ge,4,0,Math.PI*2),e.fill(),e.fillStyle="rgba(255, 255, 255, 0.4)",e.beginPath(),e.arc(U-1.5,ge-1.5,1.5,0,Math.PI*2),e.fill());e.fillStyle="#1c2833",e.fillRect(0,oe,t,2),e.fillRect(0,ye,t,4);const Xe=(h-ye)/1.5,Q=p-Xe,re=p+Xe,Se=40,Te=12,Ye=(U,ae)=>{e.fillStyle="#34495e",e.fillRect(U-Se/2,ae-Te/2,Se,Te),e.strokeStyle="#1c2833",e.lineWidth=2,e.strokeRect(U-Se/2,ae-Te/2,Se,Te),e.fillStyle="#bdc3c7",e.beginPath(),e.arc(U-12,ae,3,0,Math.PI*2),e.fill(),e.beginPath(),e.arc(U+12,ae,3,0,Math.PI*2),e.fill()};Ye(Q,ye),Ye(re,ye);const E=t*.2,R=(t-E)/2,B=ye+4,O=a*.25,j=6;e.fillStyle="#2c3e50",e.fillRect(R,B,E,j),e.fillRect(R,B+O-j,E,j),e.fillRect(R,B,j,O),e.fillRect(R+E-j,B,j,O),e.fillStyle="rgba(0, 0, 0, 0.4)",e.fillRect(R+j,B+j,E-j*2,O-j*2);const $=.2,ee=e.createLinearGradient(R,B,R+E,B);ee.addColorStop(0,"rgba(0, 255, 255, 0)"),ee.addColorStop(.2,`rgba(0, 255, 255, ${$*.2})`),ee.addColorStop(.5,`rgba(0, 255, 255, ${$})`),ee.addColorStop(.8,`rgba(0, 255, 255, ${$*.2})`),ee.addColorStop(1,"rgba(0, 255, 255, 0)"),e.fillStyle=ee,e.fillRect(R,B,E,O),e.fillStyle=`rgba(0, 255, 255, ${$*.5})`;for(let U=B;U<B+O;U+=4)Math.floor(U/20)%2===0&&e.fillRect(R+E*.4,U,E*.2,1);e.restore();const te=10,se=E-te*2,ce=(O-te*3)/2,ie=(U,ae,we,_e)=>{e.strokeStyle="#34495e",e.lineWidth=1,e.strokeRect(U,ae,we,_e),e.fillStyle="#2c3e50";const et=3,at=we/(et+1);for(let bt=1;bt<=et;bt++)e.fillRect(U+bt*at-1,ae,2,_e);const mt=3,Mt=10;for(let bt=ae+Mt;bt<ae+_e-Mt;bt+=mt+Mt)e.fillStyle="#546e7a",e.fillRect(U+2,bt,we-4,mt),e.fillStyle="rgba(255,255,255,0.1)",e.fillRect(U+2,bt,we-4,1),e.fillStyle="rgba(0,0,0,0.3)",e.fillRect(U+2,bt+mt-1,we-4,1)};ie(R+te,B+te,se,ce),ie(R+te,B+te+ce+te,se,ce);const Ce=(U,ae,we,_e,et,at)=>{e.beginPath(),e.moveTo(U,ae),e.quadraticCurveTo(U,ae+at,we,_e),e.strokeStyle=et,e.lineWidth=3,e.stroke()};Ce(R-40,ye,R,B+50,"#e74c3c",20),Ce(R-30,ye,R,B+60,"#2c3e50",20),Ce(R+E+40,ye,R+E,B+50,"#2ecc71",20),Ce(R+E+30,ye,R+E,B+60,"#2c3e50",20);const le=i||t/2,fe=o||a*.85,he=t*.25,be=(t-he)/2,We=fe+20,St=T+25+4,Ot=a*.25,Re=St+Ot,xe=We-Re;e.save();const ft=12,Tt=t*.2,ji=(t-Tt)/2,Xa=(U,ae,we)=>{const _e=e.createLinearGradient(U,ae,U+ft,ae);_e.addColorStop(0,"#2c3e50"),_e.addColorStop(.5,"#78909c"),_e.addColorStop(1,"#2c3e50"),e.fillStyle=_e,e.fillRect(U,ae-50,ft,50),e.fillStyle="#34495e",e.fillRect(U-2,ae-10,ft+4,8)};Xa(ji-4,Re),Xa(ji+Tt-ft+4,Re);const ve=6;e.fillStyle="#2c3e50",e.fillRect(be,Re,he,ve),e.fillRect(be,Re+xe-ve,he,ve),e.fillRect(be,Re,ve,xe),e.fillRect(be+he-ve,Re,ve,xe),e.fillStyle="rgba(0, 0, 0, 0.4)",e.fillRect(be+ve,Re+ve,he-ve*2,xe-ve*2);const Bt=.2;e.save(),e.beginPath(),e.rect(be+ve,Re+ve,he-ve*2,xe-ve*2),e.clip();const Ft=e.createLinearGradient(be,Re,be+he,Re);Ft.addColorStop(0,"rgba(0, 255, 255, 0)"),Ft.addColorStop(.2,`rgba(0, 255, 255, ${Bt*.2})`),Ft.addColorStop(.5,`rgba(0, 255, 255, ${Bt})`),Ft.addColorStop(.8,`rgba(0, 255, 255, ${Bt*.2})`),Ft.addColorStop(1,"rgba(0, 255, 255, 0)"),e.fillStyle=Ft,e.fillRect(be,Re,he,xe),e.fillStyle=`rgba(0, 255, 255, ${Bt*.5})`;for(let U=Re;U<Re+xe;U+=4)Math.floor(U/20)%2===0&&e.fillRect(be+he*.4,U,he*.2,1);e.restore(),e.strokeStyle="#1c2833",e.lineWidth=4,e.strokeRect(be,Re,he,xe),e.fillStyle="#2c3e50";const Za=2,mi=he/(Za+1);for(let U=1;U<=Za;U++)e.fillRect(be+U*mi-2,Re,4,xe);const qt=60,Ma=15,Xt=le-qt/2,_a=fe-10;e.fillStyle="#34495e",e.fillRect(Xt,_a,qt,Ma),e.strokeStyle="#1c2833",e.strokeRect(Xt,_a,qt,Ma),e.fillStyle="#bdc3c7",e.beginPath(),e.arc(Xt+8,_a+Ma/2,3,0,Math.PI*2),e.fill(),e.beginPath(),e.arc(Xt+qt-8,_a+Ma/2,3,0,Math.PI*2),e.fill(),e.fillStyle="#111",e.beginPath(),e.arc(be+10,Re+10,4,0,Math.PI*2),e.fill(),e.beginPath(),e.arc(be+he-10,Re+10,4,0,Math.PI*2),e.fill(),e.beginPath(),e.arc(be+10,We-10,4,0,Math.PI*2),e.fill(),e.beginPath(),e.arc(be+he-10,We-10,4,0,Math.PI*2),e.fill(),e.strokeStyle="#546e7a",e.lineWidth=2;for(let U=Re+30;U<We;U+=30){e.beginPath(),e.moveTo(be+10,U),e.lineTo(be+he-10,U),e.stroke(),e.fillStyle="#2c3e50";for(let ae=be+20;ae<be+he-20;ae+=20)e.beginPath(),e.arc(ae,U,2,0,Math.PI*2),e.fill()}e.restore();const ht=We,yi=a*.08,wt=a-yi,Ka=wt,Zt=Ka-ht,Oo=he,Bo=be;if(Zt>0){const we=t;e.fillStyle="#1b2631",e.fillRect(0,ht,we,Zt),e.save(),e.beginPath(),e.rect(0,ht,we,Zt),e.clip();const _e=e.createLinearGradient(0,ht,0,Ka);_e.addColorStop(0,"#1c2833"),_e.addColorStop(1,"#2c3e50"),e.fillStyle=_e,e.fill(),e.strokeStyle="rgba(255, 255, 255, 0.05)",e.lineWidth=1,e.beginPath();for(let st=0;st<0+we;st+=t*.1)e.moveTo(st,ht),e.lineTo(st,Ka);e.stroke(),e.restore();const et=Bo-20,at=Oo+40;e.fillStyle="#34495e",e.fillRect(et,ht,at,Zt),e.fillStyle="#546e7a",e.fillRect(et,ht,4,Zt),e.fillRect(et+at-4,ht,4,Zt);const mt=6,Mt=et+4,bt=et+at-10,Uo=st=>{e.fillStyle="#37474f",e.fillRect(st-2,Ka-6,mt+4,6);const Si=e.createLinearGradient(st,ht,st+mt,ht);Si.addColorStop(0,"rgba(0, 229, 255, 0.2)"),Si.addColorStop(.5,"rgba(224, 255, 255, 0.9)"),Si.addColorStop(1,"rgba(0, 229, 255, 0.2)"),e.fillStyle=Si,e.shadowBlur=15,e.shadowColor="#00e5ff",e.fillRect(st,ht,mt,Zt-6),e.shadowBlur=0};Uo(Mt),Uo(bt),e.restore();const Ji=Bo+10,Vo=Oo-20;e.fillStyle="#000",e.fillRect(Ji,ht+10,Vo,Zt-20),e.strokeStyle="rgba(0, 229, 255, 0.15)",e.lineWidth=2,e.beginPath();for(let st=Ji+10;st<Ji+Vo;st+=15)e.moveTo(st,ht+10),e.lineTo(st,Ka-10);e.stroke()}r&&(e.save(),e.strokeStyle="#ffffff",e.lineWidth=3,e.strokeRect(le-70,fe-30,30,60),e.strokeRect(le+40,fe-30,30,60),e.fillStyle="#ffffff",e.beginPath(),e.moveTo(le,fe+10),e.lineTo(le+10,fe),e.lineTo(le+10,fe-10),e.lineTo(le-10,fe-10),e.lineTo(le-10,fe),e.closePath(),e.fill(),e.restore());const ja=e.createLinearGradient(0,wt,0,a);ja.addColorStop(0,"#546e7a"),ja.addColorStop(.1,"#37474f"),ja.addColorStop(.5,"#263238"),ja.addColorStop(1,"#101015"),e.fillStyle=ja,e.fillRect(0,wt,t,yi),e.fillStyle="#78909c",e.fillRect(0,wt,t,4),e.fillStyle="#1c2326",e.fillRect(0,wt+4,t,2);const Fo=t*.2;for(let U=Fo;U<t;U+=Fo){e.fillStyle="#000",e.fillRect(U,wt+10,2,yi-20),e.fillStyle="rgba(255,255,255,0.1)",e.fillRect(U+2,wt+10,1,yi-20);const ae=U-60;if(ae>0){e.fillStyle="#111";for(let we=wt+15;we<a-10;we+=6)e.fillRect(ae,we,40,3)}}e.fillStyle="#111";for(let U=20;U<t;U+=40)e.beginPath(),e.arc(U,a-8,3,0,Math.PI*2),e.fill(),e.fillStyle="rgba(255,255,255,0.2)",e.beginPath(),e.arc(U-1,a-9,1,0,Math.PI*2),e.fill(),e.fillStyle="#111";const Ho=(U,ae,we,_e)=>{e.fillStyle="#222",e.fillRect(U,ae,we,_e),e.fillStyle="#051e3e",e.fillRect(U+4,ae+4,we-24,_e-8);const et=U+we-16;e.fillStyle="#e74c3c",e.beginPath(),e.arc(et,ae+8,3,0,Math.PI*2),e.fill(),e.fillStyle="#f1c40f",e.beginPath(),e.arc(et,ae+18,3,0,Math.PI*2),e.fill(),e.fillStyle="#004400",e.fillRect(U+6,ae+6,4,4)};Ho(20,wt+15,120,30),Ho(t-140,wt+15,120,30),e.restore(),Sl(e,t,a,n),ts(e,t,a,n),e.restore()}const ro={};function ns(e,t=6,a=10){const i=`${e}-${t}-${a}`;if(ro[i])return ro[i];const o=a*2,n=document.createElement("canvas"),s=(t+o)*2;n.width=s,n.height=s;const r=n.getContext("2d"),d=s/2,f=s/2;r.beginPath(),r.arc(d,f,t,0,Math.PI*2);const c=r.createRadialGradient(d-t*.4,f-t*.4,t*.2,d,f,t+1);return c.addColorStop(0,"#fff"),c.addColorStop(.3,e),c.addColorStop(1,e),r.fillStyle=c,r.shadowColor=e,r.shadowBlur=a,r.fill(),r.shadowBlur=0,r.fillStyle="rgba(255, 255, 255, 0.9)",r.beginPath(),r.arc(d-t*.4,f-t*.4,t*.3,0,Math.PI*2),r.fill(),ro[i]=n,n}function Tl(e,t,a,i){if(l.settings?.useLowPerformance)return;const o=Xi(a,i),n=o.consoleTop,s=o.consoleH,r=t*.35,d=s-10,f=t*.3,c=a-a*.08,h=o.cautionBottom+4,m=a*.25,g=t*.2,u=(t-g)/2,T=h+m,b=c,y=b-T,S=t*.3,A=(t-S)/2,v=r,P=n+5,w=f,D=d;l.isPaused||(window.spaceRendererTime||(window.spaceRendererTime=Date.now()),window.spaceRendererTime+=16.6);const k=window.spaceRendererTime||Date.now(),I=l.perfectHitTimer>0&&!l.settings.noFlash,_=l.isGameOver,H=I&&V.consecutivePerfectHits>=3;e.fillStyle=_?"#420d0d":"#051015",e.fillRect(v,P,w,D),e.save(),e.beginPath(),e.rect(v,P,w,D),e.clip();const M=_||H?"#ff0000":I?"#00e5ff":"#00ff00";e.strokeStyle=M,e.lineWidth=2,e.shadowBlur=5,e.shadowColor=e.strokeStyle,e.beginPath();const L=k*.002;for(let me=0;me<w;me+=3){let ge=I?Math.sin(me*12.9898+k*.5)*Math.sin(me*78.233+k*.1)*(D*.4):Math.sin(me*.05+L)*(D*.35);e.lineTo(v+me,P+D/2+ge)}if(e.stroke(),e.shadowBlur=0,e.restore(),it.w!==t||it.h!==a){it.w=t,it.h=a;const me=Math.max(t,a),ge=e.createRadialGradient(t/2,a/2,me*.35,t/2,a/2,me*.85);ge.addColorStop(0,"rgba(0,0,0,0)"),ge.addColorStop(1,"rgba(20, 10, 30, 0.7)"),it.vignette=ge;const Le=e.createLinearGradient(v,P,v+w,P+D);Le.addColorStop(0,"rgba(255,255,255,0.1)"),Le.addColorStop(.5,"rgba(255,255,255,0)"),Le.addColorStop(1,"rgba(255,255,255,0.05)"),it.glass=Le;const Ve=e.createLinearGradient(u,h,u+g,h);if(Ve.addColorStop(0,"rgba(0, 255, 255, 0)"),Ve.addColorStop(.2,"rgba(0, 255, 255, 0.2)"),Ve.addColorStop(.5,"rgba(0, 255, 255, 1.0)"),Ve.addColorStop(.8,"rgba(0, 255, 255, 0.2)"),Ve.addColorStop(1,"rgba(0, 255, 255, 0)"),it.upperBeam=Ve,y>0){const $e=e.createLinearGradient(A,T,A+S,T);$e.addColorStop(0,"rgba(0, 255, 255, 0)"),$e.addColorStop(.2,"rgba(0, 255, 255, 0.2)"),$e.addColorStop(.5,"rgba(0, 255, 255, 1.0)"),$e.addColorStop(.8,"rgba(0, 255, 255, 0.2)"),$e.addColorStop(1,"rgba(0, 255, 255, 0)"),it.lowerBeam=$e}const ze=e.createLinearGradient(0,b-40,0,b);ze.addColorStop(0,"rgba(0, 229, 255, 0)"),ze.addColorStop(1,"rgba(0, 229, 255, 1.0)"),it.core=ze}if(e.fillStyle=it.glass,e.fillRect(v,P,w,D),I&&Math.sin(k/50)>0&&(e.shadowBlur=10,e.shadowColor="#ff0000",e.strokeStyle="#ff0000",e.lineWidth=4,e.strokeRect(r,n+5,f,d),e.shadowBlur=0),I){const me=(Q,re,Se,Te)=>{if(Math.sin(k/50+Te)>0){const Ye=ns(Se,5,10),B=(5+20)*2;e.drawImage(Ye,Q-B/2,re-B/2)}},ge=s;me(t*.15,n+ge*.3,"#ff0000",0),me(t*.18,n+ge*.3,"#ffff00",10),me(t*.21,n+ge*.3,"#00ff00",20),me(t*.85,n+ge*.5,"#ff0000",5),me(t*.82,n+ge*.5,"#ffa500",15);const Le=o.cautionTop,Ve=o.cautionH,ze=Le+Ve/2,$e=60,Xe=t*.05;for(let Q=20;Q<t;Q+=$e)Q<Xe||Q>t-Xe||me(Q,ze,"#ff8c00",Q)}const z=6,ne=k*.001,W=(Math.sin(ne)+1)/2,X=.02,K=X+W*(.25-X);if(e.save(),e.globalAlpha=K,e.fillStyle=it.upperBeam,e.fillRect(u+z,h+z,g-z*2,m-z*2),y>0&&it.lowerBeam){e.fillStyle=it.lowerBeam,e.fillRect(A+z,T+z,S-z*2,y-z*2),e.fillStyle=it.core;const me=S,ge=A,Le=me-20,Ve=ge+10;e.fillRect(Ve,b-30,Le,20)}e.globalAlpha=1,e.restore();const pe=20,oe=c+15,J=t-140,ye=c+15;k%2e3<1e3&&(e.fillStyle="rgba(0, 255, 0, 0.4)",e.fillRect(pe+2,oe+2,12,12),e.fillRect(J+2,ye+2,12,12),e.fillStyle="#00ff00",e.fillRect(pe+6,oe+6,4,4),e.fillRect(J+6,ye+6,4,4)),e.shadowBlur=0,e.fillStyle=it.vignette,e.fillRect(0,0,t,a),ss(e,t,a,o,k)}const co=new Uint8Array(500);function ss(e,t,a,i,o){if(!window.spaceStarCache||window.spaceStarCache.length!==500){window.spaceStarCache=[];for(let y=0;y<500;y++)window.spaceStarCache.push({x:Math.random(),y:Math.random(),size:.5+Math.random()*2,offset:Math.random()*1e4,speed:.002+Math.random()*.004})}let s,r,d,f,c,p,h,m,g,u=!1;i&&(u=!0,s=t*.05,r=i.consoleTop,d=i.consoleBottom,f=i.cautionTop,c=i.cautionBottom,g=t*.25,m=(t-g)/2,p=i.cautionBottom,h=a*.85);const T=o||Date.now(),b=window.spaceStarCache;for(let y=0;y<500;y++){const S=b[y],A=S.x*t,v=S.y*a;let P=!0;if(u&&(A<s||A>t-s||v>r&&v<d||v>f&&v<c||v>p&&v<h&&A>m&&A<m+g)&&(P=!1),!P){co[y]=255;continue}const w=Math.sin(T*S.speed+S.offset),D=Math.max(0,(w+1)/2);co[y]=Math.min(9,Math.floor(D*10))}e.save(),e.fillStyle="#ffffff";for(let y=0;y<10;y++){const S=(y+1)/10;e.globalAlpha=S;for(let A=0;A<500;A++)if(co[A]===y){const v=b[A];e.fillRect(v.x*t,v.y*a,v.size,v.size)}}e.globalAlpha=1,e.restore()}function bl(e,t,a){const i=l.isGameOver,o=i;if(es(e,t,a,o),lo(e,t,a,o),e.canvas.style.cursor="pointer",ss(e,t,a,null,Date.now()),i){wn(e,t,a),lo(e,t,a,!0),En(e,t,a,!0),In(e,t,a,!0,!1),e.save(),e.textAlign="center",e.fillStyle="#ff0000",e.shadowColor="#ff0000",e.shadowBlur=20;const n=Math.min(t,a)*.08;e.font=`${n}px "PressStart2PLocal"`;let s="GAME OVER";l.consecutiveFouls>=4&&(s="BAT BROKEN!"),e.fillText(s,t/2,a*.2),e.fillStyle=l.isDailyChallenge?"#FFD700":"#ffffff",e.shadowBlur=10,e.font=`${n*.5}px "PressStart2PLocal"`,e.fillText(`SCORE: ${V.score}`,t/2,a*.35),(l.settings?.noFlash||Math.floor(Date.now()/500)%2===0)&&(e.fillStyle="#ffffff",e.shadowBlur=0,e.font=`${n*.5}px "PressStart2PLocal"`,e.fillText("TAP TO RETRY",t/2,a*.8)),e.restore()}else{wn(e,t,a),lo(e,t,a,!1),En(e,t,a,!1),In(e,t,a,!1,!0),e.save(),e.textAlign="center",e.font='40px "PressStart2PLocal"';const n=Math.sin(Date.now()/300);e.globalAlpha=.6+n*.4,e.fillStyle="#e0f7fa",e.shadowColor="#00e5ff",e.shadowBlur=15,window.innerWidth<=600||window.innerHeight<=600?(e.fillText("TAP TO",t/2,a*.72),e.fillText("START",t/2,a*.72+50)):e.fillText("TAP TO START",t/2,a*.75),e.restore()}}function _o(e,t,a,i,o=null){const n=o!==null?o:a*.1,s=e.createLinearGradient(0,0,0,n);i?(s.addColorStop(0,"#0a0a2a"),s.addColorStop(1,"#2c3e50")):(s.addColorStop(0,"#4facfe"),s.addColorStop(1,"#00f2fe")),e.fillStyle=s,e.fillRect(0,0,t,n);const r=t*.8,d=n*.35,f=i?Math.min(25,n*.5):Math.min(45,n*.7);i?(e.fillStyle="#fdfdea",e.shadowColor="#fdfdea",e.shadowBlur=15,e.beginPath(),e.arc(t*.2,d,f,0,Math.PI*2),e.fill(),e.shadowBlur=0):(e.fillStyle="#ffecb3",e.shadowColor="#ffc107",e.shadowBlur=30,e.beginPath(),e.arc(r,d,f,0,Math.PI*2),e.fill(),e.shadowBlur=0);const c=e.createLinearGradient(0,n,0,a);if(i?(c.addColorStop(0,"#000033"),c.addColorStop(1,"#001144")):(c.addColorStop(0,"#0277bd"),c.addColorStop(.3,"#00acc1"),c.addColorStop(1,"#26c6da")),e.fillStyle=c,e.fillRect(0,n+20,t,a-(n+20)),Cl(e,t*.55,n+1,.4,i),!i){const p=e.createLinearGradient(0,n-20,0,n+40);p.addColorStop(0,"rgba(255, 255, 255, 0)"),p.addColorStop(.4,"rgba(200, 240, 255, 0.5)"),p.addColorStop(1,"rgba(255, 255, 255, 0)"),e.fillStyle=p,e.fillRect(0,n-20,t,60)}vl(e,t,n,i)}function vl(e,t,a,i){const o=i?"#263238":"#546e7a",n=i?"#000000":"#37474f",s=(r,d,f)=>{e.save(),e.translate(r,d),e.scale(f,f),e.fillStyle=o,e.beginPath(),e.moveTo(0,0),e.lineTo(10,-15),e.lineTo(25,-5),e.lineTo(35,-20),e.lineTo(50,0),e.fill(),e.fillStyle=n,e.fillRect(0,-2,50,2),e.restore()};s(t*.25,a+40,.6),s(t*.22,a+45,.5),s(t*.8,a+80,.8),s(t*.85,a+75,.6)}function Cl(e,t,a,i,o){e.save(),e.translate(t,a),e.scale(i,i);const n=o?"#212121":"#455a64",s=o?"#1b5e20":"#2e7d32";e.fillStyle=n,e.beginPath(),e.moveTo(-40,0),e.lineTo(40,0),e.lineTo(35,4),e.lineTo(-38,4),e.closePath(),e.fill(),e.fillRect(20,-10,8,10),e.fillRect(22,-12,4,3),e.fillStyle=s,e.fillRect(-30,-5,12,5),e.fillRect(-15,-5,12,5),e.fillStyle=o?"#b71c1c":"#c62828",e.fillRect(-28,-9,10,4),e.fillRect(-12,-9,10,4),e.restore()}function kn(e,t,a,i,o,n=!1,s=0){const r=s?Math.sin(s*.8)*1.5:0,d=s?Math.sin(s*.5)*.05:0;e.save(),e.translate(t,a+r),n&&e.scale(-1,1),e.rotate(d),e.scale(i,i);const f=o?"#263238":"#37474f",c=o?"#b0bec5":"#ECEFF1";e.fillStyle=f,e.beginPath(),e.moveTo(-15,0),e.lineTo(15,0),e.lineTo(10,6),e.lineTo(-10,6),e.closePath(),e.fill(),e.strokeStyle=f,e.lineWidth=2,e.beginPath(),e.moveTo(0,0),e.lineTo(0,-25),e.stroke(),e.fillStyle=c,e.beginPath(),e.moveTo(2,-22),e.quadraticCurveTo(15,-12,2,-2),e.fill(),e.restore()}function Ln(e,t,a,i,o,n){const s=Math.sin(n*1.2)*2,r=Math.sin(n*.8)*.1;e.save(),e.translate(t,a+s),e.rotate(r),e.scale(i,i);const d=o?"#880e4f":"#d81b60",f=o?"#263238":"#546e7a";e.fillStyle=d,e.beginPath(),e.arc(0,0,6,0,Math.PI,!0),e.fill(),e.fillRect(-6,0,12,3),e.fillStyle=f,e.fillRect(-2,-10,4,10),e.fillRect(-4,-12,8,2),o&&(e.shadowBlur=10,e.shadowColor="red",e.fillStyle="#ff1744",e.beginPath(),e.arc(0,-13,1.5,0,Math.PI*2),e.fill()),e.restore()}function Pl(e,t,a,i,o,n=!1,s=0,r=!1){e.save(),e.translate(t,a),e.scale(i,i);const d=o?"#795548":"#ffe0b2",f=o?"#4e342e":"#ffcc80";if(e.fillStyle=f,e.beginPath(),e.ellipse(0,0,40,10,0,0,Math.PI*2),e.fill(),e.fillStyle=d,e.beginPath(),e.ellipse(0,-2,35,8,0,0,Math.PI*2),e.fill(),n){if(r){e.save(),e.translate(0,-35);const u=s*2;for(let T=0;T<2;T++){e.save(),e.rotate(u+T*Math.PI);const b=e.createLinearGradient(0,0,0,-120);b.addColorStop(0,"rgba(255, 215, 0, 0.6)"),b.addColorStop(1,"rgba(255, 215, 0, 0)"),e.fillStyle=b,e.beginPath(),e.moveTo(0,0),e.lineTo(-15,-120),e.lineTo(15,-120),e.closePath(),e.fill(),e.restore()}e.restore()}e.save(),e.beginPath(),e.moveTo(-8/2,0),e.lineTo(-8/3,-35),e.lineTo(8/3,-35),e.lineTo(8/2,0),e.clip();const m=4,g=35/m;for(let u=0;u<m;u++){const T=r?"#fff176":"#ffffff";e.fillStyle=u%2===0?o?"#37474f":T:"#d32f2f",e.fillRect(-8,-35+u*g,16,g)}e.restore(),e.fillStyle="#212121",e.fillRect(-4,-39,8,4),e.fillStyle=r?"#ffff00":"#ffeb3b",(o||r)&&(e.shadowBlur=r?20:10,e.shadowColor="#ffff00"),e.beginPath(),e.arc(0,-41,3,0,Math.PI*2),e.fill(),e.shadowBlur=0,e.fillStyle="#b71c1c",e.beginPath(),e.moveTo(-6,-43),e.lineTo(0,-47),e.lineTo(6,-43),e.fill()}e.restore()}function Zi(e,t,a,i=null,o=null){const n=Date.now()/1e3,s=i!==null?i:a*.1,r=Y.currentTheme,d=o!==null?o:r.getShorelineY?r.getShorelineY(a):a*.18,f=d-s;e.save();const c=l.isGameOver||l.isNight;e.beginPath(),e.moveTo(0,d),e.lineTo(0,s);for(let u=0;u<=t;u+=25){const T=s+Math.sin(u*.04+n*.4)*3+Math.sin(u*.12-n*.7)*1;e.lineTo(u,T)}e.lineTo(t,d),e.closePath(),e.fillStyle=c?"#000033":"#0277bd",e.fill();const p=l.perfectHitTimer>0&&V.consecutivePerfectHits>=1;Pl(e,t*.16,s+5,1.1,c,!0,n,p),e.strokeStyle="rgba(255, 255, 255, 0.25)",e.lineWidth=1,e.beginPath();for(let u=0;u<=t;u+=100){const T=Math.sin(u*.2+n*1.5)*1,b=s+Math.sin(u*.04+n*.4)*3+T;u===0?e.moveTo(u,b):e.lineTo(u,b)}e.stroke(),r._beachCache||(r._beachCache={h:0,isNight:null,waveGradients:[]});const h=r._beachCache,m=h.h!==a||h.isNight!==c;m&&(h.h=a,h.isNight=c,h.waveGradients=[]);const g=2;for(let u=0;u<g;u++){const T=(u+1)/(g+1),b=s+f*.1+f*.8*T,y=.2+u*.1,S=3+u*3;e.beginPath(),e.moveTo(0,d);for(let A=0;A<=t;A+=60){const v=Math.sin(A*.01+n*y)*S;e.lineTo(A,b+v)}if(e.lineTo(t,d),e.closePath(),m||!h.waveGradients[u]){const A=e.createLinearGradient(0,b-S,0,b+S*8),v=.08+u*.12;A.addColorStop(0,`rgba(255, 255, 255, ${v*.5})`),A.addColorStop(.3,`rgba(0, 188, 212, ${v})`),A.addColorStop(1,"rgba(0, 77, 64, 0)"),h.waveGradients[u]=A}e.fillStyle=h.waveGradients[u],e.fill(),u===0?(kn(e,t*.35,b,1,c,!1,n),kn(e,t*.62,b+2,.85,c,!0,n+1)):(Ln(e,t*.2,b+1,1.1,c,n+.5),Ln(e,t*.85,b-1,1,c,n+2.1))}if(V.consecutivePerfectHits>=1&&!l.settings?.noFlash&&!l.isGameOver){const u=l.perfectHitTimer>0,T=t*.8,b=s*.35,y=Math.min(45,s*.7);if(u){const v=(Math.sin(n*15)+1)*.5,P=y*(1.5+v*.5),w=e.createRadialGradient(T,b,y*.5,T,b,P);w.addColorStop(0,"rgba(255, 255, 210, 0.8)"),w.addColorStop(.4,"rgba(255, 215, 0, 0.6)"),w.addColorStop(1,"rgba(255, 165, 0, 0)"),e.fillStyle=w,e.beginPath(),e.arc(T,b,P,0,Math.PI*2),e.fill(),e.save(),e.translate(T,b),e.rotate(n*.5),e.fillStyle="rgba(255, 255, 255, 0.15)";for(let D=0;D<8;D++)e.rotate(Math.PI/4),e.beginPath(),e.moveTo(0,0),e.lineTo(20,-P*2),e.lineTo(-20,-P*2),e.closePath(),e.fill();e.restore()}const S=u?.3:.15;e.fillStyle=`rgba(255, 100, 0, ${S})`,e.globalCompositeOperation="overlay",e.fillRect(0,0,t,a),e.globalCompositeOperation="source-over";const A=Math.floor(n*5);for(let v=0;v<10;v++){let w=(A*9301+49297+v)%233280/233280;if(w>.5){const D=w*t%t,k=s+w*1e3%f;e.fillStyle="#fff",e.beginPath(),e.arc(D,k,2,0,Math.PI*2),e.fill()}}}e.restore()}function Rl(e,t,a){if(Y.currentTheme.id!=="BEACH")return;const i=Date.now()/1e3,o=Y.currentTheme,n=o.getShorelineY?o.getShorelineY(a):a*.18,s=40/(t/a),r=Math.sin(i*.45),d=Math.sin(i*.9)*.15,f=(r+1)/2+d,c=f*Math.min(55,Math.max(15,s)),p=n+c;e.save();const m=l.isNight||l.isGameOver?"77, 208, 225":"178, 235, 242";for(let g=0;g<3;g++){const u=(.4+g*.15)*Math.max(0,f),T=c*(.5+g*.5),b=n+T,y=e.createLinearGradient(0,n,0,b+12);y.addColorStop(0,`rgba(${m}, ${.1*g})`),y.addColorStop(.3,`rgba(${m}, ${u})`),y.addColorStop(.7,`rgba(255, 255, 255, ${u*.9})`),y.addColorStop(1,"rgba(255, 255, 255, 0)"),e.fillStyle=y,e.beginPath(),e.moveTo(0,n);for(let S=0;S<=t;S+=40){const A=Math.sin(S*.015+i*.6+g)*8,v=Math.sin(S*.05-i*.9)*3;e.lineTo(S,b+A+v)}e.lineTo(t,n),e.fill()}for(let g=0;g<50;g++){const u=t*(g/50+Math.sin(g*123)%.02),T=p+Math.sin(u*.01+i*.5)*6;T>n&&(e.fillStyle=g%2===0?`rgba(${m}, ${.8*f})`:`rgba(255, 255, 255, ${.9*f})`,e.beginPath(),e.arc(u,T,Math.max(.1,.7+Math.sin(i+g)*1.2),0,Math.PI*2),e.fill())}e.restore()}function Al(e,t,a,i,o){e.save();const n="#8d6e63",s="#4e342e",r=(d,f,c,p)=>{e.save(),e.strokeStyle=s,e.lineWidth=6,e.beginPath(),e.moveTo(d,f),e.lineTo(c,p),e.stroke(),e.strokeStyle=n,e.lineWidth=4,e.setLineDash([8,4]),e.beginPath(),e.moveTo(d,f),e.lineTo(c,p),e.stroke(),e.restore()};r(i,o,t,o-(t-i)*1.5),r(i,o,0,o-i*1.5),e.restore()}function El(e,t,a){if(Y.currentTheme.id!=="BEACH")return;const i=Y.currentTheme,n=(i.getShorelineY?i.getShorelineY(a):a*.18)+20,s=a,r=s-n;fo(e,t*.28,n+r*.15,1.2),fo(e,t*.1,s-100,1.5),fo(e,t*.88,n+r*.35,1.3),ho(e,t*.1,n+r*.6,1.5,"#ff7043"),ho(e,t*.72,n+r*.08,1.2,"#ff8a65"),ho(e,t*.92,n+r*.75,1.6,"#ef5350"),uo(e,t*.2,n+r*.1,1.4,"#f8bbd0"),uo(e,t*.03,n+r*.5,1.6,"#ffffff"),uo(e,t*.95,n+r*.45,1.3,"#e1bee7")}function fo(e,t,a,i){e.save(),e.translate(t,a),e.scale(i,i),e.rotate(.3),e.fillStyle="rgba(0,0,0,0.15)",e.beginPath(),e.ellipse(0,4,18,5,0,0,Math.PI*2),e.fill(),e.fillStyle="#6d4c41",e.beginPath(),e.moveTo(-18,-3),e.quadraticCurveTo(-10,-5,5,-4),e.lineTo(18,-2),e.lineTo(20,3),e.quadraticCurveTo(5,6,-10,5),e.lineTo(-20,2),e.closePath(),e.fill(),e.strokeStyle="rgba(0,0,0,0.2)",e.lineWidth=1,e.beginPath(),e.moveTo(-12,1),e.lineTo(12,-1),e.stroke(),e.beginPath(),e.moveTo(-8,3),e.lineTo(8,2),e.stroke(),e.beginPath(),e.arc(5,0,1.5,0,Math.PI*2),e.stroke(),e.restore()}function ho(e,t,a,i,o){e.save(),e.translate(t,a),e.scale(i,i),e.rotate(.5),e.fillStyle="rgba(0,0,0,0.1)",e.beginPath(),e.arc(0,2,7,0,Math.PI*2),e.fill(),e.fillStyle=o,e.beginPath();for(let n=0;n<5;n++){const s=n/5*Math.PI*2;e.lineTo(Math.cos(s)*10,Math.sin(s)*10),e.lineTo(Math.cos(s+Math.PI/5)*4,Math.sin(s+Math.PI/5)*4)}e.closePath(),e.fill(),e.fillStyle="rgba(255,255,255,0.3)";for(let n=0;n<5;n++){const s=n/5*Math.PI*2;e.beginPath(),e.arc(Math.cos(s)*5,Math.sin(s)*5,1,0,Math.PI*2),e.fill()}e.restore()}function uo(e,t,a,i,o){e.save(),e.translate(t,a),e.scale(i,i),e.fillStyle="rgba(0,0,0,0.1)",e.beginPath(),e.ellipse(0,2,8,4,0,0,Math.PI*2),e.fill(),e.fillStyle=o,e.beginPath(),e.moveTo(-6,4),e.bezierCurveTo(-12,-10,12,-10,6,4),e.closePath(),e.fill(),e.strokeStyle="rgba(0,0,0,0.15)",e.lineWidth=.5;for(let n=-3;n<=3;n+=2)e.beginPath(),e.moveTo(n,-6),e.lineTo(n,2),e.stroke();e.restore()}function wl(e,t,a,i,o,n,s=0){e.save(),e.translate(t,a),e.scale(i,i);const r=Math.abs(Math.sin(s*8))*.5,d=Math.sin(s*4)*.08;e.translate(0,-r),e.rotate(d);const f=o?"#b71c1c":"#ff5252",c=o?"#7f0000":"#d32f2f",p=o?"#ffcc80":"#ffe0b2",h=f,m="#ffffff",g="#000000";e.save(),e.translate(0,r),e.rotate(-d),e.fillStyle="rgba(0,0,0,0.2)",e.beginPath(),e.ellipse(0,5,25,8,0,0,Math.PI*2),e.fill(),e.restore(),e.strokeStyle=c,e.lineWidth=3,e.lineCap="round";const u=(A,v,P,w)=>{const D=A==="left"?-1:1,k=v/(P*1.5)*Math.PI,_=(w*3+k)%(Math.PI*2),H=Math.sin(_),M=Math.max(0,H)*6,L=Math.cos(_)*.5;e.beginPath(),e.moveTo(D*15,0);const z=D*(25+L),ne=5-M;e.lineTo(z,ne);const W=D*(28+L*1.5),X=12-Math.max(0,M*1.2);e.lineTo(W,X),e.stroke()};for(let A=0;A<3;A++)u("left",A,3,s),u("right",A,3,s);e.fillStyle=f,e.beginPath(),e.ellipse(0,0,20,14,0,0,Math.PI*2),e.fill(),e.fillStyle="rgba(255,255,255,0.15)",e.beginPath(),e.arc(-12,-5,2,0,Math.PI*2),e.fill(),e.beginPath(),e.arc(12,-3,3,0,Math.PI*2),e.fill(),e.beginPath(),e.arc(-8,6,1.5,0,Math.PI*2),e.fill(),e.fillStyle=p,e.beginPath(),e.ellipse(0,5,12,6,0,0,Math.PI*2),e.fill(),e.strokeStyle="#3e2723",e.lineWidth=1.5,e.beginPath(),e.arc(0,-4,6,.2,Math.PI-.2),e.stroke(),e.fillStyle="rgba(255, 100, 100, 0.3)",e.beginPath(),e.arc(-7,-4,2.5,0,Math.PI*2),e.fill(),e.beginPath(),e.arc(7,-4,2.5,0,Math.PI*2),e.fill();const T=(A,v,P)=>{e.save(),e.translate(A,v),P&&e.scale(-1,1),e.rotate(-.2+Math.sin(s*2)*.05),e.strokeStyle=f,e.lineWidth=5,e.beginPath(),e.moveTo(0,0),e.lineTo(-8,-6),e.stroke(),e.translate(-10,-9),e.rotate(-.4),e.fillStyle=h,e.beginPath(),e.moveTo(0,0),e.bezierCurveTo(5,5,15,0,10,-10),e.bezierCurveTo(5,-5,0,0,0,0),e.fill(),e.beginPath(),e.moveTo(2,-2),e.bezierCurveTo(8,-8,12,-15,4,-18),e.bezierCurveTo(2,-10,-2,-6,2,-2),e.fill(),e.restore()};T(-18,-2,!1),T(18,-2,!0);const b=(A,v)=>{const P=Math.sin(s*3)*1;e.strokeStyle=f,e.lineWidth=3,e.beginPath(),e.moveTo(A,v+5+P),e.lineTo(A,v+P),e.stroke(),e.fillStyle=m,e.beginPath(),e.arc(A,v+P,5,0,Math.PI*2),e.fill(),e.strokeStyle=c,e.lineWidth=1,e.stroke(),e.fillStyle=g,e.beginPath(),e.arc(A,v+P,2.5,0,Math.PI*2),e.fill(),e.fillStyle="#fff",e.beginPath(),e.arc(A+1.5,v-1.5+P,1,0,Math.PI*2),e.fill()};b(-6,-16),b(6,-16),e.save(),e.translate(28,-28),e.rotate(.1+Math.sin(s*2)*.05),e.fillStyle="#5d4037",e.fillRect(-2,0,4,45),e.fillStyle="#5d4037",e.fillRect(-25,-20,50,25),e.lineWidth=2,e.strokeStyle="#3e2723",e.strokeRect(-25,-20,50,25),e.fillStyle="#ffffff",e.font='6px "PressStart2PLocal"',e.textAlign="center";let y="HIGH",S=n;if(l.isDailyChallenge){y="DAILY";const A=new Date,v=A.getUTCFullYear(),P=String(A.getUTCMonth()+1).padStart(2,"0"),w=String(A.getUTCDate()).padStart(2,"0"),D=`${v}-${P}-${w}`;S=parseInt(q.getItem(`baseball_daily_score_${D}`,"0"))||0}e.fillText(y,0,-12),e.fillStyle=l.isDailyChallenge?"#f1c40f":"#b71c1c",e.fillText(`${S}`,0,-3),e.restore(),e.restore()}function ls(e,t,a){const i=l.isGameOver,o=i,n=Date.now()/1e3,s=a*.38,r=a*.65;_o(e,t,a,o,s),Zi(e,t,a,s,r),e.save();const d=r,f=a-d,c=o?"#3e2723":"#d7ccc8",p=o?"#21130d":"#8d6e63",h=e.createLinearGradient(0,d,0,a);h.addColorStop(0,c),h.addColorStop(1,o?"#1b100c":"#a1887f"),e.fillStyle=h,e.fillRect(0,d,t,f),e.strokeStyle=p,e.lineWidth=2,e.beginPath();const m=t/2;for(let w=-8;w<=8;w++){const D=m+w*(t/12),k=m+w*(t/3);e.moveTo(D,d),e.lineTo(k,a)}for(let w=d;w<a;w+=25)if(w%50===0){e.fillStyle=o?"#111":"#5d4037";for(let D=0;D<t;D+=40){const k=w%100/2;e.fillRect(D+k,w,4,4)}}e.stroke();const g=30,u=20,T=d-45;e.fillStyle="rgba(0,0,0,0.3)",e.fillRect(0,d,t,15),e.fillStyle=p,e.fillRect(0,T,t,g),e.fillStyle=o?"#5d4037":"#bcaaa4",e.fillRect(0,T,t,5),e.fillStyle=p;for(let w=0;w<=t;w+=t/6)e.fillRect(w-u/2,T,u,d-T),e.fillStyle=o?"#5d4037":"#bcaaa4",e.fillRect(w-u/2+2,T+g,3,d-T-g),e.fillStyle=p;const b=typeof V<"u"?V.highScore:0,y=t*.15,A=Math.sin(n*.5)*y,v=t*.5+A;wl(e,v,a*.7,3.5,o,b,n),e.restore(),e.restore();const P=Math.min(t,a)*.08;if(e.textAlign="center",i){e.save(),e.fillStyle="#ff0000",e.shadowColor="#000",e.shadowBlur=4,e.font=`${P}px "PressStart2PLocal"`;let w="GAME OVER";l.consecutiveFouls>=4&&(w="BAT BROKEN!"),e.fillText(w,t/2,a*.3),e.fillStyle=l.isDailyChallenge?"#FFD700":"#ffffff",e.font=`${P*.6}px "PressStart2PLocal"`;const D=typeof V<"u"?V.score:l.score;e.fillText(`SCORE: ${D}`,t/2,a*.5),(l.settings?.noFlash||Math.floor(Date.now()/500)%2===0)&&(e.fillStyle="#ffff00",e.shadowColor="#000",e.shadowBlur=2,t<=600||a<=600?(e.font=`${P*.6}px "PressStart2PLocal"`,e.fillText("TAP TO",t/2,a*.82),e.fillText("RETRY",t/2,a*.82+P*.7)):(e.font=`${P*.6}px "PressStart2PLocal"`,e.fillText("TAP TO RETRY",t/2,a*.87))),e.restore()}else{e.save();const w=Math.sin(Date.now()/300);e.globalAlpha=.8+w*.2,e.fillStyle="#ffffff",e.shadowColor="#00e5ff",e.shadowBlur=10,e.shadowOffsetX=0,e.shadowOffsetY=0;const D=t<=600||a<=600;e.textAlign="center",D?(e.font=`${P*.6}px "PressStart2PLocal"`,e.fillText("TAP TO",t/2,a*.82),e.fillText("START",t/2,a*.82+P*.7)):(e.font=`${P*.6}px "PressStart2PLocal"`,e.fillText("TAP TO START",t/2,a*.87)),e.restore()}e.canvas.style.cursor="pointer"}function Ml(e,t){const a=document.createElement("canvas");a.width=e||600,a.height=t||800;const i=a.getContext("2d"),o=Y.currentTheme;if(o&&o.id==="BEACH"){o._beachCache||(o._beachCache={h:0,isNight:null,waveGradients:[]});const r=t||800,d=r*.1,f=r-d;o._beachCache.h=r,o._beachCache.isNight=!1,o._beachCache.waveGradients=[];for(let c=0;c<2;c++){const p=(c+1)/3,h=d+f*.1+f*.8*p,m=3+c*3,g=i.createLinearGradient(0,h-m,0,h+m*8),u=.08+c*.12;g.addColorStop(0,`rgba(255, 255, 255, ${u*.5})`),g.addColorStop(.3,`rgba(0, 188, 212, ${u})`),g.addColorStop(1,"rgba(0, 77, 64, 0)"),o._beachCache.waveGradients[c]=g}}try{_o(i,a.width,a.height,!1),Zi(i,a.width,a.height),ls(i,a.width,a.height)}catch{}const n=i.createLinearGradient(0,0,0,-120);n.addColorStop(0,"rgba(255, 215, 0, 0.6)"),n.addColorStop(1,"rgba(255, 215, 0, 0)"),i.fillStyle=n,i.fillRect(0,0,10,10);const s=i.createRadialGradient(50,50,10,50,50,100);s.addColorStop(0,"rgba(255, 255, 210, 0.8)"),s.addColorStop(.4,"rgba(255, 215, 0, 0.6)"),s.addColorStop(1,"rgba(255, 165, 0, 0)"),i.fillStyle=s,i.fillRect(0,0,100,100),console.log("[Beach] Effects Warmed Up (Full Pipeline)")}function _l(e,t,a,i){const o=i?"#3d1f0b":"#8B4513",n=i?"#000000":"#555555",s=i?"#002200":"#32CD32",r=i?"#001100":"#006400",d=i?"#001100":"#228B22",f=i?"#002200":"#006400";e.fillStyle=n;const c=a*.5;e.fillRect(t*.05,c,t*.9,150),e.fillStyle=i?"#111":"#444",e.beginPath(),e.moveTo(t*.05,c),e.bezierCurveTo(t*.05,c-60,t*.95,c-60,t*.95,c),e.fill(),rs(e,t,a,i);const p=(y,S)=>{e.fillStyle="#333",e.fillRect(y,S,20,60),e.fillStyle="#222",e.fillRect(y-10,S-20,40,20),e.fillStyle=i?"#ffffe0":"#ddd",i&&(e.shadowColor="#ffffe0",e.shadowBlur=20);for(let A=0;A<3;A++)for(let v=0;v<4;v++)e.fillRect(y-8+v*10,S-18+A*6,6,4);e.shadowBlur=0};p(t*.15,c-60),p(t*.8,c-60),e.fillStyle=f,e.beginPath(),e.moveTo(0,a*.6),e.bezierCurveTo(t*.2,a*.5,t*.4,a*.65,t*.6,a*.6),e.bezierCurveTo(t*.8,a*.55,t,a*.65,t,a*.65),e.lineTo(t,a),e.lineTo(0,a),e.fill(),e.fillStyle=d,e.beginPath(),e.moveTo(0,a*.65),e.bezierCurveTo(t*.25,a*.7,t*.5,a*.6,t*.75,a*.65),e.bezierCurveTo(t*.9,a*.68,t,a*.62,t,a*.62),e.lineTo(t,a),e.lineTo(0,a),e.fill();const h=e.createLinearGradient(0,a*.6,0,a);h.addColorStop(0,s),h.addColorStop(1,r),e.fillStyle=h,e.fillRect(0,a*.65,t,a*.35);const m=new He("classic_static_world_noise");e.fillStyle="rgba(0,0,0,0.05)";for(let y=0;y<3e3;y++){const S=m.random()*t,A=a*.6+m.random()*a*.4;e.fillRect(S,A,1,2)}if(!i){e.fillStyle="#228B22";for(let y=0;y<50;y++){const S=m.random()*t,A=a*.65+m.random()*a*.35;(S<t*.35||S>t*.65)&&(e.fillRect(S,A,2,4),e.fillRect(S-2,A+2,2,2),e.fillRect(S+2,A+2,2,2))}}e.fillStyle=o,e.beginPath(),e.moveTo(t*.45,a*.6),e.lineTo(t*.55,a*.6),e.lineTo(t*.85,a),e.lineTo(t*.15,a),e.fill(),e.fillStyle=i?"rgba(0,0,0,0.3)":"rgba(60,40,20,0.15)";for(let y=0;y<800;y++){const S=t*.15+m.random()*t*.7,A=a*.6+m.random()*a*.4,v=(A-a*.6)/(a*.4),P=t*.05+v*(t*.35),w=t*.5;S>=w-P&&S<=w+P&&e.fillRect(S,A,2,2)}const g=(y,S,A,v,P)=>{const w=i?"#2a1a10":"#5C4033",D=i?"#3d2b1f":"#8B4513";e.strokeStyle=D,e.lineWidth=3*P,e.beginPath(),e.moveTo(y,S-8*P),e.lineTo(A,v-8*P),e.moveTo(y,S+2*P),e.lineTo(A,v+2*P),e.stroke(),e.fillStyle=w;const k=Math.sqrt(Math.pow(A-y,2)+Math.pow(v-S,2)),I=Math.floor(k/(25*P));for(let _=0;_<=I;_++){const H=_/I,M=y+(A-y)*H,L=S+(v-S)*H;e.fillRect(M-2*P,L-15*P,4*P,20*P)}};if(g(t*.45,a*.6,t*.15,a,1.5),g(t*.55,a*.6,t*.85,a,1.5),!window._classicTreeCache||window._classicTreeCacheIsNight!==i){const y=[],P=i?["#003300","#004400","#002200","#002600","#001a00"]:["#228B22","#006400","#2E8B57","#32CD32","#008000","#6B8E23"],w=i?"#2d1a08":"#8B4513";P.forEach(D=>{const k=document.createElement("canvas");k.width=160,k.height=320;const I=k.getContext("2d");I.scale(4,4);const _=6,H=12,M=(40-_)/2,L=80-H;I.fillStyle=w,I.fillRect(M,L,_,H),I.fillStyle=D;const z=(ne,W)=>{const N=L+ne,K=14*W,pe=N-18,oe=N;I.beginPath(),I.moveTo(20,pe),I.lineTo(20+K,oe),I.lineTo(20-K,oe),I.closePath(),I.fill(),I.fillStyle="rgba(0,0,0,0.1)",I.beginPath(),I.moveTo(20,pe),I.lineTo(20+K,oe),I.lineTo(20,oe),I.fill(),I.fillStyle=D};z(0,1.2),z(-10,1),z(-20,.8),y.push(k)}),window._classicTreeCache=y,window._classicTreeCacheIsNight=i}const u=window._classicTreeCache,T=(y,S,A,v)=>{const P=u[v%u.length],w=40*A,D=80*A,k=17*A,I=68*A;e.drawImage(P,y-k,S-I,w,D)},b=[{x:t*.1,y:a*.7,scale:4},{x:t*.05,y:a*.75,scale:5},{x:t*.25,y:a*.65,scale:2.5},{x:t*.15,y:a*.62,scale:2},{x:t*.02,y:a*.68,scale:3},{x:t*.85,y:a*.75,scale:4.5},{x:t*.95,y:a*.7,scale:5},{x:t*.75,y:a*.63,scale:2},{x:t*.8,y:a*.61,scale:1.8},{x:t*.9,y:a*.66,scale:3.5}];b.sort((y,S)=>y.y-S.y),b.forEach((y,S)=>T(y.x,y.y,y.scale,S)),e.fillStyle=i?"#1a1a1a":"#555555",e.beginPath(),e.arc(t*.3,a*.8,5,0,Math.PI*2),e.fill(),e.beginPath(),e.arc(t*.75,a*.85,7,0,Math.PI*2),e.fill(),e.beginPath(),e.arc(t*.2,a*.9,4,0,Math.PI*2),e.fill()}function rs(e,t,a,i){const o=a*.5,n=t*.35,s=o-100,r=t*.3,d=50;e.fillStyle="#222",e.fillRect(n-10,s-10,r+20,d+20),e.fillStyle="#333",e.fillRect(n-40,s,30,d),e.fillRect(n+r+10,s,30,d),i||(e.fillStyle="#c0392b",e.fillRect(n-35,s+5,20,15),e.fillStyle="#2980b9",e.fillRect(n-35,s+25,20,15),e.fillStyle="#f1c40f",e.fillRect(n+r+15,s+5,20,15),e.fillStyle="#27ae60",e.fillRect(n+r+15,s+25,20,15)),e.fillStyle="#000",e.fillRect(n,s,r,d),e.fillStyle="#111",e.fillRect(n,s-30,r,20);for(let L=0;L<5;L++){const z=n+r/4*L;e.fillStyle=i?"#ffffcc":"#555",i&&(e.shadowColor="#ffffcc",e.shadowBlur=10),e.beginPath(),e.arc(z,s-35,4,0,Math.PI*2),e.fill(),e.shadowBlur=0}const f=20,c=5,p=4,h=r-p*2,m=d-p*2,g=Math.floor(h/f),u=Math.floor(m/c),T=Math.min(g,u)-1,b=T+1,y=f*b,S=c*b,A=(r-y)/2,v=(d-S)/2;e.fillStyle="#222";for(let L=0;L<c;L++)for(let z=0;z<f;z++)e.fillRect(n+A+z*b,s+v+L*b,T,T);const P={0:[[1,1,1],[1,0,1],[1,0,1],[1,0,1],[1,1,1]],1:[[0,1,0],[1,1,0],[0,1,0],[0,1,0],[1,1,1]],2:[[1,1,1],[0,0,1],[1,1,1],[1,0,0],[1,1,1]],3:[[1,1,1],[0,0,1],[1,1,1],[0,0,1],[1,1,1]],4:[[1,0,1],[1,0,1],[1,1,1],[0,0,1],[0,0,1]],5:[[1,1,1],[1,0,0],[1,1,1],[0,0,1],[1,1,1]],6:[[1,1,1],[1,0,0],[1,1,1],[1,0,1],[1,1,1]],7:[[1,1,1],[0,0,1],[0,0,1],[0,0,1],[0,0,1]],8:[[1,1,1],[1,0,1],[1,1,1],[1,0,1],[1,1,1]],9:[[1,1,1],[1,0,1],[1,1,1],[0,0,1],[1,1,1]]};e.fillStyle=l.isDailyChallenge?"#f1c40f":"#e74c3c",i&&(e.shadowColor=l.isDailyChallenge?"#f1c40f":"#e74c3c",e.shadowBlur=15);let w=l.highScore||0;if(l.isDailyChallenge){const L=new Date,z=L.getUTCFullYear(),ne=String(L.getUTCMonth()+1).padStart(2,"0"),W=String(L.getUTCDate()).padStart(2,"0"),X=`${z}-${ne}-${W}`;w=parseInt(q.getItem(`baseball_daily_score_${X}`,"0"))||0}const D=w.toString(),k=3,I=1,_=D.length*k+(D.length-1)*I;let H=Math.floor((f-_)/2);for(let L=0;L<D.length;L++){const z=parseInt(D[L]);if(isNaN(z))continue;const ne=P[z];for(let W=0;W<5;W++)for(let X=0;X<3;X++)if(ne[W][X]){const N=H+L*(k+I)+X,K=W;e.fillRect(n+A+N*b,s+v+K*b,T,T)}}e.shadowBlur=0,e.fillStyle="#f1c40f",e.font='16px "PressStart2PLocal"',e.textAlign="center",e.textBaseline="middle";const M=l.isDailyChallenge?"DAILY":"HIGH SCORE";e.fillText(M,n+r/2,s-20)}function Il(){const a=document.createElement("canvas");a.width=400,a.height=400;const i=a.getContext("2d"),o=10,n=10,s=Wn,r=Nn;for(let p=0;p<400;p+=n){const h=p/n%2===0?0:o/2;for(let m=0;m<400;m+=o){const g=m+h+(Math.random()*2-1),u=p+(Math.random()*2-1);if(Math.random()>.9)continue;const T=s[Math.floor(Math.random()*s.length)],b=r[Math.floor(Math.random()*r.length)];i.fillStyle=b,i.fillRect(g+1,u+4,o-2,6),i.fillStyle=T,i.fillRect(g+2,u,o-4,4)}}Wt.width=4e3,Wt.height=100,ai||(ai=document.createElement("canvas")),ai.width=4e3,ai.height=100;const d=Rs;ai.getContext("2d");const f=d.createPattern(a,"repeat");d.fillStyle=f,d.fillRect(0,0,Wt.width,100);const c=document.createElement("canvas");c.width=400,c.height=400,c.getContext("2d")}let ai=null;const ga=document.createElement("canvas");let Hi=!1;const Qe={currentBannerMessage:null};function Dl(){Qe.currentBannerMessage=null,Hi=!1}const Gn=["Perfect Hit streaks earn bonus Coins!","4 Fouls in a row breaks your bat!","Daily Challenges reset at Midnight UTC.","Wait for the ball to reach the plate.","Unlock new bats in the Shop!","The Ace mixes up every pitch type.","High Scores unlock new Stadiums.","Foul balls save you from strikes.","Timing is everything!","Practice makes perfect!","Gold Bats sparkle on Perfect Hits!","I can see my house from here!","This plane runs on AA batteries.","Where is the pilot?","Do a barrel roll!","404: Cloud Not Found","If you read this, look down.","Physics are just suggestions.","Beware of low-flying birds.","Don't look down!","Why is the ball getting larger?","Have you tried turning it off and on?","Nice throw!","I saw a UFO earlier!","Bring back the hot dogs!","Swinging is mandatory.","Keep your eye on the... bird?","My other plane is a convertible.","Don't feed the clouds."];function kl(){return Gn[Math.floor(Math.random()*Gn.length)]}let Vt=null,Di=null,On=null;function Io(e){let t=e?"night":"day";l.bossModeActive&&!l.isGameOver&&(t="boss");const a=l.settings&&l.settings.theme?l.settings.theme:"classic";if((a==="space"||a==="moon")&&(t="space"),Vt||(Vt=document.createElement("canvas"),Di=Vt.getContext("2d")),Vt.width===Z&&Vt.height===de&&On===t)return Vt;Vt.width=Z,Vt.height=de,On=t;const n=Di.createLinearGradient(0,0,0,de);return t==="boss"?(n.addColorStop(0,"#1a0a2e"),n.addColorStop(.4,"#000000"),n.addColorStop(1,"#2c0000")):t==="space"?(n.addColorStop(0,"#000000"),n.addColorStop(1,"#0a0a1a")):t==="night"?(n.addColorStop(0,"#000033"),n.addColorStop(1,"#191970")):(n.addColorStop(0,"#4facfe"),n.addColorStop(1,"#00f2fe")),Di.fillStyle=n,Di.fillRect(0,0,Z,de),Vt}function Et(e,t=!0){Ya.width=Z,Ya.height=de,l.lastStaticRenderMode=e;const a=zn,i=Z,o=de;if(t||a.clearRect(0,0,i,o),Y.currentTheme.id==="SPACE"){a.clearRect(0,0,i,o),es(a,i,o,e),Rt.width=i,Rt.height=o;const n=150+Oe+32;os(To,i,o,i/2,l.bat.pivotY,n,e),ts(To,i,o,n);return}if(Y.currentTheme.id==="BEACH"){_o(a,i,o,e);return}if(Y.currentTheme.id==="HAUNTED"){Yn(a,i,o,e);return}if(t){const n=Io(e);a.drawImage(n,0,0)}_l(a,i,o,e)}function Ll(){!Y.currentTheme||Y.currentTheme.id!=="CLASSIC"||rs(zn,Z,de,l.lastStaticRenderMode)}function Gl(e){const t=document.getElementById("start-screen");if(Y.currentTheme.id==="BEACH"){l.isGameOver?t&&t.style.display!=="none"&&(t.style.display="none"):t&&t.style.display==="none"&&!l.gameActive&&(t.style.display=""),ls(C,Z,de);return}if(Y.currentTheme.id==="HAUNTED"){l.isGameOver?t&&t.style.display!=="none"&&(t.style.display="none"):t&&t.style.display==="none"&&!l.gameActive&&(t.style.display=""),jn(C,Z,de);return}if(Y.currentTheme.id==="SPACE"){l.isGameOver?t&&t.style.display!=="none"&&(t.style.display="none"):t&&t.style.display==="none"&&!l.gameActive&&(t.style.display=""),bl(C,Z,de);return}else!l.gameActive&&t&&t.style.display==="none"&&(t.style.display="");const a=Io(l.isGameOver);C.drawImage(a,0,0);const i=Date.now()/1e3;if(l.isGameOver){C.fillStyle="#FFFFFF";for(let z=0;z<50;z++){const ne=(Math.sin(z*123.45)*.5+.5)*Z,W=(Math.cos(z*67.89)*.5+.5)*de*.6;Math.random()>.95&&(C.globalAlpha=.5+Math.sin(i*5+z)*.5),C.fillRect(ne,W,2,2),C.globalAlpha=1}const I=Z-80,_=60,H=4,M=(z,ne,W,X)=>{C.fillStyle="#DDDDDD",C.fillRect(I+z*H,_+ne*H,W*H,X*H)},L=(z,ne,W="#AAAAAA")=>{C.fillStyle=W,C.fillRect(I+z*H,_+ne*H,H,H)};M(4,0,6,1),M(2,1,10,1),M(1,2,12,2),M(0,4,14,6),M(1,10,12,2),M(2,12,10,1),M(4,13,6,1),L(3,4),L(4,4),L(3,5),L(4,5),L(9,8),L(10,8),L(9,9),L(10,9),L(7,2),L(8,2)}else{C.fillStyle="#FFD700",C.fillRect(Z-60,20,30,30),C.fillStyle="#FFA500",C.fillRect(Z-65,25,5,20),C.fillRect(Z-25,25,5,20),C.fillRect(Z-55,15,20,5),C.fillRect(Z-55,50,20,5),C.strokeStyle="#000",C.lineWidth=2;const I=50+Math.sin(i)*10,H=i/20%1*(Z+50)-20;C.beginPath(),C.moveTo(H,I),C.lineTo(H+5,I+3),C.lineTo(H+10,I),C.stroke(),C.beginPath(),C.moveTo(H-15,I+5),C.lineTo(H-10,I+8),C.lineTo(H-5,I+5),C.stroke()}const o=l.isGameOver?"rgba(50, 50, 100, 0.5)":"rgba(255, 255, 255, 0.8)";C.fillStyle=o;const s=i/50%1*(Z+100)-50;C.fillRect(s,40,60,20),C.fillRect(s+10,30,40,10);const d=(i/65+.3)%1*(Z+100)-50;C.fillRect(d,80,50,15),C.fillRect(d+10,70,30,10);const f=180,c=i/35%1,p=Z+500,h=Z+100-c*p,m=(I,_)=>{let M=l.isGameOver?"#CCCCCC":"#FFFFFF",L=l.isGameOver?"#1a3d6a":"#2a4d7a",z=l.isGameOver?"#AAAAAA":"#F0F0F0",ne=L;const W=(X,N,K,pe,oe)=>{C.fillStyle=oe,C.fillRect(I+X*4,_+N*4,K*4,pe*4)};W(18,0,2,1,M),W(19,1,2,4,ne),W(18,1,1,4,M),W(17,4,1,1,M),W(4,4,16,2,M),W(3,5,1,1,M),W(1,6,2,1,M),W(1,6,19,3,L),W(3,9,10,1,L),W(2,4,2,1,"#87CEEB"),W(8,7,5,1,z),W(9,8,4,1,z),W(10,9,3,1,z),W(11,10,2,1,z),W(5,10,1,1,"#000"),W(5,9,1,1,"#555"),W(11,11,1,1,"#000")},g=4,u=h+21*g,T=f+3*g,b=20;if(Qe.currentBannerMessage||(Qe.currentBannerMessage=kl(),Hi=!1),!Hi){const I=` ${Qe.currentBannerMessage} `,_=ga.getContext("2d");_.font='10px "PressStart2PLocal"';const M=_.measureText(I).width+24,L=24;ga.width!==M&&(ga.width=M,ga.height=L),_.clearRect(0,0,M,L),_.fillStyle="#FFF",_.fillRect(0,0,M,L),_.fillStyle="#008000",_.fillRect(0,0,4,L),_.fillStyle="#2a4d7a",_.fillRect(4,0,M-4,4),_.fillRect(4,L-4,M-4,4),_.fillStyle="#2a4d7a",_.textBaseline="middle",_.font='10px "PressStart2PLocal"',_.fillText(I,14,L/2+2),Hi=!0}const y=ga.width,S=ga.height,A=u+b,v=f-2,P=Math.sin(i*2)*3;C.strokeStyle="#1a3d6a",C.lineWidth=2,C.beginPath(),C.moveTo(u,T),C.lineTo(A,v+P),C.stroke(),C.beginPath(),C.moveTo(u,T),C.lineTo(A,v+S+P),C.stroke();for(let I=0;I<y;I+=2){const _=Math.sin(i*2+I*.15)*3,H=Math.min(2,y-I);C.drawImage(ga,I,0,H,S,A+I,v+_,H,S)}m(h,f),e&&l.showFireworks&&e.draw(),Qe.cachedFgCanvas||(Qe.cachedFgCanvas=document.createElement("canvas"),Qe.cachedFgCtx=Qe.cachedFgCanvas.getContext("2d"),Qe.lastFgMode=null);const w=l.isGameOver?"night":"day",D=Qe.cachedFgCanvas.width===Z&&Qe.cachedFgCanvas.height===de,k=Qe.lastFgMode===w;(!D||!k)&&(Qe.cachedFgCanvas.width=Z,Qe.cachedFgCanvas.height=de,Qe.lastFgMode=w,Et(l.isGameOver,!1),Qe.cachedFgCtx.clearRect(0,0,Z,de),Qe.cachedFgCtx.drawImage(Ya,0,0)),C.drawImage(Qe.cachedFgCanvas,0,0)}function Ea(e=null,t=null,a=null,i=null){const o=t||Z,n=a||de,r=(i?ra[i]:Y.currentTheme)||Y.currentTheme,d=o/2,c=l.bat&&l.bat.pivotY?l.bat.pivotY:n*.85;let p;r.id==="SPACE"?p=150+Oe+32:p=l.pitcher&&typeof l.pitcher.y<"u"?l.pitcher.y+(l.pitcher.height||32)/2:n*.25;const h=e||(r.id==="SPACE"?To:Ps);if(e||(r.id==="SPACE"?(Rt.width!==o||Rt.height!==n)&&(Rt.width=o,Rt.height=n):(ba.width!==o||ba.height!==n)&&(ba.width=o,ba.height=n)),h.save(),r.id==="SPACE"){h.clearRect(0,0,o,n),os(h,o,n,d,c,p),h.restore(),h.restore();return}if(r.id==="HAUNTED"){h.clearRect(0,0,o,n),el(h,o,n);return}r.id!=="BEACH"&&r.id!=="HAUNTED"&&h.clearRect(0,0,o,n);const m=c,g=o*1.4,u=Math.max(16,c-40);if(r.id==="BEACH"||(h.beginPath(),h.ellipse(d,m,Math.max(1,g),Math.max(1,u),0,0,Math.PI*2),h.rect(0,c,o,n-c),h.fillStyle=r.warningTrackColor,h.fill(),h.beginPath(),h.ellipse(d,m,Math.max(1,g-15),Math.max(1,u-15),0,0,Math.PI*2),h.fillStyle=r.grassColor,h.fill(),h.clip()),r.drawGrassPattern(h,o,n),h.restore(),h.save(),r.id==="BEACH"&&r.getShorelineY){const y=r.getShorelineY(n);h.beginPath(),h.rect(0,y,o,n-y),h.clip()}r.id!=="BEACH"&&(h.beginPath(),h.ellipse(d,m,Math.max(1,g-15),Math.max(1,u-15),0,0,Math.PI*2),h.clip()),h.fillStyle=r.dirtColor;const T=25;h.beginPath(),h.moveTo(d,c),h.lineTo(o,c-(o-d)*1.5),h.lineTo(o,c-(o-d)*1.5+T),h.lineTo(d+T,c+T),h.fill(),h.beginPath(),h.moveTo(d,c),h.lineTo(0,c-d*1.5),h.lineTo(0,c-d*1.5+T),h.lineTo(d-T,c+T),h.fill(),h.strokeStyle=r.lineColor,h.lineWidth=4,r.id==="BEACH"?Al(h,o,n,d,c):(h.beginPath(),h.moveTo(d,c),h.lineTo(o,c-(o-d)*1.5),h.moveTo(d,c),h.lineTo(0,c-d*1.5),h.stroke()),h.fillStyle=r.dirtColor,h.beginPath(),h.arc(d,c,70,0,Math.PI*2),h.fill();const b=l.pitcher&&typeof l.pitcher.y<"u"?l.pitcher.y+(l.pitcher.height||64)/2+10:n*.25+42;if(h.beginPath(),h.arc(d,b,45,0,Math.PI*2),h.fillStyle=r.moundColor,h.fill(),h.beginPath(),h.arc(d,b,35,0,Math.PI*2),h.fillStyle=r.dirtColor,h.fill(),r.id==="BEACH"&&(h.fillStyle="rgba(0,0,0,0.08)",h.beginPath(),h.arc(d,c,78,0,Math.PI*2),h.fill(),h.beginPath(),h.arc(d,b,52,0,Math.PI*2),h.fill()),h.strokeStyle="#ffffff",h.lineWidth=3,h.strokeRect(d-70,c-30,30,60),h.strokeRect(d+40,c-30,30,60),h.fillStyle="#ffffff",h.beginPath(),h.moveTo(d,c+10),h.lineTo(d+10,c),h.lineTo(d+10,c-10),h.lineTo(d-10,c-10),h.lineTo(d-10,c),h.fill(),h.restore(),r.id!=="BEACH"){const y=Ol(h);h.save(),h.globalCompositeOperation="overlay",h.globalAlpha=.15,h.fillStyle=y,h.fillRect(0,0,o,n),h.restore()}r.id==="BEACH"&&El(h,o,n)}let ki=null;function Ol(e){if(ki)return ki;const t=256,a=document.createElement("canvas");a.width=t,a.height=t;const i=a.getContext("2d"),o=i.createImageData(t,t),n=o.data;for(let s=0;s<n.length;s+=4){const r=Math.random()*255;n[s]=r,n[s+1]=r,n[s+2]=r,n[s+3]=255}return i.putImageData(o,0,0),ki=e.createPattern(a,"repeat"),ki}const po={};function Bl(e){if(po[e])return po[e];const t=400,a=document.createElement("canvas");a.width=t,a.height=t;const i=a.getContext("2d"),o=t/de;i.scale(o,o);const n=(de-Z)/2;return i.translate(n,0),Ea(i,Z,de,e),po[e]=a,a}let go=null;function Fl(){if(go)return go;const e=200,t=800,a=document.createElement("canvas");a.width=e,a.height=t;const i=a.getContext("2d"),o=i.createLinearGradient(0,0,0,t);o.addColorStop(0,"rgba(255, 255, 255, 0.8)"),o.addColorStop(1,"rgba(255, 255, 255, 0)"),i.save(),i.fillStyle=o,i.beginPath(),i.moveTo(e*.45,0),i.lineTo(e*.55,0),i.lineTo(e,t),i.lineTo(0,t),i.closePath(),i.fill();const n=i.createLinearGradient(0,0,0,t);return n.addColorStop(0,"rgba(200, 230, 255, 0.1)"),n.addColorStop(1,"rgba(200, 230, 255, 0)"),i.fillStyle=n,i.fillRect(0,0,e,t),i.restore(),go=a,a}Fl();function Hl(e,t,a,i,o,n=!1,s=1,r=1,d=null){if(l.isDailyChallenge||o>=300)return;let f=o%50/50,c=!1;if(n&&(f=1,c=!0),c&&(f=s,c=s>.01),f<=.001)return;const p=-Math.PI/2,h=p+Math.PI*2*f,m=4,g=d||"#FFD700";e.save();const u=y=>{e.beginPath(),r!==1?e.ellipse(t,a,y,y*r,0,p,h):e.arc(t,a,y,p,h)};let T=0,b=!1;if(f>=.8){const y=Date.now();let S=600;f>=1?S=100:f>=.9&&(S=300),T=(Math.sin(y/S*Math.PI)+1)*.5,b=!0,T>.95&&Date.now()-(Bn||0)>S&&(l.settings?.vibration&&navigator.vibrate&&navigator.vibrate(5),Bn=Date.now())}if(e.lineCap="round",b){const y=i+T*2;if(e.lineWidth=m+T*4,d)u(y),e.strokeStyle=g,e.stroke(),T>.1&&(u(y),e.strokeStyle=`rgba(255, 255, 255, ${T})`,e.stroke());else if(u(y),e.strokeStyle=g,e.stroke(),T>.1){u(y);const S=.6+T*.4;e.strokeStyle=`rgba(255, 255, 255, ${S})`,e.lineWidth=m*.8,e.stroke()}}else u(i),e.strokeStyle=g,e.lineWidth=m,e.stroke();e.restore()}let Bn=0;const Do=[{id:"ROOKIE",name:"The Rookie",leagueId:0,minScoreInSeason:0,maxScoreInSeason:49,visuals:{gender:"MALE",skinColor:"#ffccaa",hatColor:"#e74c3c",walkSpeed:.18},pools:[{max:9,probs:{fastball:.5,curveball:.5}},{max:19,probs:{super_fastball:.4,fastball:.3,curveball:.3}},{max:29,probs:{super_fastball:.5,changeup:.5}},{max:39,probs:{zigzag:.4,super_fastball:.15,changeup:.15,fastball:.15,curveball:.15}},{max:49,probs:{fastball:.2,curveball:.2,super_fastball:.2,changeup:.2,zigzag:.2}}],seasonTwoTrick:F.GHOSTBALL},{id:"TECHNICIAN",name:"The Technician",leagueId:1,minScoreInSeason:50,maxScoreInSeason:99,visuals:{gender:"FEMALE",skinColor:"#ffdbac",hatColor:null,shoeColor:"#FF69B4",scale:1,walkSpeed:.18},pools:[{max:59,probs:{[F.STOPBALL]:.4,[F.FASTBALL]:.12,[F.CURVEBALL]:.12,[F.SUPER_FASTBALL]:.12,[F.CHANGEUP]:.12,[F.ZIGZAG]:.12}},{max:69,probs:{[F.SPLITTER]:.4,[F.FASTBALL]:.1,[F.CURVEBALL]:.1,[F.SUPER_FASTBALL]:.1,[F.CHANGEUP]:.1,[F.ZIGZAG]:.1,[F.STOPBALL]:.1}},{max:79,probs:{[F.GHOSTBALL]:.4,[F.FASTBALL]:.0857,[F.CURVEBALL]:.0857,[F.SUPER_FASTBALL]:.0857,[F.CHANGEUP]:.0857,[F.ZIGZAG]:.0857,[F.STOPBALL]:.0857,[F.SPLITTER]:.0857}},{max:99,probs:{[F.FASTBALL]:.125,[F.CURVEBALL]:.125,[F.SUPER_FASTBALL]:.125,[F.CHANGEUP]:.125,[F.ZIGZAG]:.125,[F.STOPBALL]:.125,[F.SPLITTER]:.125,[F.GHOSTBALL]:.125}}],seasonTwoTrick:F.STOP_CURVE},{id:"ACE",name:"The Ace",leagueId:2,minScoreInSeason:100,maxScoreInSeason:149,visuals:{gender:"MALE",skinColor:"#8d5524",hatColor:"#000000",shoeColor:"#FFD700",sunglasses:!0,beard:!0,goldChain:!0,scale:1,walkSpeed:.18},pools:[{max:109,probs:{SUPER_CURVE:.4,fastball:.075,curveball:.075,changeup:.075,splitter:.075,zigzag:.075,stopball:.075,ghostball:.075,super_fastball:.075}},{max:119,probs:{zigzag_splitter:.4,fastball:.0667,curveball:.0667,changeup:.0667,splitter:.0667,zigzag:.0667,stopball:.0667,ghostball:.0667,super_fastball:.0667,SUPER_CURVE:.0667}},{max:129,probs:{curve_changeup:.4,fastball:.06,curveball:.06,changeup:.06,splitter:.06,zigzag:.06,stopball:.06,ghostball:.06,super_fastball:.06,SUPER_CURVE:.06,zigzag_splitter:.06}},{max:139,probs:{super_zigzag:.4,fastball:.0545,curveball:.0545,changeup:.0545,splitter:.0545,zigzag:.0545,stopball:.0545,ghostball:.0545,super_fastball:.0545,SUPER_CURVE:.0545,zigzag_splitter:.0545,curve_changeup:.0545}},{max:149,probs:{curve_splitter:.4,fastball:.05,curveball:.05,changeup:.05,splitter:.05,zigzag:.05,stopball:.05,ghostball:.05,super_fastball:.05,SUPER_CURVE:.05,zigzag_splitter:.05,curve_changeup:.05,super_zigzag:.05}}],seasonTwoTrick:F.SUPER_ZIGZAG},{id:"SCARY",name:"The Legend",leagueId:4,minScoreInSeason:300,maxScoreInSeason:1/0,bossMode:!0,visuals:{gender:"MALE",skinColor:"#000000",hatColor:"#ffffff",shoeColor:"#ff0000",scale:1.1,walkSpeed:.08},pools:[{max:309,probs:{ghost_stop:.4,fastball:.02307,curveball:.02307,changeup:.02307,super_fastball:.02307,zigzag:.02307,stopball:.02307,splitter:.02307,ghostball:.02307,SUPER_CURVE:.02307,zigzag_splitter:.02307,curve_changeup:.02307,super_zigzag:.02307,curve_splitter:.02307,super_splitter:.02307,GHOST_CURVE:.02307,stop_super:.02307,ghost_zigzag:.02307,stop_zigzag:.02307,stop_splitter:.02307,ghost_changeup:.02307,zigzag_changeup:.02307,STOP_CURVE:.02307,splitter_changeup:.02307,ghost_splitter:.02307,stop_changeup:.02307,ghost_super:.02307}},{max:1/0,probs:{fastball:.037,curveball:.037,changeup:.037,super_fastball:.037,zigzag:.037,stopball:.037,splitter:.037,ghostball:.037,SUPER_CURVE:.037,zigzag_splitter:.037,curve_changeup:.037,super_zigzag:.037,curve_splitter:.037,ghost_stop:.037,super_splitter:.037,GHOST_CURVE:.037,stop_super:.037,ghost_zigzag:.037,stop_zigzag:.037,stop_splitter:.037,ghost_changeup:.037,zigzag_changeup:.037,STOP_CURVE:.037,splitter_changeup:.037,ghost_splitter:.037,stop_changeup:.037,ghost_super:.037}}],seasonTwoTrick:F.STOP_SUPER},{id:"MONITOR",name:"The Monitor",leagueId:3,minScoreInSeason:150,maxScoreInSeason:199,visuals:{gender:"MALE",style:"TV_HEAD",skinColor:"#888888",hatColor:null,shoeColor:"#00ff00",scale:1,walkSpeed:.18},pools:[{max:159,probs:{stop_zigzag:.4,fastball:.0462,curveball:.0462,changeup:.0462,super_fastball:.0462,zigzag:.0462,stopball:.0462,splitter:.0462,ghostball:.0462,SUPER_CURVE:.0462,zigzag_splitter:.0462,curve_changeup:.0462,super_zigzag:.0462,curve_splitter:.0462}},{max:169,probs:{super_splitter:.4,stop_zigzag:.0429,fastball:.0429,curveball:.0429,changeup:.0429,super_fastball:.0429,zigzag:.0429,stopball:.0429,splitter:.0429,ghostball:.0429,SUPER_CURVE:.0429,zigzag_splitter:.0429,curve_changeup:.0429,super_zigzag:.0429,curve_splitter:.0429}},{max:179,probs:{GHOST_CURVE:.4,super_splitter:.04,stop_zigzag:.04,fastball:.04,curveball:.04,changeup:.04,super_fastball:.04,zigzag:.04,stopball:.04,splitter:.04,ghostball:.04,SUPER_CURVE:.04,zigzag_splitter:.04,curve_changeup:.04,super_zigzag:.04,curve_splitter:.04}},{max:189,probs:{stop_super:.4,GHOST_CURVE:.0375,super_splitter:.0375,stop_zigzag:.0375,fastball:.0375,curveball:.0375,changeup:.0375,super_fastball:.0375,zigzag:.0375,stopball:.0375,splitter:.0375,ghostball:.0375,SUPER_CURVE:.0375,zigzag_splitter:.0375,curve_changeup:.0375,super_zigzag:.0375,curve_splitter:.0375}},{max:199,probs:{ghost_zigzag:.4,stop_super:.0353,GHOST_CURVE:.0353,super_splitter:.0353,stop_zigzag:.0353,fastball:.0353,curveball:.0353,changeup:.0353,super_fastball:.0353,zigzag:.0353,stopball:.0353,splitter:.0353,ghostball:.0353,SUPER_CURVE:.0353,zigzag_splitter:.0353,curve_changeup:.0353,super_zigzag:.0353,curve_splitter:.0353}}],seasonTwoTrick:F.GHOST_SUPER},{id:"ROOKIE",name:"The Rookie (Elite)",leagueId:0,minScoreInSeason:200,maxScoreInSeason:249,visuals:{gender:"MALE",skinColor:"#ffccaa",hatColor:"#e74c3c",walkSpeed:.18},pools:[{max:209,probs:{stop_splitter:.4,ghost_zigzag:.0333,stop_super:.0333,GHOST_CURVE:.0333,super_splitter:.0333,stop_zigzag:.0333,fastball:.0333,curveball:.0333,changeup:.0333,super_fastball:.0333,zigzag:.0333,stopball:.0333,splitter:.0333,ghostball:.0333,SUPER_CURVE:.0333,zigzag_splitter:.0333,curve_changeup:.0333,super_zigzag:.0333,curve_splitter:.0333}},{max:219,probs:{ghost_changeup:.4,stop_splitter:.0316,ghost_zigzag:.0316,stop_super:.0316,GHOST_CURVE:.0316,super_splitter:.0316,stop_zigzag:.0316,fastball:.0316,curveball:.0316,changeup:.0316,super_fastball:.0316,zigzag:.0316,stopball:.0316,splitter:.0316,ghostball:.0316,SUPER_CURVE:.0316,zigzag_splitter:.0316,curve_changeup:.0316,super_zigzag:.0316,curve_splitter:.0316}},{max:229,probs:{zigzag_changeup:.4,ghost_changeup:.03,stop_splitter:.03,ghost_zigzag:.03,stop_super:.03,GHOST_CURVE:.03,super_splitter:.03,stop_zigzag:.03,fastball:.03,curveball:.03,changeup:.03,super_fastball:.03,zigzag:.03,stopball:.03,splitter:.03,ghostball:.03,SUPER_CURVE:.03,zigzag_splitter:.03,curve_changeup:.03,super_zigzag:.03,curve_splitter:.03}},{max:239,probs:{STOP_CURVE:.4,zigzag_changeup:.0286,ghost_changeup:.0286,stop_splitter:.0286,ghost_zigzag:.0286,stop_super:.0286,GHOST_CURVE:.0286,super_splitter:.0286,stop_zigzag:.0286,fastball:.0286,curveball:.0286,changeup:.0286,super_fastball:.0286,zigzag:.0286,stopball:.0286,splitter:.0286,ghostball:.0286,SUPER_CURVE:.0286,zigzag_splitter:.0286,curve_changeup:.0286,super_zigzag:.0286,curve_splitter:.0286}},{max:249,probs:{splitter_changeup:.4,STOP_CURVE:.0273,zigzag_changeup:.0273,ghost_changeup:.0273,stop_splitter:.0273,ghost_zigzag:.0273,stop_super:.0273,GHOST_CURVE:.0273,super_splitter:.0273,stop_zigzag:.0273,fastball:.0273,curveball:.0273,changeup:.0273,super_fastball:.0273,zigzag:.0273,stopball:.0273,splitter:.0273,ghostball:.0273,SUPER_CURVE:.0273,zigzag_splitter:.0273,curve_changeup:.0273,super_zigzag:.0273,curve_splitter:.0273}}]},{id:"TECHNICIAN",name:"The Technician (Elite)",leagueId:1,minScoreInSeason:250,maxScoreInSeason:299,visuals:{gender:"FEMALE",skinColor:"#ffdbac",hatColor:null,shoeColor:"#FF69B4",scale:1,walkSpeed:.18},pools:[{max:259,probs:{ghost_splitter:.4,splitter_changeup:.0261,STOP_CURVE:.0261,zigzag_changeup:.0261,ghost_changeup:.0261,stop_splitter:.0261,ghost_zigzag:.0261,stop_super:.0261,GHOST_CURVE:.0261,super_splitter:.0261,stop_zigzag:.0261,fastball:.0261,curveball:.0261,changeup:.0261,super_fastball:.0261,zigzag:.0261,stopball:.0261,splitter:.0261,ghostball:.0261,SUPER_CURVE:.0261,zigzag_splitter:.0261,curve_changeup:.0261,super_zigzag:.0261,curve_splitter:.0261}},{max:269,probs:{stop_changeup:.4,ghost_splitter:.025,splitter_changeup:.025,STOP_CURVE:.025,zigzag_changeup:.025,ghost_changeup:.025,stop_splitter:.025,ghost_zigzag:.025,stop_super:.025,GHOST_CURVE:.025,super_splitter:.025,stop_zigzag:.025,fastball:.025,curveball:.025,changeup:.025,super_fastball:.025,zigzag:.025,stopball:.025,splitter:.025,ghostball:.025,SUPER_CURVE:.025,zigzag_splitter:.025,curve_changeup:.025,super_zigzag:.025,curve_splitter:.025}},{max:279,probs:{ghost_super:.4,stop_changeup:.024,ghost_splitter:.024,splitter_changeup:.024,STOP_CURVE:.024,zigzag_changeup:.024,ghost_changeup:.024,stop_splitter:.024,ghost_zigzag:.024,stop_super:.024,GHOST_CURVE:.024,super_splitter:.024,stop_zigzag:.024,fastball:.024,curveball:.024,changeup:.024,super_fastball:.024,zigzag:.024,stopball:.024,splitter:.024,ghostball:.024,SUPER_CURVE:.024,zigzag_splitter:.024,curve_changeup:.024,super_zigzag:.024,curve_splitter:.024}},{max:299,probs:{fastball:.0385,curveball:.0385,changeup:.0385,super_fastball:.0385,zigzag:.0385,stopball:.0385,splitter:.0385,ghostball:.0385,SUPER_CURVE:.0385,zigzag_splitter:.0385,curve_changeup:.0385,super_zigzag:.0385,curve_splitter:.0385,super_splitter:.0385,GHOST_CURVE:.0385,stop_super:.0385,ghost_zigzag:.0385,stop_splitter:.0385,ghost_changeup:.0385,zigzag_changeup:.0385,STOP_CURVE:.0385,splitter_changeup:.0385,ghost_splitter:.0385,stop_changeup:.0385,ghost_super:.0385,stop_zigzag:.0385}}]}];function cs(e){if(e>=300)return{seasonIndex:0,scoreInSeason:e};const t=400,a=Math.floor(e/t),i=e%t;return{seasonIndex:a,scoreInSeason:i}}function Eo(e){const{scoreInSeason:t}=cs(e);return Do.find(a=>t>=a.minScoreInSeason&&t<=a.maxScoreInSeason)}function Fn(e,t,a=!1){const{seasonIndex:i,scoreInSeason:o}=cs(t);if(!e||!e.pools)return F.FASTBALL;const n=i>=1,s=a?Ra.random():Math.random();if(n&&s<.1&&e.seasonTwoTrick)return e.seasonTwoTrick;const d=e.pools.find(p=>o<=p.max)||e.pools[e.pools.length-1],f=a?Ra.random():Math.random();let c=0;for(const[p,h]of Object.entries(d.probs))if(c+=h,f<c)return p;return F.FASTBALL}let Hn;function ds(){const e=Z;if(window.innerWidth===0||window.innerHeight===0)return;const t=window.innerWidth/window.innerHeight,a=600/800;let i,o;t>a?(o=800,i=o*t):(i=600,o=i/t),Es(i,o),Gt.width=i,Gt.height=o,C.imageSmoothingEnabled=!1,Gt.style.width=`${window.innerWidth}px`,Gt.style.height=`${window.innerHeight}px`;const n=Oe;de>en?tn((de-en)/2):tn(0);const s=Oe-n,r=e/2,f=Z/2-r;l.pitcher&&(l.pitcher.x=Z/2-l.pitcher.width/2,l.pitcher.y=150+Oe),l.bat&&(l.bat.pivotX=Z/2-40,l.bat.pivotY=As+Oe),l.balls&&l.balls.forEach(g=>{g.x+=f,g.startY+=s,g.y+=s,g.startX+=f,g.prevX+=f,g.prevY+=s}),Et(l.lastStaticRenderMode||!1),Ea(null,i,o);const m=110*(window.innerHeight/o)+20;Be&&Be.style.setProperty("--title-bottom-offset",`${m}px`),clearTimeout(Hn),Hn=setTimeout(()=>{const g=Y.currentTheme?Y.currentTheme.id:"CLASSIC";Y.currentTheme&&Y.currentTheme.warmup&&Y.currentTheme.warmup(Z,de);let u=new Set(["CLASSIC"]);try{const y=localStorage.getItem("baseball_unlockables");if(y){const S=JSON.parse(y),A=JSON.parse(S.d||y);A.stadiums&&A.stadiums.filter(v=>v.unlocked).forEach(v=>{const P={stadium_haunted:"HAUNTED",stadium_beach:"BEACH",stadium_space:"SPACE"};P[v.id]&&u.add(P[v.id])})}}catch{u=new Set(["CLASSIC","HAUNTED","BEACH","SPACE"])}const T=["HAUNTED","BEACH","SPACE"].filter(y=>y===g?!1:u.has(y));let b=800;T.forEach(y=>{setTimeout(()=>{l.gameActive||ra[y]&&ra[y].warmup&&(console.log(`[Warmup] Background loading: ${y}`),ra[y].warmup(Z,de))},b),b+=1e3})},200)}function Ul(){if(Y.currentTheme.id!=="SPACE"&&Y.currentTheme.id!=="HAUNTED"&&Y.currentTheme.id!=="CLASSIC"&&Y.currentTheme.id!=="BEACH"){const e=Io(l.isGameOver);C.drawImage(e,0,0)}if(Ya.width>0&&C.drawImage(Ya,0,0),Y.currentTheme.id==="CLASSIC"&&(C.fillStyle="#1a1a1a",C.fillRect(0,0,Z,100),Wt.width>0)){const e=(Wt.width-Z)/2,t=Math.max(0,e),a=e<0?-e:0,i=Math.floor(Math.min(Z,Wt.width)),o=100;if(l.staticCrowdCache||(typeof OffscreenCanvas<"u"?l.staticCrowdCache=new OffscreenCanvas(i,o):(l.staticCrowdCache=document.createElement("canvas"),l.staticCrowdCache.width=i,l.staticCrowdCache.height=o)),l.staticCrowdCache.width!==i||!l.crowdData||l.crowdDataWidth!==i){l.staticCrowdCache.width=i,l.staticCrowdCache.height=o;const n=l.staticCrowdCache.getContext("2d"),s=[],r=200,d=Wn,f=Nn,c=m=>{const g=Math.sin(m)*1e4;return g-Math.floor(g)};for(let m=0;m<r;m++){const g=m*1337,u=c(g),T=c(g+1),b=Math.floor(c(g+4)*2e3),y=800+Math.floor(c(g+5)*700);s.push({localX:Math.floor(u*i),py:Math.floor(T*100),skin:d[Math.floor(c(g+2)*d.length)],shirt:f[Math.floor(c(g+3)*f.length)],shift:b,cycleDuration:y})}l.crowdData=s,l.crowdDataWidth=i;const p=l.crowdData,h=p.length;for(let m=0;m<h;m++){const g=p[m];n.fillStyle=g.shirt,n.fillRect(g.localX,g.py+4,8,6),n.fillStyle=g.skin,n.fillRect(g.localX+1,g.py,6,4)}}if(C.drawImage(Wt,Math.floor(t),0,i,o,Math.floor(a),0,i,o),C.drawImage(l.staticCrowdCache,Math.floor(a),0),V.consecutivePerfectHits>=1&&l.perfectHitTimer>0&&l.crowdData){const n=Date.now(),s=-4;C.save();const r=l.crowdData,d=r.length;for(let f=0;f<d;f++){const c=r[f];if((n+c.shift)%c.cycleDuration<300){const h=a+c.localX,m=c.py,g=t+c.localX;C.drawImage(Wt,g,m,8,10,h,m,8,10),C.fillStyle=c.shirt,C.fillRect(h,m+4+s,8,6),C.fillStyle=c.skin,C.fillRect(h+1,m+s,6,4),C.fillStyle=c.skin,C.fillRect(h-1,m+2+s,2,4),C.fillRect(h+7,m+2+s,2,4)}}C.restore()}}if(Y.currentTheme.id==="HAUNTED"&&zs(C,Z,de),Y.currentTheme.id==="BEACH"&&Zi(C,Z,de),Y.currentTheme.id==="SPACE"&&Rt.width>0){const e=150+Oe+32;C.drawImage(Rt,0,0),Tl(C,Rt.width,Rt.height,e)}if(ba.width>0&&Y.currentTheme.id!=="SPACE"){if(C.save(),Y.currentTheme.id,Y.currentTheme.id==="BEACH"&&Y.currentTheme.getShorelineY){const e=C.canvas.height,t=Y.currentTheme.getShorelineY(e);C.beginPath(),C.rect(0,t,C.canvas.width,e-t),C.clip()}C.drawImage(ba,0,0),C.restore(),Y.currentTheme.id==="BEACH"&&Rl(C,Z,de)}if(Y.currentTheme.id==="HAUNTED"&&Xs(C,Z,de),l.bossModeActive){const e=l.pitcher.state;(e===Ae.WALK_ON||e===Ae.WALK_OFF)&&(C.fillStyle="rgba(0, 0, 0, 0.6)",C.fillRect(0,0,Z,de))}if(Y.currentTheme.id==="CLASSIC"||Y.currentTheme.id==="BEACH"||Y.currentTheme.id==="HAUNTED"||Y.currentTheme.id==="SPACE"){const e=Z/2;let t=150+Oe+26;Y.currentTheme.id==="SPACE"&&(t=150+Oe+32);let a=!1,i=1;if(!l.isDailyChallenge&&l.pitcher){const r=Eo(V.score);if(r){const d=r.id!==l.pitcher.id,f=l.pitcher.state===Ae.WALK_OFF||l.pitcher.state===Ae.WALK_ON;if(d||f)if(a=!0,l.pitcher.state===Ae.WALK_OFF){const c=Z/2,p=-100,h=l.pitcher.x,m=c-p,g=h-p;i=Math.max(0,Math.min(1,g/m))}else l.pitcher.state===Ae.WALK_ON&&(i=0)}}let o=48,n=1,s=null;Y.currentTheme.id==="HAUNTED"?(o=80,n=.4,s="#00FFFF"):Y.currentTheme.id==="SPACE"&&(o=49),Hl(C,e,t,o,V.score,a,i,n,s)}if(l.aceFlashStartTime){const e=performance.now()-l.aceFlashStartTime;if(e<1e3){const t=e/1e3,a=1-Math.pow(1-t,3),i=Z/2,o=l.pitcher.y+(l.pitcher.height||64)/2,s=Z*1.5*a,r=C.createRadialGradient(i,o,0,i,o,s);r.addColorStop(0,`rgba(255, 255, 255, ${.9*(1-t)})`),r.addColorStop(.2,`rgba(255, 215, 0, ${.8*(1-t)})`),r.addColorStop(1,"rgba(255, 215, 0, 0)"),C.fillStyle=r,C.fillRect(0,0,Z,de),C.strokeStyle=`rgba(255, 255, 255, ${.8*(1-t)})`,C.lineWidth=15*(1-t),C.beginPath(),C.arc(i,o,s*.8,0,Math.PI*2),C.stroke(),C.lineWidth=5*(1-t),C.stroke()}}if(l.showTutorial&&Qn(),l.monitorEntranceStartTime){const e=performance.now()-l.monitorEntranceStartTime;e<1500?Vl(C,e/1500):l.monitorEntranceStartTime=0}}function Vl(e,t){const a=Z,i=de,o=Math.floor(a/20),n=1-t;e.save(),e.font="bold 20px monospace",e.textAlign="center";for(let s=0;s<o;s++){const r=s*20+10,d=s*731,f=Math.floor(i/20),c=t*i*2;for(let p=0;p<f;p++){const h=(p*20+c)%i,m=Math.sin(p+d+t*10)>0?"1":"0",g=n*(.3+.7*Math.random());Math.random()>.95?(e.globalAlpha=n,e.fillStyle="#cfc"):(e.globalAlpha=g,e.fillStyle="#0f0"),e.fillText(m,r,h)}}e.restore()}function zl(){Y.currentTheme.id==="HAUNTED"&&(l.bat&&(l.bat.pivotX,l.bat.pivotY),Kn(C,Z,de))}const ra={CLASSIC:{id:"CLASSIC",name:"Classic Field",grassColor:"#00a800",dirtColor:"#654321",lineColor:"#ffffff",warningTrackColor:"#a0522d",moundColor:"#503010",stripeColor:"rgba(0, 0, 0, 0.1)",drawGrassPattern(e,t,a){const o=Math.ceil(t/40);for(let n=0;n<o;n++)n%2!==0&&(e.fillStyle=this.stripeColor,e.fillRect(n*40,0,40,a))}},SPACE:{id:"SPACE",name:"Space Station",grassColor:"#1e272e",dirtColor:"#bdc3c7",lineColor:"#f39c12",warningTrackColor:"#2c3e50",moundColor:"#95a5a6",stripeColor:"rgba(255, 255, 255, 0.05)",pitcherAccessories:{spaceHelmet:!0},pitcherAccessories:{spaceHelmet:!0},walkOffType:"FLY_AWAY",warmup(e,t){is(e,t)},drawGrassPattern(e,t,a){const o=30*Math.sqrt(3),s=60*.75;e.lineWidth=1,e.strokeStyle="#2f3640";const r=Math.ceil(a/o)+1,d=Math.ceil(t/s)+1;for(let c=0;c<r;c++)for(let p=0;p<d;p++){const h=p*s,m=c*o+(p%2===0?0:o/2);e.beginPath();for(let g=0;g<6;g++){const u=2*Math.PI/6*g,T=h+30*Math.cos(u),b=m+30*Math.sin(u);g===0?e.moveTo(T,b):e.lineTo(T,b)}e.closePath(),Math.random()>.95?(e.fillStyle="rgba(52, 152, 219, 0.1)",e.fill()):Math.random()>.98&&(e.fillStyle="rgba(231, 76, 60, 0.1)",e.fill()),e.stroke(),e.fillStyle="#353b48",e.fillRect(h-1,m-1,2,2)}const f=e.createRadialGradient(t/2,a/2,a/4,t/2,a/2,a);f.addColorStop(0,"rgba(0,0,0,0)"),f.addColorStop(1,"rgba(0,0,0,0.4)"),e.fillStyle=f,e.fillRect(0,0,t,a)}},BEACH:{id:"BEACH",name:"Sunny Beach",grassColor:"#f4e4bc",dirtColor:"#e0cda7",lineColor:"#ffffff",warningTrackColor:"#90d4e9",moundColor:"#d6c096",stripeColor:"rgba(0, 0, 0, 0.05)",pitcherAccessories:{sunglasses:!0},walkOffType:"SWIM",warmup(e,t){if(Ml(e,t),typeof document<"u"){const a=document.createElement("canvas");a.width=1,a.height=1;const i=a.getContext("2d");this.drawGrassPattern(i,e,t),console.log("[ThemeManager] Beach Ground Cache Force-Generated")}},getShorelineY(e){const t=150+(Oe||0)+32;return Math.max(e*.1+20,t-120)},drawGrassPattern(e,t,a){if(!this._cachedGroundCanvas||this._cachedGroundCanvas.width!==t||this._cachedGroundCanvas.height!==a){this._cachedGroundCanvas=document.createElement("canvas"),this._cachedGroundCanvas.width=t,this._cachedGroundCanvas.height=a;const i=this._cachedGroundCanvas.getContext("2d");if(!this.sandPattern){const r=document.createElement("canvas"),d=128;r.width=d,r.height=d;const f=r.getContext("2d");f.fillStyle="#f4e4bc",f.fillRect(0,0,d,d);const c=f.getImageData(0,0,d,d),p=c.data;for(let h=0;h<p.length;h+=4){const m=(Math.random()-.5)*20;p[h]=Math.max(0,Math.min(255,p[h]+m)),p[h+1]=Math.max(0,Math.min(255,p[h+1]+m)),p[h+2]=Math.max(0,Math.min(255,p[h+2]+m))}f.putImageData(c,0,0),f.fillStyle="rgba(255, 255, 255, 0.4)";for(let h=0;h<40;h++)f.fillRect(Math.random()*d,Math.random()*d,1,1);this.sandPattern=i.createPattern(r,"repeat")}const o=this.getShorelineY(a);i.fillStyle=this.sandPattern,i.fillRect(0,o,t,a-o);const n=240;for(let r=o;r<a;r+=n){const d=i.createLinearGradient(0,r,0,r+n);d.addColorStop(0,"rgba(100, 80, 50, 0.15)"),d.addColorStop(.4,"rgba(100, 80, 50, 0)"),d.addColorStop(1,"rgba(255, 255, 255, 0.2)"),i.fillStyle=d,i.beginPath(),i.moveTo(0,r);for(let f=0;f<=t;f+=50){const c=r+Math.sin(f*.003+r)*20;i.lineTo(f,c)}i.lineTo(t,r+n),i.lineTo(0,r+n),i.fill()}const s=i.createRadialGradient(t/2,a*.7,50,t/2,a*.7,t*.6);s.addColorStop(0,"rgba(160, 140, 110, 0.4)"),s.addColorStop(1,"rgba(160, 140, 110, 0)"),i.fillStyle=s,i.fillRect(0,o,t,a-o)}e.drawImage(this._cachedGroundCanvas,0,0)}},HAUNTED:{id:"HAUNTED",name:"Haunted Mansion",grassColor:"#1a261a",dirtColor:"#2d3436",lineColor:"#dfe6e9",warningTrackColor:"#000000",moundColor:"#4b4b4b",stripeColor:"rgba(0,0,0,0.3)",pitcherAccessories:{halloweenMask:!0},walkOffType:"GHOST",warmup(e,t){pi(e,t)},drawGrassPattern(e,t,a){}}},Y={currentTheme:ra.CLASSIC,setTheme(e){ra[e]&&(this.currentTheme=ra[e],typeof document<"u"&&document.body&&document.body.setAttribute("data-theme",e),il())},init(){typeof document<"u"&&document.body&&this.currentTheme&&document.body.setAttribute("data-theme",this.currentTheme.id)}};Y.init();const Wl=Object.freeze(Object.defineProperty({__proto__:null,THEMES:ra,themeManager:Y},Symbol.toStringTag,{value:"Module"})),ii={Heavy:"HEAVY",Medium:"MEDIUM",Light:"LIGHT"};class Nl{constructor(){this.Haptics=null,this.initialized=!1,this.patterns={light:ii.Light,medium:ii.Medium,heavy:ii.Heavy,perfect:ii.Heavy,good:15,foul:15,failure:[60,50,60,50,100],unlock:[50,50,100,50,150],purchase:[60,40,60,40,100],locked:[30,50,30],equipped:[20,20,20],footstep:25,bossStep:ii.Heavy,bossEntrance:[100,50,100,50,200,50,400]},this.init()}async init(){if(typeof window.Capacitor<"u")try{const{Haptics:t}=await De(async()=>{const{Haptics:a}=await import("./index-l1QRJpTW.js");return{Haptics:a}},__vite__mapDeps([0,1]),import.meta.url);this.Haptics=t,this.initialized=!0}catch{console.log("Haptics native plugin not found.")}}async vibrate(t){if(!l.settings?.vibration)return;const a=this.patterns[t];try{if(this.initialized&&this.Haptics)typeof a=="string"?await this.Haptics.impact({style:a}):typeof a=="number"?await this.Haptics.vibrate({duration:a}):Array.isArray(a)&&this.vibrateSequence(a);else throw new Error("Native Haptics unavailable")}catch{if(navigator.vibrate){if(Array.isArray(a)||typeof a=="number")navigator.vibrate(a);else if(typeof a=="string"){const n={LIGHT:10,MEDIUM:25,HEAVY:50}[a]||25;navigator.vibrate(n)}}}}async vibrateSequence(t){for(let a=0;a<t.length;a++){const i=t[a];a%2===0&&i>0&&this.Haptics&&await this.Haptics.vibrate({duration:i}),await new Promise(o=>setTimeout(o,i))}}vibrateCustom(t){l.settings?.vibration&&(this.initialized&&this.Haptics?typeof t=="number"?this.Haptics.vibrate({duration:t}).catch(()=>{}):Array.isArray(t)&&this.vibrateSequence(t):navigator.vibrate&&navigator.vibrate(t))}}const Ee=new Nl;class $l{constructor(){this.isOpen=!1,this.init()}closeAndExit(){this.isOpen=!1,ea&&(ea.style.display="none"),G.playSettingsClose(),fs()}init(){this.loadSettings(),qe.addEventListener("click",()=>this.openSettings()),bs.addEventListener("click",()=>this.closeSettings()),vt.addEventListener("click",()=>{if(l.isDailyChallenge){Ee.vibrate("medium"),G.playError();return}Ee.vibrate("medium"),this.restartGame()}),ea&&(ea.onclick=t=>{t.stopPropagation(),t.target===ea&&this.closeSettings()}),ut&&ut.addEventListener("click",()=>{if(l.isDailyChallenge&&!l.isGameOver){Ee.vibrate("medium"),G.playError();return}if(l.isGameOver){this.closeAndExit();return}const t=document.getElementById("confirmation-modal"),a=document.getElementById("confirm-ok-btn"),i=document.getElementById("confirm-cancel-btn");if(t&&a&&i){const o=()=>{Ee.vibrate("light"),t.style.display="none",G.playSettingsClose()};a.onclick=()=>{Ee.vibrate("medium"),t.style.display="none",this.closeAndExit()},i.onclick=o,t.onclick=n=>{n.stopPropagation(),n.target===t&&o()},t.style.display="flex",G.playSettingsOpen()}else this.closeAndExit()}),Xo.addEventListener("change",t=>this.updateSetting("swingOnRelease",t.target.checked)),Zo.addEventListener("change",t=>this.updateSetting("vibration",t.target.checked)),Ko.addEventListener("change",t=>this.updateSetting("muteMusic",t.target.checked)),jo.addEventListener("change",t=>this.updateSetting("muteSound",t.target.checked)),Jo.addEventListener("change",t=>this.updateSetting("colorBlindMode",t.target.checked)),Qo.addEventListener("change",t=>this.updateSetting("noFlash",t.target.checked)),document.addEventListener("keydown",t=>{(t.key==="r"||t.key==="R")&&(this.isOpen&&l.gameActive&&!l.isDailyChallenge?(Ee.vibrate("medium"),this.restartGame()):this.isOpen&&l.gameActive&&l.isDailyChallenge&&(Ee.vibrate("medium"),G.playError()))})}loadSettings(){const t=localStorage.getItem("baseball_settings");if(t)try{const a=JSON.parse(t);l.settings={...l.settings,...a}}catch(a){console.error("Failed to parse settings",a)}this.syncUI(),this.applySideEffects()}syncUI(){l.settings&&(Xo.checked=!!l.settings.swingOnRelease,Zo.checked=!!l.settings.vibration,Ko.checked=!!l.settings.muteMusic,jo.checked=!!l.settings.muteSound,Jo.checked=!!l.settings.colorBlindMode,Qo.checked=!!l.settings.noFlash)}updateSetting(t,a){l.settings||(l.settings={}),l.settings[t]=a,this.saveSettings(),this.applySideEffects(t),G.playSettingsToggle()}saveSettings(){localStorage.setItem("baseball_settings",JSON.stringify(l.settings))}applySideEffects(t){if(t==="muteMusic"||!t)l.settings.muteMusic?G.stopTheme():!l.gameActive&&l.isGameOver&&(Y.currentTheme&&Y.currentTheme.id==="HAUNTED"?G.playHauntedTheme():G.playTheme());else if(t==="noFlash"&&l.isGameOver){const a=document.getElementById("restart-msg");a&&(a.style.animation=l.settings.noFlash?"none":"blink 1s infinite")}}openSettings(){this.isOpen=!0,ea.style.display="flex",G.init().then(()=>{G.playSettingsOpen()}),l.gameActive?(vt.style.display="block",l.isDailyChallenge?(vt.classList.add("btn-blocked"),vt.style.opacity="",vt.style.filter="",vt.style.textDecoration=""):(vt.classList.remove("btn-blocked"),vt.style.opacity="1",vt.style.filter="none",vt.style.textDecoration="none")):vt.style.display="none",ut&&(!l.gameActive&&!l.isGameOver?ut.style.display="none":(ut.style.display="block",l.isDailyChallenge&&!l.isGameOver?(ut.classList.add("btn-blocked"),ut.style.opacity="",ut.style.filter="",ut.style.textDecoration=""):(ut.classList.remove("btn-blocked"),ut.style.opacity="1",ut.style.filter="none",ut.style.textDecoration="none")))}closeSettings(){this.isOpen=!1,ea.style.display="none",Aa(!0),G.playSettingsClose()}restartGame(){this.closeSettings(),ca(l.isDailyChallenge,!1,"menu")}}const aa=new $l;class Yl{constructor(){this.boundHandleKeyDown=this.handleKeyDown.bind(this),this.boundHandleTouchStart=this.handleTouchStart.bind(this),this.boundHandleTouchEnd=this.handleTouchEnd.bind(this),this.boundHandleMouseDown=this.handleMouseDown.bind(this),this.boundHandleMouseUp=this.handleMouseUp.bind(this),this.boundHandleClick=this.handleClick.bind(this),this.lastPhysicalInputTime=0,this.touchStartX=0,this.touchStartY=0}markInput(){this.lastPhysicalInputTime=performance.now()}init(){window.addEventListener("keydown",t=>{this.markInput(),this.boundHandleKeyDown(t)}),window.addEventListener("keyup",t=>{this.markInput(),this.handleKeyUp(t)}),window.addEventListener("touchstart",t=>{this.markInput(),this.boundHandleTouchStart(t)},{passive:!1}),window.addEventListener("touchend",t=>{this.markInput(),this.boundHandleTouchEnd(t)},{passive:!1}),window.addEventListener("mousedown",t=>{this.markInput(),this.boundHandleMouseDown(t)}),window.addEventListener("mouseup",t=>{this.markInput(),this.boundHandleMouseUp(t)}),Me&&Me.addEventListener("click",t=>{t.stopPropagation(),$a()}),window.addEventListener("contextmenu",t=>t.preventDefault()),window.addEventListener("pointerdown",t=>{t.target.closest('button, .clickable, #settings-btn, #pause-btn, #unlockables-btn, #leaderboard-btn, .close-btn, input[type="checkbox"], #daily-prev-btn, #daily-next-btn, #message-overlay, .nav-arrow')&&Ee.vibrate("light")})}handleKeyDown(t){if(!l.transitioning&&t.isTrusted&&!t.target.matches("input, textarea")){if(t.code==="Space"){if(l.isLoading||l.showTutorial)return;l.gameActive?!l.settings?.swingOnRelease&&!l.isPaused&&Ta():Be.style.display!=="none"&&G.init().then(()=>ca(l.isDailyChallenge,!1,"game_over"))}if(t.code==="Escape"){if(aa.isOpen){aa.closeSettings();return}Me.style.pointerEvents!=="none"&&$a()}if(t.code==="KeyP"){if(aa.isOpen)return;Me.style.pointerEvents!=="none"&&$a()}t.code==="KeyS"&&(aa.isOpen?aa.closeSettings():(l.isPaused||!l.gameActive)&&aa.openSettings()),t.code==="KeyD"&&bi&&(bi.style.display==="none"?bi.style.display="block":bi.style.display="none")}}isUIClick(t){return t.closest("#pause-btn")||t.closest("#settings-btn")||t.closest("#settings-modal")||t.closest("#unlockables-btn")||t.closest("#unlockables-modal")||t.closest("#leaderboard-btn")||t.closest("#leaderboard-modal")||t.closest("#daily-retry-modal")||t.closest("#security-modal")||t.closest("#confirmation-modal")||t.closest("#feedback-btn")||t.closest("#coin-container")}handleTouchStart(t){if(l.transitioning||!t.isTrusted||this.isUIClick(t.target)||l.isLoading||(t.preventDefault(),t.touches&&t.touches.length>0&&(this.touchStartX=t.touches[0].clientX,this.touchStartY=t.touches[0].clientY),!l.gameActive)||l.showTutorial)return;!l.settings?.swingOnRelease&&!l.isPaused&&Ta()}handleTouchEnd(t){if(!l.transitioning&&t.isTrusted&&!this.isUIClick(t.target)){if(t.preventDefault(),!l.gameActive){const a=t.changedTouches[0].clientX,i=t.changedTouches[0].clientY;Math.hypot(a-this.touchStartX,i-this.touchStartY)<30&&G.init().then(()=>ca(l.isDailyChallenge,!1,"game_over"));return}l.gameActive&&!l.showTutorial&&!l.isPaused&&l.settings?.swingOnRelease&&Ta()}}handleMouseDown(t){if(l.transitioning||!t.isTrusted||this.isUIClick(t.target)||l.isLoading)return;if(!l.gameActive){G.init().then(()=>ca(l.isDailyChallenge,!1,"game_over"));return}if(l.showTutorial)return;!l.settings?.swingOnRelease&&!l.isPaused&&Ta()}handleMouseUp(t){l.transitioning||t.isTrusted&&(this.isUIClick(t.target)||l.gameActive&&!l.showTutorial&&!l.isPaused&&l.settings?.swingOnRelease&&Ta())}handleKeyUp(t){l.transitioning||t.code==="Space"&&l.gameActive&&!l.showTutorial&&!l.isPaused&&l.settings?.swingOnRelease&&Ta()}handleClick(t){}}const Ui=new Yl;class ql{#e=Math.floor(Math.random()*16777215);#s=0;#a=0;#c=0;#d=0;#i=0;#o=0;#y=0;#f=null;#u=null;#n=!1;#t=0;#l=0;#g=!1;#p=null;#m=null;_lastSyncTimestamp=0;constructor(){q.migrate("baseball_coins"),q.migrate("baseball_local_delta"),q.migrate("baseball_local_perfects_delta");const t=He.getDailySeed();q.migrate(`baseball_daily_score_${t}`),this.#s=0^this.#e,this.#i=0^this.#e,this.#o=0^this.#e;const a=parseInt(q.getItem("baseball_high_score_s1","0"))||0;this.#c=a^this.#e;const i=parseInt(q.getItem(`baseball_daily_score_${t}`,"0"))||0;this.#d=i^this.#e;const o=parseInt(q.getItem("baseball_coins","0"))||0;this.#a=o^this.#e;const n=parseInt(q.getItem("baseball_local_delta")||"0");this.#t=n;const s=parseInt(q.getItem("baseball_local_perfects_delta")||"0");this.#l=s;const r=q.getItem("baseball_last_synced_balance");if(r!==null&&n===0){const d=parseInt(r)||0;this.#t=Math.max(0,o-d),this.#h(),q.removeItem("baseball_last_synced_balance"),console.log(`[ScoreManager] Migrated from lastSynced (${d}) to localDelta (${this.#t})`)}this.startCoins=this.coins,this.initialHighScore=this.highScore,this.initialDailyHigh=this.dailyHighScore,this.fetchServerBalance()}async startSession(){return this.#m=null,this.#p=(async()=>{try{console.log("[ScoreManager] Session Tracking Disabled (Optimization)")}catch{console.warn("[ScoreManager] Failed to start server session (Offline?)")}return null})(),this.#p}get score(){return this.#s^this.#e}get coins(){return this.#a^this.#e}get strikes(){return this.#i^this.#e}get consecutivePerfectHits(){return this.#o^this.#e}get highScore(){return this.#c^this.#e}set highScore(t){this.#c=t^this.#e}get dailyHighScore(){return this.#d^this.#e}set dailyHighScore(t){this.#d=t^this.#e}reset(){this.#s=0^this.#e,this.#i=0^this.#e,this.#o=0^this.#e,this.startCoins=this.coins,this.#n=!1,this.sessionPerfects=0,this.initialHighScore=this.highScore;const t=He.getDailySeed();q.migrate(`baseball_daily_score_${t}`);const a=parseInt(q.getItem(`baseball_daily_score_${t}`,"0"))||0;this.dailyHighScore=a,this.initialDailyHigh=a,this.updateScoreDisplay(),this.updateCoinDisplay(),Ht&&(Ht.style.display="none"),ma&&(ma.style.display="none")}get isTainted(){return this.#n}get localDelta(){return this.#t}#h(){q.setItem("baseball_local_delta",this.#t.toString()),q.setItem("baseball_local_perfects_delta",this.#l.toString())}#T(){this.#t=0,this.#l=0,this.#h()}#r(){const t=this.#s^this.#e,a=this.#a^this.#e,i=this.#c^this.#e,o=this.#d^this.#e,n=this.#i^this.#e,s=this.#o^this.#e;this.#e=Math.floor(Math.random()*16777215),this.#s=t^this.#e,this.#a=a^this.#e,this.#c=i^this.#e,this.#d=o^this.#e,this.#i=n^this.#e,this.#o=s^this.#e}registerHit(t){if(!l.gameActive&&!l.isGameOver)return;if(!l.gameActive){console.warn("Iron Umpire: Hit rejected (Game Not Active)");return}if(Ui&&Ui.lastPhysicalInputTime){const o=performance.now()-Ui.lastPhysicalInputTime;if(o>2e3){console.warn(`Iron Umpire: Hit rejected (No recent input). Delta: ${o.toFixed(2)}ms`),o>5e3&&(this.isTainted=!0);return}}const a=performance.now();if(a-this.#y<100)return;this.#y=a;let i=0;if(t==="PERFECT"){let o=this.#o^this.#e;o++,this.#o=o^this.#e,i=1,o===2&&(i=2),o>=3&&(i=3),this.showPointsPopup(i,!0,l.settings?.noFlash),this.sessionPerfects||(this.sessionPerfects=0),this.sessionPerfects++,this.#l++,this.#h()}else t==="GOOD"&&(i=1,this.#o=0^this.#e,this.showPointsPopup(1,!1,l.settings?.noFlash));if(i>0){let o=this.#s^this.#e;o+=i,this.#s=o^this.#e,this.addCoins(i)}else this.#r();this.updateScoreDisplay(),this.updateCoinDisplay(),this.checkHighScore()}registerStrike(){let t=this.#i^this.#e;t++,this.#i=t^this.#e,this.#r()}resetStrikes(){this.#i=0^this.#e,this.#r()}setStrikes(t){this.#i=t^this.#e,this.#r()}setMultiplier(t){this.#o=t^this.#e,this.#r()}registerFoul(){this.#o=0^this.#e,this.#r()}async deductCoins(t,a="generic_spend"){if(this.coins<t)return console.warn(`[ScoreManager] Deduct Failed: Insufficient funds (Local=${this.coins} < ${t})`),!1;const{supabaseService:i}=await De(async()=>{const{supabaseService:r}=await Promise.resolve().then(()=>Pa);return{supabaseService:r}},void 0,import.meta.url),{showSecurityModal:o}=await De(async()=>{const{showSecurityModal:r}=await Promise.resolve().then(()=>tr);return{showSecurityModal:r}},void 0,import.meta.url),n=i.getClient();if(!n)return this.deductCoinsLocal(t);const{data:{user:s}}=await n.auth.getUser();if(!s)return this.deductCoinsLocal(t);try{const{data:r,error:d}=await n.rpc("deduct_coins",{p_amount:t,p_reason:a});return d?(console.warn("[ScoreManager] Deduct Coins Failed:",d.message),console.warn("[ScoreManager] Falling back to local deduction..."),this.deductCoinsLocal(t)):r&&r.success?(console.log(`[ScoreManager] Deducted ${t} coins. New Bal: ${r.new_balance}`),this.setAuthoritativeBalance(r.new_balance),!0):r?.error==="Insufficient funds"?(console.warn("[ScoreManager] Server says insufficient funds. Checking local..."),this.deductCoinsLocal(t)):!1}catch(r){return console.error("[ScoreManager] Deduct RPC Error",r),console.warn("[ScoreManager] Falling back to local deduction due to error..."),this.deductCoinsLocal(t)}}addCoins(t){if(!t||t<=0)return;let a=this.#a^this.#e;a+=t,this.#a=a^this.#e,this.#t+=t,this.#h(),console.log(`[ScoreManager] addCoins(+${t}) -> Balance: ${a}, Delta: ${this.#t}`),this.updateCoinDisplay(),this.#r(),this.saveCoins(!0)}deductCoinsLocal(t){let a=this.#a^this.#e;return a>=t?(a-=t,this.#a=a^this.#e,this.updateCoinDisplay(),this.#r(),this.saveCoins(!0),console.log(`[ScoreManager] Local Deduction: -${t}. Balance: ${a}`),!0):(console.warn(`[ScoreManager] Local Deduction Failed: Insufficient Funds (${a} < ${t})`),!1)}updateScoreDisplay(){ke&&(ke.innerText=`Score: ${this.score}`)}updateCoinDisplay(){nt&&(nt.innerText=`${this.coins}`)}saveCoins(t=!1){if(l.coins=this.coins,this.#f&&clearTimeout(this.#f),t){q.setItem("baseball_coins",this.coins),this.#f=null;return}this.#f=setTimeout(()=>{q.setItem("baseball_coins",this.coins),this.#f=null},2e3)}checkHighScore(){if(l.isDailyChallenge){if(this.score>this.dailyHighScore){if(this.dailyHighScore=this.score,!this.#n){const a=`baseball_daily_score_${He.getDailySeed()}`;q.setItem(a,this.dailyHighScore)}return!0}return!1}return this.score>this.highScore?(this.score>this.initialHighScore&&this.score>1,this.highScore=this.score,l.highScore=this.highScore,this.#n||(this.#u&&clearTimeout(this.#u),this.#u=setTimeout(()=>{q.setItem("baseball_high_score_s1",this.highScore),this.#u=null},2e3)),Y.currentTheme&&Y.currentTheme.id!=="SPACE"&&Ll(),!0):!1}showPointsPopup(t,a=!1,i=!1){requestAnimationFrame(()=>{t>1&&Ht&&(Ht.innerText=`+${t}`,Ht.style.display="block",i?Ht.classList.remove("perfect-hit"):Ht.classList.add("perfect-hit"),setTimeout(()=>{Ht.style.display="none",Ht.classList.remove("perfect-hit")},1e3))})}animateCoinGain(t){const a=this.coins-(this.startCoins||0);if(a>0&&ma&&nt){ma.innerText=`+${a}`,ma.style.display="block";const i=this.startCoins||0;let o=i;const n=this.coins,s=1500,r=performance.now(),d=f=>{const c=f-r,p=Math.min(c/s,1),h=1-Math.pow(1-p,3);o=Math.floor(i+a*h),nt.innerText=`${o}`,p<1?requestAnimationFrame(d):(nt.innerText=`${n}`,setTimeout(()=>{ma.style.display="none",t&&t()},1e3))};requestAnimationFrame(d)}else t&&t()}hasNewRecord(){return this.highScore>this.initialHighScore&&this.score===this.highScore}async updateDailyStreak(){if(!l.isDailyChallenge||this.#n)return;const{TimeAnchorManager:t}=await De(async()=>{const{TimeAnchorManager:h}=await Promise.resolve().then(()=>Un);return{TimeAnchorManager:h}},void 0,import.meta.url),i=await t.getTrustedTime()||new Date,o=He.getDailySeed(i),n=q.getItem("baseball_daily_streak_updated_date");if(n===o){console.log(`Daily Challenge: Streak already updated for ${o}. Current: ${l.dailyStreak}`);return}const s=Date.UTC(i.getUTCFullYear(),i.getUTCMonth(),i.getUTCDate()-1),r=new Date(s),d=r.getUTCFullYear(),f=String(r.getUTCMonth()+1).padStart(2,"0"),c=String(r.getUTCDate()).padStart(2,"0"),p=`${d}-${f}-${c}`;n===p?l.dailyStreak++:l.dailyStreak=1,l.lastDailyDate=o,q.setItem("baseball_daily_streak",l.dailyStreak),q.setItem("baseball_last_daily_date",l.lastDailyDate),q.setItem("baseball_daily_streak_updated_date",o),console.log(`Daily Challenge: Streak updated to ${l.dailyStreak}`)}async validateStartupStreak(){const t=q.getItem("baseball_daily_streak_updated_date");if(!l.dailyStreak||l.dailyStreak===0)return;if(!t&&!l.lastDailyDate){l.dailyStreak=0;return}const{TimeAnchorManager:a}=await De(async()=>{const{TimeAnchorManager:m}=await Promise.resolve().then(()=>Un);return{TimeAnchorManager:m}},void 0,import.meta.url),o=await a.getTrustedTime()||new Date,n=He.getDailySeed(o);if(t===n)return;const s=Date.UTC(o.getUTCFullYear(),o.getUTCMonth(),o.getUTCDate()-1),r=new Date(s),d=r.getUTCFullYear(),f=String(r.getUTCMonth()+1).padStart(2,"0"),c=String(r.getUTCDate()).padStart(2,"0"),p=`${d}-${f}-${c}`,h=t||l.lastDailyDate;h!==p&&h!==n&&(console.log(`Daily Challenge: Streak broken (Last: ${h}, Yest: ${p}). Visual Reset to 0.`),l.dailyStreak=0,q.setItem("baseball_daily_streak",0))}#b(t){this.#n=!0,console.error(`ðŸš¨ Iron Umpire: Cheating attempt detected - ${t}`),typeof window<"u"&&De(()=>Promise.resolve().then(()=>Ki),void 0,import.meta.url).then(a=>{const i=a.leaderboardManager;i&&i.flagSession&&i.flagSession(t)}).catch(()=>{console.warn("[Iron Umpire] Could not report to server")})}enableDevMode(t){return t==="iron_umpire_2026"?(this.#n=!0,console.log("%c[DEV MODE ENABLED] SCORES ARE NOW TAINTED.","color: red; font-weight: bold; font-size: 14px;"),ue.innerText="DEV MODE ACTIVE",ue.style.color="red",De(()=>Promise.resolve().then(()=>to),void 0,import.meta.url).then(a=>{window.gameState=a.gameState,console.log("%c[DEV] gameState exposed to window","color: orange")}),window.testWalkOff=async(a="TECHNICIAN")=>{const o=(await De(()=>Promise.resolve().then(()=>to),void 0,import.meta.url)).gameState;if(!o.gameActive){console.warn("[DEV] âŒ Start a game first!"),console.log("[DEV] Hint: Click 'PLAY BALL!' or run: document.querySelector('.start-btn').click()");return}o.isPaused&&(console.log("[DEV] Unpausing game..."),(await De(()=>Promise.resolve().then(()=>dr),void 0,import.meta.url)).togglePause(),await new Promise(s=>setTimeout(s,100))),o.pitcher.nextPitcherId=a,o.pitcher.state="walk_off",o.pitcher.timer=0,o.balls=[],console.log(`[DEV] âœ… Triggering walk-off to ${a}`),console.log(`[DEV] Theme: ${window.themeManager?.currentTheme?.id||"UNKNOWN"}`),console.log(`[DEV] Walk-off type: ${window.themeManager?.currentTheme?.walkOffType||"CLASSIC"}`),console.log("[DEV] Watch the pitcher swim away!")},window.debugStatus=()=>{De(()=>Promise.resolve().then(()=>to),void 0,import.meta.url).then(a=>{const i=a.gameState;console.log("=== ðŸŽ® GAME STATUS ==="),console.log(`Active: ${i.gameActive?"âœ…":"âŒ"}`),console.log(`Paused: ${i.isPaused?"â¸ï¸":"â–¶ï¸"}`),console.log(`Over: ${i.isGameOver?"ðŸ’€":"ðŸ”¥"}`),console.log(`Pitcher State: ${i.pitcher.state}`),console.log(`Pitcher ID: ${i.pitcher.id}`),console.log(`Theme: ${window.themeManager?.currentTheme?.id}`),console.log(`Walk-off Type: ${window.themeManager?.currentTheme?.walkOffType||"CLASSIC"}`),console.log("=====================")})},De(()=>Promise.resolve().then(()=>Wl),void 0,import.meta.url).then(a=>{window.themeManager=a.themeManager,window.THEMES=a.THEMES,console.log("%c[DEV] themeManager exposed to window","color: orange")}),!0):(console.warn("Access Denied"),!1)}setScore(t){if(!this.#n){console.warn("Iron Umpire: Score manipulation blocked. Dev mode not active.");return}this.#s=t^this.#e,this.updateScoreDisplay(),console.log(`[DEV] Score set to ${t}`)}get isTainted(){return this.#n}set isTainted(t){t===!0&&(this.#n=!0)}saveGame(){if(!l.gameActive||l.isGameOver){q.removeItem("baseball_saved_game");return}const t={score:this.score,strikes:this.strikes,isDailyChallenge:l.isDailyChallenge,dailySeed:l.isDailyChallenge?He.dailySeed:null,pitcher:{id:l.pitcher.id,skinColor:l.pitcher.skinColor,hatColor:l.pitcher.hatColor,gender:l.pitcher.gender,props:l.pitcher.props,scale:l.pitcher.scale},timestamp:Date.now()};q.setItem("baseball_saved_game",JSON.stringify(t)),console.log("Game Saved Securely (Encrypted)")}loadGame(){const t=q.getItem("baseball_saved_game");if(!t)return!1;try{const a=JSON.parse(t);if(Date.now()-a.timestamp>1440*60*1e3)return q.removeItem("baseball_saved_game"),!1;if(a.isDailyChallenge){const i=He.getDailySeed();if(a.dailySeed!==i)return q.removeItem("baseball_saved_game"),!1;He.setSeed(i),l.isDailyChallenge=!0,ke.style.color="#FFD700"}else l.isDailyChallenge=!1,ke.style.color="#fff";return this.#s=a.score^this.#e,this.#i=a.strikes^this.#e,l.gameActive=!0,l.isPaused=!0,l.isGameOver=!1,l.pitcher.id=a.pitcher.id,l.pitcher.skinColor=a.pitcher.skinColor,l.pitcher.hatColor=a.pitcher.hatColor,l.pitcher.gender=a.pitcher.gender,l.pitcher.props=a.pitcher.props,l.pitcher.scale=a.pitcher.scale||1,l.pitcher.state="IDLE",l.pitcher.timer=0,a}catch(a){return console.error("Failed to load secure save:",a),q.removeItem("baseball_saved_game"),!1}}async fetchServerBalance(){if(this.#g){console.log("[ScoreManager] Sync already in progress - skipping");return}this.#g=!0;try{const{supabaseService:t}=await De(async()=>{const{supabaseService:g}=await Promise.resolve().then(()=>Pa);return{supabaseService:g}},void 0,import.meta.url),a=t.getClient();if(!a){console.log("[ScoreManager] Offline - skipping server sync");return}const{data:{session:i}}=await a.auth.getSession();if(!i){console.log("[ScoreManager] No session - skipping sync");return}const o=i.user,{data:n,error:s}=await a.from("user_stats").select("total_coins").eq("user_id",o.id).limit(1);if(s||!n||n.length===0){console.log("[ScoreManager] No user_stats found (New User?)");return}const r=n[0].total_coins||0,d=this.coins,f=this.#t,c=q.getItem("baseball_pending_purchases");let p=0;if(c)try{const g=JSON.parse(c);Array.isArray(g)&&g.length>0&&(p=g.reduce((u,T)=>u+(T.cost||0),0),console.log(`[ScoreManager] Found ${g.length} pending purchases (${p} coins). Triggering sync...`),De(()=>Promise.resolve().then(()=>ur),void 0,import.meta.url).then(u=>u.unlockablesManager.syncPendingPurchases()))}catch(g){console.warn("[ScoreManager] Failed to parse pending purchases",g)}const h=Math.max(0,r-p);console.log(`[ScoreManager] Sync: Server=${r}, Effective=${h}, Local=${d}, Delta=${f}, Pending=${p}`);const m=Math.max(0,h+f);if(f===0){if(d===h){console.log("[ScoreManager] Sync: Already in sync (accounting for pending purchases)");return}if(d>h){const g=d-h;console.log(`[ScoreManager] Sync: Local (${d}) > Effective Server (${h}). Pushing ${g}...`),await this.#S(g)&&console.log("[ScoreManager] Push successful - balances synced")}else p===0?(console.log(`[ScoreManager] Sync: Server (${r}) > Local (${d}). Updating local.`),this.#a=r^this.#e,this.saveCoins(),this.updateCoinDisplay(),l.gameActive||(this.startCoins=r)):console.log("[ScoreManager] Sync: Local < Server but pending purchases exist - keeping local (no refund)");return}(f>0||this.#l>0)&&(console.log(`[ScoreManager] Pushing unsynchronized earnings (Coins: ${f}, Perfects: ${this.#l})...`),await this.#S()?(this.#T(),console.log("[ScoreManager] Push successful - deltas cleared")):console.warn("[ScoreManager] Push failed - deltas preserved for retry")),l.gameActive||(this.startCoins=this.coins),this._lastSyncTimestamp=Date.now()}catch(t){console.warn("[ScoreManager] Fetch Balance Warning:",t)}finally{this.#g=!1}}async#S(){const t=this.#t,a=this.#l;if(t<=0&&a<=0)return!1;const{supabaseService:i}=await De(async()=>{const{supabaseService:n}=await Promise.resolve().then(()=>Pa);return{supabaseService:n}},void 0,import.meta.url),o=i.getClient();if(!o)return!1;console.log(`[ScoreManager] Pushing offline delta (Coins: +${t}, Perfects: +${a}) to server...`);try{const{data:n,error:s}=await o.rpc("update_user_coins",{p_delta:t,p_perfects:a});if(s)throw s;return console.log("[ScoreManager] Delta Sync Success."),!0}catch(n){return console.error(`[ScoreManager] Delta Push Failed: ${n.message}`),!1}}setAuthoritativeBalance(t){console.log(`[ScoreManager] Setting balance to: ${t}`),this.#a=t^this.#e,this._lastSyncTimestamp=Date.now(),l.gameActive||(this.startCoins=t),this.#r(),this.updateCoinDisplay(),this.saveCoins()}async syncSession(){const t=this.coins-(this.startCoins||0),a=this.#t,i=Math.max(t,a);if(i<=0){console.log("[ScoreManager] No earnings to sync");return}console.log(`[ScoreManager] Syncing Session: SessionEarnings=${t}, Delta=${a}, Pushing=${i}`),this.#p&&(console.log("Waiting for Session Handshake..."),await this.#p),this.#m;const{supabaseService:o}=await De(async()=>{const{supabaseService:s}=await Promise.resolve().then(()=>Pa);return{supabaseService:s}},void 0,import.meta.url),n=o.getClient();if(!n){console.warn("[ScoreManager] Sync Skipped: No RPC Client (Offline?)");return}try{const s=q.hash("gameplay_trace",`${this.score}-${this.#e}-${Date.now()}`),r=Math.floor((l.activeSessionTime||0)/1e3),d=this.sessionPerfects||0,{data:f,error:c}=await n.rpc("update_user_coins",{p_delta:i,p_perfects:d});if(c)throw c;const p=typeof f=="number"?f:f?.new_balance;p!=null?(console.log("[ScoreManager] Session Sync Success. Server Balance:",p),this.#t=Math.max(0,this.#t-i),this.#l=Math.max(0,this.#l-d),this.#h(),this.startCoins=this.coins,this.sessionPerfects=0,this.#m=null):console.warn("[ScoreManager] Sync Rejected: Invalid Data",f)}catch(s){console.error("[ScoreManager] Sync RPC Failed",s),console.error("Error Details:",{message:s.message,code:s.code,hint:s.hint,details:s.details})}}}window.enableDevTools=e=>V.enableDevMode(e);window.setGameScore=e=>V.setScore(e);const V=new ql;window.__addCoins=e=>{console.warn("ðŸš¨ Iron Umpire: Honeypot triggered"),V.isTainted=!0,console.error("ðŸš¨ Iron Umpire: Cheating attempt detected - honeypot_coins"),De(()=>Promise.resolve().then(()=>Ki),void 0,import.meta.url).then(t=>{t.leaderboardManager.flagSession&&t.leaderboardManager.flagSession("honeypot_coins")})};window.__setScore=e=>{console.warn("ðŸš¨ Iron Umpire: Honeypot triggered"),V.isTainted=!0,console.error("ðŸš¨ Iron Umpire: Cheating attempt detected - honeypot_score"),De(()=>Promise.resolve().then(()=>Ki),void 0,import.meta.url).then(t=>{t.leaderboardManager.flagSession&&t.leaderboardManager.flagSession("honeypot_score")})};window.__unlockAll=()=>{console.warn("ðŸš¨ Iron Umpire: Honeypot triggered"),V.isTainted=!0,console.error("ðŸš¨ Iron Umpire: Cheating attempt detected - honeypot_unlock"),De(()=>Promise.resolve().then(()=>Ki),void 0,import.meta.url).then(e=>{e.leaderboardManager.flagSession&&e.leaderboardManager.flagSession("honeypot_unlock")})};const Xl=Object.freeze(Object.defineProperty({__proto__:null,scoreManager:V},Symbol.toStringTag,{value:"Module"})),Yi=new Mo(()=>({x:0,y:0,startX:0,startY:0,size:10,speedY:0,speedX:0,baseSpeedY:0,type:"FASTBALL",timeAlive:0,active:!1,hasPaused:!1,pauseTimer:0,invisible:!1,rotationAngle:0,rotationSpeed:0,prevRotationAngle:0,strikeCounted:!1,curveDirection:1,hit:!1,spin:0,trail:[]}),(e,t,a,i,o,n,s,r)=>{e.x=t,e.y=a,e.prevX=t,e.prevY=a,e.startX=t,e.startY=a,e.size=10,e.speedY=o,e.speedX=n,e.baseSpeedY=o,e.type=i,e.timeAlive=0,e.active=!0,e.hasPaused=!1,e.pauseTimer=0,e.invisible=!1,e.rotationAngle=0,e.prevRotationAngle=0,e.rotationSpeed=s,e.strikeCounted=!1,e.curveDirection=r,e.hit=!1,e.spin=0,e.trail.length=0},20);function Zl(){l.balls.forEach(e=>Yi.release(e)),l.balls.length=0}const Kl={update:(e,t,a)=>{const i=e/16.667;for(let o=l.balls.length-1;o>=0;o--){const n=l.balls[o];if(n.hit)n.prevX=n.x,n.prevY=n.y,n.prevRotationAngle=n.rotationAngle,n.x+=n.speedX,n.y+=n.speedY,n.invisible=!1,n.spin&&(n.speedX+=n.spin*i),n.rotationAngle+=n.rotationSpeed*3*i;else{if(n.timeAlive+=e,n.prevX=n.x,n.prevY=n.y,n.prevRotationAngle=n.rotationAngle,sn[n.type]&&sn[n.type](n,e))continue;n.rotationAngle+=n.rotationSpeed*i,n.y+=n.speedY,!n.hit&&!n.strikeCounted&&n.y>l.bat.pivotY+60&&(n.strikeCounted=!0,l.lastPitchResult="STRIKE",V.registerStrike(),V.registerFoul(),ue.innerText="STRIKE!",ue.className="foul-text",G.playStrike(),a&&a(!0),l.consecutiveFouls=0,V.strikes>=3?t&&t("STRIKE_OUT"):setTimeout(()=>{ue.innerText.includes("STRIKE")&&(ue.innerText="",ue.className="")},1e3))}if(n.timeAlive>1e4){Yi.release(n),l.balls.splice(o,1);continue}(n.y>de||n.y<-50||n.x<-50||n.x>Z+50)&&(Yi.release(n),l.balls.splice(o,1),l.balls.length===0&&a&&a(!0))}}},Li=new Mo(()=>({x:0,y:0,vx:0,vy:0,color:"#fff",alpha:1,decay:.01,gravity:.05,active:!1}),(e,t,a,i)=>{e.x=t,e.y=a,e.color=i;const o=Math.random()*Math.PI*2,n=Math.random()*3+1;e.vx=Math.cos(o)*n,e.vy=Math.sin(o)*n,e.alpha=1,e.decay=Math.random()*.015+.005,e.gravity=.05,e.active=!0},500),mo=new Mo(()=>({x:0,y:0,targetY:0,speed:6,color:"#fff",exploded:!1,active:!1,trail:[]}),(e,t,a)=>{e.x=t,e.y=Gt.height,e.targetY=a,e.speed=6;const i=["#ff0000","#00ff00","#0000ff","#ffff00","#ff00ff","#00ffff","#ffffff"];e.color=i[Math.floor(Math.random()*i.length)],e.exploded=!1,e.active=!0,e.trail.length=0},10),At={fireworks:[],particles:[],timer:0,interval:500,reset(){this.fireworks.forEach(e=>mo.release(e)),this.particles.forEach(e=>Li.release(e)),this.fireworks.length=0,this.particles.length=0,this.timer=this.interval},update(e,t=!0){const a=Y.currentTheme&&Y.currentTheme.id==="SPACE";if(this.timer+=e,t&&!a&&this.timer>this.interval){this.timer=0;const i=Math.random()*Gt.width,o=Math.random()*(Gt.height/2),n=mo.get(i,o);this.fireworks.push(n)}for(let i=this.fireworks.length-1;i>=0;i--){const o=this.fireworks[i];if(!o.exploded){o.y-=o.speed,o.trail.push({x:o.x,y:o.y,alpha:1}),o.trail.length>8&&o.trail.shift();for(let n of o.trail)n.alpha-=.15;o.y<=o.targetY&&(o.exploded=!0,this.spawnParticles(o.x,o.y,o.color),G.playFirework(),mo.release(o),this.fireworks.splice(i,1))}}for(let i=this.particles.length-1;i>=0;i--){const o=this.particles[i];if(o.x+=o.vx,o.y+=o.vy,o.vy+=o.gravity,o.alpha-=o.decay,o.alpha<=0){Li.release(o);const n=this.particles[this.particles.length-1];this.particles[i]=n,this.particles.pop()}}},spawnParticles(e,t,a){if(!(this.particles.length>300))for(let i=0;i<50;i++){const o=Li.get(e,t,a);this.particles.push(o)}},spawnImpactParticles(e,t,a="#ffffff"){for(let i=0;i<15;i++){const o=Li.get(e,t,a);o.vx*=1.5,o.vy*=1.5,o.decay=.05,this.particles.push(o)}},draw(){for(const e of this.fireworks)if(!e.exploded){for(const t of e.trail)C.globalAlpha=Math.max(0,t.alpha),C.fillStyle=e.color,C.fillRect(t.x-1,t.y-1,3,3);C.globalAlpha=1,C.fillStyle=e.color,C.fillRect(e.x-2,e.y-2,5,5)}if(this.particles.length>0){let e="",t=-1;C.beginPath();for(const a of this.particles){if(a.alpha<=.01)continue;a.color!==e&&(e=a.color,C.fillStyle=e);const i=Math.round(a.alpha*20)/20;i!==t&&(t=i,C.globalAlpha=t),C.fillRect(a.x|0,a.y|0,3,3)}C.globalAlpha=1}}},wo={url:"https://yfxamjivfbrzmdfipcyc.supabase.co",key:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InlmeGFtaml2ZmJyem1kZmlwY3ljIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjUyMjcyNDgsImV4cCI6MjA4MDgwMzI0OH0.SyFt2GpS82vFsSbsboG6e3t01CoXlDLPAnXn_THBGWs"},jl=Object.freeze(Object.defineProperty({__proto__:null,SUPABASE_CONFIG:wo},Symbol.toStringTag,{value:"Module"}));class Jl{constructor(){this.client=null,this.initialized=!1,this.authPromise=null}init(){if(this.initialized)return this.client;if(window.supabase)try{this.client=window.supabase.createClient(wo.url,wo.key),this.initialized=!0,console.log("Supabase Service: Initialized"),this.authPromise=this.ensureAuth()}catch(t){console.error("Supabase Service: Failed to initialize",t)}else console.error("Supabase Service: SDK not loaded");return this.client}async ensureAuth(){if(!this.client)return;const{data:{session:t}}=await this.client.auth.getSession();if(!t){console.log("Supabase: Attempting Anonymous Sign-in...");const{data:a,error:i}=await this.client.auth.signInAnonymously();i?(console.warn("Supabase Anon Auth Failed:",i.message),i.message.includes("Anonymous sign-ins are disabled")&&console.error("Developer Action Required: Enable 'Anonymous Sign-ins' in Supabase Dashboard (Authentication -> Providers).")):console.log("Supabase: Signed in anonymously",a.user.id)}}async waitForAuth(){return this.initialized||this.init(),this.authPromise&&await this.authPromise,this.client}getClient(){return this.initialized?this.client:this.init()}}const gi=new Jl,Pa=Object.freeze(Object.defineProperty({__proto__:null,supabaseService:gi},Symbol.toStringTag,{value:"Module"})),hi={getUserId(){const e=gi.getClient();if(e&&e.auth){const a=e.auth.session;if(a&&typeof a=="object"&&a.user){const i=a.user.id,o=localStorage.getItem("baseball_user_id");return o!==i&&(console.log(`[UserManager] Adopting Cloud ID: ${i} (Replacing ${o})`),localStorage.setItem("baseball_user_id",i)),i}}let t=localStorage.getItem("baseball_user_id");return t||(typeof crypto<"u"&&crypto.randomUUID?t=crypto.randomUUID():t="user_"+Math.random().toString(36).substr(2,9)+Date.now().toString(36),localStorage.setItem("baseball_user_id",t)),t}},Ql="https://timeapi.io/api/Time/current/zone?timeZone=UTC",xl="https://cdnjs.cloudflare.com/ajax/libs/json3/3.3.2/json3.min.js",Gi="baseball_time_anchor";class Nt{static async fetchServerTime(){try{console.log("[TimeAnchor] Attempting Primary (TimeAPI.io)...");let t=await this.tryFetch(Ql,"dateTime",!0);return this.isValidDate(t)?(this.updateAnchor(t),t):(console.log("[TimeAnchor] Primary API failed. Attempting Secondary (CDN Head Check)..."),t=await this.fetchHeadDate(xl),this.isValidDate(t)?(this.updateAnchor(t),t):(console.log("[TimeAnchor] Secondary failed. Using Supabase Connection..."),t=await this.fetchViaSupabase(),this.isValidDate(t)?(this.updateAnchor(t),t):(console.warn("[TimeAnchor] All Time Sources failed. Using Local Fallback."),null)))}catch(t){return console.warn("[TimeAnchor] Network Error",t.message),null}}static isValidDate(t){return!t||isNaN(t.getTime())?!1:t.getUTCFullYear()>=2025}static async fetchViaSupabase(){try{const{SUPABASE_CONFIG:t}=await De(async()=>{const{SUPABASE_CONFIG:d}=await Promise.resolve().then(()=>jl);return{SUPABASE_CONFIG:d}},void 0,import.meta.url),a=`${t.url}/rest/v1/`,i=t.key;console.log("[TimeAnchor] Fetching time headers from Supabase...");const o=new AbortController,n=setTimeout(()=>o.abort(),5e3),s=await fetch(a,{method:"HEAD",headers:{apikey:i,Authorization:`Bearer ${i}`},cache:"no-store",signal:o.signal});if(clearTimeout(n),!s.ok)return null;const r=s.headers.get("Date");if(r){const d=new Date(r);if(this.isValidDate(d))return d;console.warn(`[TimeAnchor] Supabase returned invalid date string: ${r}`)}return null}catch(t){return console.warn("[TimeAnchor] Supabase Header Check Failed",t),null}}static async fetchHeadDate(t){try{const a=new AbortController,i=setTimeout(()=>a.abort(),3e3),o=await fetch(t+"?_cb="+Date.now(),{method:"HEAD",cache:"no-store",signal:a.signal});if(clearTimeout(i),!o.ok)return null;const n=o.headers.get("Date");if(n){const s=new Date(n);if(this.isValidDate(s))return s}return null}catch(a){return console.warn("[TimeAnchor] CDN Head Check Failed",a.message),null}}static async tryFetch(t,a,i=!0){try{const o=new AbortController,n=setTimeout(()=>o.abort(),5e3);let s=t;if(i){const p=t.includes("?")?"&":"?";s=`${t}${p}_cb=${Date.now()}`}const r=await fetch(s,{signal:o.signal,cache:"no-store"});if(clearTimeout(n),!r.ok)throw new Error(`API Error ${r.status}`);const d=await r.json();let f=d[a];if(f||(d.datetime?f=d.datetime:d.dateTime?f=d.dateTime:d.milliSeconds&&(f=d.milliSeconds)),!f)throw new Error("Invalid JSON format");typeof f=="string"&&f.includes("T")&&!f.endsWith("Z")&&!f.includes("+")&&(f+="Z");const c=new Date(f);if(!this.isValidDate(c))throw new Error(`Invalid Date Parsed: ${c.toISOString()}`);return c}catch(o){return console.warn(`[TimeAnchor] Fetch failed for ${t}:`,o.message),null}}static updateAnchor(t){if(!this.isValidDate(t))return;const a={serverTime:t.getTime(),deviceTime:Date.now(),verifiedAt:Date.now()};q.setItem(Gi,JSON.stringify(a)),console.log(`[TimeAnchor] Security Lease Renewed: ${t.toISOString()}`)}static async getTrustedTime(){const t=q.getItem(Gi);if(t){const a=JSON.parse(t),i=Date.now()-a.verifiedAt,o=2880*60*1e3;if(i<o&&i>-864e5){const n=Date.now()-a.deviceTime;return new Date(a.serverTime+n)}}return await this.fetchServerTime()}static async verifyOrFetch(t){let a=this.isDateAllowed(t);if(!a.allowed&&(a.reasonCode==="MISSING_ANCHOR"||a.reasonCode==="EXPIRED_ANCHOR"||a.reasonCode==="FUTURE_BLOCK")){console.log(`[TimeAnchor] Auto-repairing security check for ${t} (${a.reasonCode})...`);const i=await this.fetchServerTime();i?console.log(`[TimeAnchor] Repair successful. New Server Time: ${i.toISOString()}`):console.warn("[TimeAnchor] Repair FAILED. Could not fetch server time."),a=this.isDateAllowed(t)}return a}static isDateAllowed(t){q.migrate(Gi);const a=q.getItem(Gi);if(!a)return console.warn("TimeAnchor: No security lease found. Online verification required."),{allowed:!1,reason:"Please connect to internet to verify date.",reasonCode:"MISSING_ANCHOR"};const i=JSON.parse(a),o=Date.now()-i.verifiedAt,n=1440*60*1e3,s=2*n;if(o>s||o<-n)return console.warn("TimeAnchor: Security lease expired or invalid (future timestamp)."),{allowed:!1,reason:"Time synchronization error. Connect to verify.",reasonCode:"EXPIRED_ANCHOR"};const r=new Date(i.serverTime),d=r.getUTCFullYear(),f=String(r.getUTCMonth()+1).padStart(2,"0"),c=String(r.getUTCDate()).padStart(2,"0"),p=`${d}-${f}-${c}`,[h,m,g]=t.split("-").map(Number),u=Date.UTC(h,m-1,g),T=Date.UTC(d,Number(f)-1,Number(c)),b=(u-T)/n;return console.log(`[TimeAnchor] Target: ${t} (${u}) | Valid: ${p} (${T}) | Diff: ${b.toFixed(2)} days`),b>2.5?(console.warn(`[TimeAnchor] BLOCK: Future Date detected. Diff: ${b.toFixed(2)} > 2.5`),{allowed:!1,reason:"Future Date Blocked",reasonCode:"FUTURE_BLOCK"}):{allowed:!0}}}const Un=Object.freeze(Object.defineProperty({__proto__:null,TimeAnchorManager:Nt},Symbol.toStringTag,{value:"Module"}));class er{constructor(){this.client=null,this.initialized=!1,this.queueKey="baseball_leaderboard_queue"}init(){if(!this.initialized)try{gi.init(),this.client=gi.getClient(),this.initialized=!0,console.log("LeaderboardManager: Supabase initialized (via Service)"),Nt.fetchServerTime(),this.syncScores(),this.processRetryQueue()}catch(t){console.error("LeaderboardManager: Failed to initialize",t)}}async syncScores(){if(!this.initialized)return;console.log("LeaderboardManager: Syncing scores...");const t=localStorage.getItem("baseball_username");if(!t)return;let a=parseInt(q.getItem("baseball_high_score_s1","0"))||0;if(a===0){const n=await this.getUserEntry("leaderboard");n&&n.score>0&&(console.log(`LeaderboardManager: Restored High Score ${n.score} from cloud.`),a=n.score,q.setItem("baseball_high_score_s1",a),V.highScore=a,l.highScore=a)}a>0&&await this.submitScore(t,a,"leaderboard");const i=He.getDailySeed(),o=parseInt(q.getItem(`baseball_daily_score_${i}`,"0"))||0;o>0&&await this.submitScore(t,o,"daily_leaderboard")}async submitScore(t,a,i="leaderboard",o=null){if(!this.initialized||!this.client)return{error:"Not initialized"};if(V.isTainted)return console.warn("LeaderboardManager: Submission REJECTED. Score is tainted (Dev Mode)."),{success:!0,ignored:!0,reason:"Tainted"};if(i==="daily_leaderboard"){const n=await Nt.fetchServerTime(),s=He.getDailySeed();if(n){const r=n.getUTCFullYear(),d=String(n.getUTCMonth()+1).padStart(2,"0"),f=String(n.getUTCDate()).padStart(2,"0"),c=`${r}-${d}-${f}`;if(s>c)return console.error("Security Block: Attempted future score submission"),{error:"Future Date Blocked"}}else return console.warn("Security: Offline submission deferred."),{error:"Offline - Score Saved Locally",queued:!0}}try{const{data:{session:n}}=await this.client.auth.getSession();if(o||(i==="daily_leaderboard"?o=`daily_${He.getDailySeed()}`:o="classic"),!n)return console.log("LeaderboardManager: Security: No Session (Offline). Deferring."),this.addToQueue(t,a,i,o),{error:"Offline (Deferred)",queued:!0};const s=hi.getUserId(),r=await Nt.getTrustedTime(),d=r?r.getTime():Date.now(),f=q.signPayload(s,a,d,o);console.log("LeaderboardManager: Submitting via Secure RPC...",{score:a,details:o});const c={p_user_id:s,p_username:t,p_score:a,p_timestamp:d,p_details:o,p_signature:f},{data:p,error:h}=await this.client.rpc("submit_score_secure",c);if(h)throw console.error("LeaderboardManager: RPC Error",h),h;return p&&!p.success?(console.warn("LeaderboardManager: Server rejected score:",p.error),{error:p.error}):{success:!0}}catch(n){return console.error("LeaderboardManager: Failed to submit score",n),this.addToQueue(t,a,i,o),{error:n.message,queued:!0}}}addToQueue(t,a,i,o){console.log("LeaderboardManager: Queuing score for later retry...");const n=JSON.parse(q.getItem(this.queueKey)||"[]");n.some(r=>r.score===a&&r.table===i&&r.details===o)||(n.push({username:t,score:a,table:i,details:o,timestamp:Date.now()}),q.setItem(this.queueKey,JSON.stringify(n)))}async processRetryQueue(){if(!this.initialized)return;const t=q.getItem(this.queueKey);if(!t)return;let a=JSON.parse(t);if(a.length===0)return;console.log(`LeaderboardManager: Processing ${a.length} pending items...`);const i=[];for(const o of a)try{(await this.submitScoreInternal(o)).success?console.log(`LeaderboardManager: Recovered score ${o.score} on ${o.table}`):i.push(o)}catch{i.push(o)}i.length<a.length?q.setItem(this.queueKey,JSON.stringify(i)):i.length===0&&q.removeItem(this.queueKey)}async submitScoreInternal(t){try{return(await this.submitScore(t.username,t.score,t.table)).error?{success:!1}:{success:!0}}catch{return{success:!1}}}async getUserEntry(t="leaderboard",a=null){if(!this.initialized||!this.client)return null;const i=hi.getUserId();try{let o=this.client.from(t).select("score, username, rank").select("score, username").eq("user_id",i).maybeSingle();t==="daily_leaderboard"&&a&&(o=o.eq("score_date",a));const{data:n,error:s}=await o;if(s)throw s;return n}catch(o){return console.error("LeaderboardManager: User entry fetch error",o),null}}async getLeaderboard(t=100,a="leaderboard",i=null){if(!this.initialized||!this.client)return{error:"Service Not Initialized"};try{let o=this.client.from(a).select("username, score, created_at, user_id").order("score",{ascending:!1}).limit(t);if(a==="daily_leaderboard"){let r=i;if(!r){const d=new Date,f=d.getUTCFullYear(),c=String(d.getUTCMonth()+1).padStart(2,"0"),p=String(d.getUTCDate()).padStart(2,"0");r=`${f}-${c}-${p}`}o=o.eq("score_date",r)}const{data:n,error:s}=await o;if(s)throw s;return n}catch(o){return console.error("LeaderboardManager: Fetch error",o),{error:o.message||"Unknown Error"}}}async getUserRank(t,a="leaderboard",i=null){if(!this.initialized||!this.client)return null;try{let o=this.client.from(a).select("*",{count:"exact",head:!0}).gt("score",t);if(a==="daily_leaderboard"){let h=i;if(!h){const m=new Date,g=m.getUTCFullYear(),u=String(m.getUTCMonth()+1).padStart(2,"0"),T=String(m.getUTCDate()).padStart(2,"0");h=`${g}-${u}-${T}`}o=o.eq("score_date",h)}const{count:n,error:s}=await o;if(s)throw s;let r=this.client.from(a).select("*",{count:"exact",head:!0});if(a==="daily_leaderboard"){let h=i;if(!h){const m=new Date,g=m.getUTCFullYear(),u=String(m.getUTCMonth()+1).padStart(2,"0"),T=String(m.getUTCDate()).padStart(2,"0");h=`${g}-${u}-${T}`}r=r.eq("score_date",h)}const{count:d,error:f}=await r;if(f)throw f;const c=n+1,p=d>0?(c/d*100).toFixed(1):0;return{rank:c,total:d,percentile:p}}catch(o){return console.error("LeaderboardManager: Rank fetch error",o),null}}flagSession(t){console.warn(`ðŸš¨ Leaderboard Manager: Cheating attempt logged - ${t}`);const a=JSON.parse(localStorage.getItem("baseball_cheat_flags")||"[]");a.push({reason:t,timestamp:Date.now(),userId:hi.getUserId()}),localStorage.setItem("baseball_cheat_flags",JSON.stringify(a.slice(-10)))}}const ia=new er,Ki=Object.freeze(Object.defineProperty({__proto__:null,leaderboardManager:ia},Symbol.toStringTag,{value:"Module"}));function ko(e,t="SECURITY ALERT"){console.log("[SecurityUI] Modal Requested:",e),on&&(on.innerText=t),nn&&(nn.textContent=e),Kt&&(Kt.style.display="flex",Kt.style.pointerEvents="auto");try{G&&G.playError(),Ee&&Ee.vibrate("medium")}catch(o){console.warn("[SecurityUI] Sound error:",o)}const a=o=>{o&&(o.preventDefault(),o.stopPropagation()),Kt&&(Kt.style.display="none");try{G&&G.playSettingsClose()}catch{}},i=document.getElementById("security-close-btn")||Ms;i&&(i.onclick=a),Kt&&(Kt.onclick=o=>{o.target===Kt&&a(o)})}const tr=Object.freeze(Object.defineProperty({__proto__:null,showSecurityModal:ko},Symbol.toStringTag,{value:"Module"}));class ar{constructor(){this.isOpen=!1,this.username=localStorage.getItem("baseball_username")||null,this.pendingScore=null,this.pendingTable=null,this.isSyncing=!1,this.currentTab="all-time",this.init(),setTimeout(()=>this.syncLocalScore(),2e3),this.currentViewDate=new Date}init(){gt.addEventListener("click",()=>this.open()),vs.addEventListener("click",()=>this.close()),Cs.addEventListener("click",()=>this.submitName()),Ut&&Ut.addEventListener("keydown",t=>{t.key==="Enter"&&(t.preventDefault(),this.submitName())}),Ba.addEventListener("click",t=>{t.target===Ba&&this.close()}),Da&&Da.addEventListener("click",()=>this.switchTab("all-time")),ka&&ka.addEventListener("click",()=>this.switchTab("daily")),an&&an.addEventListener("click",()=>this.changeDate(-1)),Ai&&Ai.addEventListener("click",()=>this.changeDate(1))}async changeDate(t){this.currentViewDate||(this.currentViewDate=new Date);const a=new Date(this.currentViewDate);a.setUTCDate(this.currentViewDate.getUTCDate()+t);const i=a.getUTCFullYear(),o=String(a.getUTCMonth()+1).padStart(2,"0"),n=String(a.getUTCDate()).padStart(2,"0"),s=`${i}-${o}-${n}`;if(t>0){const r=await Nt.verifyOrFetch(s);if(!r.allowed){ko(r.reason),console.log("Leaderboard Nav Blocked: Future Date");return}}this.currentViewDate.setUTCDate(this.currentViewDate.getUTCDate()+t),G&&G.playSettingsToggle(),this.updateDailyUI(),this.loadLeaderboard("daily"),this.updatePersonalBest()}open(t="all-time"){this.isOpen=!0,Ba.style.display="flex",l.isPaused=!0,ni.style.display="none",ea.style.display="none",$t.style.display="none",this.switchTab(t),this.syncLocalScore(),t==="daily"&&this.updateDailyUI(),G&&G.init().then(()=>{G.playUnlockablesOpen()})}close(){this.isOpen&&(this.isOpen=!1,Ba.style.display="none",!l.isGameOver&&l.gameActive&&(l.isPaused=!1),G&&G.playUnlockablesClose())}async updatePersonalBest(){let t=0,a="leaderboard",i=null;if(this.currentTab==="daily"){a="daily_leaderboard";const o=this.currentViewDate||new Date,n=o.getUTCFullYear(),s=String(o.getUTCMonth()+1).padStart(2,"0"),r=String(o.getUTCDate()).padStart(2,"0");i=`${n}-${s}-${r}`;const d=new Date;if(o.getUTCFullYear()===d.getUTCFullYear()&&o.getUTCMonth()===d.getUTCMonth()&&o.getUTCDate()===d.getUTCDate()){const c=He.getDailySeed();t=parseInt(q.getItem(`baseball_daily_score_${c}`,"0"))||0}else{const c=await ia.getUserEntry(a,i);t=c?c.score:0}}else De(()=>Promise.resolve().then(()=>Xl),void 0,import.meta.url).then(o=>{}),t=parseInt(q.getItem("baseball_high_score_s1","0"))||0;if(Ja.textContent=t>0?t:"-",t>0){Ja.textContent=`${t} (Loading...)`;const o=await ia.getUserRank(t,a,i);o?o.rank<=100?Ja.textContent=`${t} (#${o.rank})`:Ja.textContent=`${t} (Top ${o.percentile}%)`:Ja.textContent=t}}async loadLeaderboard(t="all-time"){if(this.currentTab===t&&(Pi.style.display="none",Qi&&(Qi.style.display="none"),Qa.style.display="none",Ia.style.display="block"),!this.username){this.currentTab===t&&(Ia.style.display="none",t==="all-time"&&(Qa.style.display="flex",Ut&&Ut.focus()));return}let a="leaderboard",i=null;if(t==="daily"){a="daily_leaderboard";const n=this.currentViewDate||new Date,s=n.getUTCFullYear(),r=String(n.getUTCMonth()+1).padStart(2,"0"),d=String(n.getUTCDate()).padStart(2,"0");i=`${s}-${r}-${d}`}let o=await ia.getLeaderboard(100,a,i);if(o&&!o.error){let n=0;const s=He.getDailySeed();if(t==="daily"?(!this.currentViewDate||this.currentViewDate.toDateString()===new Date().toDateString())&&(n=parseInt(q.getItem(`baseball_daily_score_${s}`,"0"))||0):n=parseInt(q.getItem("baseball_high_score_s1","0"))||0,n>0){const r=hi.getUserId();let d=!1;for(let f of o)if(f.user_id===r&&f.username===this.username){n>f.score&&(f.score=n,f.isOptimistic=!0),d=!0;break}if(!d){const f=o.length>0?o[o.length-1].score:-1;(o.length<100||n>f)&&o.push({rank:0,score:n,username:this.username,user_id:r,isOptimistic:!0})}o.sort((f,c)=>c.score-f.score),o.forEach((f,c)=>{f.rank=c+1}),o.length>100&&(o=o.slice(0,100))}}this.renderList(o,t)}renderList(t,a){let i=Pi;if(a==="daily"&&(i=Qi),!i)return;if(this.currentTab===a?(Ia.style.display="none",i.style.display="flex",i.style.flexDirection="column"):i.style.display="none",i.innerHTML="",t&&t.error){i.innerHTML=`
                <div style="text-align:center; padding: 20px; color: #ff5555;">
                    SERVICE UNAVAILABLE<br>
                    <span style="font-size: 0.6em; color: #aaa;">${t.error.toUpperCase()}</span>
                </div>`;return}if(t===null){i.innerHTML=`
                <div style="text-align:center; padding: 20px; color: #ff5555;">
                    CONNECTION FAILED<br>
                    <span style="font-size: 0.8em; color: #aaa;">OFFLINE MODE</span>
                </div>`;return}if(!t||t.length===0){i.innerHTML='<div style="text-align:center; padding: 20px; color: #666;">NO SCORES YET</div>';return}const o=hi.getUserId();t.forEach((n,s)=>{const r=s+1;let d="";r===1?d="gold":r===2?d="silver":r===3&&(d="bronze");const f=document.createElement("div");f.className=`leaderboard-row ${d}`;const c=n.user_id===o;let p=n.username;c&&(f.classList.add("current-user-row"),p+=" (YOU)",setTimeout(()=>{const u=f;u.isConnected&&u.scrollIntoView({behavior:"smooth",block:"nearest"})},100));const h=document.createElement("div");h.className="leaderboard-rank",h.textContent=`#${r}`;const m=document.createElement("div");m.className="leaderboard-name",m.textContent=p;const g=document.createElement("div");g.className="leaderboard-score",g.textContent=n.score.toLocaleString(),f.appendChild(h),f.appendChild(m),f.appendChild(g),i.appendChild(f)})}async submitName(){const t=Ut.value.trim().toUpperCase(),a=/^[A-Z]+$/,i=["NIG","FUK","CNT","KKK","ASS","CUM","FAG","WOP","JAP","POO","TIT","DIK","SEX","GAY","JEW","AZN","FCK","FUC","COC","COK","PEE","VAG","SHT","WTF","HIV","STD","LSD","GOD","DYK","FGT","NGR","PCP","XXX"];if(t.length<1||!a.test(t)||i.includes(t)){Ut.classList.add("input-error"),Ut.classList.add("shake-animation"),setTimeout(()=>{Ut.classList.remove("input-error"),Ut.classList.remove("shake-animation")},500);return}this.username=t,localStorage.setItem("baseball_username",this.username),Ee.vibrate("medium"),Qa.style.display="none",Ia.style.display="block";try{await this.processPendingScore(),await this.syncLocalScore()}catch(o){console.error("Error during score submission flow:",o)}this.loadLeaderboard(this.currentTab)}async checkAndSubmitScore(t,a="leaderboard"){t<=0||(this.username?(console.log(`Submitting score: ${t} for ${this.username} on table: ${a}`),await ia.submitScore(this.username,t,a)):(this.pendingScore=t,this.pendingTable=a,this.open()))}async processPendingScore(){if(this.pendingScore&&this.username){const t=this.pendingTable||"leaderboard";console.log(`Submitting PENDING score: ${this.pendingScore} for ${this.username} on table: ${t}`),await ia.submitScore(this.username,this.pendingScore,t),this.pendingScore=null,this.pendingTable=null}}async syncLocalScore(){if(!this.username||this.isSyncing)return;const t=l.highScore;if(t>0){this.isSyncing=!0,console.log(`Attempting to sync local best (${t}) to server...`);try{await ia.submitScore(this.username,t)}finally{this.isSyncing=!1}}}updateDailyUI(){if(!sa)return;const t=He.getDailySeed(),a=l.lastDailyDate,i=this.currentViewDate||new Date;i.getUTCFullYear(),String(i.getUTCMonth()+1).padStart(2,"0");const o=String(i.getUTCDate()).padStart(2,"0"),n=new Date,s=i.getUTCFullYear()===n.getUTCFullYear()&&i.getUTCMonth()===n.getUTCMonth()&&i.getUTCDate()===n.getUTCDate();if(xo){const r=i.toLocaleString("en-US",{month:"short",timeZone:"UTC"}).toUpperCase();xo.innerText=`${r} ${o}`}Ai&&(Ai.style.visibility=s?"hidden":"visible"),sa&&(sa.style.display=s?"block":"none"),Fa&&(Fa.parentElement.style.visibility=s?"visible":"hidden"),s&&(zi&&(zi.innerText=l.dailyStreak),a!==t?(Vi.innerText="FREE",Fa.className="stat-value free",la&&(la.style.display="none")):(Vi.innerText="20",Fa.className="stat-value cost",la&&(la.style.display="block")))}switchTab(t){this.currentTab!==t&&G&&G.playSettingsToggle(),this.currentTab=t,Pi&&(Pi.style.display="none"),Ri&&(Ri.style.display="none"),Qa&&(Qa.style.display="none"),Ia&&(Ia.style.display="none"),Da&&(Da.className="tab-btn"),ka&&(ka.className="tab-btn"),t==="all-time"?(Da&&Da.classList.add("active"),this.loadLeaderboard("all-time")):t==="daily"&&(ka&&ka.classList.add("active"),Ri&&(Ri.style.display="flex"),this.currentViewDate=new Date,this.updateDailyUI(),this.loadLeaderboard("daily")),this.updatePersonalBest()}}const Na=new ar;class ir{checkCollisions(t,a,i){if(l.bat.swinging)for(let o=l.balls.length-1;o>=0;o--){const n=l.balls[o];if(!n.active)continue;const s=n.x-l.bat.pivotX,r=n.y-l.bat.pivotY,d=s*s+r*r,f=Math.atan2(r,s);let c=l.bat.angle%(Math.PI*2);c>Math.PI&&(c-=Math.PI*2);let p=Math.abs(c-f);p>Math.PI&&(p=Math.PI*2-p);const h=p<1.2,m=ot.BAT_LENGTH+20,g=ot.BAT_LENGTH-5,u=ot.BAT_LENGTH+8,T=ot.BAT_LENGTH-25,b=d>0&&d<m*m,y=!0,S=n.x>l.bat.pivotX-10,A=n.y<l.bat.pivotY+30;if(h&&b&&y&&S&&A){n.active=!1,i(!0),n.strikeCounted&&(V.setStrikes(V.strikes-1),n.strikeCounted=!1,l.gameActive||(l.gameActive=!0,Be.style.display="none",ke.style.display="block",G.stopTheme()));const v=l.bat.angle,P=d>=T*T&&d<g*g,w=d>=g*g&&d<u*u,D=d>=u*u&&d<m*m,k=v<.5&&v>-3,I=P&&k||w||D,_=12*(t/16.667),H=.08;if(I){let M;const L=(Math.random()-.5)*.4;if(D){const z=(Math.random()-.5)*.4;M=wi+.15+z,ue.innerText="GOOD HIT!",ue.className=""}else if(w){const z=(Math.random()-.5)*.3;M=eo+z,ue.innerText="PERFECT HIT!",ue.className="perfect-hit"}else{let ne=(Math.max(-2,Math.min(.5,v))- -1)/(.5- -1);ne=Math.max(0,Math.min(1,ne)),M=eo+ne*(Ei-eo),M+=L,ue.innerText="GOOD HIT!",ue.className=""}M=Math.max(wi+H,Math.min(Ei-H,M)),n.speedX=Math.cos(M)*_,n.speedY=Math.sin(M)*_,w?(l.lastPitchResult="HIT",V.registerHit("PERFECT"),requestAnimationFrame(()=>{Ee.vibrate("perfect"),Pt.currentBat.id==="GOLD"&&At.spawnImpactParticles(n.x+n.size/2,n.y+n.size/2,"#ffd700"),ue.innerText="PERFECT HIT!",l.settings?.noFlash?ue.className="":ue.className="perfect-hit",G.playPerfectHit(),l.perfectHitTimer=1500}),V.consecutivePerfectHits>=3):(l.lastPitchResult="HIT",V.registerHit("GOOD"),ue.innerText="GOOD HIT!",ue.className="",ue.className="",G.playHit(),Ee.vibrate("good")),l.consecutiveFouls=0,V.updateScoreDisplay(),V.checkHighScore(),setTimeout(()=>{ue.innerText.includes("HIT")&&(ue.innerText="",ue.className="")},1e3)}else{if(l.lastPitchResult="FOUL",V.registerFoul(),l.consecutiveFouls++,l.consecutiveFouls>=4){G.playBatBreak(),G.playBatBreak(),Ee.vibrate("failure"),document.body.style.animation="shake 0.5s cubic-bezier(.36,.07,.19,.97) both",setTimeout(()=>{document.body.style.animation=""},500),ue.innerText="BAT BROKEN!",ue.className="foul-text",setTimeout(()=>{a&&a("BAT_BROKEN")},500),n.speedX=0,n.speedY=5,n.hit=!0;return}let M;const L=Math.random();if(L<.3){const z=.08+Math.random()*.05;Math.random()>.5?(M=Ei+z,n.spin=.03+Math.random()*.03):(M=wi-z,n.spin=-(.03+Math.random()*.03))}else if(L<.7){const z=.25+Math.random()*.5;Math.random()>.5?(M=Ei+z,n.spin=.05+Math.random()*.05):(M=wi-z,n.spin=-(.05+Math.random()*.05))}else Math.random()>.5?(M=.2+Math.random()*1,n.spin=.02):(M=Math.PI-(.2+Math.random()*1),n.spin=-.02);n.speedX=Math.cos(M)*_,n.speedY=Math.sin(M)*_,G.playHit(),Ee.vibrate("foul"),setTimeout(()=>{G.playFoul();let z="FOUL";v>-1.3?z="FOUL<br>(LATE SWING)":v<-1.8&&(z="FOUL<br>(EARLY SWING)"),ue.innerHTML=z,ue.className="foul-text",V.strikes<2&&V.registerStrike()},600),setTimeout(()=>{ue.innerText.includes("FOUL")&&(ue.innerText="",ue.className="")},2e3)}n.hit=!0;break}}}}const or=new ir;class nr{update(t){if(!l.isDailyChallenge){const a=Eo(V.score);a&&a.id!==l.pitcher.id&&l.pitcher.state===Ae.IDLE&&l.balls.length===0&&(l.pitcher.nextPitcherId=a.id,l.pitcher.state=Ae.WALK_OFF,l.pitcher.timer=0,V.score<300&&(V.setStrikes(0),l.consecutiveFouls=0,l.balls.length>0&&(l.balls=[]),ue.innerHTML="<div style='width:100%; text-align:center'>STRIKES</div><div style='width:100%; text-align:center'>CLEARED!</div>",ue.className="strikes-cleared",ue.style.color="#FFD700",Et(!1),G.playStrikesCleared&&G.playStrikesCleared(),setTimeout(()=>{ue.innerText.includes("STRIKES")&&(ue.innerText="",ue.className="",ue.style.color="")},4e3)))}l.startMessage&&l.startMessage.active&&l.pitcher.state!==Ae.WALK_ON&&l.pitcher.state!==Ae.WALK_OFF||(l.pitcher.state===Ae.IDLE?this.handleIdle(t):l.pitcher.state===Ae.WALK_OFF?this.handleWalkOff(t):l.pitcher.state===Ae.WALK_ON?this.handleWalkOn(t):l.pitcher.state===Ae.WINDUP?this.handleWindup(t):l.pitcher.state===Ae.BACKFLIP&&this.handleBackflip(t))}handleIdle(t){let a=0;if(l.totalPitches===0?a=1500:(l.lastPitchResult==="STRIKE"||l.lastPitchResult==="FOUL")&&(a=1e3),l.pitcher.timer>a){if(l.pitcher.state=Ae.WINDUP,Aa(!1),l.pitcher.timer=0,l.totalPitches++,l.totalPitches>1&&(l.showTutorial=!1,l.tutorialSeen=!0),(l.totalPitches===1||V.score===0)&&!l.tutorialSeen&&!l.isDailyChallenge)l.pitcher.nextPitch=F.CURVEBALL,l.pitcher.windupDuration=4e3;else{const o=Eo(V.score);if(o&&l.pitcher.freshArm)o.id==="TECHNICIAN"?(l.pitcher.nextPitch=F.STOPBALL,l.pitcher.freshArm=!1):o.id==="ACE"?(l.pitcher.nextPitch=F.SUPER_CURVE,l.pitcher.freshArm=!1):o.id==="SCARY"?(l.pitcher.nextPitch=F.GHOST_STOP,l.pitcher.freshArm=!1):l.pitcher.nextPitch=Fn(o,V.score,l.isDailyChallenge);else if(l.isDailyChallenge){const n=Object.keys(Ua);l.pitcher.nextPitch=Ra.choice(n)}else l.pitcher.nextPitch=Fn(o,V.score)}const i=Ua[l.pitcher.nextPitch];l.showTutorial||(l.pitcher.windupDuration=i.windupDuration||1e3),i.chargeSound&&G[i.chargeSound]&&G[i.chargeSound]()}}handleWalkOff(t){l.pitcher.timer+=t;const a=Y.currentTheme.walkOffType;if(a==="FLY_AWAY"){l.pitcher.x-=.2*t;const i=Math.PI*2/1200;l.pitcher.rotation=(l.pitcher.rotation||0)-i*t,l.pitcher.y=150+Oe+Math.sin(l.pitcher.timer/100)*10,l.pitcher.flyAwayTriggered||(G.playWoosh&&G.playWoosh(),l.pitcher.flyAwayTriggered=!0)}else if(a==="SWIM"){const i=-Math.PI/2,o=l.pitcher.rotation||0;Math.abs(o-i)>.1?l.pitcher.rotation=o+(i-o)*.1:l.pitcher.rotation=i,l.pitcher.x-=.15*t,l.pitcher.y=150+Oe+Math.sin(l.pitcher.timer/300)*15,l.pitcher.rotation+=Math.sin(l.pitcher.timer/150)*.1}else l.pitcher.x-=.18*t,l.pitcher.rotation=0,Math.floor(l.pitcher.timer/160)%2===0?(l.pitcher.y=150+Oe-2,l.pitcher.stepTriggeredOff||(l.pitcher.gender==="FEMALE"&&G.playLightStep?G.playLightStep():l.pitcher.id==="XXX"&&G.playThud?G.playThud():G.playNormalStep&&G.playNormalStep(),l.pitcher.stepTriggeredOff=!0)):(l.pitcher.y=150+Oe+2,l.pitcher.stepTriggeredOff=!1);l.pitcher.x<-100&&this.transitionToNextPitcher()}transitionToNextPitcher(){l.pitcher.state=Ae.WALK_ON,l.pitcher.x=Z+50,l.pitcher.timer=0;const t=Do.find(a=>a.id===l.pitcher.nextPitcherId);t?(l.pitcher.id=t.id,l.pitcher.freshArm=!0,l.pitcher.skinColor=t.visuals.skinColor,l.pitcher.gender=t.visuals.gender,l.pitcher.scale=t.visuals.scale||1,l.pitcher.hatColor=t.visuals.hatColor,l.pitcher.shoeColor=t.visuals.shoeColor,l.pitcher.walkSpeed=t.visuals.walkSpeed||.18,l.pitcher.props={sunglasses:t.visuals.sunglasses,beard:t.visuals.beard,goldChain:t.visuals.goldChain,hatColor:t.visuals.hatColor,shoeColor:t.visuals.shoeColor},l.pitcher.flyAwayTriggered=!1,l.pitcher.rotation=0,l.bossModeActive=t.id!=="ROOKIE"):(l.pitcher.id="ROOKIE",l.pitcher.skinColor="#ffccaa",l.pitcher.gender="MALE",l.pitcher.scale=1,l.bossModeActive=!1)}handleWalkOn(t){l.pitcher.timer+=t;let a=l.pitcher.walkSpeed||.18,i=160;l.pitcher.id==="SCARY"&&(i=300),l.pitcher.x-=a*t,Math.floor(l.pitcher.timer/i)%2===0?(l.pitcher.y=150+Oe-2,l.pitcher.stepTriggeredOn||(l.pitcher.id==="SCARY"?this.playWalkSound():l.pitcher.gender==="FEMALE"&&G.playLightStep?G.playLightStep():l.pitcher.id==="XXX"&&G.playThud?G.playThud():G.playNormalStep&&G.playNormalStep(),l.pitcher.stepTriggeredOn=!0)):(l.pitcher.y=150+Oe+2,l.pitcher.stepTriggeredOn=!1),l.pitcher.x<=Z/2-l.pitcher.width/2&&(l.pitcher.x=Z/2-l.pitcher.width/2,l.pitcher.state=Ae.IDLE,l.pitcher.timer=-1e3,(l.pitcher.id==="TECHNICIAN"||l.pitcher.id==="ACE")&&(l.bossModeActive=!0),this.playEntranceEffects())}playWalkSound(){if(l.pitcher.id==="SCARY"){const t=document.getElementById("game-container");t&&(t.classList.remove("shake-screen"),t.offsetWidth,t.classList.add("shake-screen")),G.playThud&&G.playThud(),Ee.vibrate("bossStep")}else l.pitcher.id==="ACE"?G.playAceStep&&G.playAceStep():l.pitcher.gender==="FEMALE"?G.playLightStep&&G.playLightStep():G.playNormalStep&&G.playNormalStep()}playEntranceEffects(){l.pitcher.id==="ACE"?(G.playAceEntrance&&G.playAceEntrance(),l.aceFlashStartTime=performance.now()):l.pitcher.gender==="FEMALE"?(document.body.classList.add("sparkle-effect"),G.playCheer&&G.playCheer(),setTimeout(()=>{document.body.classList.remove("sparkle-effect")},1500)):l.pitcher.id==="SCARY"?(l.pitcher.skinColor="#000000",document.body.classList.add("fracture-effect"),G.playRoar&&G.playRoar(),G.playThunder&&G.playThunder(),Ee.vibrate("bossEntrance"),setTimeout(()=>{document.body.classList.remove("fracture-effect")},600)):l.pitcher.id==="MONITOR"&&(l.monitorEntranceStartTime=performance.now(),G.playDigitalEntrance&&G.playDigitalEntrance(),Ee.vibrate("bossEntrance"))}handleWindup(t){l.pitcher.timer+=t,this.updateColorBlindIndicator(),l.pitcher.timer>1250&&!l.pitcher.chargeSoundPlayed&&this.playChargeSound(),l.pitcher.timer>l.pitcher.windupDuration&&this.throwBall(t)}updateColorBlindIndicator(){const t=Ua[l.pitcher.nextPitch];if(l.settings?.colorBlindMode){if(Ct.style.display!=="block"&&(Ct.style.display="block",Ct.style.textShadow="2px 2px 0 #000"),window.innerWidth/window.innerHeight>=.7)Ct.style.top="20vh";else{const o=l.pitcher.y/de*100;Ct.style.top=`${o}%`}let i="";if(t.colors.length>1&&t.colorName.includes("/")){const o=t.colorName.split("/");o.forEach((n,s)=>{const r=t.colors[s]||"#ffffff";i+=`<span style="color: ${r}">${n}</span>`,s<o.length-1&&(i+='<span style="color: #ffffff">/</span>')})}else i=`<span style="color: ${t.colors[0]}">${t.colorName}</span>`;Ct.innerHTML!==i&&(Ct.innerHTML=i)}else Ct.style.display!=="none"&&(Ct.style.display="none")}handleBackflip(t){l.pitcher.timer+=t;const a=600;if(l.pitcher.timer<a){const i=l.pitcher.timer/a;l.pitcher.rotation=-i*Math.PI*2,l.pitcher.y=150+Oe-Math.sin(i*Math.PI)*50}else l.pitcher.rotation=0,l.pitcher.y=150+Oe,l.pitcher.state=Ae.IDLE,l.pitcher.timer=0}playChargeSound(){const t=l.pitcher.nextPitch;t===F.SUPER_ZIGZAG||t===F.STOP_ZIGZAG||t===F.GHOST_ZIGZAG?G.playZigZagCharge():t===F.SUPER_CURVE||t===F.STOP_CURVE||t===F.GHOST_CURVE?G.playCurveCharge():t===F.GHOST_CHANGEUP||t===F.CURVE_CHANGEUP||t===F.SPLITTER_CHANGEUP||t===F.STOP_CHANGEUP||t===F.ZIGZAG_CHANGEUP?G.playChangeCharge():t===F.CURVE_SPLITTER||t===F.ZIGZAG_SPLITTER||t===F.SUPER_SPLITTER||t===F.GHOST_SPLITTER||t===F.STOP_SPLITTER?G.playSplitterCharge():(t===F.GHOST_STOP||t===F.GHOST_SUPER||t===F.STOP_SUPER)&&(t===F.GHOST_STOP?G.playEvilLaugh():G.playSuperCharge()),l.pitcher.chargeSoundPlayed=!0}throwBall(t){l.pitcher.state=Ae.IDLE,l.pitcher.timer=0,l.pitcher.chargeSoundPlayed=!1,Ct.style.display="none",l.showTutorial&&(l.showTutorial=!1);let a=1,i=0;const o=Ua[l.pitcher.nextPitch];let n=o.rotationSpeed||.2;if(l.isDailyChallenge){const f=V.score+rt.DAILY_SCORE_OFFSET;a=rt.BASE_MULTIPLIER+Math.log10(f/10+1)*rt.LOG_FACTOR,i=(o.baseSpeed||.4)*a*Ra.range(.95,1.05)}else{const f=V.score,c=rt.TRANSITION_SCORE;if(f<c)a=rt.BASE_MULTIPLIER+Math.pow(f,rt.POWER_EXPONENT)*rt.POWER_FACTOR;else{const p=rt.BASE_MULTIPLIER+Math.pow(c,rt.POWER_EXPONENT)*rt.POWER_FACTOR,h=rt.BASE_MULTIPLIER+Math.log10(c/10+1)*rt.LOG_FACTOR,m=p-h;a=rt.BASE_MULTIPLIER+Math.log10(f/10+1)*rt.LOG_FACTOR+m}i=(o.baseSpeed||.4)*a}let s=0,r=1;l.isDailyChallenge?r=Ra.random()>.5?1:-1:r=Math.random()>.5?1:-1;const d=Yi.get(l.pitcher.x+l.pitcher.width/2-5,l.pitcher.y+l.pitcher.height,l.pitcher.nextPitch,i*t,s,n,r);l.balls.push(d),o.throwSound&&G[o.throwSound]?G[o.throwSound]():G.playPitch()}}const sr=new nr;class kt{static init(t,a){this.startGame=t,this.returnToTitleScreen=a,this.bindRetryEvents()}static setupRetryModal(){Lt&&(Lt.innerText=20,Lt.style.color="#fff"),Ie&&(Ie.onclick=async a=>{a.stopPropagation(),Ie.style.opacity="0.5",Ie.style.pointerEvents="none",await V.deductCoins(20,"daily_retry")?(G.playPurchase(),Ee.vibrate("purchase"),ct&&(ct.style.display="none"),this.startGame&&this.startGame(!0,!0)):(G.playError(),Ee.vibrate("medium"),Ie.style.opacity="1",Ie.style.pointerEvents="auto",Ie.innerText="NEED COINS")}),xi&&(xi.innerText="HOME",xi.onclick=a=>{a.stopPropagation(),G.playSettingsClose(),ct&&(ct.style.display="none"),this.returnToTitleScreen&&this.returnToTitleScreen()}),V.coins>=20?Ie&&(Ie.disabled=!1,Ie.style.opacity="1",Ie.innerText="RETRY",Ie.style.cursor="pointer",Ie.style.pointerEvents="auto"):(Lt&&(Lt.style.color="#e74c3c"),Ie&&(Ie.disabled=!1,Ie.innerText="NEED COINS",Ie.classList.add("btn-disabled-visual")))}static bindRetryEvents(){ct&&(ct.onclick=t=>{t.target===ct&&(G.playSettingsClose(),ct.style.display="none")})}static async attemptEntry(t,a="generic"){const i=He.getDailySeed(),o=l.lastDailyDate,n=await Nt.verifyOrFetch(i);return n.allowed?(Nt.fetchServerTime(),t?!0:o!==i?(console.log("Daily Challenge: Free Entry Used"),l.lastDailyDate=i,q.setItem("baseball_last_daily_date",i),!0):!1):(ko(n.reason),!1)}static setupGame(t){if(!t){l.isDailyChallenge=!1,ke.style.color="#fff",V.setStrikes(0),l.startMessage.active=!1,yt&&(yt.style.display="none");return}l.isDailyChallenge=!0,l.showTutorial=!1,Ra.setSeed(He.getDailySeed()),ke.style.color="#FFD700";const a=Do.reduce((h,m)=>(h.find(g=>g.id===m.id)||h.push(m),h),[]),i=He.getDailySeed();Ra.setSeed(i);const n=parseInt(i.replace(/-/g,""))%a.length,s=a[n];this._applyPitcherToGameState(s),V.setStrikes(2),vi&&(vi.innerText="ONE STRIKE"),Wo&&(Wo.innerText="1 STRIKE = GAME OVER"),vi&&(vi.style.color="#FF0000"),yt&&(yt.style.display="flex"),l.startMessage.active=!0;const r=Z+60,d=Z/2-16,f=r-d;l.pitcher.width=32;const c=l.pitcher.walkSpeed||.18,p=f/c;l.startMessage.timer=Math.max(1e3,p-750),G.playError()}static _applyPitcherToGameState(t){l.pitcher.id=t.id,l.pitcher.skinColor=t.visuals.skinColor,l.pitcher.hatColor=t.visuals.hatColor,l.pitcher.gender=t.visuals.gender,l.pitcher.shoeColor=t.visuals.shoeColor||null,l.pitcher.scale=t.visuals.scale||1,l.pitcher.walkSpeed=t.visuals.walkSpeed||.18,l.pitcher.props={sunglasses:t.visuals.sunglasses||!1,beard:t.visuals.beard||!1,goldChain:t.visuals.goldChain||!1},l.pitcher.x=Z+60,l.pitcher.state=Ae.WALK_ON}static updateButtonState(){if(!sa)return;const t=He.getDailySeed(),a=l.lastDailyDate;zi&&(zi.innerText=l.dailyStreak),a!==t?(Vi.innerText="FREE",Fa.className="daily-badge free",la&&(la.style.display="none")):(Vi.innerText="20",Fa.className="daily-badge cost",la&&(la.style.display="block"))}}let ui=!0;function $a(){l.gameActive&&(l.isPaused=!l.isPaused,$t.style.display=l.isPaused?"flex":"none",l.isPaused?(Me.innerHTML="&#9658;",Me.style.fontSize="8vmin",Me.style.paddingLeft=""):(Me.innerHTML='<div class="pause-bar"></div><div class="pause-bar"></div>',Me.style.fontSize="",Me.style.paddingLeft=""),Me.style.display=l.isPaused||l.gameActive?"flex":"none",l.isPaused?(qe.style.display="block",l.startMessage&&l.startMessage.active&&yt&&(yt.style.display="none"),G.audioContext&&G.playPause(!0),l.balls.forEach(e=>{e.prevX=e.x,e.prevY=e.y,e.prevRotationAngle=e.rotationAngle})):($t.style.display="none",qe.style.display="none",l.startMessage&&l.startMessage.active&&yt&&(yt.style.display="flex"),G.audioContext&&G.playPause(!1),l.lastTime=performance.now()))}function fs(){if(console.log("Returning to Title Screen..."),l.gameActive=!1,l.isPaused=!1,l.isGameOver=!1,l.isDailyChallenge=!1,l.bossModeActive=!1,l.showFireworks=!1,G.stopTheme(),$t&&($t.style.display="none"),qe&&(qe.style.display="block"),qe&&(qe.style.display="block"),tt&&(tt.style.display="flex",tt.classList.remove("wiggle-active")),dt&&(dt.style.visibility="hidden"),l.showTutorial=!1,ke&&(ke.style.visibility="hidden"),nt&&(nt.style.visibility="visible"),oi&&(oi.style.display="flex",oi.parentElement&&(oi.parentElement.style.display="flex")),Ti&&(Ti.style.display="block",Ti.style.visibility="visible",Ti.style.opacity="1"),V&&V.updateCoinDisplay(),Me&&(Me.style.display="none",Me.innerHTML='<div class="pause-bar"></div><div class="pause-bar"></div>',Me.style.paddingLeft="",Me.style.fontSize=""),Be){Be.style.display="block";const e='<div class="game-title"><div class="title-line" data-text="PERFECT">PERFECT</div><div class="title-line" data-text="DERBY">DERBY</div></div><div class="subtitle pulse">TAP TO <span class="mobile-block">START</span></div>',t=document.getElementById("start-content");t?t.innerHTML=e:Be.innerHTML=`<div id="start-content">${e}</div>`}je&&(je.style.display="flex"),gt&&(gt.style.display="flex"),Et(!1),Ea()}async function ca(e=!1,t=!1,a="generic"){if(!ui)return;if(e){const n=He.getDailySeed();if(!Nt.isDateAllowed(n).allowed){await kt.attemptEntry(t,a);return}if(l.lastDailyDate===n&&!t){if(a==="game_over"){G.playUnlockablesOpen(),ct&&(ct.style.display="flex"),kt.setupRetryModal();return}const d=20;if(V.coins<d){G.playError(),ct&&(ct.style.display="flex"),kt.setupRetryModal();return}if(await V.deductCoins(d,"daily_retry"))G.playPurchase(),kt.setupGame(!0);else{G.playError();return}}else{if(!await kt.attemptEntry(t,a))return;kt.setupGame(!0)}}else kt.setupGame(!1);Me.style.display="flex",qe.style.display="none",Me.style.display="flex",qe.style.display="none",tt&&(tt.style.display="none",tt.classList.remove("wiggle-active")),je&&(je.style.display="none"),gt&&(gt.style.display="none"),Be.style.display="none",Ba&&(Ba.style.display="none"),dt&&(dt.style.display="none"),l.needsUnlockablesGlow=!1,je&&je.classList.remove("unlockables-glow"),!l.tutorialSeen&&!e?l.pendingUnlockablesGlow=!0:l.pendingUnlockablesGlow=!1,G.stopTheme(),al(),l.gameActive=!0,l.isPaused=!1,l.isGameOver=!1,Et(!1),Ea(),$t.style.display="none",e||(l.pitcher.id="ROOKIE",l.pitcher.skinColor="#ffccaa",l.pitcher.hatColor="#e74c3c",l.pitcher.props={hatColor:"#e74c3c"},l.pitcher.gender="MALE",l.pitcher.shoeColor=null,l.pitcher.baseColor="#ffffff",l.pitcher.bossType=null,l.pitcher.freshArm=!1,l.pitcher.scale=1),e||(l.showTutorial=!l.tutorialSeen),V.reset(),V.startSession(),e&&V.setStrikes(2),ke.innerText=`Score: ${V.score}`,l.totalPitches=0,V.setMultiplier(0),l.consecutiveFouls=0,ke.innerText=`Score: ${V.score}`,At.reset(),l.showFireworks=!1,V.updateCoinDisplay(),ma.style.display="none",ke.style.visibility="visible",V.updateCoinDisplay(),ke.style.visibility="visible",ke.parentElement.style.display="flex";const i=document.getElementById("coin-container");i?(i.style.display="none",i.style.visibility="hidden"):nt&&nt.parentElement&&(nt.parentElement.style.display="none"),ue.innerText="",Ct.style.display="none",Be.style.display="none",Zl(),l.lastTime=performance.now(),l.accumulator=0,l.pitcher.state=Ae.IDLE,l.sessionStartTime=Date.now(),l.activeSessionTime=0,l.lastActiveTick=Date.now(),l.pitcher.timer=0,l.showFireworks=!1,l.timeScale=1,l.bossModeActive=!1,l.bossLevel=0,l.nextBossType=null;const o=document.querySelector("canvas");o&&(o.style.cursor="default"),l.isDailyChallenge?l.pitcher.state=Ae.WALK_ON:(l.pitcher.x=Z/2-l.pitcher.width/2,l.pitcher.state=Ae.IDLE),l.pitcher.y=150+Oe,l.perfectHitTimer=0,l.score===0&&!l.tutorialSeen&&!l.isDailyChallenge?l.showTutorial=!0:l.showTutorial=!1,Aa(!0),localStorage.removeItem("baseball_saved_game"),l.isGameOver=!1}async function lr(e,t="generic"){return await kt.attemptEntry(e,t)}function rr(){Lt&&(Lt.innerText=20,Lt.style.color="#fff"),V.coins>=20?Ie&&(Ie.disabled=!1,Ie.style.opacity="1",Ie.innerText="RETRY",Ie.style.cursor="pointer"):(Lt&&(Lt.style.color="#e74c3c"),Ie&&(Ie.disabled=!1,Ie.innerText="NEED COINS",Ie.classList.add("btn-disabled-visual")))}function hs(){l.isDailyChallenge=!1,localStorage.removeItem("baseball_saved_game"),l.isGameOver=!1,l.gameActive=!1,G.stopTheme(),V.reset(),l.showFireworks=!1,At.reset(),l.bossModeActive=!1,Be.style.display="block",na?na.innerHTML=`
            <div class="game-title">
                <div class="title-line" data-text="PERFECT">PERFECT</div>
                <div class="title-line" data-text="DERBY">DERBY</div>
            </div>
            <div class="subtitle pulse">TAP TO <span class="mobile-block">START</span></div>
        `:Be.innerHTML=`
            <div class="game-title">
                <div class="title-line" data-text="PERFECT">PERFECT</div>
                <div class="title-line" data-text="DERBY">DERBY</div>
            </div>
            <div class="subtitle pulse">TAP TO <span class="mobile-block">START</span></div>
        `,qe&&(qe.style.display="block"),qe&&(qe.style.display="block"),tt&&(tt.style.display="flex",tt.classList.remove("wiggle-active")),je&&(je.style.display="flex"),gt&&(gt.style.display="block"),dt&&(dt.style.display="none"),Et(!1),ke.style.color="#fff",ct&&(ct.style.display="none"),Na&&Na.close(),$t&&($t.style.display="none"),ke&&ke.parentElement&&(ke.parentElement.style.display="flex");const e=document.getElementById("coin-container");e?(e.style.display="flex",e.style.visibility="visible"):nt&&nt.parentElement&&(nt.parentElement.style.display="flex"),yt&&(yt.style.display="none"),na?na.innerHTML=`
            <div class="game-title">
                <div class="title-line" data-text="PERFECT">PERFECT</div>
                <div class="title-line" data-text="DERBY">DERBY</div>
            </div>
            <div class="subtitle pulse">TAP TO <span class="mobile-block">START</span></div>
            ${l.isMobile?'<span class="mobile-block"><br>(TAP ZONES)</span>':""}
        `:Be.innerHTML=`
            <div class="game-title">
                <div class="title-line" data-text="PERFECT">PERFECT</div>
                <div class="title-line" data-text="DERBY">DERBY</div>
            </div>
            <div class="subtitle pulse">TAP TO <span class="mobile-block">START</span></div>
            ${l.isMobile?'<span class="mobile-block"><br>(TAP ZONES)</span>':""}
        `,qe&&(qe.style.display="block"),je&&(je.style.display="flex"),gt&&(gt.style.display="block"),Be.style.display="block"}function qi(e=null){if(l.transitioning)return;if(e&&!l.isGameOver&&!l.transitioning){if(l.transitioning=!0,l.gameActive=!1,Aa(!1),ui=!1,Be&&(Be.style.display="none"),qe&&(qe.style.display="none"),l.balls.forEach(s=>{s.prevX=s.x,s.prevY=s.y,s.prevRotationAngle=s.rotationAngle}),Ci){Ci.style.display="flex";let s="GAME OVER",r="BETTER LUCK NEXT TIME",d=null;e==="STRIKE_OUT"?(s="STRIKE OUT!",r="THREE STRIKES, YOU'RE OUT",d=()=>G.playStrike()):e==="BAT_BROKEN"&&(s="BAT BROKEN!",r="TOO MANY FOULS",d=()=>G.playBatBreak()),No&&(No.innerText=s),$o&&($o.innerText=r),d&&d()}setTimeout(()=>{l.transitioning=!1,Ci&&(Ci.style.display="none"),qi()},2e3);return}l.gameActive=!1,l.isGameOver=!0,ui=!1,V.checkHighScore();const t=Y.currentTheme&&Y.currentTheme.id==="CLASSIC";V.score>50&&V.hasNewRecord()&&t&&(l.showFireworks=!0,At.reset()),Dl(),localStorage.removeItem("baseball_saved_game"),qe.style.display="block",qe.style.display="block",tt&&(tt.style.display="flex",tt.classList.add("wiggle-active")),je&&(je.style.display="flex"),gt&&(gt.style.display="block"),dt&&(dt.style.display="none"),l.pendingUnlockablesGlow&&!l.isDailyChallenge&&(l.needsUnlockablesGlow=!0,l.pendingUnlockablesGlow=!1,je&&je.classList.add("unlockables-glow")),Et(!0),l.isDailyChallenge?`${V.dailyHighScore}`:`${V.highScore}`;const i=l.isDailyChallenge?"#FFD700":"#ffffff";console.log(`[Game Over] isDaily: ${l.isDailyChallenge}, color: ${i}`),na?na.innerHTML=`
            <span style="color: #ff0000; font-size: 1.2em;">GAME OVER</span><br>
            <span style="font-size: 1.0em; display: block; margin-top: 10px; animation: none; color: ${i} !important;">SCORE: ${V.score}</span>
            <span id="restart-msg" style="font-size: 0.8em; display: block; margin-top: 20px; animation: blink 1s infinite linear; color: #fff;">TAP TO RETRY</span>
        `:Be.innerHTML=`
            <span style="color: #ff0000; font-size: 1.2em;">GAME OVER</span><br>
            <span style="font-size: 1.0em; display: block; margin-top: 10px; animation: none; color: ${i} !important;">SCORE: ${V.score}</span>
            <span id="restart-msg" style="font-size: 0.8em; display: block; margin-top: 20px; animation: blink 1s infinite linear; color: #fff;">TAP TO RETRY</span>
        `,Be.style.display="block",Be.style.display="block",l.isDailyChallenge&&V.updateDailyStreak().catch(s=>console.warn("[Daily] Streak update failed",s)),ke.parentElement.style.display="flex",ke.parentElement.style.display="flex",ke.style.visibility="hidden";const o=document.getElementById("coin-container");o?(o.style.display="flex",o.style.visibility="visible"):nt.parentElement.style.display="flex",ue.innerText="",Y.currentTheme&&Y.currentTheme.id==="HAUNTED"?G.playHauntedTheme():G.playTheme();const n=l.isDailyChallenge?"daily_leaderboard":"leaderboard";Na.checkAndSubmitScore(V.score,n),setTimeout(()=>{ui=!0},1e3),Me.style.display="none",Aa(!0),V.saveCoins(!0),V.animateCoinGain(),V.syncSession().catch(s=>console.error("Sync Failed",s))}function Ta(){if(l.isPaused)return;if(!l.gameActive){if(!ui)return;G.init().then(()=>{ca()});return}const e=Date.now();e-l.lastSwingTime<_s||l.bat.swinging||(l.lastSwingTime=e,l.bat.swinging=!0,l.bat.angle=Math.PI,G.playSwing())}function us(e){l.gameActive&&Be.style.display!=="none"&&(Be.style.display="none",na&&(na.style.display="none")),document.visibilityState==="visible"&&(l.activeSessionTime+=e),l.balls.length===0&&(l.pitcher.timer+=e),l.perfectHitTimer>0&&(l.perfectHitTimer-=e),l.startMessage&&l.startMessage.active&&(l.startMessage.timer-=e,l.startMessage.timer<=0&&(l.startMessage.active=!1,yt&&(yt.style.display="none"))),l.isDailyChallenge&&ke.style.color!=="rgb(255, 215, 0)"&&ke.style.color!=="#FFD700"&&(ke.style.color="#FFD700"),sr.update(e),Kl.update(e,qi,Aa),l.bat.swinging&&(l.bat.angle+=l.bat.swingSpeed*(e/16),l.bat.angle<=-Math.PI&&(l.bat.angle=Math.PI,l.bat.swinging=!1)),or.checkCollisions(e,t=>{t==="BAT_BROKEN"&&qi("BAT_BROKEN")},Aa)}function ps(){kt.updateButtonState()}function Lo(){V.saveGame()}function cr(){return V.loadGame()?(l.pitcher.state=Ae.IDLE,l.pitcher.timer=0,l.pitcher.x=Z/2-l.pitcher.width/2,l.pitcher.y=150+Oe,l.balls=[],Be.style.display="none",$t.style.display="block",qe.style.display="block",ke.style.visibility="visible",ke.parentElement.style.display="flex",V.updateScoreDisplay(),nt.parentElement.style.display="none",je&&(je.style.display="none"),gt&&(gt.style.display="none"),Et(!1),Ea(),console.log("Game Restored from Secure Disk"),!0):!1}kt.init(ca,hs);const dr=Object.freeze(Object.defineProperty({__proto__:null,attemptDailyEntry:lr,gameOver:qi,loadSavedGame:cr,returnToTitle:fs,returnToTitleScreen:hs,saveGame:Lo,setupDailyRetryModal:rr,startGame:ca,swing:Ta,togglePause:$a,update:us,updateDailyButtonState:ps},Symbol.toStringTag,{value:"Module"})),fr=`data:image/svg+xml;charset=utf-8,${encodeURIComponent('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 10 10" shape-rendering="crispEdges"><rect x="3" y="0" width="4" height="1" fill="#DAA520" /><rect x="2" y="1" width="1" height="1" fill="#DAA520" /><rect x="3" y="1" width="4" height="1" fill="#FFD700" /><rect x="7" y="1" width="1" height="1" fill="#DAA520" /><rect x="1" y="2" width="1" height="1" fill="#DAA520" /><rect x="2" y="2" width="1" height="1" fill="#FFD700" /><rect x="3" y="2" width="2" height="1" fill="#FFFFFF" /><rect x="5" y="2" width="3" height="1" fill="#FFD700" /><rect x="8" y="2" width="1" height="1" fill="#DAA520" /><rect x="1" y="3" width="1" height="1" fill="#DAA520" /><rect x="2" y="3" width="1" height="1" fill="#FFD700" /><rect x="3" y="3" width="1" height="1" fill="#FFFFFF" /><rect x="4" y="3" width="3" height="1" fill="#000000" /><rect x="7" y="3" width="1" height="1" fill="#FFD700" /><rect x="8" y="3" width="1" height="1" fill="#DAA520" /><rect x="1" y="4" width="1" height="1" fill="#DAA520" /><rect x="2" y="4" width="2" height="1" fill="#FFD700" /><rect x="4" y="4" width="1" height="1" fill="#000000" /><rect x="5" y="4" width="3" height="1" fill="#FFD700" /><rect x="8" y="4" width="1" height="1" fill="#DAA520" /><rect x="1" y="5" width="1" height="1" fill="#DAA520" /><rect x="2" y="5" width="2" height="1" fill="#FFD700" /><rect x="4" y="5" width="1" height="1" fill="#000000" /><rect x="5" y="5" width="3" height="1" fill="#FFD700" /><rect x="8" y="5" width="1" height="1" fill="#DAA520" /><rect x="1" y="6" width="1" height="1" fill="#DAA520" /><rect x="2" y="6" width="2" height="1" fill="#FFD700" /><rect x="4" y="6" width="3" height="1" fill="#000000" /><rect x="7" y="6" width="1" height="1" fill="#FFD700" /><rect x="8" y="6" width="1" height="1" fill="#DAA520" /><rect x="1" y="7" width="1" height="1" fill="#DAA520" /><rect x="2" y="7" width="6" height="1" fill="#FFD700" /><rect x="8" y="7" width="1" height="1" fill="#DAA520" /><rect x="2" y="8" width="1" height="1" fill="#DAA520" /><rect x="3" y="8" width="4" height="1" fill="#FFD700" /><rect x="7" y="8" width="1" height="1" fill="#DAA520" /><rect x="3" y="9" width="4" height="1" fill="#DAA520" /></svg>')}`;class hr{constructor(){this.stadiums=[{id:"stadium_default",name:"Classic Field",cost:0,type:"stadium",unlocked:!0,equipped:!0,theme:"CLASSIC"},{id:"stadium_night",name:"Night Game",cost:1e6,type:"stadium",unlocked:!1,equipped:!1,theme:"NIGHT"},{id:"stadium_retro",name:"Retro Park",cost:25e5,type:"stadium",unlocked:!1,equipped:!1,theme:"RETRO"},{id:"stadium_space",name:"Space Station",cost:30,type:"stadium",unlocked:!1,equipped:!1,theme:"SPACE"},{id:"stadium_beach",name:"Sunny Beach",cost:20,type:"stadium",unlocked:!1,equipped:!1,theme:"BEACH"},{id:"stadium_haunted",name:"Haunted Mansion",cost:10,type:"stadium",unlocked:!1,equipped:!1,theme:"HAUNTED"}],this.bats=[{id:"bat_default",name:"Pink Bat",cost:0,type:"bat",unlocked:!0,equipped:!0,color:"#ff69b4"},{id:"bat_blue",name:"Blue Bat",cost:1,type:"bat",unlocked:!1,equipped:!1,color:"#0000FF"},{id:"bat_gold",name:"Gold Bat",cost:10,type:"bat",unlocked:!1,equipped:!1,color:"#FFD700"},{id:"bat_laser",name:"Neon Bat",cost:1,type:"bat",unlocked:!1,equipped:!1,color:"#00ffff"}],this.init()}init(){this.loadProgress(),this.renderItems(),this.setupEventListeners(),setTimeout(()=>this.syncPendingPurchases(),2e3)}async syncPendingPurchases(){const t=JSON.parse(q.getItem("baseball_pending_purchases")||"[]");if(t.length===0)return;console.log(`[Unlockables] Found ${t.length} pending offline purchases to sync...`);const{supabaseService:a}=await De(async()=>{const{supabaseService:s}=await Promise.resolve().then(()=>Pa);return{supabaseService:s}},void 0,import.meta.url),i=a.getClient();if(!i)return;const{data:{session:o}}=await i.auth.getSession();if(!o)return;try{await i.rpc("ensure_user_exists",{p_user_id:o.user.id})}catch(s){console.warn("[Unlockables] Failed to ensure user exists:",s)}const n=[];for(const s of t)try{console.log(`[Unlockables] Syncing purchase: ${s.id}`);const{data:r,error:d}=await i.rpc("purchase_item",{p_item_id:s.id,p_cost:s.cost,p_item_type:s.type});d?(console.warn(`[Unlockables] Sync failed for ${s.id}: ${d.message}`),n.push(s)):typeof r.new_balance=="number"?console.log(`[Unlockables] Synced ${s.id}. Server Balance: ${r.new_balance}`):console.warn(`[Unlockables] Synced ${s.id} but received invalid balance: ${r.new_balance}.`)}catch(r){console.error(`[Unlockables] Sync Error for ${s.id}`,r),n.push(s)}q.setItem("baseball_pending_purchases",JSON.stringify(n)),await this.syncPendingEquips(i)}async syncPendingEquips(t){const a=["bat","stadium"];for(const i of a){const o=`pending_equip_${i}`,n=q.getItem(o);if(n)try{const s=JSON.parse(n);console.log(`[Unlockables] Syncing pending equip: ${s.id}`);const{error:r}=await t.rpc("set_equipped_item",{p_item_id:s.id,p_item_type:s.type});r?console.warn(`[Unlockables] Failed to sync pending equip ${s.id}: ${r.message}`):(q.removeItem(o),console.log(`[Unlockables] Pending equip synced: ${s.id}`))}catch(s){console.error("Error syncing pending equip",s)}}}setupEventListeners(){je.addEventListener("click",()=>this.open()),Ss.addEventListener("click",()=>this.close()),oi.addEventListener("click",t=>{t.stopPropagation(),(!l.gameActive||l.isGameOver)&&(Ee.vibrate("light"),this.open())}),ni.addEventListener("click",t=>{t.target===ni&&this.close()})}open(){ni.style.display="flex",this.updateCoinDisplay(),l.isPaused=!0,l.needsUnlockablesGlow=!1,je&&je.classList.remove("unlockables-glow"),G.init().then(()=>{G.playUnlockablesOpen()})}close(){ni.style.display="none",l.isPaused=!1,G.playUnlockablesClose()}updateCoinDisplay(){Ts.textContent=V.coins}renderItems(){this.stadiums.sort((t,a)=>t.cost-a.cost),this.bats.sort((t,a)=>t.cost-a.cost),this.renderGrid(Yo,this.stadiums),this.renderGrid(qo,this.bats)}renderGrid(t,a){t.innerHTML="",a.forEach(i=>{const o=document.createElement("div");o.dataset.id=i.id,o.className=`unlockable-item clickable ${i.unlocked?"unlocked":"locked"} ${i.equipped?"equipped":""}`,o.onclick=()=>this.handleItemClick(i);let n="";if(i.equipped)n='<div class="item-status equipped">EQUIPPED</div>';else if(i.unlocked)n='<div class="item-status owned">OWNED</div>';else{const c=i.id==="stadium_night"||i.id==="stadium_retro"?"?":i.cost.toLocaleString();n=`
                    <div class="item-cost">
                        <img src="${fr}" style="width: 1.2em; height: 1.2em;">
                        <span style="color: #ffffff; margin-left: 4px;">${c}</span>
                    </div>`}const r=i.unlocked?"":`<div class="lock-overlay">
            <svg viewBox="0 0 12 14" xmlns="http://www.w3.org/2000/svg" style="shape-rendering: crispEdges; width: 100%; height: 100%;">
                <!-- Shackle (Silver) -->
                <rect x="3" y="0" width="6" height="1" fill="#C0C0C0"/>
                <rect x="2" y="1" width="1" height="4" fill="#C0C0C0"/>
                <rect x="9" y="1" width="1" height="4" fill="#C0C0C0"/>
                <!-- Body (Gold) -->
                <rect x="1" y="5" width="10" height="9" fill="#FFD700"/>
                <!-- Highlight -->
                <rect x="2" y="6" width="1" height="1" fill="#FFFFFF" opacity="0.5"/>
                <rect x="3" y="6" width="7" height="1" fill="#FFFFFF" opacity="0.5"/>
                <!-- Keyhole (Black) -->
                <rect x="5" y="8" width="2" height="3" fill="#000"/>
            </svg></div>`;let d="";i.type==="stadium"?d=this.getStadiumIcon(i):i.type==="bat"&&(d=this.getBatIcon(i)),o.innerHTML=`
                <div class="item-name">${i.name}</div>
                <div class="item-icon-container">
                    <div class="item-icon">${d}</div>
                    ${r}
                </div>
                <div class="item-footer">
                    ${n}
                </div>
            `,t.appendChild(o)})}handleItemClick(t){if(console.log(`[Unlockables] Clicked item: ${t.name}, Equipped: ${t.equipped}`),t.equipped){G.playItemAlreadyEquipped(),Ee.vibrate("equipped");return}t.unlocked?this.equipItem(t):V.coins>=t.cost?this.purchaseItem(t):this.purchaseItem(t)}async purchaseItem(t){if(console.log(`[Unlockables] Attempting purchase: ${t.name} (${t.id})`),!V.deductCoinsLocal(t.cost)){G.playError(),Ee.vibrate("locked"),console.log("[Unlockables] Purchase Failed: Insufficient Local Funds");return}t.unlocked=!0,this.saveProgress(),this.updateCoinDisplay(),this.renderItems(),G.playPurchase(),Ee.vibrate("purchase"),console.log(`[Unlockables] Local Purchase Successful: ${t.name}`),this.syncPurchaseToServer(t)}async syncPurchaseToServer(t){const{supabaseService:a}=await De(async()=>{const{supabaseService:o}=await Promise.resolve().then(()=>Pa);return{supabaseService:o}},void 0,import.meta.url),i=a.getClient();if(!i){console.warn("[Unlockables] Offline. Queuing purchase for server sync."),this.queuePendingPurchase(t);return}try{const{data:o,error:n}=await i.rpc("purchase_item",{p_item_id:t.id,p_cost:t.cost,p_item_type:t.type});if(n){if(n.message?.includes("already owned")){console.log(`[Unlockables] Item ${t.id} already owned on server - OK`);return}console.warn("[Unlockables] Server Sync Failed:",n.message),this.queuePendingPurchase(t)}else console.log(`[Unlockables] Server Sync Success for ${t.id}. Server Bal: ${o.new_balance}`)}catch(o){console.error("[Unlockables] Sync RPC Exception",o),this.queuePendingPurchase(t)}}purchaseItemLocal(t){V.deductCoinsLocal(t.cost)?(t.unlocked=!0,this.saveProgress(),this.queuePendingPurchase(t),this.updateCoinDisplay(),this.renderItems(),G.playPurchase(),Ee.vibrate("purchase"),console.log(`[Unlockables] Offline Purchase Successful: ${t.name}`)):(G.playError(),Ee.vibrate("locked"),console.log("[Unlockables] Offline Purchase Failed: Insufficient Funds"))}queuePendingPurchase(t){const a=JSON.parse(q.getItem("baseball_pending_purchases")||"[]");a.find(i=>i.id===t.id)||(a.push({id:t.id,cost:t.cost,type:t.type,timestamp:Date.now()}),q.setItem("baseball_pending_purchases",JSON.stringify(a)),console.log(`[Unlockables] Queued purchase sync for ${t.name}`))}equipItem(t){G.playEquip(),Ee.vibrate("light"),(t.type==="stadium"?this.stadiums:this.bats).forEach(o=>o.equipped=!1),t.equipped=!0,t.equipped=!0,this.saveProgress(),this.updateEquippedUI(t),t.type==="stadium"&&(t.theme==="SPACE"||t.theme==="HAUNTED"||t.theme==="BEACH")?(this.showLoadingOverlay(t.theme),requestAnimationFrame(()=>{setTimeout(()=>{if(t.theme&&Y.setTheme(t.theme),t.theme==="HAUNTED"&&pi){const o=Z||window.innerWidth,n=de||window.innerHeight;pi(o,n)}else if(t.theme==="SPACE"&&Y.currentTheme.warmup){const o=Z||window.innerWidth,n=de||window.innerHeight;Y.currentTheme.warmup(o,n)}else if(t.theme==="BEACH"&&Y.currentTheme.warmup){const o=Z||window.innerWidth,n=de||window.innerHeight;Y.currentTheme.warmup(o,n)}Et(!1),Ea(),requestAnimationFrame(()=>{this.applyEquippedItem(t),t.type==="stadium"&&this.close(),setTimeout(()=>this.hideLoadingOverlay(),500)})},500)})):(this.applyEquippedItem(t),t.type==="stadium"&&this.close()),this.syncEquippedItem(t)}async syncEquippedItem(t){const{supabaseService:a}=await De(async()=>{const{supabaseService:o}=await Promise.resolve().then(()=>Pa);return{supabaseService:o}},void 0,import.meta.url),i=a.getClient();if(!i){console.warn("[Unlockables] Offline. Queuing equip for server sync."),this.savePendingEquip(t);return}try{const{data:{session:o}}=await i.auth.getSession();if(o){const{error:r}=await i.rpc("ensure_user_exists",{p_user_id:o.user.id});r&&console.error("[Unlockables] ensure_user_exists FAILED:",r)}console.log(`[Unlockables] Syncing equip: ${t.id}`);const{data:n,error:s}=await i.rpc("set_equipped_item",{p_item_id:t.id,p_item_type:t.type});if(s)console.warn(`[Unlockables] Equip Sync Network Error: ${s.message}`),this.savePendingEquip(t);else{console.log(`[Unlockables] Equip Sync Result: ${n}`);const r=String(n).match(/Equipped=(\d+)/);if((r?parseInt(r[1]):null)===0){console.warn("[Unlockables] Server missed equip (Item likely missing). Attempting Backfill..."),await this.syncPurchaseToServer(t),console.log(`[Unlockables] Retrying equip for ${t.id}...`);const{data:f}=await i.rpc("set_equipped_item",{p_item_id:t.id,p_item_type:t.type});console.log(`[Unlockables] Retry Result: ${f}`)}else n&&String(n).startsWith("Error")&&this.savePendingEquip(t)}}catch(o){console.error("[Unlockables] Equip Sync Exception",o),this.savePendingEquip(t)}}savePendingEquip(t){const a=`pending_equip_${t.type}`;q.setItem(a,JSON.stringify({id:t.id,type:t.type,timestamp:Date.now()}))}applyEquippedItem(t){if(t.type==="bat"){const a={bat_default:"STANDARD",bat_blue:"BLUE",bat_gold:"GOLD",bat_laser:"LASER"};Pt.setBat(a[t.id]||"STANDARD"),ll()}else if(t.type==="stadium"&&t.theme){if(Y.setTheme(t.theme),l.gameActive=!1,l.isGameOver=!1,l.bossModeActive=!1,l.showFireworks=!1,l.showFireworks=!1,G.stopTheme(),tt&&tt.classList.remove("wiggle-active"),Be){Be.style.display="block";const a='<div class="game-title"><div class="title-line" data-text="PERFECT">PERFECT</div><div class="title-line" data-text="DERBY">DERBY</div></div><div class="subtitle pulse">TAP TO <span class="mobile-block">START</span></div>',i=document.getElementById("start-content");i?i.innerHTML=a:Be.innerHTML=`<div id="start-content">${a}</div>`}Et(!1),Ea()}}showLoadingOverlay(t){let a=document.getElementById("global-loading-overlay"),i="INITIALIZING SYSTEM";t==="HAUNTED"?i="SUMMONING SPIRITS":t==="SPACE"?i="INITIALIZING SPACE SYSTEMS":t==="BEACH"&&(i="WAXING SURFBOARDS"),a||(a=document.createElement("div"),a.id="global-loading-overlay",a.style.position="fixed",a.style.top="0",a.style.left="0",a.style.width="100%",a.style.height="100%",a.style.background="rgba(0,0,0,0.85)",a.style.color="#fff",a.style.zIndex="10000",a.style.display="flex",a.style.flexDirection="column",a.style.alignItems="center",a.style.justifyContent="center",a.style.fontFamily="var(--font-display, monospace)",a.style.fontSize="4vmin",document.body.appendChild(a)),a.innerHTML=`<div class="pulse">LOADING...</div><div class="subtitle" style="font-size: 0.5em; margin-top: 20px; color: #888;">${i}</div>`,a.style.display="flex",l.isLoading=!0}hideLoadingOverlay(){const t=document.getElementById("global-loading-overlay");t&&(t.style.display="none"),l.isLoading=!1}saveProgress(){const t={stadiums:this.stadiums.map(a=>({id:a.id,unlocked:a.unlocked,equipped:a.equipped})),bats:this.bats.map(a=>({id:a.id,unlocked:a.unlocked,equipped:a.equipped})),coins:l.coins};q.setItem("baseball_unlockables",JSON.stringify(t))}loadProgress(){q.migrate("baseball_unlockables");const t=q.getItem("baseball_unlockables");if(t)try{const a=JSON.parse(t);a.stadiums&&a.stadiums.forEach(i=>{const o=this.stadiums.find(n=>n.id===i.id);o&&(o.unlocked=i.unlocked,o.equipped=i.equipped,o.equipped&&o.theme&&Y.setTheme(o.theme))}),a.bats&&a.bats.forEach(i=>{const o=this.bats.find(n=>n.id===i.id);if(o&&(o.unlocked=i.unlocked,o.equipped=i.equipped,o.equipped&&o.type==="bat")){const n={bat_default:"STANDARD",bat_blue:"BLUE",bat_gold:"GOLD",bat_laser:"LASER"};Pt.setBat(n[o.id]||"STANDARD")}})}catch(a){console.warn("Failed to parse unlockables. Resetting.",a),q.removeItem("baseball_unlockables")}}getStadiumIcon(t){const a=`icon-${t.id}`;if(this._iconDataUrlCache||(this._iconDataUrlCache={}),this._iconDataUrlCache[t.theme])return`<img src="${this._iconDataUrlCache[t.theme]}" draggable="false" style="width: 100%; height: 100%; border-radius: 1vmin; display: block; user-select: none; -webkit-user-drag: none; pointer-events: none;">`;requestAnimationFrame(()=>{const s=Bl(t.theme).toDataURL();this._iconDataUrlCache[t.theme]=s;const r=document.getElementById(a);r&&(r.src=s)});const o={CLASSIC:"linear-gradient(135deg, #2d8a4e, #1a5c32)",BEACH:"linear-gradient(135deg, #87CEEB, #f4e4bc)",SPACE:"linear-gradient(135deg, #0a0a2e, #1a1a4e)",HAUNTED:"linear-gradient(135deg, #2d1b4e, #1a0a2e)",NIGHT:"linear-gradient(135deg, #1a1a3e, #0a0a1e)",RETRO:"linear-gradient(135deg, #8B7355, #654321)"}[t.theme]||"linear-gradient(135deg, #333, #666)";return`<img id="${a}" src="" draggable="false" style="width: 100%; height: 100%; border-radius: 1vmin; display: block; user-select: none; -webkit-user-drag: none; pointer-events: none; background: ${o};">`}getBatIcon(t){const i={bat_default:oa.STANDARD,bat_blue:oa.BLUE,bat_gold:oa.GOLD,bat_laser:oa.LASER}[t.id]||oa.STANDARD;return`<img src="${Jn.generateIcon(i).toDataURL()}" draggable="false" style="width: 100%; height: 100%; display: block; user-select: none; -webkit-user-drag: none; pointer-events: none;">`}updateEquippedUI(t){const a=t.type==="stadium"?Yo:qo;Array.from(a.children).forEach(i=>{const o=i.dataset.id,n=i.querySelector(".item-footer");o===t.id?(i.classList.add("equipped"),n&&(n.innerHTML='<div class="item-status equipped">EQUIPPED</div>')):i.classList.contains("equipped")&&(i.classList.remove("equipped"),n&&(n.innerHTML='<div class="item-status owned">OWNED</div>'))})}}const Go=new hr,ur=Object.freeze(Object.defineProperty({__proto__:null,unlockablesManager:Go},Symbol.toStringTag,{value:"Module"})),yo=512,So=[{name:"Audio System Warmup",action:async()=>{G&&(await G.init(),G.warmup&&G.warmup())}},{name:"Perfect Hit GPU Pipeline",draw:e=>{const t=yo,a=e.createRadialGradient(t/2,t/2,10,t/2,t/2,t/2);a.addColorStop(0,"rgba(255, 255, 210, 0.8)"),a.addColorStop(.4,"rgba(255, 215, 0, 0.6)"),a.addColorStop(1,"rgba(255, 165, 0, 0)"),e.fillStyle=a,e.beginPath(),e.arc(t/2,t/2,t/2,0,Math.PI*2),e.fill();const i=e.createLinearGradient(0,0,t,0);i.addColorStop(0,"rgba(0, 255, 255, 0)"),i.addColorStop(.5,"rgba(0, 255, 255, 1.0)"),i.addColorStop(1,"rgba(0, 255, 255, 0)"),e.fillStyle=i,e.fillRect(0,0,t,t),e.globalCompositeOperation="overlay",e.fillStyle="rgba(255, 100, 0, 0.3)",e.fillRect(0,0,t,t),e.globalCompositeOperation="screen",e.fillStyle="rgba(180, 220, 255, 0.4)",e.fillRect(0,0,t,t),e.globalCompositeOperation="source-over",e.shadowBlur=10,e.shadowColor="#ff0000",e.strokeStyle="#ff0000",e.lineWidth=4,e.strokeRect(50,50,t-100,t-100),e.shadowBlur=15,e.shadowColor="#00e5ff",e.fillStyle="#00e5ff",e.beginPath(),e.arc(t/2,t/2,10,0,Math.PI*2),e.fill(),e.shadowBlur=0;const o=document.createElement("canvas");o.width=64,o.height=64;const n=o.getContext("2d");if(n.fillStyle="#ff0000",n.fillRect(0,0,64,64),e.drawImage(o,0,0,32,32,100,100,32,32),typeof OffscreenCanvas<"u"){const s=new OffscreenCanvas(64,64),r=s.getContext("2d");r.fillStyle="#111",r.fillRect(0,0,64,64),e.drawImage(s,0,0)}}},{name:"Beach Sun Flare & Island Glow (Perfect Hit)",requiredTheme:"BEACH",draw:e=>{const t=l.perfectHitTimer,a=V.consecutivePerfectHits,i=l.settings;l.perfectHitTimer=1,V.setMultiplier(3),l.settings={...i,noFlash:!1};for(let o=0;o<3;o++)Zi(e,yo,yo);l.perfectHitTimer=t,V.setMultiplier(a),l.settings=i}},{name:"Space Warp (Perfect Hit)",requiredTheme:"SPACE",draw:e=>{["#ff0000","#ffff00","#00ff00","#ffa500","#ff8c00"].forEach(a=>{const i=document.createElement("canvas");i.width=50,i.height=50;const o=i.getContext("2d"),n=o.createRadialGradient(25,25,2,25,25,6);n.addColorStop(0,"#fff"),n.addColorStop(.3,a),n.addColorStop(1,a),o.fillStyle=n,o.shadowColor=a,o.shadowBlur=10,o.beginPath(),o.arc(25,25,5,0,Math.PI*2),o.fill(),o.shadowBlur=0,e.drawImage(i,0,0)})}},{name:"Monitor Shocked Face",draw:e=>{const t=l.perfectHitTimer;l.perfectHitTimer=1;const a=l.pitcher;l.pitcher={id:"MONITOR"},Co(e,64,64,1),l.perfectHitTimer=t,l.pitcher=a}},{name:"Fireworks Particles",draw:e=>{At.spawnParticles(64,64,"#ff0000"),At.draw(),At.reset()}},{name:"Pitcher Sprites (Current Daily)",draw:e=>{try{const t=l.pitcher||{skinColor:"#ffccaa",gender:"MALE",props:{hatColor:"#e74c3c"}},a=t.skinColor||"#ffccaa",i=t.props||{},o=["IDLE","SET","KICK","THROW"],n=["#ffffff","#ff0000"];o.forEach(s=>{n.forEach(r=>{typeof vo=="function"&&vo(s,r,null,"full",a,i)})}),Co(e,64,64,1)}catch(t){console.warn("[Preloader] Pitcher warmup failed (Non-fatal):",t)}}},{name:"Haunted Mansion Storm",requiredTheme:"HAUNTED",draw:e=>{if(pi){const t=Z||window.innerWidth,a=de||window.innerHeight;pi(t,a)}}}];async function pr(e,t){console.log("[Preloader] Starting effect warmup...");const a=document.createElement("canvas");a.width=512,a.height=512;const i=a.getContext("2d",{willReadFrequently:!0});for(let o=0;o<So.length;o++){if(t&&t.aborted){console.log("[Preloader] Warmup aborted.");break}const n=So[o];if(n.requiredTheme&&n.requiredTheme!==(Y.currentTheme?.id||"CLASSIC")){console.log(`[Preloader] Skipped (not equipped): ${n.name}`);continue}try{if(i.clearRect(0,0,512,512),n.action&&await n.action(),n.draw){n.draw(i);const s=i.getImageData(0,0,1,1).data}console.log(`[Preloader] Warmed up: ${n.name}`)}catch(s){console.warn(`[Preloader] Failed to warmup ${n.name}:`,s)}if(e){const s=Math.round((o+1)/So.length*100);e(s,`Loading: ${n.name}`),await new Promise(r=>setTimeout(r,20))}}a.width=1,a.height=1,console.log("[Preloader] Warmup complete.")}function gs(e){try{l.lastTime===0&&(l.lastTime=e);let t=(e-l.lastTime)*Ds.TIME_SCALE;for(l.lastTime=e,t>100&&(t=100),l.accumulator+=t;l.accumulator>=La;)l.gameActive&&!l.isPaused?(us(La),At.update(La,!1)):!l.gameActive&&l.showFireworks&&At.update(La),l.accumulator-=La;C.clearRect(0,0,Gt.width,Gt.height);const a=l.accumulator/La;l.gameActive||l.transitioning?(Ul(),ol(),cl(),l.balls.forEach(i=>fl(i,a)),zl(),At.draw(),hl(),Qn()):Gl(At),requestAnimationFrame(gs)}catch(t){console.error("CRITICAL GAMELOOP ERROR:",t),l.gameActive=!1}}async function gr(){try{if(typeof window.Capacitor<"u"){const{App:e}=await De(async()=>{const{App:o}=await import("./index-DXYXO7bI.js");return{App:o}},__vite__mapDeps([2,1]),import.meta.url),{StatusBar:t}=await De(async()=>{const{StatusBar:o}=await import("./index-DbeBRm09.js");return{StatusBar:o}},__vite__mapDeps([3,1]),import.meta.url),{SplashScreen:a}=await De(async()=>{const{SplashScreen:o}=await import("./index-BWoUE4Yb.js");return{SplashScreen:o}},__vite__mapDeps([4,1]),import.meta.url),i=async()=>{await t.hide().catch(()=>{}),await a.hide().catch(()=>{})};await i(),e.addListener("appStateChange",({isActive:o})=>{o?(i(),G._checkAndResume()):G.suspendAudio()}),window.addEventListener("touchend",i),window.addEventListener("click",i),e.addListener("backButton",({canGoBack:o})=>{l.gameActive&&!l.isPaused&&!l.isGameOver?Me&&Me.style.display!=="none"&&Me.style.pointerEvents!=="none"&&$a():l.isPaused?$a():Na&&Na.modal.style.display==="flex"?Na.close():aa.isOpen?aa.closeSettings():l.isDailyChallenge&&l.gameActive})}}catch{console.log("Native mode disabled (Web/Browser).")}}const Vn=async()=>{console.log("Game Loading...");let e=document.getElementById("global-loading-overlay");e||(e=document.createElement("div"),e.id="global-loading-overlay",e.style.position="fixed",e.style.top="0",e.style.left="0",e.style.width="100%",e.style.height="100%",e.style.background="rgba(0,0,0,1)",e.style.zIndex="90",e.style.display="block",document.body.appendChild(e)),requestAnimationFrame(()=>{document.body.offsetWidth,ds(),G.init(),requestAnimationFrame(()=>{document.body.classList.add("play-intro"),console.log("[DEBUG] Intro Animation Triggered (Safe)")}),typeof window.Capacitor<"u"&&window.Capacitor.isNativePlatform()&&(setTimeout(()=>G.playIntroReveal(),450),setTimeout(()=>G.playIntroImpact(),1050))}),gr(),console.log("[DEBUG] initGame: Starting..."),ia.init(),console.log("[DEBUG] initGame: Leaderboard Init Called");try{const n=gi.waitForAuth(),s=new Promise((r,d)=>{setTimeout(()=>d(new Error("Auth Timeout")),2e3)});await Promise.race([n,s]),V.fetchServerBalance(),V.validateStartupStreak(),console.log("[DEBUG] initGame: Auth & Sync Complete")}catch(n){console.warn(`[DEBUG] initGame: Auth/Sync skipped (${n.message}). Starting game offline.`)}V.updateCoinDisplay(),Il(),console.log("[DEBUG] initGame: Crowd Generated");const t=setTimeout(()=>{if(l.isLoading&&document.getElementById("global-loading-overlay")){console.warn("Loading taking too long. Showing Failsafe Reset.");const n=document.getElementById("global-loading-overlay");if(document.getElementById("failsafe-reset-btn"))return;const s=document.createElement("button");s.id="failsafe-reset-btn",s.textContent="STUCK? RESET DATA",s.style.marginTop="20px",s.style.padding="10px 20px",s.style.background="#ff4444",s.style.color="white",s.style.border="none",s.style.borderRadius="5px",s.style.cursor="pointer",s.style.fontFamily="inherit",s.style.fontSize="16px",s.style.pointerEvents="auto",s.style.zIndex="10001",s.onclick=()=>{confirm("This will clear your save data and high scores to fix the loading error. Continue?")&&(localStorage.clear(),window.location.reload())},n.appendChild(s)}},5e3),a=new AbortController,i=a.signal;try{console.log("[DEBUG] Starting Preloader...");const n=pr(d=>{},i),s=new Promise(d=>setTimeout(()=>{d("timeout")},3e3));await Promise.race([n,s])==="timeout"?(console.warn("Preloader timed out - Aborting background tasks."),a.abort()):console.log("[DEBUG] Preloader Finished Successfully.")}catch(n){console.error("Preload failed or timed out:",n)}const o=Y.currentTheme;if(o&&o.warmup){console.log(`[DEBUG] Startup: Warming up ${o.id} Cache...`);const n=e.querySelector("div");if(n){const s={HAUNTED:"SUMMONING SPIRITS...",SPACE:"ENTERING ORBIT...",BEACH:"WAXING BOARDS...",CLASSIC:"MOWING GRASS..."};n.innerText=s[o.id]||"LOADING..."}try{const s=window.innerWidth||GAME_WIDTH,r=window.innerHeight||GAME_HEIGHT;o.warmup(s,r)}catch(s){console.warn("Theme warmup failed:",s)}}e.style.transition="opacity 0.5s",requestAnimationFrame(()=>{e.style.opacity="0"}),setTimeout(()=>{clearTimeout(t),e.parentNode&&e.parentNode.removeChild(e),l.isLoading=!1,document.body.classList.add("loading-complete"),typeof window.Capacitor<"u"&&window.Capacitor.isNativePlatform()},800),Et(!1),sa&&(sa.style.display="flex",V.validateStartupStreak(),ps(),sa.addEventListener("click",n=>{n.stopPropagation(),Ee.vibrate("medium"),console.log("Daily Challenge Button Clicked"),ca(!0)}),sa.addEventListener("touchstart",n=>{n.stopPropagation()},{passive:!1})),typeof tt<"u"&&tt&&tt.addEventListener("click",n=>{n.stopPropagation(),Ee.vibrate("medium"),console.log("Feedback Button Clicked: Generating Smart Link...");const s=V.highScore||0,r=localStorage.getItem("baseball_username")||"N/A";let d="Web";typeof window.Capacitor<"u"?d=window.Capacitor.isNativePlatform()?"Android_App":"Web_Mobile":/Mobi|Android/i.test(navigator.userAgent)?d="Mobile_Browser":d="PC_Browser";const f="https://docs.google.com/forms/d/e/1FAIpQLSdYRPa0zwJ1ZpBerKdjKKpuLKunedoiuoMTOEgCjCrfIjDSTw/viewform",c=new URLSearchParams({usp:"pp_url","entry.571653272":s,"entry.612925055":r,"entry.1950205778":d}),p=`${f}?${c.toString()}`;window.open(p,"_blank")}),requestAnimationFrame(gs)};document.readyState==="complete"||document.readyState==="interactive"?Vn():window.addEventListener("load",Vn);window.addEventListener("resize",ds);Ui.init();document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"?(Go.saveProgress(),Lo()):document.visibilityState==="visible"&&Nt.fetchServerTime()});window.addEventListener("pagehide",()=>{Go.saveProgress(),Lo()});export{De as _};
