const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./index-Bw9m61A9.js","./index-DGoMKXoD.js","./index-dbv-4xsI.js","./index-DbeBRm09.js","./index-CEbq_H6s.js"])))=>i.map(i=>d[i]);
(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))a(o);new MutationObserver(o=>{for(const n of o)if(n.type==="childList")for(const s of n.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&a(s)}).observe(document,{childList:!0,subtree:!0});function i(o){const n={};return o.integrity&&(n.integrity=o.integrity),o.referrerPolicy&&(n.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?n.credentials="include":o.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function a(o){if(o.ep)return;o.ep=!0;const n=i(o);fetch(o.href,n)}})();const Tl="modulepreload",bl=function(e,t){return new URL(e,t).href},An={},Le=function(t,i,a){let o=Promise.resolve();if(i&&i.length>0){let f=function(d){return Promise.all(d.map(u=>Promise.resolve(u).then(h=>({status:"fulfilled",value:h}),h=>({status:"rejected",reason:h}))))};const s=document.getElementsByTagName("link"),l=document.querySelector("meta[property=csp-nonce]"),c=l?.nonce||l?.getAttribute("nonce");o=f(i.map(d=>{if(d=bl(d,a),d in An)return;An[d]=!0;const u=d.endsWith(".css"),h=u?'[rel="stylesheet"]':"";if(a)for(let m=s.length-1;m>=0;m--){const p=s[m];if(p.href===d&&(!u||p.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${d}"]${h}`))return;const g=document.createElement("link");if(g.rel=u?"stylesheet":Tl,u||(g.as="script"),g.crossOrigin="",g.href=d,c&&g.setAttribute("nonce",c),document.head.appendChild(g),u)return new Promise((m,p)=>{g.addEventListener("load",m),g.addEventListener("error",()=>p(new Error(`Unable to preload CSS for ${d}`)))})}))}function n(s){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=s,window.dispatchEvent(l),!l.defaultPrevented)throw s}return o.then(s=>{for(const l of s||[])l.status==="rejected"&&n(l.reason);return t().catch(n)})},Ut=document.getElementById("gameCanvas"),C=Ut.getContext("2d",{alpha:!1,desynchronized:!0}),He=document.getElementById("start-screen"),fi=document.getElementById("start-content"),Oe=document.getElementById("score"),Lt=document.getElementById("score-plus"),lt=document.getElementById("coin-display"),Sa=document.getElementById("coin-container"),Ba=document.getElementById("coin-icon"),wi=document.getElementById("coin-plus"),he=document.getElementById("feedback"),wt=document.getElementById("pitch-indicator"),Ga=document.getElementById("debug-console"),Ae=document.getElementById("pause-btn"),jt=document.getElementById("pause-overlay"),ut=document.getElementById("tutorial-volume"),bt=document.getElementById("message-overlay"),Fa=document.getElementById("message-text"),_n=document.getElementById("message-subtext"),Ha=document.getElementById("transition-overlay"),In=document.getElementById("transition-title"),kn=document.getElementById("transition-subtitle"),ot=document.getElementById("feedback-btn"),Ze=document.getElementById("settings-btn"),si=document.getElementById("settings-modal"),Et=document.getElementById("restart-game"),mt=document.getElementById("home-btn"),xe=document.getElementById("unlockables-btn"),Ta=document.getElementById("unlockables-modal"),vl=document.getElementById("close-unlockables"),Dn=document.getElementById("stadium-grid"),da=document.getElementById("bat-grid"),en=document.getElementById("unlockables-coin-display"),Ua=document.getElementById("tab-shop"),za=document.getElementById("tab-collection"),Ln=document.getElementById("shop-tab-content"),On=document.getElementById("collection-tab-content"),ko=document.getElementById("crate-section"),Do=document.getElementById("collection-grid"),Bn=document.getElementById("collection-stats"),Bi=document.getElementById("crate-reveal-overlay"),Wa=document.getElementById("crate-reveal-box"),Na=document.getElementById("crate-reveal-card"),Gn=document.getElementById("crate-reveal-rarity"),Fn=document.getElementById("crate-reveal-icon"),Cl=document.getElementById("crate-reveal-name"),Lo=document.getElementById("crate-reveal-duplicate"),tn=document.getElementById("crate-reveal-actions"),So=document.getElementById("crate-equip-btn"),Hn=document.getElementById("crate-close-btn"),Pl=document.getElementById("close-settings");document.getElementById("crate-odds-modal");document.getElementById("odds-list");document.getElementById("close-odds");const Un=document.getElementById("toggle-release"),zn=document.getElementById("toggle-vibration"),Wn=document.getElementById("toggle-music"),Nn=document.getElementById("toggle-sound"),Vn=document.getElementById("toggle-colorblind"),$n=document.getElementById("toggle-noflash"),St=document.getElementById("leaderboard-btn"),Ki=document.getElementById("leaderboard-modal"),El=document.getElementById("close-leaderboard"),Va=document.getElementById("leaderboard-list"),Ni=document.getElementById("leaderboard-loading"),fa=document.getElementById("personal-best-display"),ha=document.getElementById("name-entry-container"),Vt=document.getElementById("player-name-input"),wl=document.getElementById("submit-name-btn"),Vi=document.getElementById("tab-all-time"),$i=document.getElementById("tab-daily"),$a=document.getElementById("daily-section"),hi=document.getElementById("daily-challenge-btn"),Zi=document.getElementById("daily-cost-container"),To=document.getElementById("daily-cost-value"),ui=document.getElementById("daily-cost-icon"),bo=document.getElementById("daily-streak-value"),Yn=document.getElementById("daily-date"),Oo=document.getElementById("daily-list"),ia=document.createElement("canvas"),Ns=ia.getContext("2d"),ki=document.createElement("canvas"),Rl=ki.getContext("2d"),qt=document.createElement("canvas"),Ml=qt.getContext("2d"),oo=document.createElement("canvas"),ct=oo.getContext("2d"),vo=document.createElement("canvas"),Ue=vo.getContext("2d"),At=document.createElement("canvas"),an=At.getContext("2d");let K=600,de=800;const qn=800,Al=680;function _l(e,t){K=e,de=t}let Fe=0;function Xn(e){Fe=e}const Ca={},Qe=80,ea=20,Pa=20,Il=13,ji=32;function Fi(e){e?(Ae.style.opacity="1",Ae.style.pointerEvents="auto",Ae.style.cursor="pointer"):(Ae.style.opacity="0",Ae.style.pointerEvents="none",Ae.style.cursor="default")}const ht=document.getElementById("daily-retry-modal"),Ht=document.getElementById("retry-cost-display"),Bo=document.getElementById("retry-cancel-btn"),De=document.getElementById("retry-confirm-btn"),Kn=document.getElementById("daily-prev-btn"),Ya=document.getElementById("daily-next-btn"),ti=document.getElementById("security-modal"),Zn=document.getElementById("security-title"),jn=document.getElementById("security-message"),kl=document.getElementById("security-close-btn");document.getElementById("confirmation-modal");document.getElementById("confirm-ok-btn");document.getElementById("confirm-cancel-btn");const Dl=600,Ll=60,Yi=1e3/Ll,Go=-Math.PI/2,qa=-1,Xa=-2.2,F={FASTBALL:"fastball",CURVEBALL:"curveball",CHANGEUP:"changeup",SPLITTER:"splitter",SUPER_FASTBALL:"super_fastball",SUPER_SPLITTER:"super_splitter",GHOSTBALL:"ghostball",STOPBALL:"stopball",STOP_CURVE:"STOP_CURVE",GHOST_CURVE:"GHOST_CURVE",SUPER_CURVE:"SUPER_CURVE",SUPER_ZIGZAG:"super_zigzag",STOP_SPLITTER:"stop_splitter",STOP_ZIGZAG:"stop_zigzag",GHOST_SPLITTER:"ghost_splitter",GHOST_ZIGZAG:"ghost_zigzag",GHOST_CHANGEUP:"ghost_changeup",CURVE_SPLITTER:"curve_splitter",ZIGZAG_SPLITTER:"zigzag_splitter",CURVE_CHANGEUP:"curve_changeup",SPLITTER_CHANGEUP:"splitter_changeup",ZIGZAG_CHANGEUP:"zigzag_changeup",GHOST_STOP:"ghost_stop",GHOST_SUPER:"ghost_super",STOP_SUPER:"stop_super",STOP_CHANGEUP:"stop_changeup",ZIGZAG:"zigzag"},Re=Object.freeze({IDLE:"idle",WINDUP:"windup",PITCHING:"pitching",WALK_OFF:"walk_off",WALK_ON:"walk_on",BACKFLIP:"backflip"}),dt=Object.freeze({BASE_MULTIPLIER:.9,LOG_FACTOR:.6,DAILY_SCORE_OFFSET:150,TRANSITION_SCORE:150,POWER_EXPONENT:.8,POWER_FACTOR:.015}),ke=Object.freeze({BAT_LENGTH:50,BAT_WIDTH:12}),Ol={TIME_SCALE:1},Vs=["#ffccaa","#e0ac69","#d2b48c","#8d5524"],$s=["#ffffff","#e74c3c","#3498db","#f1c40f","#95a5a6","#2ecc71","#9b59b6","#34495e"],Di=function(e){function t(w,E){return w>>>E|w<<32-E}for(var i=Math.pow,a=i(2,32),o="",n=[],s=e.length*8,l=Di.h=Di.h||[],c=Di.k=Di.k||[],f=c.length,d={},u=2;f<64;u++)if(!d[u]){for(var h=0;h<313;h+=u)d[h]=u;l[f]=i(u,.5)*a|0,c[f++]=i(u,1/3)*a|0}for(e+="Â€";e.length%64-56;)e+="\0";for(var h=0;h<e.length;h++){var g=e.charCodeAt(h);if(g>>8)return;n[h>>2]|=g<<(3-h)%4*8}n[n.length]=s/a|0,n[n.length]=s;for(var g=0;g<n.length;){var m=n.slice(g,g+=16),p=l;l=l.slice(0,8);for(var h=0;h<64;h++){var b=m[h-15],v=m[h-2],y=l[0],T=l[4],R=l[7]+(t(T,6)^t(T,11)^t(T,25))+(T&l[5]^~T&l[6])+c[h]+(m[h]=h<16?m[h]:m[h-16]+(t(b,7)^t(b,18)^b>>>3)+m[h-7]+(t(v,17)^t(v,19)^v>>>10)|0),S=(t(y,2)^t(y,13)^t(y,22))+(y&l[1]^y&l[2]^l[1]&l[2]);l=[R+S|0].concat(l),l[4]=l[4]+R|0}for(var h=0;h<8;h++)l[h]=l[h]+p[h]|0}for(var h=0;h<8;h++)for(var g=3;g+1;g--){var P=l[h]>>g*8&255;o+=(P<16?0:"")+P.toString(16)}return o},Bl="94a08da1",Gl="fecbb6e8",Fl="b4699053",Hl="8c7b50b2",Ul="super_baseball_secret_salt_v1_",zl=()=>navigator.userAgent+(window.screen.width+"x"+window.screen.height);class Y{static getSecret(){return Bl+Gl+Fl+Hl}static hash(t,i,a=null){const o=a||this.getSecret(),n=`${t}|${i}|${o}`;return Di(n)}static setItem(t,i){const a=String(i),o=this.hash(t,a),n={d:a,s:o};try{localStorage.setItem(t,JSON.stringify(n))}catch(s){console.warn("SecureStorage: Write failed",s)}}static getItem(t,i=null){const a=localStorage.getItem(t);if(!a)return i;try{const o=JSON.parse(a);if(!o.s||o.d===void 0)return console.warn(`SecureStorage: Invalid envelope for ${t}.`),i;const n=this.hash(t,o.d);if(o.s===n)return o.d;const s=this.hash(t,o.d,Ul);if(o.s===s)return console.log(`SecureStorage: Upgrading ${t} from V1 to V2...`),this.upgrade(t,o.d),o.d;const l=`${t}|${o.d}|${this.getSecret()}|${zl()}`,c=Di(l);return o.s===c?(console.log(`SecureStorage: Recovered ${t} from device-bound payload. Upgrading...`),this.upgrade(t,o.d),o.d):(console.error(`SecureStorage: TAMPER DETECTED for ${t}. Signature mismatch.`),i)}catch{return i}}static upgrade(t,i){setTimeout(()=>{this.setItem(t,i)},0)}static removeItem(t){localStorage.removeItem(t)}static migrate(t){const i=localStorage.getItem(t);if(!i)return;let a=!1;try{const o=JSON.parse(i);o&&o.s&&o.d!==void 0&&(a=!0)}catch{}if(!a){if(t==="baseball_coins"||t==="baseball_local_delta"){const o=parseInt(i),n=1e3;if(isNaN(o)||o>n){console.warn(`SecureStorage: Migration BLOCKED for ${t}. Value ${o} exceeds legacy safety limit (${n}). Resetting to 0.`),this.setItem(t,"0");return}if(o<0){this.setItem(t,"0");return}}console.log(`SecureStorage: Migrating raw legacy data for ${t}...`),this.setItem(t,i)}}static signPayload(t,i,a,o){const n=this.getSecret(),s=`${t}|${i}|${a}|${o}|${n}`;return Di(s)}}const r={gameActive:!1,isPaused:!1,isLoading:!0,showTutorial:!0,tutorialSeen:!1,needsUnlockablesGlow:!1,pendingUnlockablesGlow:!1,settings:{swingOnRelease:!1,vibration:!0,noFlash:!1,muteMusic:!1,muteSound:!1,colorBlindMode:!1},showFireworks:!1,score:0,coins:parseInt(Y.getItem("baseball_coins","0"))||0,highScore:parseInt(Y.getItem("baseball_high_score_s1","0"))||0,initialHighScore:0,totalPitches:0,consecutiveFouls:0,lastTime:0,accumulator:0,isGameOver:!1,lastPitchResult:null,lastSwingTime:0,lastStaticRenderMode:null,bossModeActive:!1,monitorEntranceStartTime:0,isDailyChallenge:!1,dailyRetries:0,dailyStreak:parseInt(Y.getItem("baseball_daily_streak","0"))||0,lastDailyDate:Y.getItem("baseball_last_daily_date")||null,startMessage:{text:"",color:"#ffffff",active:!1,timer:0},pitcher:{id:"ROOKIE",x:0,y:150,width:32,height:32,baseColor:"#ffffff",color:"#ffffff",state:Re.IDLE,timer:0,idleDuration:1e3,windupDuration:1e3,nextPitch:F.FASTBALL,chargeSoundPlayed:!1},bat:{x:0,y:0,angle:Math.PI,swinging:!1,swingSpeed:-.3,pivotX:0,pivotY:0},balls:[]},Fo=Object.freeze(Object.defineProperty({__proto__:null,gameState:r},Symbol.toStringTag,{value:"Module"}));class hn{constructor(t,i,a=10){this.createFn=t,this.resetFn=i,this.pool=[];for(let o=0;o<a;o++)this.pool.push(this.createFn())}get(...t){let i;return this.pool.length>0?i=this.pool.pop():i=this.createFn(),this.resetFn&&this.resetFn(i,...t),i}release(t){this.pool.push(t)}clear(){this.pool=[]}}class ee{static playSwing(t,i){const a=t.currentTime,o=t.createOscillator(),n=t.createGain();o.type="sawtooth",o.frequency.setValueAtTime(200,a),o.frequency.exponentialRampToValueAtTime(100,a+.1),n.gain.setValueAtTime(.15,a),n.gain.exponentialRampToValueAtTime(.01,a+.1),o.connect(n),n.connect(i),o.start(a),o.stop(a+.1)}static playHit(t,i){const a=t.currentTime,o=t.createOscillator(),n=t.createGain();o.type="square",o.frequency.setValueAtTime(800,a),o.frequency.exponentialRampToValueAtTime(200,a+.15),n.gain.setValueAtTime(.3,a),n.gain.exponentialRampToValueAtTime(.01,a+.15),o.connect(n),n.connect(i),o.start(a),o.stop(a+.15)}static playPerfectHit(t,i){const a=t.currentTime,o=[523.25,659.25,783.99,1046.5],n=.1,s=.08;o.forEach((d,u)=>{const h=t.createOscillator(),g=t.createGain(),m=a+u*s;h.type="square",h.frequency.value=d,g.gain.setValueAtTime(.2,m),g.gain.exponentialRampToValueAtTime(.01,m+n),h.connect(g),g.connect(i),h.start(m),h.stop(m+n)});const l=t.createOscillator(),c=t.createGain(),f=a+o.length*s;l.type="triangle",l.frequency.setValueAtTime(1200,f),l.frequency.linearRampToValueAtTime(2e3,f+.3),c.gain.setValueAtTime(.1,f),c.gain.linearRampToValueAtTime(.01,f+.3),l.connect(c),c.connect(i),l.start(f),l.stop(f+.3)}static playGlitchPerfectHit(t,i,a){const o=t.currentTime,n=[523.25,659.25,783.99,1046.5];n.forEach((d,u)=>{const h=t.createOscillator(),g=t.createGain(),m=o+u*.08;h.type="square",h.frequency.setValueAtTime(d,m),h.detune.setValueAtTime(0,m),h.detune.linearRampToValueAtTime(u%2===0?15:-15,m+.1),g.gain.setValueAtTime(.15,m),g.gain.exponentialRampToValueAtTime(.01,m+.15),h.connect(g),g.connect(i),h.start(m),h.stop(m+.2)});const s=.7071;n.forEach((d,u)=>{const h=t.createOscillator(),g=t.createGain(),m=o+u*.08+.04;h.type="sawtooth",h.frequency.setValueAtTime(d*s,m),g.gain.setValueAtTime(.1,m),g.gain.exponentialRampToValueAtTime(.01,m+.3),h.connect(g),g.connect(i),h.start(m),h.stop(m+.4)});const l=t.createOscillator(),c=t.createOscillator(),f=t.createGain();if(l.type="sawtooth",c.type="sawtooth",l.frequency.setValueAtTime(65,o),c.frequency.setValueAtTime(65,o),l.detune.value=-15,c.detune.value=15,f.gain.setValueAtTime(.4,o),f.gain.exponentialRampToValueAtTime(.01,o+1.2),l.connect(f),c.connect(f),f.connect(i),l.start(o),c.start(o),l.stop(o+1.2),c.stop(o+1.2),a){const d=t.createBufferSource();d.buffer=a;const u=t.createGain(),h=t.createBiquadFilter();h.type="lowpass",h.frequency.setValueAtTime(2e3,o),h.frequency.exponentialRampToValueAtTime(100,o+.5),u.gain.setValueAtTime(.3,o+.3),u.gain.exponentialRampToValueAtTime(.01,o+.8),d.connect(h),h.connect(u),u.connect(i),d.start(o),d.stop(o+.8)}}static playFoul(t,i){const a=t.currentTime,o=t.createOscillator(),n=t.createGain();o.type="sawtooth",o.frequency.setValueAtTime(150,a),o.frequency.exponentialRampToValueAtTime(50,a+.3),n.gain.setValueAtTime(.2,a),n.gain.linearRampToValueAtTime(.01,a+.3),o.connect(n),n.connect(i),o.start(a),o.stop(a+.3)}static playPause(t,i,a){const o=t.currentTime,n=t.createOscillator(),s=t.createGain();n.type="square",a?(n.frequency.setValueAtTime(660,o),n.frequency.setValueAtTime(440,o+.1)):(n.frequency.setValueAtTime(440,o),n.frequency.setValueAtTime(660,o+.1)),s.gain.setValueAtTime(.1,o),s.gain.linearRampToValueAtTime(.01,o+.2),n.connect(s),s.connect(i),n.start(o),n.stop(o+.2)}static playSettingsToggle(t,i){const a=t.currentTime,o=t.createOscillator(),n=t.createGain();o.type="square",o.frequency.setValueAtTime(800,a),o.frequency.exponentialRampToValueAtTime(1200,a+.05),n.gain.setValueAtTime(.05,a),n.gain.exponentialRampToValueAtTime(.01,a+.05),o.connect(n),n.connect(i),o.start(a),o.stop(a+.05)}static playSettingsOpen(t,i){const a=t.currentTime,o=t.createOscillator(),n=t.createGain();o.type="square",o.frequency.setValueAtTime(500,a),o.frequency.linearRampToValueAtTime(300,a+.1),n.gain.setValueAtTime(.1,a),n.gain.linearRampToValueAtTime(.01,a+.1),o.connect(n),n.connect(i),o.start(a),o.stop(a+.1)}static playSettingsClose(t,i){const a=t.currentTime,o=t.createOscillator(),n=t.createGain();o.type="square",o.frequency.setValueAtTime(300,a),o.frequency.linearRampToValueAtTime(500,a+.1),n.gain.setValueAtTime(.1,a),n.gain.linearRampToValueAtTime(.01,a+.1),o.connect(n),n.connect(i),o.start(a),o.stop(a+.1)}static playError(t,i){const a=t.currentTime,o=t.createOscillator(),n=t.createGain();o.type="sawtooth",o.frequency.setValueAtTime(150,a),o.frequency.linearRampToValueAtTime(100,a+.15),n.gain.setValueAtTime(.2,a),n.gain.exponentialRampToValueAtTime(.01,a+.15),o.connect(n),n.connect(i),o.start(a),o.stop(a+.15)}static playUnlockablesOpen(t,i){this.playSettingsOpen(t,i)}static playUnlockablesClose(t,i){this.playSettingsClose(t,i)}static playItemAlreadyEquipped(t,i){const a=t.currentTime,o=t.createOscillator(),n=t.createGain();o.type="sine",o.frequency.setValueAtTime(150,a),o.frequency.exponentialRampToValueAtTime(100,a+.1),n.gain.setValueAtTime(.1,a),n.gain.linearRampToValueAtTime(.01,a+.1),o.connect(n),n.connect(i),o.start(a),o.stop(a+.1)}static playStrike(t,i){const a=t.currentTime,o=t.createOscillator(),n=t.createGain();o.type="sawtooth",o.frequency.setValueAtTime(100,a),o.frequency.linearRampToValueAtTime(80,a+.2),n.gain.setValueAtTime(.25,a),n.gain.exponentialRampToValueAtTime(.01,a+.2),o.connect(n),n.connect(i),o.start(a),o.stop(a+.2)}static playStrikesCleared(t,i){const a=t.currentTime,o=t.createOscillator(),n=t.createGain(),s=[349.23,440,523.25,659.25],l=.08;o.type="triangle",s.forEach((c,f)=>{o.frequency.setValueAtTime(c,a+f*l)}),n.gain.setValueAtTime(.1,a),n.gain.setValueAtTime(.1,a+s.length*l),n.gain.exponentialRampToValueAtTime(.01,a+s.length*l+.3),o.connect(n),n.connect(i),o.start(a),o.stop(a+s.length*l+.3)}static playLevelUp(t,i){const a=t.currentTime,o=[440,554,659,880,1108,1318],n=.1,s=.08;o.forEach((l,c)=>{const f=t.createOscillator(),d=t.createGain(),u=a+c*s;f.type="square",f.frequency.value=l,d.gain.setValueAtTime(.1,u),d.gain.linearRampToValueAtTime(.01,u+n),f.connect(d),d.connect(i),f.start(u),f.stop(u+n)})}static playPitch(t,i){const a=t.currentTime,o=t.createOscillator(),n=t.createGain();o.type="sawtooth",o.frequency.setValueAtTime(300,a),o.frequency.exponentialRampToValueAtTime(150,a+.08),n.gain.setValueAtTime(.12,a),n.gain.exponentialRampToValueAtTime(.01,a+.08),o.connect(n),n.connect(i),o.start(a),o.stop(a+.08)}static playCurveCharge(t,i){const a=t.currentTime,o=t.createOscillator(),n=t.createGain(),s=t.createOscillator(),l=t.createGain();o.type="triangle",o.frequency.setValueAtTime(200,a),o.frequency.linearRampToValueAtTime(400,a+.8),s.frequency.value=10,l.gain.value=20,s.connect(l),l.connect(o.frequency),n.gain.setValueAtTime(.1,a),n.gain.linearRampToValueAtTime(.01,a+.8),o.connect(n),n.connect(i),o.start(a),s.start(a),o.stop(a+.8),s.stop(a+.8)}static playChangeCharge(t,i){const a=t.currentTime,o=t.createOscillator(),n=t.createGain();o.type="square",o.frequency.setValueAtTime(100,a),o.frequency.linearRampToValueAtTime(200,a+.8),n.gain.setValueAtTime(.05,a),n.gain.linearRampToValueAtTime(.01,a+.8),o.connect(n),n.connect(i),o.start(a),o.stop(a+.8)}static playSuperCharge(t,i){const a=t.currentTime,o=t.createOscillator(),n=t.createGain();o.type="sawtooth",o.frequency.setValueAtTime(400,a),o.frequency.exponentialRampToValueAtTime(1200,a+.8),n.gain.setValueAtTime(.1,a),n.gain.linearRampToValueAtTime(.01,a+.8),o.connect(n),n.connect(i),o.start(a),o.stop(a+.8)}static playSplitterCharge(t,i){const a=t.currentTime,o=t.createOscillator(),n=t.createGain(),s=t.createOscillator(),l=t.createGain();o.type="sawtooth",o.frequency.setValueAtTime(400,a),o.frequency.exponentialRampToValueAtTime(40,a+.8),s.type="square",s.frequency.setValueAtTime(15,a),s.frequency.linearRampToValueAtTime(60,a+.8),l.gain.value=100,s.connect(l),l.connect(o.frequency),n.gain.setValueAtTime(.2,a),n.gain.linearRampToValueAtTime(.01,a+.8),o.connect(n),n.connect(i),o.start(a),s.start(a),o.stop(a+.8),s.stop(a+.8)}static playZigZagCharge(t,i){const a=t.currentTime,o=t.createOscillator(),n=t.createGain(),s=t.createOscillator(),l=t.createGain();o.type="sine",o.frequency.setValueAtTime(400,a),o.frequency.linearRampToValueAtTime(600,a+.8),s.type="square",s.frequency.value=12,l.gain.value=50,s.connect(l),l.connect(o.frequency),n.gain.setValueAtTime(.15,a),n.gain.linearRampToValueAtTime(.01,a+.8),o.connect(n),n.connect(i),o.start(a),s.start(a),o.stop(a+.8),s.stop(a+.8)}static playStopCharge(t,i){const a=t.currentTime,o=t.createOscillator(),n=t.createGain();o.type="sawtooth",o.frequency.setValueAtTime(100,a),o.frequency.exponentialRampToValueAtTime(300,a+1),n.gain.setValueAtTime(.15,a),n.gain.linearRampToValueAtTime(.01,a+1),o.connect(n),n.connect(i),o.start(a),o.stop(a+1)}static playEvilLaugh(t,i){const a=t.currentTime;[0,.2,.4].forEach((o,n)=>{const s=t.createOscillator(),l=t.createGain();s.type="sawtooth",s.frequency.setValueAtTime(400-n*50,a+o),s.frequency.linearRampToValueAtTime(300-n*50,a+o+.15),l.gain.setValueAtTime(.2,a+o),l.gain.exponentialRampToValueAtTime(.01,a+o+.15),s.connect(l),l.connect(i),s.start(a+o),s.stop(a+o+.15)})}static playGhostCharge(t,i){const a=t.currentTime,o=t.createOscillator(),n=t.createOscillator(),s=t.createGain();o.type="sine",n.type="triangle",o.frequency.setValueAtTime(300,a),o.frequency.linearRampToValueAtTime(600,a+.8),n.frequency.setValueAtTime(305,a),n.frequency.linearRampToValueAtTime(605,a+.8),s.gain.setValueAtTime(.1,a),s.gain.linearRampToValueAtTime(.01,a+.8),o.connect(s),n.connect(s),s.connect(i),o.start(a),n.start(a),o.stop(a+.8),n.stop(a+.8)}static playThud(t,i){const a=t.currentTime;[45,48,90].forEach(l=>{const c=t.createOscillator(),f=t.createGain(),d=t.createBiquadFilter();c.type="sawtooth",c.frequency.value=l,d.type="lowpass",d.frequency.value=200,f.gain.setValueAtTime(0,a),f.gain.linearRampToValueAtTime(.6,a+.05),f.gain.exponentialRampToValueAtTime(.01,a+.25),c.connect(d),d.connect(f),f.connect(i),c.start(a),c.stop(a+.3)});const n=t.createOscillator(),s=t.createGain();n.type="sine",n.frequency.value=30,s.gain.setValueAtTime(.8,a),s.gain.exponentialRampToValueAtTime(.01,a+.3),n.connect(s),s.connect(i),n.start(a),n.stop(a+.3)}static playNormalStep(t,i,a){const o=t.currentTime;if(a){const l=t.createBufferSource();l.buffer=a;const c=t.createBiquadFilter();c.type="lowpass",c.frequency.value=2500;const f=t.createGain();f.gain.setValueAtTime(.5,o),f.gain.exponentialRampToValueAtTime(.01,o+.15),l.connect(c),c.connect(f),f.connect(i),l.start(o),l.stop(o+.15)}const n=t.createOscillator(),s=t.createGain();n.type="triangle",n.frequency.setValueAtTime(100,o),n.frequency.exponentialRampToValueAtTime(50,o+.1),s.gain.setValueAtTime(.5,o),s.gain.exponentialRampToValueAtTime(.01,o+.1),n.connect(s),s.connect(i),n.start(o),n.stop(o+.1)}static playRoar(t,i,a){const o=t.currentTime,n=t.createOscillator(),s=t.createOscillator(),l=t.createGain(),c=t.createGain();n.type="sawtooth",n.frequency.setValueAtTime(150,o),n.frequency.exponentialRampToValueAtTime(50,o+1.5),s.type="square",s.frequency.value=45,l.gain.setValueAtTime(200,o),l.gain.exponentialRampToValueAtTime(50,o+1.5),s.connect(l),l.connect(n.frequency),c.gain.setValueAtTime(0,o),c.gain.linearRampToValueAtTime(.6,o+.1),c.gain.exponentialRampToValueAtTime(.01,o+1.5),n.connect(c),c.connect(i),n.start(o),s.start(o),n.stop(o+1.5),s.stop(o+1.5)}static playBatBreak(t,i){const a=t.currentTime,o=t.createOscillator(),n=t.createGain();o.type="sawtooth",o.frequency.setValueAtTime(150,a),o.frequency.exponentialRampToValueAtTime(50,a+.1),n.gain.setValueAtTime(.5,a),n.gain.exponentialRampToValueAtTime(.01,a+.1),o.connect(n),n.connect(i),o.start(a),o.stop(a+.1);const s=t.createOscillator(),l=t.createGain();s.type="square",s.frequency.value=1e3,l.gain.setValueAtTime(.3,a),l.gain.exponentialRampToValueAtTime(.01,a+.2),s.connect(l),l.connect(i),s.start(a),s.stop(a+.2)}static playFirework(t,i,a){const o=t.currentTime,n=t.createOscillator(),s=t.createGain();if(n.type="square",n.frequency.setValueAtTime(600,o),n.frequency.exponentialRampToValueAtTime(150,o+.4),s.gain.setValueAtTime(.3,o),s.gain.exponentialRampToValueAtTime(.01,o+.3),n.connect(s),s.connect(i),n.start(o),n.stop(o+.4),a){const l=t.createBufferSource();l.buffer=a;const c=t.createGain();c.gain.setValueAtTime(.4,o),c.gain.exponentialRampToValueAtTime(.01,o+.3);const f=t.createBiquadFilter();f.type="lowpass",f.frequency.value=5e3,l.connect(f),f.connect(c),c.connect(i),l.start(o),l.stop(o+.3)}}static playThunder(t,i,a,o=1){if(!a)return;const n=t.currentTime,s=t.createBufferSource();s.buffer=a;const l=t.createBiquadFilter(),c=t.createGain();l.type="lowpass",l.frequency.setValueAtTime(800,n),l.frequency.exponentialRampToValueAtTime(100,n+1.5),c.gain.setValueAtTime(o,n),c.gain.exponentialRampToValueAtTime(.01,n+1.5),s.connect(l),l.connect(c),c.connect(i),s.start(n),s.stop(n+1.5)}static playFanfare(t,i){const a=t.currentTime;[{f:523.25,t:0,d:.15},{f:523.25,t:.15,d:.15},{f:523.25,t:.3,d:.15},{f:659.25,t:.45,d:.3},{f:523.25,t:.75,d:.15},{f:783.99,t:.9,d:.6}].forEach(n=>{const s=t.createOscillator(),l=t.createGain();s.type="sawtooth",s.frequency.setValueAtTime(n.f,a+n.t),l.gain.setValueAtTime(0,a+n.t),l.gain.linearRampToValueAtTime(.2,a+n.t+.05),l.gain.linearRampToValueAtTime(.15,a+n.t+n.d-.05),l.gain.linearRampToValueAtTime(0,a+n.t+n.d),s.connect(l),l.connect(i),s.start(a+n.t),s.stop(a+n.t+n.d)})}static playDigitalEntrance(t,i){const a=t.currentTime,o=1,n=t.createOscillator(),s=t.createGain();n.type="square",n.frequency.setValueAtTime(400,a),n.frequency.exponentialRampToValueAtTime(800,a+.5),n.frequency.exponentialRampToValueAtTime(100,a+1);const l=t.createOscillator(),c=t.createGain();l.type="square",l.frequency.value=30,c.gain.value=50,l.connect(c),c.connect(n.frequency),s.gain.setValueAtTime(0,a),s.gain.linearRampToValueAtTime(.15,a+.1),s.gain.linearRampToValueAtTime(.1,a+.5),s.gain.exponentialRampToValueAtTime(.01,a+o),n.connect(s),s.connect(i),n.start(a),l.start(a),n.stop(a+o),l.stop(a+o);const f=t.createOscillator(),d=t.createGain();f.type="square",f.frequency.setValueAtTime(2e3,a),f.frequency.setValueAtTime(3e3,a+.1),f.frequency.setValueAtTime(2500,a+.2),d.gain.setValueAtTime(.05,a),d.gain.exponentialRampToValueAtTime(.01,a+.3),f.connect(d),d.connect(i),f.start(a),f.stop(a+.3)}static playCheer(t,i,a){if(!a)return;const o=t.currentTime,n=t.createBufferSource();n.buffer=a;const s=t.createBiquadFilter(),l=t.createGain();s.type="bandpass",s.frequency.setValueAtTime(1e3,o),s.Q.value=.5,l.gain.setValueAtTime(0,o),l.gain.linearRampToValueAtTime(.4,o+.5),l.gain.exponentialRampToValueAtTime(.01,o+2),n.connect(s),s.connect(l),l.connect(i),n.start(o),n.stop(o+2)}static playLightStep(t,i){const a=t.currentTime,o=t.createOscillator(),n=t.createGain();o.type="triangle",o.frequency.setValueAtTime(800,a),o.frequency.exponentialRampToValueAtTime(400,a+.05),n.gain.setValueAtTime(.1,a),n.gain.exponentialRampToValueAtTime(.01,a+.05),o.connect(n),n.connect(i),o.start(a),o.stop(a+.05)}static playAceStep(t,i,a){const o=t.currentTime;if(a){const l=t.createBufferSource();l.buffer=a;const c=t.createBiquadFilter();c.type="lowpass",c.frequency.value=1200;const f=t.createGain();f.gain.setValueAtTime(.4,o),f.gain.exponentialRampToValueAtTime(.01,o+.12),l.connect(c),c.connect(f),f.connect(i),l.start(o),l.stop(o+.12)}const n=t.createOscillator(),s=t.createGain();n.type="sine",n.frequency.setValueAtTime(80,o),n.frequency.exponentialRampToValueAtTime(40,o+.1),s.gain.setValueAtTime(.3,o),s.gain.exponentialRampToValueAtTime(.01,o+.1),n.connect(s),s.connect(i),n.start(o),n.stop(o+.1)}static playAceEntrance(t,i){const a=t.currentTime;[261.63,329.63,392,493.88,587.33].forEach((n,s)=>{const l=t.createOscillator(),c=t.createGain(),f=t.createOscillator(),d=t.createGain();f.type="sine",f.frequency.value=n*.5,d.gain.value=100,f.connect(d),d.connect(l.frequency),l.type="sine",l.frequency.setValueAtTime(n,a),c.gain.setValueAtTime(0,a),c.gain.linearRampToValueAtTime(.1,a+.2),c.gain.exponentialRampToValueAtTime(.01,a+1.5),l.connect(c),c.connect(i),l.start(a),f.start(a),l.stop(a+1.5),f.stop(a+1.5)})}static playWoosh(t,i,a){if(!a)return;const o=t.currentTime,n=t.createBufferSource();n.buffer=a;const s=t.createBiquadFilter(),l=t.createGain();s.type="bandpass",s.frequency.setValueAtTime(400,o),s.frequency.exponentialRampToValueAtTime(1200,o+.3),s.frequency.exponentialRampToValueAtTime(200,o+.8),s.Q.value=1,l.gain.setValueAtTime(0,o),l.gain.linearRampToValueAtTime(.4,o+.2),l.gain.linearRampToValueAtTime(.01,o+.8),n.connect(s),s.connect(l),l.connect(i),n.start(o),n.stop(o+.8)}static playKick(t,i,a){const o=t.createOscillator(),n=t.createGain();o.frequency.setValueAtTime(150,a),o.frequency.exponentialRampToValueAtTime(.01,a+.5),n.gain.setValueAtTime(.8,a),n.gain.exponentialRampToValueAtTime(.01,a+.5),o.connect(n),n.connect(i),o.start(a),o.stop(a+.5)}static playSnare(t,i,a,o){if(!o)return;const n=t.createBufferSource();n.buffer=o;const s=t.createGain();s.gain.setValueAtTime(.4,a),s.gain.exponentialRampToValueAtTime(.01,a+.2),n.connect(s),s.connect(i),n.start(a),n.stop(a+.2);const l=t.createOscillator(),c=t.createGain();l.frequency.setValueAtTime(250,a),l.frequency.exponentialRampToValueAtTime(100,a+.1),c.gain.setValueAtTime(.3,a),c.gain.exponentialRampToValueAtTime(.01,a+.1),l.connect(c),c.connect(i),l.start(a),l.stop(a+.1)}static playHiHat(t,i,a,o){if(!o)return;const n=t.createBufferSource();n.buffer=o;const s=t.createBiquadFilter();s.type="highpass",s.frequency.value=8e3;const l=t.createGain();l.gain.setValueAtTime(.15,a),l.gain.exponentialRampToValueAtTime(.01,a+.05),n.connect(s),s.connect(l),l.connect(i),n.start(a),n.stop(a+.05)}static playBassNote(t,i,a,o,n){const s=t.createOscillator(),l=t.createGain();s.type="triangle",s.frequency.setValueAtTime(a,o),l.gain.setValueAtTime(.5,o),l.gain.exponentialRampToValueAtTime(.01,o+n),s.connect(l),l.connect(i),s.start(o),s.stop(o+n)}static playMelodyNote(t,i,a,o,n){const s=t.createOscillator(),l=t.createGain();s.type="square",s.frequency.setValueAtTime(a,o),l.gain.setValueAtTime(.05,o),l.gain.exponentialRampToValueAtTime(.01,o+n-.05);const c=t.createOscillator(),f=t.createGain();c.type="sawtooth",c.frequency.setValueAtTime(a-2,o),f.gain.setValueAtTime(.03,o),f.gain.exponentialRampToValueAtTime(.01,o+n-.05),s.connect(l),l.connect(i),s.start(o),s.stop(o+n),c.connect(f),f.connect(i),c.start(o),c.stop(o+n)}static _playBopSound(t,i,a,o){const n=t.createOscillator(),s=t.createGain();n.type="sine",n.frequency.setValueAtTime(400,a),n.frequency.exponentialRampToValueAtTime(300,a+.3),s.gain.setValueAtTime(o,a),s.gain.exponentialRampToValueAtTime(.01,a+.3),n.connect(s),s.connect(i),n.start(a),n.stop(a+.35)}static playEquip(t,i){this._playBopSound(t,i,t.currentTime,.3)}static playPurchase(t,i){const a=t.currentTime;[1200,1500,1800,2200].forEach((s,l)=>{const c=t.createOscillator(),f=t.createGain(),d=a+l*.05;c.type="sine",c.frequency.setValueAtTime(s,d),f.gain.setValueAtTime(.1,d),f.gain.exponentialRampToValueAtTime(.01,d+.1),c.connect(f),f.connect(i),c.start(d),c.stop(d+.1)}),[523.25,659.25,783.99,1046.5].forEach((s,l)=>{const c=t.createOscillator(),f=t.createGain();c.type="triangle",c.frequency.setValueAtTime(s,a),f.gain.setValueAtTime(0,a),f.gain.linearRampToValueAtTime(.1,a+.1),f.gain.exponentialRampToValueAtTime(.01,a+.6),c.connect(f),f.connect(i),c.start(a),c.stop(a+.6)})}static playZigZag(t,i){const a=t.currentTime,o=t.createOscillator(),n=t.createGain(),s=t.createOscillator(),l=t.createGain();o.type="square",o.frequency.setValueAtTime(800,a),o.frequency.exponentialRampToValueAtTime(100,a+.5),s.type="sawtooth",s.frequency.value=60,l.gain.value=500,s.connect(l),l.connect(o.frequency),n.gain.setValueAtTime(.3,a),n.gain.exponentialRampToValueAtTime(.01,a+.5),o.connect(n),n.connect(i),o.start(a),o.stop(a+.5),s.start(a),s.stop(a+.5)}static playTheme(t,i,a){const s=.6382978723404256/4,l=261.63,c=293.66,f=329.63,d=392,u=440,h=523.25,g=65.41,m=87.31,p=98,b=110,v={K:[1,0,0,1,0,0,1,0,0,0,1,0,0,1,0,0],S:[0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0],H:[1,0,1,0,1,0,1,0,1,0,1,0,1,1,1,0]},y={0:{note:l,len:2},2:{note:h,len:2},4:{note:u,len:2},6:{note:d,len:2},8:{note:f,len:2},10:{note:d,len:2},12:{note:c,len:8},32:{note:l,len:2},34:{note:h,len:2},36:{note:u,len:2},38:{note:d,len:2},40:{note:f,len:2},42:{note:d,len:2},44:{note:u,len:8}},T={0:{note:g,len:3},3:{note:g,len:1},4:{note:g,len:2},7:{note:m,len:1},8:{note:p,len:4},14:{note:p,len:2},16:{note:g,len:3},20:{note:g,len:2},24:{note:p,len:4},30:{note:b,len:2},32:{note:m,len:3},36:{note:m,len:2},40:{note:g,len:4},46:{note:g,len:2},48:{note:p,len:3},52:{note:p,len:2},56:{note:g,len:4},62:{note:g,len:2}};let R=0,S=t.currentTime;const P=typeof a=="object"?a:null;return(function w(){for(S<t.currentTime-.2&&(S=t.currentTime);S<t.currentTime+.1;){const E=R%16,M=R%64;if(v.K[E]&&ee.playKick(t,i,S),v.S[E]&&ee.playSnare(t,i,S,P),v.H[E]&&ee.playHiHat(t,i,S,P),y[M]){const D=y[M];ee.playMelodyNote(t,i,D.note,S,D.len*s)}if(T[M]){const D=T[M];ee.playBassNote(t,i,D.note,S,D.len*s)}S+=s,R++}return setTimeout(w,25)})()}static playHauntedTheme(t,i,a){const s=.6382978723404256/4,l=261.63,c=293.66,f=311.13,d=392,u=415.3,h=523.25,g=65.41,m=98,p=87.31,b={0:{note:l,len:4},4:{note:h,len:4},8:{note:u,len:4},12:{note:d,len:4},16:{note:f,len:4},20:{note:d,len:4},24:{note:c,len:12},48:{note:l,len:4},52:{note:h,len:4},56:{note:u,len:4},60:{note:d,len:4},64:{note:f,len:4},68:{note:d,len:4},72:{note:u,len:12}},v={0:{note:g,len:6},12:{note:m,len:6},24:{note:m,len:6},36:{note:g,len:6},48:{note:g,len:6},60:{note:g,len:6},72:{note:p,len:6},84:{note:m,len:6}};let y=0,T=t.currentTime;const R=typeof a=="object"?a:null,S=(E,M,D)=>{const I=t.createOscillator(),H=t.createGain(),k=t.createOscillator(),O=t.createGain();I.type="triangle",I.frequency.setValueAtTime(E,M),k.frequency.value=4.5,O.gain.value=6,k.connect(O),O.connect(I.frequency),H.gain.setValueAtTime(0,M),H.gain.linearRampToValueAtTime(.12,M+.05),H.gain.exponentialRampToValueAtTime(.08,M+D-.1),H.gain.linearRampToValueAtTime(0,M+D),I.connect(H),H.connect(i),I.start(M),k.start(M),I.stop(M+D),k.stop(M+D)},P=(E,M,D)=>{const I=t.createOscillator(),H=t.createGain();I.type="sawtooth",I.frequency.setValueAtTime(E,M);const k=t.createBiquadFilter();k.type="lowpass",k.frequency.value=150,H.gain.setValueAtTime(.15,M),H.gain.exponentialRampToValueAtTime(.01,M+D),I.connect(k),k.connect(H),H.connect(i),I.start(M),I.stop(M+D)},w=E=>{if(!R)return;const M=t.createBufferSource();M.buffer=R;const D=t.createBiquadFilter();D.type="lowpass",D.frequency.setValueAtTime(200,E),D.frequency.linearRampToValueAtTime(600,E+2),D.frequency.linearRampToValueAtTime(100,E+4);const I=t.createGain();I.gain.setValueAtTime(0,E),I.gain.linearRampToValueAtTime(.1,E+1),I.gain.linearRampToValueAtTime(0,E+4),M.connect(D),D.connect(I),I.connect(i),M.start(E),M.stop(E+4)};return(function E(){for(T<t.currentTime-.2&&(T=t.currentTime);T<t.currentTime+.1;){const M=y%96;if(M%48===0&&w(T),b[M]){const D=b[M];S(D.note,T,D.len*s)}if(v[M]){const D=v[M];P(D.note,T,D.len*s)}T+=s,y++}return setTimeout(E,25)})()}static playIntroReveal(t,i){this.playPerfectHit(t,i)}static playIntroImpact(t,i){const a=t.currentTime,o=t.createOscillator(),n=t.createGain();o.type="sine",o.frequency.setValueAtTime(120,a),o.frequency.exponentialRampToValueAtTime(30,a+.5),n.gain.setValueAtTime(.8,a),n.gain.exponentialRampToValueAtTime(.01,a+.5),o.connect(n),n.connect(i),o.start(a),o.stop(a+.5);const s=t.sampleRate*.2,l=t.createBuffer(1,s,t.sampleRate),c=l.getChannelData(0);for(let h=0;h<s;h++)c[h]=Math.random()*2-1;const f=t.createBufferSource();f.buffer=l;const d=t.createBiquadFilter();d.type="lowpass",d.frequency.setValueAtTime(800,a),d.frequency.exponentialRampToValueAtTime(100,a+.2);const u=t.createGain();u.gain.setValueAtTime(.6,a),u.gain.exponentialRampToValueAtTime(.01,a+.2),f.connect(d),d.connect(u),u.connect(i),f.start(a),f.stop(a+.2)}}class Wl{constructor(){this.audioContext=null,this.initialized=!1,this.themeOscillators=[],this.themeTimer=null,this.themePlaying=!1,this.noiseBuffer=null,this.masterGain=null,this.themeGain=null}init(){return this.initialized?Promise.resolve():(document.addEventListener("visibilitychange",()=>this._handleVisibilityChange()),window.addEventListener("pageshow",()=>this._handleVisibilityChange()),document.addEventListener("touchstart",()=>this._handleInteraction()),document.addEventListener("click",()=>this._handleInteraction()),new Promise(t=>{try{this.audioContext=new(window.AudioContext||window.webkitAudioContext),this.masterGain=this.audioContext.createGain(),this.masterGain.connect(this.audioContext.destination),this.audioContext.resume().catch(()=>{}),this._finishInit(),t()}catch{console.warn("Web Audio API not supported"),t()}}))}_handleVisibilityChange(){document.hidden?this.suspendAudio():this._checkAndResume()}_handleInteraction(){this._checkAndResume()}_checkAndResume(){this.audioContext&&this.audioContext.state==="running"||this.audioContext&&(this.audioContext.state==="suspended"||this.audioContext.state==="interrupted")&&this.audioContext.resume().catch(()=>{})}suspendAudio(){this.audioContext&&this.audioContext.state==="running"&&this.audioContext.suspend().catch(()=>{})}_finishInit(){if(this.initialized)return;const t=this.audioContext.createBuffer(1,1,22050),i=this.audioContext.createBufferSource();i.buffer=t,i.connect(this.audioContext.destination),i.start(0);const a=this.audioContext.createOscillator(),o=this.audioContext.createGain();a.type="sine",a.frequency.value=1,o.gain.value=1e-4,a.connect(o),o.connect(this.audioContext.destination),a.start(0),this.initialized=!0}_createNoiseBuffer(){if(this.noiseBuffer)return;const t=this.audioContext.sampleRate*2,i=this.audioContext.createBuffer(1,t,this.audioContext.sampleRate),a=i.getChannelData(0);for(let o=0;o<t;o++)a[o]=Math.random()*2-1;this.noiseBuffer=i}warmup(){if(!this.initialized)return;const t=this.audioContext,i=t.currentTime;console.log("[SoundManager] Warming up DSP (Safe Mode)..."),["sawtooth","square","triangle","sine"].forEach(a=>{const o=t.createOscillator(),n=t.createGain();o.type=a,o.frequency.value=440,n.gain.value=0,o.connect(n),n.connect(this.masterGain),o.start(i),o.stop(i+.05)});for(let a=0;a<5;a++){const o=t.createOscillator(),n=t.createGain();o.type="square",n.gain.value=0,o.connect(n),n.connect(this.masterGain),o.start(i),o.stop(i+.05)}this.noiseBuffer||this._createNoiseBuffer()}playSwing(){r.settings?.muteSound||!this.initialized||ee.playSwing(this.audioContext,this.masterGain)}playPause(t){r.settings?.muteSound||!this.initialized||ee.playPause(this.audioContext,this.masterGain,t)}playHit(){r.settings?.muteSound||!this.initialized||ee.playHit(this.audioContext,this.masterGain)}playPerfectHit(t){r.settings?.muteSound||!this.initialized||(t==="GLITCH"?(this.noiseBuffer||this._createNoiseBuffer(),ee.playGlitchPerfectHit(this.audioContext,this.masterGain,this.noiseBuffer)):ee.playPerfectHit(this.audioContext,this.masterGain))}playFoul(){r.settings?.muteSound||!this.initialized||ee.playFoul(this.audioContext,this.masterGain)}playStrike(){r.settings?.muteSound||!this.initialized||ee.playStrike(this.audioContext,this.masterGain)}playStrikesCleared(){r.settings?.muteSound||!this.initialized||ee.playStrikesCleared(this.audioContext,this.masterGain)}playLevelUp(){r.settings?.muteSound||!this.initialized||ee.playLevelUp(this.audioContext,this.masterGain)}playPitch(){r.settings?.muteSound||!this.initialized||ee.playPitch(this.audioContext,this.masterGain)}playCurveCharge(){r.settings?.muteSound||!this.initialized||ee.playCurveCharge(this.audioContext,this.masterGain)}playChangeCharge(){r.settings?.muteSound||!this.initialized||ee.playChangeCharge(this.audioContext,this.masterGain)}playSuperCharge(){r.settings?.muteSound||!this.initialized||ee.playSuperCharge(this.audioContext,this.masterGain)}playSplitterCharge(){r.settings?.muteSound||!this.initialized||ee.playSplitterCharge(this.audioContext,this.masterGain)}playZigZagCharge(){r.settings?.muteSound||!this.initialized||ee.playZigZagCharge(this.audioContext,this.masterGain)}playStopCharge(){r.settings?.muteSound||!this.initialized||ee.playStopCharge(this.audioContext,this.masterGain)}stopTheme(){if(this.themePlaying=!1,this.themeTimer&&(clearTimeout(this.themeTimer),this.themeTimer=null),this.themeGain){const t=this.audioContext.currentTime;this.themeGain.gain.cancelScheduledValues(t),this.themeGain.gain.setValueAtTime(this.themeGain.gain.value,t),this.themeGain.gain.linearRampToValueAtTime(0,t+.05),setTimeout(()=>{!this.themePlaying&&this.themeGain&&(this.themeGain.disconnect(),this.themeGain=null)},100)}}playEvilLaugh(){r.settings?.muteSound||!this.initialized||ee.playEvilLaugh(this.audioContext,this.masterGain)}playGhostCharge(){r.settings?.muteSound||!this.initialized||ee.playGhostCharge(this.audioContext,this.masterGain)}playThud(){r.settings?.muteSound||!this.initialized||ee.playThud(this.audioContext,this.masterGain)}playNormalStep(){r.settings?.muteSound||!this.initialized||(this.noiseBuffer||this._createNoiseBuffer(),ee.playNormalStep(this.audioContext,this.masterGain,this.noiseBuffer))}playRoar(){r.settings?.muteSound||!this.initialized||(this.noiseBuffer||this._createNoiseBuffer(),ee.playRoar(this.audioContext,this.masterGain,this.noiseBuffer))}playBatBreak(){r.settings?.muteSound||!this.initialized||ee.playBatBreak(this.audioContext,this.masterGain)}playFirework(){r.settings?.muteSound||!this.initialized||(this.noiseBuffer||this._createNoiseBuffer(),ee.playFirework(this.audioContext,this.masterGain,this.noiseBuffer))}playSettingsOpen(){r.settings?.muteSound||!this.initialized||ee.playSettingsOpen(this.audioContext,this.masterGain)}playSettingsClose(){r.settings?.muteSound||!this.initialized||ee.playSettingsClose(this.audioContext,this.masterGain)}playSettingsToggle(){r.settings?.muteSound||!this.initialized||ee.playSettingsToggle(this.audioContext,this.masterGain)}playUnlockablesOpen(){r.settings?.muteSound||!this.initialized||ee.playUnlockablesOpen(this.audioContext,this.masterGain)}playUnlockablesClose(){r.settings?.muteSound||!this.initialized||ee.playUnlockablesClose(this.audioContext,this.masterGain)}playItemAlreadyEquipped(){r.settings?.muteSound||!this.initialized||(this.audioContext.state==="suspended"&&this.audioContext.resume(),ee.playItemAlreadyEquipped(this.audioContext,this.masterGain))}playEquip(){if(r.settings?.muteSound||!this.audioContext&&!this.initialized)return;const t=this.audioContext;t&&t.state==="suspended"&&t.resume(),t&&ee.playEquip(t,this.masterGain)}playZigZag(){r.settings?.muteSound||!this.initialized||ee.playZigZag(this.audioContext,this.masterGain)}playPurchase(){r.settings?.muteSound||!this.initialized||ee.playPurchase(this.audioContext,this.masterGain)}playError(){r.settings?.muteSound||!this.initialized||ee.playError(this.audioContext,this.masterGain)}playThunder(t=1){r.settings?.muteSound||!this.initialized||(this.noiseBuffer||this._createNoiseBuffer(),ee.playThunder(this.audioContext,this.masterGain,this.noiseBuffer,t))}playFanfare(){r.settings?.muteSound||!this.initialized||ee.playFanfare(this.audioContext,this.masterGain)}playCheer(){r.settings?.muteSound||!this.initialized||(this.noiseBuffer||this._createNoiseBuffer(),ee.playCheer(this.audioContext,this.masterGain,this.noiseBuffer))}playLightStep(){r.settings?.muteSound||!this.initialized||ee.playLightStep(this.audioContext,this.masterGain)}playAceStep(){r.settings?.muteSound||!this.initialized||(this.noiseBuffer||this._createNoiseBuffer(),ee.playAceStep(this.audioContext,this.masterGain,this.noiseBuffer))}playAceEntrance(){r.settings?.muteSound||!this.initialized||ee.playAceEntrance(this.audioContext,this.masterGain)}playWoosh(){r.settings?.muteSound||!this.initialized||(this.noiseBuffer||this._createNoiseBuffer(),ee.playWoosh(this.audioContext,this.masterGain,this.noiseBuffer))}playDigitalEntrance(){r.settings?.muteSound||!this.initialized||ee.playDigitalEntrance(this.audioContext,this.masterGain)}playTheme(){r.settings?.muteMusic||!this.initialized||this.themePlaying||(this.themePlaying=!0,this.themeGain&&this.themeGain.disconnect(),this.themeGain=this.audioContext.createGain(),this.themeGain.gain.value=1,this.themeGain.connect(this.masterGain),this.noiseBuffer||this._createNoiseBuffer(),this.themeTimer=ee.playTheme(this.audioContext,this.themeGain,this.noiseBuffer))}playHauntedTheme(){r.settings?.muteMusic||!this.initialized||this.themePlaying||(this.themePlaying=!0,this.themeGain&&this.themeGain.disconnect(),this.themeGain=this.audioContext.createGain(),this.themeGain.gain.value=.8,this.themeGain.connect(this.masterGain),this.noiseBuffer||this._createNoiseBuffer(),this.themeTimer=ee.playHauntedTheme(this.audioContext,this.themeGain,this.noiseBuffer))}playIntroSlam(){r.settings?.muteSound||!this.initialized||ee.playIntroSlam(this.audioContext,this.masterGain)}playIntroReveal(){r.settings?.muteSound||!this.initialized||ee.playIntroReveal(this.audioContext,this.masterGain)}playIntroImpact(){r.settings?.muteSound||!this.initialized||ee.playIntroImpact(this.audioContext,this.masterGain)}}const L=new Wl,Jn={[F.STOPBALL]:(e,t)=>{const i=r.bat.pivotY-e.startY,o=(e.y-e.startY)/i;return!e.hasPaused&&o>=.5&&(e.hasPaused=!0,e.pauseTimer=400),e.pauseTimer>0?(e.pauseTimer-=t,e.prevX=e.x,e.prevY=e.y,e.prevRotationAngle=e.rotationAngle,!0):!1},[F.GHOSTBALL]:(e,t)=>{const i=r.bat.pivotY-e.startY,o=(e.y-e.startY)/i;return o>.4&&o<.7?e.invisible=!0:e.invisible=!1,!1},[F.STOP_CURVE]:(e,t)=>{const i=r.bat.pivotY-e.startY,a=e.y-e.startY,o=a/i;if(!e.hasPaused&&o>=.5&&(e.hasPaused=!0,e.pauseTimer=400),e.pauseTimer>0)return e.pauseTimer-=t,e.prevX=e.x,e.prevY=e.y,e.prevRotationAngle=e.rotationAngle,!0;const n=Math.max(0,Math.min(1,a/i));let s=0;if(n<.75){const l=n/.75*Math.PI;s=Math.sin(l)*50,s=s*e.curveDirection}return e.x=e.startX+s,!1},[F.GHOST_CURVE]:(e,t)=>{const i=r.bat.pivotY-e.startY,a=e.y-e.startY,o=a/i;o>.4&&o<.7?e.invisible=!0:e.invisible=!1;const n=Math.max(0,Math.min(1,a/i));let s=0;if(n<.75){const l=n/.75*Math.PI;s=Math.sin(l)*50,s=s*e.curveDirection}return e.x=e.startX+s,!1},[F.SPLITTER]:(e,t)=>{const i=r.bat.pivotY-e.startY;return(e.y-e.startY)/i>.2?e.speedY=e.baseSpeedY*2.6:e.speedY=e.baseSpeedY*.6,!1},[F.CURVEBALL]:(e,t)=>{const i=r.bat.pivotY-e.startY,a=e.y-e.startY,o=Math.max(0,Math.min(1,a/i));let n=0;if(o<.75){const s=o/.75*Math.PI;n=Math.sin(s)*50,n=n*e.curveDirection}return e.x=e.startX+n,!1},[F.ZIGZAG]:(e,t)=>{const i=r.bat.pivotY-e.startY,a=e.y-e.startY,o=Math.max(0,Math.min(1,a/i));let n=0;return o<.25?n=o/.25*75:o<.5?n=75-(o-.25)/.25*150:o<.75?n=-75+(o-.5)/.25*75:n=0,e.x=e.startX+n*e.curveDirection,!1},[F.SUPER_CURVE]:(e,t)=>{const i=r.bat.pivotY-e.startY,a=e.y-e.startY,o=Math.max(0,Math.min(1,a/i));let n=0;if(o<.75){const s=o/.75*Math.PI;n=Math.sin(s)*75,n=n*e.curveDirection}return e.x=e.startX+n,!1},[F.SUPER_ZIGZAG]:(e,t)=>{const i=r.bat.pivotY-e.startY,a=e.y-e.startY,o=Math.max(0,Math.min(1,a/i));let n=0;return o<.25?n=o/.25*75:o<.5?n=75-(o-.25)/.25*150:o<.75?n=-75+(o-.5)/.25*75:n=0,e.x=e.startX+n*e.curveDirection,!1},[F.SUPER_SPLITTER]:(e,t)=>{const i=r.bat.pivotY-e.startY;return(e.y-e.startY)/i>.2?e.speedY=e.baseSpeedY*2.6:e.speedY=e.baseSpeedY*.6,!1},[F.STOP_SPLITTER]:(e,t)=>{const i=r.bat.pivotY-e.startY,o=(e.y-e.startY)/i;return!e.hasPaused&&o>=.5&&(e.hasPaused=!0,e.pauseTimer=400),e.pauseTimer>0?(e.pauseTimer-=t,e.prevX=e.x,e.prevY=e.y,e.prevRotationAngle=e.rotationAngle,!0):(o>.2?e.speedY=e.baseSpeedY*2.6:e.speedY=e.baseSpeedY*.6,!1)},[F.STOP_ZIGZAG]:(e,t)=>{const i=r.bat.pivotY-e.startY,a=e.y-e.startY,o=Math.max(0,Math.min(1,a/i));if(!e.hasPaused&&o>=.5&&(e.hasPaused=!0,e.pauseTimer=400),e.pauseTimer>0)return e.pauseTimer-=t,e.prevX=e.x,e.prevY=e.y,e.prevRotationAngle=e.rotationAngle,!0;let n=0;o<.25?n=o/.25*75:o<.5?n=75-(o-.25)/.25*150:o<.75?n=-75+(o-.5)/.25*75:n=0,e.x=e.startX+n*e.curveDirection},[F.GHOST_SPLITTER]:(e,t)=>{const i=r.bat.pivotY-e.startY,o=(e.y-e.startY)/i;return o>.4&&o<.7?e.invisible=!0:e.invisible=!1,o>.2?e.speedY=e.baseSpeedY*2.6:e.speedY=e.baseSpeedY*.6,!1},[F.GHOST_ZIGZAG]:(e,t)=>{const i=r.bat.pivotY-e.startY,a=e.y-e.startY,o=Math.max(0,Math.min(1,a/i));o>.4&&o<.7?e.invisible=!0:e.invisible=!1;let n=0;return o<.25?n=o/.25*75:o<.5?n=75-(o-.25)/.25*150:o<.75?n=-75+(o-.5)/.25*75:n=0,e.x=e.startX+n*e.curveDirection,!1},[F.GHOST_CHANGEUP]:(e,t)=>{const i=r.bat.pivotY-e.startY,o=(e.y-e.startY)/i;return o>.4&&o<.7?e.invisible=!0:e.invisible=!1,!1},[F.CURVE_SPLITTER]:(e,t)=>{const i=r.bat.pivotY-e.startY,a=e.y-e.startY,o=Math.max(0,Math.min(1,a/i));let n=0;if(o<.75){const s=o/.75*Math.PI;n=Math.sin(s)*50,n=n*e.curveDirection}return e.x=e.startX+n,o>.2?e.speedY=e.baseSpeedY*2.6:e.speedY=e.baseSpeedY*.6,!1},[F.ZIGZAG_SPLITTER]:(e,t)=>{const i=r.bat.pivotY-e.startY,a=e.y-e.startY,o=Math.max(0,Math.min(1,a/i));let n=0;return o<.25?n=o/.25*75:o<.5?n=75-(o-.25)/.25*150:o<.75?n=-75+(o-.5)/.25*75:n=0,e.x=e.startX+n*e.curveDirection,o>.2?e.speedY=e.baseSpeedY*2.6:e.speedY=e.baseSpeedY*.6,!1},[F.CURVE_CHANGEUP]:(e,t)=>{const i=r.bat.pivotY-e.startY,a=e.y-e.startY,o=Math.max(0,Math.min(1,a/i));let n=0;if(o<.75){const s=o/.75*Math.PI;n=Math.sin(s)*50,n=n*e.curveDirection}return e.x=e.startX+n,!1},[F.SPLITTER_CHANGEUP]:(e,t)=>{const i=r.bat.pivotY-e.startY;return(e.y-e.startY)/i>.2?e.speedY=e.baseSpeedY*2.5:e.speedY=e.baseSpeedY*.6,!1},[F.ZIGZAG_CHANGEUP]:(e,t)=>{const i=r.bat.pivotY-e.startY,a=e.y-e.startY,o=Math.max(0,Math.min(1,a/i));let n=0;return o<.25?n=o/.25*75:o<.5?n=75-(o-.25)/.25*150:o<.75?n=-75+(o-.5)/.25*75:n=0,e.x=e.startX+n*e.curveDirection,!1},[F.GHOST_STOP]:(e,t)=>{const i=r.bat.pivotY-e.startY,a=e.y-e.startY,o=Math.max(0,Math.min(1,a/i));return o>.4&&o<.7?e.invisible=!0:e.invisible=!1,!e.hasPaused&&o>=.5&&(e.hasPaused=!0,e.pauseTimer=400),e.pauseTimer>0?(e.pauseTimer-=t,e.prevX=e.x,e.prevY=e.y,e.prevRotationAngle=e.rotationAngle,!0):!1},[F.GHOST_SUPER]:(e,t)=>{const i=r.bat.pivotY-e.startY,a=e.y-e.startY,o=Math.max(0,Math.min(1,a/i));return o>.4&&o<.7?e.invisible=!0:e.invisible=!1,!1},[F.STOP_SUPER]:(e,t)=>{const i=r.bat.pivotY-e.startY,a=e.y-e.startY,o=Math.max(0,Math.min(1,a/i));return!e.hasPaused&&o>=.5&&(e.hasPaused=!0,e.pauseTimer=400),e.pauseTimer>0?(e.pauseTimer-=t,e.prevX=e.x,e.prevY=e.y,e.prevRotationAngle=e.rotationAngle,!0):!1},[F.STOP_CHANGEUP]:(e,t)=>{const i=r.bat.pivotY-e.startY,a=e.y-e.startY,o=Math.max(0,Math.min(1,a/i));return!e.hasPaused&&o>=.5&&(e.hasPaused=!0,e.pauseTimer=400),e.pauseTimer>0?(e.pauseTimer-=t,e.prevX=e.x,e.prevY=e.y,e.prevRotationAngle=e.rotationAngle,!0):!1}};let ua=null,Qn=0;function Nl(e){const a=Math.ceil(140*e),o=Math.ceil(180*e);let n;typeof OffscreenCanvas<"u"?n=new OffscreenCanvas(a,o):(n=document.createElement("canvas"),n.width=a,n.height=o);const s=n.getContext("2d");s.translate(a/2,40*e),s.scale(e,e);const l="#1a1d23",c="#2c3036";s.fillStyle=l,s.fillRect(-80/2,0,80,120),s.fillStyle="#111",s.fillRect(-25,10,8,100),s.fillRect(17,10,8,100),s.fillRect(-4,15,8,90),s.fillStyle=c,s.fillRect(-80/2-10,100,100,20),s.beginPath(),s.moveTo(-80/2-15,0),s.lineTo(80/2+15,0),s.lineTo(80/2+5,25),s.lineTo(-80/2-5,25),s.fill();const f=-5;s.fillStyle="#0a0a0a",s.beginPath(),s.arc(0,f,35,0,Math.PI,!1),s.fill(),s.strokeStyle="#000",s.lineWidth=4,s.beginPath(),s.moveTo(-35,f),s.lineTo(-45,f-40),s.moveTo(35,f),s.lineTo(45,f-40),s.stroke(),s.save();const d=m=>{let p=m+=1831565813;return p=Math.imul(p^p>>>15,p|1),p^=p+Math.imul(p^p>>>7,p|61),((p^p>>>14)>>>0)/4294967296};s.fillStyle="rgba(0,0,0,0.15)";const u=150,h=-80/2,g=0;for(let m=0;m<u;m++){const p=h+d(m*11)*80,b=g+d(m*33)*120,v=d(m*55)*3+1;s.fillRect(p,b,v,v)}return s.fillStyle="rgba(0,0,0,0.3)",s.fillRect(-26,10,2,100),s.fillRect(16,10,2,100),s.restore(),n}function Ys(e,t,i,a=1,o=!1,n=0,s=!1){(!ua||Qn!==a)&&(ua=Nl(a),Qn=a);const l=ua.width;ua.height,e.drawImage(ua,t-l/2,i-40*a);const c=r.isGameOver&&!s,f=n,g=(c?"RED":"CYAN")==="RED"?{core:"#fbe9e7",mid:"#ff7043",outer:"#b71c1c",glow:"rgba(255, 87, 34, 0.4)",text:"#3e2723"}:{core:"#e0f7fa",mid:"#4dd0e1",outer:"#006064",text:"#006064"};e.save(),e.translate(t,i),e.scale(a,a);const p=-5-60,b=Date.now()/1e3,v=Math.sin(b*3)*.1+1;e.save(),e.shadowColor=g.mid,e.shadowBlur=80*v,e.fillStyle="rgba(0,0,0,0)",e.beginPath(),e.arc(0,p,60,0,Math.PI*2),e.fill(),e.restore();const y=(P,w,E,M,D)=>{e.save(),e.globalAlpha=D*.6,e.fillStyle=E,e.beginPath();const I=40*P,H=Math.sin(b*10)*3*w,k=p-75*w+H;e.moveTo(-I,p+30);const O=(Math.sin(b*M)*10+Math.cos(b*M*1.5)*5)*P;e.quadraticCurveTo(-I*1.2+Math.cos(b*2)*8,p,O,k),e.quadraticCurveTo(I*1.2+Math.sin(b*2.3)*8,p,I,p+30),e.shadowColor=E,e.shadowBlur=20,e.fill(),e.restore()};y(1.3,1.1,g.outer,1.5,.3),y(1,1,g.mid,2.5,.4),y(.6,.85,g.core,4,.5),e.save(),e.fillStyle=g.core,e.shadowColor="#fff",e.shadowBlur=10;for(let P=0;P<8;P++){const w=P*13,E=40+w%40,M=w%60-30,D=120,I=(b*E+w*100)%D,H=p+20-I,k=M+Math.sin(b*5+w)*5,O=1-I/D;if(O>0){e.globalAlpha=O;const W=1+w%2;e.fillRect(k,H,W,W)}}e.restore(),e.textAlign="center";let T="HIGH SCORE",R="#90a4ae",S=g.text;r.isDailyChallenge&&(T="DAILY BEST",R="#ffea00",S="#ffea00"),e.font='10px "PressStart2PLocal"',e.fillStyle=R,e.fillText(T,0,60),e.font='32px "PressStart2PLocal"',e.fillStyle=S,e.fillText(f,0,p+20),e.restore()}let Ti=null,xn=0,es=0,ts=null;function Vl(e,t,i,a=null){if(!Ti||t!==xn||i!==es||a!==ts){xn=t,es=i,ts=a;const h=i/t>1.2,g=Math.min(t,i)*(h?.08:.1),m=Math.ceil(g*8+20);typeof OffscreenCanvas<"u"?Ti=new OffscreenCanvas(m,m):(Ti=document.createElement("canvas"),Ti.width=m,Ti.height=m);const p=Ti.getContext("2d"),b=m/2,v=m/2,y=a||"#ffffe0",T=p.createRadialGradient(b,v,g,b,v,g*4);a?(T.addColorStop(0,"rgba(255, 0, 0, 0.4)"),T.addColorStop(.5,"rgba(100, 0, 0, 0.1)")):(T.addColorStop(0,"rgba(255, 255, 230, 0.4)"),T.addColorStop(.5,"rgba(200, 200, 255, 0.1)")),T.addColorStop(1,"rgba(0, 0, 0, 0)"),p.fillStyle=T,p.beginPath(),p.arc(b,v,g*4,0,Math.PI*2),p.fill(),p.fillStyle=y,p.shadowColor=y,p.shadowBlur=20,p.beginPath(),p.arc(b,v,g,0,Math.PI*2),p.fill(),p.shadowBlur=0,p.fillStyle=a?"rgba(50, 0, 0, 0.3)":"rgba(200, 200, 210, 0.5)";const R=(S,P,w)=>{p.beginPath(),p.arc(S,P,w,0,Math.PI*2),p.fill()};R(b-g*.3,v-g*.2,g*.2),R(b+g*.4,v+g*.3,g*.15)}const n=t*.85,s=i/t>1.2,l=s?45:i*.1,c=Math.min(t,i)*(s?.08:.1),f=Math.ceil(c*8+20),d=n-f/2,u=l-f/2;e.drawImage(Ti,d,u)}function qs(e,t,i,a=!1){const o=e.createLinearGradient(0,0,0,i);o.addColorStop(0,"#0a0520"),o.addColorStop(.5,"#1a0f35"),o.addColorStop(1,"#151020"),e.fillStyle=o,e.fillRect(0,0,t,i);const n=r.isGameOver?"#ff4444":null;Vl(e,t,i,n),(yt.length===0||t>Co+50)&&Ks(t,i,!0),e.save();for(let s=0;s<yt.length;s++){const l=yt[s];l.isDynamic||(e.globalAlpha=l.baseAlpha,e.fillStyle=l.color,e.fillRect(l.x,l.y,l.size,l.size))}e.restore()}let bi=null,vi=null,is=0,as=0,os=0,qi={flash1:!1,flash2:!1};function $l(e,t,i){let a=0;const o=U.consecutivePerfectHits>=1&&r.perfectHitTimer>0;if(o){const m=r.perfectHitTimer;m>1300?(a=1,qi.flash1||(L.playThunder(.3),qi.flash1=!0)):m>850&&m<1e3&&(a=.8,qi.flash2||(L.playThunder(.15),qi.flash2=!0))}else qi.flash1=!1,qi.flash2=!1;e.save(),a>.5&&(e.globalCompositeOperation="screen",e.fillStyle=`rgba(180, 220, 255, ${.4*a})`,e.fillRect(0,0,t,i),e.globalCompositeOperation="source-over",e.strokeStyle=`rgba(255, 255, 255, ${a})`,e.lineWidth=3,e.lineCap="round",e.lineJoin="round",(a>.9?0:1)===0?(e.beginPath(),e.moveTo(t*.5,0),e.lineTo(t*.48,i*.15),e.lineTo(t*.52,i*.3),e.lineTo(t*.5,i*.5),e.stroke()):(e.beginPath(),e.moveTo(t*.7,0),e.lineTo(t*.68,i*.2),e.lineTo(t*.72,i*.35),e.lineTo(t*.7,i*.5),e.stroke()));const n=4096,s=2160,l=Math.floor(Math.min(t,n)),c=Math.floor(Math.min(i,s)),f=l!==is||c!==as,d=Date.now(),u=f&&d-os<200;if(!bi||!vi||f&&!u){t>n&&console.warn(`[HauntedRenderer] Clamping Storm Cache Width: ${t} -> ${n}`),console.log(`[HauntedRenderer] Storm Cache UPDATE: ${l}x${c}`),typeof OffscreenCanvas<"u"?(bi=new OffscreenCanvas(l,c),vi=new OffscreenCanvas(l,c)):(bi=document.createElement("canvas"),bi.width=l,bi.height=c,vi=document.createElement("canvas"),vi.width=l,vi.height=c);const m=bi.getContext("2d"),p=vi.getContext("2d");Ea(m,l,c,0,"FULL"),Ea(p,l,c,1,"WINDOWS_ONLY"),is=l,as=c,os=d}const g=Date.now()/1e3;e.save();for(let m=0;m<yt.length;m++){const p=yt[m];if(p.isDynamic){const v=.7+Math.sin(g*p.speed+p.phase)*.3;e.globalAlpha=p.baseAlpha*v,e.fillStyle=p.color,e.fillRect(p.x,p.y,p.size,p.size)}}if(e.restore(),e.drawImage(bi,0,0,t,i),o){const m=jl()*1e3,b=.5+(Math.sin(m*.008)+1)/4;e.globalAlpha=b,e.globalCompositeOperation="screen",e.drawImage(vi,0,0,t,i),e.globalCompositeOperation="source-over",e.globalAlpha=1}e.restore()}function We(e){const t=Math.sin(e)*1e4;return t-Math.floor(t)}const yt=[];let li=null,Co=0,Xs=0;function Ks(e,t,i=!1){if(!i&&yt.length>0)return;i&&(yt.length=0,li=null);const a=150/600,o=Math.ceil(e*a);for(let n=0;n<o;n++){const s=Math.random()>.9;yt.push({x:Math.random()*e,y:Math.random()*t*.7,size:s?2:1,baseAlpha:.3+Math.random()*.7,phase:Math.random()*Math.PI*2,speed:.5+Math.random()*1.5,color:Math.random()>.8?"#a0c0ff":Math.random()>.8?"#fffacd":"#ffffff",isDynamic:s})}Co=e,Xs=t}function Yl(e,t,i,a){if((yt.length===0||t>Co+50)&&Ks(t,i,!0),!li||t!==Co||i!==Xs){typeof OffscreenCanvas<"u"?li=new OffscreenCanvas(t,i):(li=document.createElement("canvas"),li.width=t,li.height=i);const o=li.getContext("2d");o.clearRect(0,0,t,i);for(let n=0;n<yt.length;n++){const s=yt[n];s.isDynamic||(o.globalAlpha=s.baseAlpha,o.fillStyle=s.color,o.fillRect(s.x,s.y,s.size,s.size))}}e.drawImage(li,0,0),e.save();for(let o=0;o<yt.length;o++){const n=yt[o];if(n.isDynamic){const l=.7+Math.sin(a*n.speed+n.phase)*.3;e.globalAlpha=n.baseAlpha*l,e.fillStyle=n.color,e.fillRect(n.x,n.y,n.size,n.size)}}e.restore()}const ql=(e,t,i,a,o,n,s)=>{const l=d=>{const u=Math.sin(d)*1e4;return u-Math.floor(u)};e.lineWidth=n,e.strokeStyle="#0a0f14",e.lineCap="square",e.lineJoin="bevel",e.beginPath(),e.moveTo(t,i);const c=(t+a)/2+(l(s)-.5)*10,f=(i+o)/2+(l(s+1)-.5)*10;e.lineTo(c,f),e.lineTo(a,o),e.stroke()};class ns{constructor(t){this.m=2147483648,this.a=1103515245,this.c=12345,this.state=t||Math.floor(Math.random()*(this.m-1))}nextInt(){return this.state=(this.a*this.state+this.c)%this.m,this.state}nextFloat(){return this.nextInt()/(this.m-1)}range(t,i){return t+this.nextFloat()*(i-t)}}const Ho=new Map,Xl=(e,t,i)=>`${e}-${t?"d":"l"}-${i.toFixed(1)}`,Kl=(e,t,i,a,o,n,s=!1,l=1)=>{const c=v=>{const y=Math.sin(v)*1e4;return y-Math.floor(y)},f=v=>c(v),d=a*.5;e.save(),e.globalAlpha=l;const u=(v,y,T,R)=>{e.save();const S=3+Math.floor(f(R)*3);for(let P=0;P<S;P++){const w=(f(R+P)-.5)*T*1.8,E=(f(R+P*2)-.5)*T*1.2,M=T*(.4+f(R+P*3)*.3);e.beginPath(),e.arc(v+w,y+E,M,0,Math.PI*2);const D=f(R+P*4);D>.8?e.fillStyle="#1b262c":D<.4?e.fillStyle="#05070a":e.fillStyle="#0f171a",e.fill()}e.restore()},h=(v,y,T,R,S,P,w)=>{if(R<2||P>6){if(!s&&P>2){const k=Math.max(1,15*d*Math.max(.5,6-P));u(v,y,k,w)}return}let E=v+Math.cos(T)*R,M=y+Math.sin(T)*R;ql(e,v,y,E,M,S*.8,w),!s&&P>3&&f(w*99)>.7&&u(v,y,10*d,w+10);const D=w*13.1,I=w*17.5,H=1-P*.05;if(f(D)<H){if(h(E,M,T+(f(D)-.5)*.8,R*.7,S*.6,P+1,D+1),f(I)>.3){const k=f(I)>.5?1:-1;h(E,M,T+.6*k,R*.5,S*.5,P+1,I+2)}}else h(E,M,T+(f(D)-.5)*.4,R*.8,S*.7,P+1,D+1)},g=(s?15:25)*d,m=(s?220:180)*d;e.fillStyle="rgba(0,0,0,0.5)",e.beginPath(),e.ellipse(t,i+2,g*1.5,6,0,0,Math.PI*2),e.fill();const p=e.createLinearGradient(t-g,0,t+g,0);p.addColorStop(0,"#020305"),p.addColorStop(.4,"#1b262c"),p.addColorStop(1,"#000000"),e.fillStyle=p,e.beginPath(),e.moveTo(t-g,i+5),e.quadraticCurveTo(t-g*.2,i-m*.5,t-g*.4,i-m),e.lineTo(t+g*.4,i-m),e.quadraticCurveTo(t+g*.2,i-m*.5,t+g,i+5),e.closePath(),e.fill();const b=(s?140:120)*d;h(t,i-m,-Math.PI/2+o*.1,b,8*d,0,n),f(n)>.5&&h(t,i-m*.6,-Math.PI/2+o*.8,b*.7,6*d,0,n+50),e.restore()},Zs=(e,t,i,a)=>{const o=Xl(e,t,a);if(Ho.has(o))return Ho.get(o);const n=100*a,s=300*a+n,l=400*a+n,c=document.createElement("canvas");c.width=Math.ceil(s),c.height=Math.ceil(l);const f=c.getContext("2d");return Kl(f,s/2,l-50*a,a,i,e,t,1),Ho.set(o,c),c};function ss(e,t,i){e.shadowBlur=0;const{cx:a,baseY:o,scaleX:n,wingsPerSide:s}=na(t,i),l=(u,h,g,m,p,b)=>{const v=Zs(p,b,m,g),y=v.width/2,T=v.height-50*g;e.drawImage(v,u-y,h-T)},c=(60+s*90)*n,f=c+20*n,d=c+120*n;l(a-f,o+20,.7,.2,1e3,!1),l(a-d,o+10,.5,.1,1050,!0),l(a+f,o+20,.7,-.2,2e3,!1),l(a+(d+40*n),o+15,.6,-.1,2050,!0)}let Uo=null,zo={w:0,h:0};function Zl(e,t){const i=[],{cx:a,baseY:o,scaleX:n,horizonY:s,wingsPerSide:l}=na(e,t),c=10,f=s+180,d=t,u=new ns(12345),h=t*.85,m=70/1.8,p=1.5*m,b=a-m,v=h-p,y=a+m,T=h-p,R=(P,w,E,M,D)=>{const I=D<0?1.5:-1.5,H=I,k=-1,O=M-I*E;return Math.abs(H*P+k*w+O)/Math.sqrt(H*H+k*k)};let S=0;for(;i.length<c&&S<600;){S++;let P=u.nextFloat()*e,w=f+u.nextFloat()*(d-f);const M=55+(w-s)/(d-s)*50,D=R(P,w,b,v,-1),I=R(P,w,y,T,1);if(D<M||I<M||Math.abs(P-a)<60)continue;const H=45,k=(60+l*90)*n,O=240*n,Z=Math.min(k,O)+H;if(Math.abs(P-a)<Z)continue;const N=i.length,$=777+N*1337,j=new ns($).nextFloat()>.4,se=.5+(w-s)/(t-s)*.5,Q=P<a?.4:-.4;i.push({x:P,y:w,scale:se,lean:Q,isDead:j,id:N})}return i.sort((P,w)=>P.y-w.y),i}let ls=0,rs=0,Ka=0,cs=0,Za=0;function jl(){const e=Date.now()/1e3;Za===0&&(Za=e);const t=e-Za;return Za=e,r.isPaused||(cs+=t),cs}function Jl(e,t,i){const{horizonY:a}=na(t,i),o=Date.now();Ka===0&&(Ka=o);const n=(o-Ka)/1e3;Ka=o,r.isPaused||(rs+=n);const s=rs,c=t*.15+Math.sin(s*.25)*30;Wo(e,c,a+(i-a)*.3,1.2,s);const d=t*.85+Math.sin(s*.3+2)*25;Wo(e,d,a+(i-a)*.4,1.3,s+1);const h=t*.25+Math.cos(s*.2+1)*40;Wo(e,h,a+(i-a)*.6,1.8,s+2)}function js(e,t,i,a){const o=Date.now(),n=zo.w!==t||zo.h!==i;(!Uo||n&&o-ls>200)&&(Uo=Zl(t,i),zo={w:t,h:i},ls=o),Uo.forEach(l=>{const f=Zs(5e3+l.id,l.isDead,l.lean,l.scale);e.save(),e.globalAlpha=1;const d=f.width/2,u=f.height-50*l.scale;e.drawImage(f,l.x-d,l.y-u),e.restore()})}const ds=(e,t,i,a,o,n)=>{e.save();const s=Math.abs(a-t),l=Math.sign(a-t),f=Math.ceil(s/100),d=s/f,u=20,h=o+15,g="#2d3436",m="#636e72",p="#15181c",b="#050505",v=100;for(let S=0;S<f;S++){if(S>=v){console.warn("[HauntedRenderer] Max Fence Sections Reached. Stopping generation.");break}const P=t+S*d*l,w=t+(S+1)*d*l,E=P,M=Math.min(E,w)+u/2,I=Math.max(E,w)-u/2-M;if(I>0){e.fillStyle=b;const N=i-o*.85,$=i-o*.15;e.fillRect(M,N,I,6),e.fillRect(M,$,I,6);const V=16,j=Math.floor(I/V),ge=M+(I-j*V)/2;for(let se=0;se<=j;se++){const Q=ge+se*V,Se=i-o;e.fillRect(Q-2,Se,4,o);const Ee=Se;e.beginPath(),e.moveTo(Q,Ee-15),e.lineTo(Q+5,Ee),e.lineTo(Q-5,Ee),e.fill(),e.beginPath(),e.arc(Q,Ee+5,3,0,Math.PI*2),e.fill(),se%2===0&&(e.beginPath(),e.arc(Q,i-o*.5,5,0,Math.PI*2),e.fill())}}e.fillStyle=p,e.fillRect(E-u/2,i-h,u,h),e.fillStyle=g,e.fillRect(E-u/2+2,i-h,u-2,h),e.fillStyle=p;const H=14;for(let N=i-h+10;N<i-5;N+=H)e.fillRect(E-u/2+2,N,u-2,1),e.fillStyle="rgba(255,255,255,0.1)",e.fillRect(E-u/2+2,N+1,u-2,1),e.fillStyle=p;for(let N=0;N<8;N++){const $=E-u/2+3+Math.abs(Math.sin(P+N)*(u-6)),V=i-h+Math.abs(Math.cos(P*N)*h);e.fillStyle=N%2===0?"#111":"#555",e.fillRect($,V,1,1)}const k=6,O=10,W=i-h;e.fillStyle=m,e.beginPath(),e.moveTo(E-u/2-k,W+O),e.lineTo(E+u/2+k,W+O),e.lineTo(E+u/2+k-2,W),e.lineTo(E-u/2-k+2,W),e.fill(),e.fillStyle="rgba(255,255,255,0.2)",e.fillRect(E-u/2-k+3,W,u+k*2-6,2);for(let N=0;N<5;N++){const $=E*.13+N*5.7,V=Math.abs(Math.sin($)),j=Math.abs(Math.cos($*2.1)),ge=Math.abs(Math.sin($*3.3)),se=E-u/2-k+V*(u+k*2),Q=W+j*O;e.fillStyle=ge>.5?"rgba(0,0,0,0.3)":"rgba(255,255,255,0.2)",e.fillRect(se,Q,1,1)}e.fillStyle=p,e.fillRect(E-u/2-2,i-10,u+4,10),Math.abs(Math.sin(P*.1+n))>.7&&(e.fillStyle="#111",e.fillRect(E-2,i-h+30,3,15))}const y=a,T=i-h;e.fillStyle=p,e.fillRect(y-u/2,i-h,u,h),e.fillStyle=g,e.fillRect(y-u/2+2,i-h,u-2,h),e.fillStyle=p;const R=14;for(let S=i-h+10;S<i-5;S+=R)e.fillRect(y-u/2+2,S,u-2,1),e.fillStyle="rgba(255,255,255,0.1)",e.fillRect(y-u/2+2,S+1,u-2,1),e.fillStyle=p;e.fillStyle=m,e.beginPath(),e.moveTo(y-u/2-4,T+10),e.lineTo(y+u/2+4,T+10),e.lineTo(y+u/2+2,T),e.lineTo(y-u/2-2,T),e.fill(),e.fillStyle="rgba(255,255,255,0.2)",e.fillRect(y-u/2,T,u,2);for(let S=0;S<5;S++){const P=y*.13+S*5.7,w=Math.abs(Math.sin(P)),E=Math.abs(Math.cos(P*2.1)),M=Math.abs(Math.sin(P*3.3)),D=y-u/2-4+w*(u+8),I=T+E*10;e.fillStyle=M>.5?"rgba(0,0,0,0.3)":"rgba(255,255,255,0.2)",e.fillRect(D,I,1,1)}e.restore()},Ql=(e,t,i,a,o)=>{e.save(),e.translate(t,i),e.scale(a,a),e.strokeStyle="#050505",e.lineWidth=1;const n=3+Math.floor(Math.abs(Math.sin(o)*3));for(let s=0;s<n;s++){const l=-Math.PI/2+Math.sin(o+s)*.5,c=5+Math.abs(Math.cos(o*s)*6);e.beginPath(),e.moveTo(0,0),e.quadraticCurveTo(Math.cos(l)*c*.5,Math.sin(l)*c*.5,Math.cos(l)*c,Math.sin(l)*c),e.stroke()}e.restore()};function Ea(e,t,i,a=0,o="FULL",n=0,s=null,l=null){const c=o!=="WINDOWS_ONLY",f=o!=="STRUCTURE_ONLY",{cx:d,baseY:u,scaleX:h,scaleY:g,wingsPerSide:m}=s||na(t,i);e.save(),e.translate(d,u),e.scale(h,g);const p="#4a4e57",b="#1a1d23",v="#6c757d",y=6,T=4,R=a>.5,S=R?"#e0f7fa":"#feca57",P=(_,A,G,B)=>{const J=_,q=J-y,te=A,ie=A+B,le=te-T,fe=ie-T;e.beginPath(),e.moveTo(J,ie),e.lineTo(J,te),e.lineTo(q,le),e.lineTo(q,fe),e.closePath();const oe=e.createLinearGradient(J,0,q,0);oe.addColorStop(0,"#050508"),oe.addColorStop(1,"#000000"),e.fillStyle=oe,e.fill(),e.strokeStyle="#111",e.lineWidth=1,e.beginPath(),e.moveTo(J,te),e.lineTo(J,ie),e.stroke()},w=(_,A,G,B,J)=>{e.fillStyle=J,R&&J===S&&(e.shadowColor="#00e5ff",e.shadowBlur=40),e.fillRect(_,A,G,B),e.shadowBlur=0},E=(_,A,G,B)=>{for(let q=A;q>A-B;q-=6){const te=25+We(q)*5,ie=`rgb(${te}, ${te}, ${te+10})`;e.fillStyle=ie,e.fillRect(_-G,q-6,G*2,6),e.fillStyle="rgba(0,0,0,0.4)",e.fillRect(_-G,q,G*2,1);const le=8,fe=Math.abs(q)/6%2*(le/2);for(let oe=_-G+fe;oe<_+G;oe+=le){const Pe=We(oe*q);if(Pe>.96){e.fillStyle="#050505",e.fillRect(oe+1,q-6+1,le-2,5);continue}Pe>.75?(e.fillStyle="rgba(255,255,255,0.06)",e.fillRect(oe,q-6,le,5)):Pe<.2&&(e.fillStyle="rgba(0,0,0,0.3)",e.fillRect(oe,q-6,le,5)),e.fillStyle="rgba(0,0,0,0.5)",e.fillRect(oe+le-1,q-6,1,6)}}},M=(_,A,G,B,J=!1)=>{e.save(),e.beginPath(),e.rect(_,A,G,B),e.clip(),J||(e.fillStyle="#2c2c2c",e.fillRect(_,A,G,B));const q=10,te=14;for(let ie=A;ie<A+B;ie+=q){const le=Math.floor((ie-A)/q)%2===1;let fe=_-(le?te/2:0);for(;fe<_+G;){const oe=te,Pe=Math.sin(fe*ie)*1e4;let re;const ue=Pe-Math.floor(Pe);ue>.8?re="#5a5e68":ue>.4?re="#4a4e57":re="#3e4249",e.fillStyle="#636e72",e.fillRect(fe,ie,oe-1,1),e.fillStyle=re,e.fillRect(fe,ie+1,oe-1,q-3),e.fillStyle="#2d3436",e.fillRect(fe,ie+q-2,oe-1,1),fe+=oe}}e.restore()},D=90,I=60,H=D+(m-1)*I,k=({x:_,y:A,w:G,h:B,arched:J,lit:q,phase:te=0,ignoreStorm:ie=!1})=>{if(e.save(),c&&(e.fillStyle="#05070a",J?(e.beginPath(),e.moveTo(_,A+B),e.lineTo(_+G,A+B),e.lineTo(_+G,A+B*.3),e.quadraticCurveTo(_+G/2,A-B*.1,_,A+B*.3),e.fill()):e.fillRect(_,A,G,B),e.strokeStyle="rgba(0,0,0,0.6)",e.lineWidth=2,e.beginPath(),J?(e.moveTo(_+G,A+B*.3),e.moveTo(_,A+B),e.lineTo(_,A+B*.3),e.quadraticCurveTo(_+G/2,A-B*.1,_+G,A+B*.3),e.stroke()):(e.beginPath(),e.moveTo(_+G,A),e.lineTo(_,A),e.lineTo(_,A+B),e.stroke())),f){const fe=_+2,oe=A+2,Pe=G-4,re=B-4;let ue=0;if(R&&!ie)if(q=!0,n>0){ue=(Math.sin(te+n*.008)+1)/2;const ve=Math.floor(40+215*ue),$e=Math.floor(100+155*ue),Je=255;e.fillStyle=`rgb(${ve},${$e},${Je})`}else e.fillStyle="#e0f7fa";else if(q)if(l)e.fillStyle=l,e.shadowColor=l,e.shadowBlur=20;else{const pe=e.createRadialGradient(_+G/2,A+B/2,2,_+G/2,A+B/2,G);pe.addColorStop(0,"#ffca28"),pe.addColorStop(1,"#ff6f00"),e.fillStyle=pe}else e.fillStyle="#15181c";q&&R&&!ie?(e.shadowColor="#00e5ff",e.shadowBlur=20+30*ue):e.shadowBlur=0,e.beginPath(),J?(e.moveTo(fe,A+B-2),e.lineTo(fe+Pe,A+B-2),e.lineTo(fe+Pe,A+B*.3),e.quadraticCurveTo(_+G/2,A-B*.1+2,fe,A+B*.3),e.fill()):e.fillRect(fe,oe,Pe,re),e.shadowBlur=0}if(c&&(e.strokeStyle="#636e72",e.lineWidth=1,e.beginPath(),J?(e.moveTo(_+G,A+B*.3),e.quadraticCurveTo(_+G/2,A-B*.1,_,A+B*.3),e.lineTo(_,A+B)):(e.moveTo(_+G,A),e.lineTo(_,A),e.lineTo(_,A+B)),e.stroke(),e.strokeStyle="#000",e.beginPath(),J?(e.moveTo(_+G,A+B*.3),e.lineTo(_+G,A+B),e.lineTo(_,A+B)):(e.moveTo(_+G,A),e.lineTo(_+G,A+B),e.lineTo(_,A+B)),e.stroke()),c||f){e.save(),e.beginPath();const le=2,fe=_+le,oe=G-le*2;J?(e.moveTo(fe,A+B-le),e.lineTo(fe+oe,A+B-le),e.lineTo(fe+oe,A+B*.3),e.quadraticCurveTo(_+G/2,A-B*.1+le,fe,A+B*.3)):e.rect(fe,A+le,oe,B-le*2),e.clip(),e.strokeStyle="#000",e.lineWidth=1,e.beginPath(),e.moveTo(_+G/2,A),e.lineTo(_+G/2,A+B),e.moveTo(_,A+B/2),e.lineTo(_+G,A+B/2),e.stroke(),e.restore()}e.restore()},O=(_,A,G,B)=>{const q=G*.6;e.fillStyle=b,e.beginPath(),e.moveTo(_-G/2-8,A),e.lineTo(_+G/2+8,A),e.lineTo(_+q/2,A-B),e.lineTo(_-q/2,A-B),e.fill(),e.save(),e.clip(),E(_,A,G+16,B),e.restore();const te=5,ie=G+16,le=_-ie/2;e.fillStyle="#1a1c21",e.fillRect(le,A,ie,te),e.fillStyle="#3e4249",e.fillRect(le,A,ie,1),e.fillStyle="#08090a",e.fillRect(le,A+te-1,ie,1),e.fillStyle="#1a1c21",e.fillRect(_-q/2-2,A-B-2,q+4,3),e.fillStyle="#3e4249",e.fillRect(_-q/2-2,A-B-2,q+4,1),e.fillStyle="#050508",e.beginPath();const fe=_-q/2-2;e.moveTo(fe,A-B-2),e.lineTo(fe-y,A-B-2-T),e.lineTo(fe-y,A-B+1-T),e.lineTo(fe,A-B+1),e.fill(),e.strokeStyle="#0a0a0d",e.fillStyle="#0a0a0d",e.lineWidth=1.5,e.beginPath(),e.moveTo(_-q/2,A-B),e.lineTo(_+q/2,A-B),e.moveTo(_-q/2,A-B-5),e.lineTo(_+q/2,A-B-5),e.stroke();const oe=6;for(let ue=0;ue<=q;ue+=oe){const pe=_-q/2+ue;e.beginPath(),e.moveTo(pe,A-B),e.lineTo(pe,A-B-10),e.stroke(),e.beginPath(),e.arc(pe,A-B-11,1.5,0,Math.PI*2),e.fill()}e.fillStyle="#050508",e.beginPath();const Pe=_-G/2-8,re=_-q/2;e.moveTo(Pe,A),e.lineTo(Pe-y,A-T),e.lineTo(re-y,A-B-T),e.lineTo(re,A-B),e.closePath(),e.fill(),e.strokeStyle="#3e4249",e.lineWidth=1,e.beginPath(),e.moveTo(Pe,A),e.lineTo(re,A-B),e.stroke()},W=(_,A,G,B)=>{if(e.save(),c){e.fillStyle="rgba(0,0,0,0.5)",e.beginPath(),e.ellipse(_,A+2,G/2+4,3,0,0,Math.PI*2),e.fill(),w(_-G/2,A-B,G,B,p),M(_-G/2,A-B,G,B),e.fillStyle="#1a1d22",e.beginPath();const q=_-G/2;e.moveTo(q,A-B),e.lineTo(q-y,A-B-T),e.lineTo(q-y,A-T),e.lineTo(q,A),e.fill(),e.strokeStyle="#000",e.lineWidth=.5,e.stroke(),e.fillStyle=b,e.beginPath(),e.moveTo(_-G/2-4,A-B),e.lineTo(_+G/2+4,A-B),e.lineTo(_,A-B-12),e.fill(),e.fillStyle="rgba(0,0,0,0.4)",e.beginPath(),e.moveTo(_-G/2,A-B),e.lineTo(_+G/2,A-B),e.lineTo(_,A-B+4),e.fill(),e.save(),e.clip(),E(_,A-B,G+8,12),e.restore()}k({x:_-G/2+2,y:A-B+3,w:G-4,h:B-5,arched:!0,lit:!0}),e.restore()},Z=(_,A,G,B)=>{const q=_*(A?1:-1),te=60;e.save(),e.translate(q,0);const ie=50,le=6,oe=te-3*2,Pe=40,re=-ie-le,ue=-te/2;c&&(G&&!A&&P(ue,-ie,te,ie),w(ue,-ie,te,ie,p),M(ue,-ie,te,ie),e.fillStyle="rgba(0,0,0,0.35)",e.fillRect(ue+4,-ie,te-4,6),w(ue-2,-ie,te+4,5,v));const pe=te+4,ve=-pe/2,$e=-oe/2,Je=re-Pe;if(c){if(G&&!A){P(ve,re+le,pe,le),e.fillStyle="#050508";const Ce=ve;e.beginPath(),e.moveTo(Ce,re),e.lineTo(Ce,re+le),e.lineTo(Ce-y,re+le-T),e.lineTo(Ce-y,re-T),e.closePath(),e.fill();const Wt=$e;e.beginPath(),e.moveTo(Wt,re),e.lineTo(Ce,re),e.lineTo(Ce-y,re-T),e.lineTo(Wt-y,re-T),e.closePath(),e.fill()}w(ve,re,pe,le,v),e.fillStyle="rgba(255,255,255,0.4)",e.fillRect(ve,re,pe,1),e.fillStyle="rgba(0,0,0,0.6)",e.fillRect(ve,re+le-1,pe,1),e.fillStyle="#6a6e75",e.fillRect(ve,re,pe,2),G&&!A&&P($e,Je,oe,Pe),w($e,Je,oe,Pe,p),M($e,Je,oe,Pe);{const Ce=e.createLinearGradient(0,Je,0,Je+12);Ce.addColorStop(0,"rgba(0,0,0,0.8)"),Ce.addColorStop(1,"rgba(0,0,0,0.0)"),e.fillStyle=Ce,e.fillRect($e+4,Je,oe-4,12)}w($e-2,re-3,oe+4,4,v)}const et=oe+8,Ui=40,vt=-et/2,zt=Je-Ui;if(c){{const Ce=A?vt:vt+et,Wt=et*.55,Nt=(et-Wt)/2,la=A?vt+Nt:vt+et-Nt,Da=y*.8,Qt=Ce-Da,zi=la-Da;e.beginPath(),e.moveTo(Ce,Je),e.lineTo(la,zt),e.lineTo(zi,zt-T),e.lineTo(Qt,Je-T),e.closePath();const xt=e.createLinearGradient(Ce,0,Qt,0);xt.addColorStop(0,"#050508"),xt.addColorStop(1,"#000000"),e.fillStyle=xt,e.fill(),e.save(),e.clip();const Wi=Je-(zt-T)+20;E(Math.min(Ce,Qt)-50,Je,200,Wi),e.fillStyle="rgba(0,0,0,0.2)",e.fill(),e.restore(),e.strokeStyle="#3e4249",e.lineWidth=1,e.stroke()}O(0,Je,et,Ui)}const Jt=We(B*11+(A?100:0)),we=We(B*13+(A?200:0)),it=We(B*17+(A?300:0)),pt=!G||Jt>.5,Ct=we>.3,sa=Math.abs(q)*.015;if(k({x:-10,y:-40,w:20,h:25,arched:!0,lit:pt,phase:sa}),k({x:-9,y:Je+12,w:18,h:18,arched:!1,lit:Ct,phase:sa}),!G||it>.5){const Ce=Je-25;W(0,Ce+12,16,12)}e.restore()},N=54,$=60,V=-90,j=66,ge=8,se=V-$-ge,Q=-2,Se=54,Ee=50,ye=se;if(c){const _=Q-N/2;P(_,V,N,$),e.fillStyle="#050508",e.beginPath(),e.moveTo(_,V),e.lineTo(_,V-$),e.lineTo(_-y,V-$-T),e.lineTo(_-y,V-T),e.fill();const A=Q-N/2;w(A,V-$,N,$,"#2d3138"),M(A,V-$,N,$);const G=Q-j/2;e.fillStyle="#0a0c0e",e.beginPath(),e.moveTo(G,se+ge),e.lineTo(G,se),e.lineTo(G-6,se-2),e.lineTo(G-6,se+ge-2),e.fill(),w(Q-j/2,se,j,ge,v),e.fillStyle="rgba(255,255,255,0.4)",e.fillRect(Q-j/2,se,j,1),e.fillStyle="rgba(0,0,0,0.6)",e.fillRect(Q-j/2,se+ge-1,j,1);const B=Q-Se/2;e.fillStyle="#050508",e.beginPath(),e.moveTo(B,ye),e.lineTo(B,ye-Ee),e.lineTo(B-y,ye-Ee-T),e.lineTo(B-y,ye-T),e.fill(),w(Q-Se/2,ye-Ee,Se,Ee,"#2d3138"),M(Q-Se/2,ye-Ee,Se,Ee),O(Q,ye-Ee,60,50);const J=ye-Ee-54;e.strokeStyle="#000",e.lineWidth=2,e.beginPath(),e.moveTo(Q,J),e.lineTo(Q,J-30),e.stroke(),e.lineWidth=1,e.beginPath(),e.moveTo(Q-10,J-20),e.lineTo(Q+10,J-20),e.stroke(),e.fillStyle="#c0a060",e.beginPath(),e.arc(Q,J-30,3,0,Math.PI*2),e.fill();const q=J;e.strokeStyle="#0a0a0d",e.lineWidth=2,e.beginPath(),e.moveTo(Q-20,q-10),e.lineTo(Q+20,q-10);for(let te=-18;te<=18;te+=6)e.moveTo(Q+te,q),e.lineTo(Q+te,q-12);e.stroke()}k({x:Q-10,y:ye-Ee+10,w:20,h:30,arched:!0,lit:!0,ignoreStorm:!0});const me=120,Be=50,Ne=8,Ve=-Be-Ne,je=me-5*2,x=40,ce=Ve,Te=ce-x;if(c){e.fillStyle="#050508";const _=-me/2;e.beginPath(),e.moveTo(_,0),e.lineTo(_,-Be),e.lineTo(_-y,-Be-T),e.lineTo(_-y,0-T),e.closePath(),e.fill(),w(-me/2,-Be,me,Be,p),M(-me/2,-Be,me,Be);for(let B=-Be;B<-4;B+=16)e.fillStyle=Math.abs(B)%32===0?p:"#3b3f46",e.fillRect(-me/2,B,6,8),e.fillRect(me/2-6,B,6,8);const A=-me/2-4;e.fillStyle="#050508",e.beginPath(),e.moveTo(A,Ve+Ne),e.lineTo(A,Ve),e.lineTo(A-y,Ve-T),e.lineTo(A-y,Ve+Ne-T),e.closePath(),e.fill(),w(-me/2-4,Ve,me+8,Ne,v),e.fillStyle="#5a5e68",e.fillRect(-me/2,ce,me,2);const G=-je/2;e.fillStyle="#050508",e.beginPath(),e.moveTo(G,ce),e.lineTo(G,Te),e.lineTo(G-y,Te-T),e.lineTo(G-y,ce-T),e.closePath(),e.fill(),w(-je/2,Te,je,x,p),M(-je/2,Te,je,x),w(-je/2-2,ce-4,je+4,4,v)}k({x:-40,y:Te+10,w:14,h:20,arched:!0,lit:!0,ignoreStorm:!0}),k({x:-7,y:Te+10,w:14,h:20,arched:!0,lit:!0,ignoreStorm:!0}),k({x:26,y:Te+10,w:14,h:20,arched:!0,lit:!0,ignoreStorm:!0});const be=40,Ke=35;if(c){w(-be/2,-Ke,be,Ke,"#2d3436"),e.beginPath(),e.moveTo(-be/2-6,-Ke),e.lineTo(0,-Ke-12),e.lineTo(be/2+6,-Ke),e.closePath(),e.fillStyle="#111",e.fill(),e.strokeStyle="#444",e.lineWidth=2,e.stroke(),e.fillStyle="rgba(0,0,0,0.6)",e.fillRect(-be/2+2,-Ke,be-4,6),e.fillStyle="#050505";const _=24,A=25;e.fillRect(-_/2,-A,_,A),e.fillStyle="#1a0f0f";const G=2;e.fillRect(-_/2+G,-A+G,_-G*2,A-G),e.fillStyle="#2b1b1b",e.fillRect(-_/2+4,-A+4,6,8),e.fillRect(_/2-10,-A+4,6,8),e.fillRect(-_/2+4,-A+14,6,8),e.fillRect(_/2-10,-A+14,6,8),e.fillStyle="#e1b12c",e.beginPath(),e.arc(_/2-6,-A/2+2,1.5,0,Math.PI*2),e.fill(),e.strokeStyle="#3a3a3a",e.lineWidth=1,e.strokeRect(-_/2,-A,_,A)}k({x:-45,y:-35,w:12,h:20,arched:!1,lit:!0,ignoreStorm:!0}),k({x:33,y:-35,w:12,h:20,arched:!1,lit:!0,ignoreStorm:!0}),c&&(w(-25,-25,6,25,v),w(19,-25,6,25,v),w(-30,-32,60,8,v),e.beginPath(),e.moveTo(-32,-32),e.lineTo(32,-32),e.lineTo(0,-50),e.fill());for(let _=1;_<=m;_++){const A=D+(_-1)*I;Z(A,!1,_===m,_)}for(let _=m;_>=1;_--){const A=D+(_-1)*I;Z(A,!0,_===m,_)}if(c){const _=H+60,A=-d/h,G=(t-d)/h,B=0,J=120,q=1200,te=Math.max(A-50,-_-q),ie=Math.min(G+50,_+q);ds(e,-_+5,B,te,J,100),ds(e,_-5,B,ie,J,200)}e.restore()}function na(e,t){const i=e/2,a=150+(Fe||0),o=Math.max(a-40,t*.2);let n=(o-30)/290*1.5,s=0;e>t*1.2?(n*=1.5,s=1):t>e&&(n*=.75);const l=n,c=300*l,f=(e-c)/2;let d=0;f>0?d=Math.ceil(f/(90*l))+1:d=1;const u=1+Math.min(d,6)+s;return{cx:i,baseY:o,scaleX:l,scaleY:n,horizonY:o,wingsPerSide:u}}function xl(e,t,i){const{cx:a,baseY:o,scaleX:n,scaleY:s}=na(t,i);e.save(),e.translate(a,o),e.scale(n,s);const l=(d,u,h,g,m)=>{e.fillStyle=m,e.fillRect(d,u,h,g)},c="#2a2e35",f="#1a1d23";l(-25,0,50,3,c),l(-25,3,50,2,f),l(-30,5,60,3,c),l(-30,8,60,2,f),l(-35,10,70,3,c),l(-35,13,70,2,f),e.restore()}const er=(e,t,i,a,o,n,s,l)=>{e.save(),e.beginPath(),e.moveTo(t-a/2,i),e.lineTo(t+a/2,i),e.lineTo(t+n/2,o),e.lineTo(t-n/2,o),e.closePath(),e.fillStyle="#1a1a1a",e.fill(),e.restore();const c=(u,h,g,m)=>{e.save(),e.translate(u,h),e.scale(-g,1),e.strokeStyle="rgba(255, 255, 255, 0.9)",e.lineWidth=1.3,e.lineCap="butt",e.beginPath();let p=m;const b=()=>We(p+=17.1),v=30+b()*25,y=5,T=0,R=Math.PI*.55,S=[];for(let w=0;w<y;w++){const E=w/(y-1),M=T+E*(R-T),D=v*(.8+b()*.4),I=Math.cos(M)*D,H=Math.sin(M)*D;S.push({x:I,y:H}),e.moveTo(0,0),e.lineTo(I,H)}const P=3;for(let w=1;w<=P;w++){const E=w/(P+.2);for(let M=0;M<y-1;M++){const D=S[M],I=S[M+1],H=D.x*E,k=D.y*E,O=I.x*E,W=I.y*E;e.moveTo(H,k);const Z=(H+O)*.5,N=(k+W)*.5,$=.85;e.quadraticCurveTo(Z*$,N*$,O,W)}}e.stroke(),e.restore()},f=16,d=o-i;if(d>0){const u=Math.floor(d/f),h=[];let g=-999,m=We(u)>.5;for(let p=0;p<u;p++){const b=i+p*f,v=p/u,y=a+(n-a)*v,T=t-y/2,R=p*1337;let S=y,P=T,w=0;for(;S>0;){let M=20+Math.floor(We(R+S)*30);M>S&&(M=S);let D=P,I=M-2;if(D<T&&(I-=T-D,D=T),D+I>T+y&&(I=T+y-D),I>1){const H=60+Math.floor(We(R+w)*30),k=`rgb(${H}, ${H}, ${H})`,O=`rgb(${H+40}, ${H+40}, ${H+40})`,W=`rgb(${H-30}, ${H-30}, ${H-30})`;e.fillStyle=k,e.fillRect(D,b,I,f-2),e.fillStyle=O,e.fillRect(D,b,I,1),e.fillRect(D,b,1,f-2),e.fillStyle=W,e.fillRect(D,b+f-3,I,1),e.fillRect(D+I-1,b,1,f-2)}S-=M,P+=M,w++}if(l&&b>l-80&&b<l+85||b>o-80||b<i+40||p-g<5)continue;const E=p*999;if(We(E)>.82){const M=m?-1:1,D=E+(m?0:100);h.push({x:m?T+2:T+y-2,y:b+5,side:M,seed:D}),m=!m,g=p}}h.forEach(p=>c(p.x,p.y,p.side,p.seed))}};function tr(e,t,i,a){e.save(),e.beginPath(),e.arc(t,i,a,0,Math.PI*2),e.fillStyle="#1a1a1a",e.fill();const o=18,n=Math.floor(a/o);for(let s=0;s<n;s++){const l=a-s*o,c=2*Math.PI*l,f=Math.floor(c/25),d=Math.PI*2/f,u=s*.5;for(let h=0;h<f;h++){const g=u+h*d,m=u+(h+1)*d-.1,p=l,b=l-o+2,v=70+h%3*20;e.fillStyle=`rgb(${v}, ${v}, ${v})`,e.beginPath(),e.arc(t,i,p,g,m),e.arc(t,i,b,m,g,!0),e.closePath(),e.fill()}}e.beginPath(),e.arc(t,i,a-n*o,0,Math.PI*2),e.fillStyle="#555",e.fill(),e.restore()}function fs(e,t,i,a,o){const n=a-t,s=o-i,l=Math.sqrt(n*n+s*s),c=Math.atan2(s,n),f=24,d=22,u=0,h=Math.ceil(l/(f+u));e.save(),e.translate(t,i),e.rotate(c);const m=d*2+2+4;e.fillStyle="#1a1a1a",e.fillRect(0,-m/2,l,m);for(let p=0;p<2;p++){const b=p===0?0:f/2;for(let v=0;v<h;v++){const y=v*(f+u)-b;if(y+f<0||y>l)continue;const T=f,R=d,S=p===0?-d:0,P=(v+p*1e3)*1.1,w=60+Math.floor(We(P)*30),E=`rgb(${w}, ${w}, ${w})`,M=`rgb(${w+40}, ${w+40}, ${w+40})`,D=`rgb(${w-30}, ${w-30}, ${w-30})`,I=1;e.fillStyle=E,e.fillRect(y,S+I,T-I,R-I),e.fillStyle=M,e.fillRect(y,S+I,T-I,1),e.fillRect(y,S+I,1,R-I),e.fillStyle=D,e.fillRect(y,S+R-1,T-I,1),e.fillRect(y+T-I-1,S+I,1,R-I)}}e.restore()}function ir(e,t,i,a,o){e.save(),e.translate(t,i);const n=.9+o*.3,s=1.1-o*.2;e.scale(a*n,a*s);const l="#616161",c="#424242",f="#212121";e.lineWidth=2,e.strokeStyle=f,e.fillStyle=c,e.beginPath(),e.moveTo(10,-14),e.lineTo(14,-14),e.lineTo(14,0),e.lineTo(10,0),e.fill(),e.stroke(),e.fillStyle=l,e.beginPath(),e.arc(0,-18,10,Math.PI,0),e.lineTo(10,0),e.lineTo(-10,0),e.lineTo(-10,-18),e.fill(),e.stroke(),e.fillStyle="rgba(0,0,0,0.15)";for(let u=0;u<6;u++){const h=(We(o+u)-.5)*16,g=-4-We(o*u)*20;e.fillRect(h,g,2,2)}e.fillStyle=c,o>.5?(e.beginPath(),e.moveTo(4,-24),e.lineTo(7,-18),e.stroke()):(e.fillStyle=c,e.fillRect(-10,-18,4,4)),e.fillStyle="#424242",e.fillRect(-4,-14,8,2),e.fillRect(-3,-10,6,2),e.fillStyle="rgba(0,0,0,0.5)",e.beginPath(),e.ellipse(0,2,12,4,0,0,Math.PI*2),e.fill(),e.strokeStyle="#0f1a13",e.lineWidth=1;const d=5+Math.floor(o*4);for(let u=0;u<d;u++){const h=-12+u/d*24+(We(u)-.5)*4,g=3+We(u*2)*4;e.beginPath(),e.moveTo(h,2),e.quadraticCurveTo(h+1,2-g/2,h+(u%2==0?2:-2),2-g),e.stroke()}e.restore()}let ii=null;function ar(){if(ii)return ii;const e=128,t=2;typeof OffscreenCanvas<"u"?ii=new OffscreenCanvas(e,e):(ii=document.createElement("canvas"),ii.width=e,ii.height=e);const i=ii.getContext("2d");i.translate(e/2,e/2),i.scale(t,t);const a=i.createRadialGradient(-4,-8,2,0,0,18);return a.addColorStop(0,"#ffffff"),a.addColorStop(.5,"#e1f5fe"),a.addColorStop(1,"#b3e5fc"),i.fillStyle=a,i.beginPath(),i.arc(0,-12,8,Math.PI,0),i.lineTo(8,10),i.lineTo(4,8),i.lineTo(0,12),i.lineTo(-4,8),i.lineTo(-8,10),i.lineTo(-8,-12),i.fill(),i.fillStyle="#e1f5fe",i.beginPath(),i.moveTo(-8,-4),i.lineTo(-12,-8),i.lineTo(-10,-2),i.lineTo(-8,0),i.fill(),i.beginPath(),i.moveTo(8,-4),i.lineTo(12,-2),i.lineTo(10,2),i.lineTo(8,-2),i.fill(),i.fillStyle="#1a237e",i.save(),i.translate(-3,-10),i.rotate(-.2),i.fillRect(-1.5,-2,3,5),i.restore(),i.save(),i.translate(3,-10),i.rotate(.2),i.fillRect(-1.5,-2,3,5),i.restore(),i.fillRect(-2,-4,4,6),ii}function Wo(e,t,i,a,o=0){e.save(),e.save(),e.translate(t,i+20*a),e.scale(a,a*.3),e.fillStyle="rgba(0,0,0,0.4)",e.beginPath(),e.arc(0,0,10,0,Math.PI*2),e.fill(),e.restore();const n=Math.sin(o*.8)*(5*a),s=ar(),l=32*a;e.save(),e.translate(t,i+n),e.globalAlpha=.7,e.drawImage(s,-l,-l,l*2,l*2),e.restore(),e.restore()}let ai=null,hs=0,us=0,ps=!1,gs=0;function or(e,t,i,a=!0){const{cx:o,horizonY:n,scaleX:s,wingsPerSide:l}=na(t,i),c=r.bat&&r.bat.pivotY?r.bat.pivotY:i*.85;if(!(!ai||Math.floor(t)!==Math.floor(hs)||Math.floor(i)!==Math.floor(us)||a!==ps||Math.abs(c-gs)>2)){e.drawImage(ai,0,0);return}hs=t,us=i,ps=a,gs=c,typeof OffscreenCanvas<"u"?ai=new OffscreenCanvas(t,i):(ai=document.createElement("canvas"),ai.width=t,ai.height=i);const d=ai.getContext("2d");d.clearRect(0,0,t,i),d.clearRect(0,0,t,n),d.save(),d.beginPath(),d.rect(0,n,t,i-n),d.clip();const u=(x,ce)=>{const Ke=document.createElement("canvas");Ke.width=1024,Ke.height=1024;const _=Ke.getContext("2d");_.imageSmoothingEnabled=!0;const A="#0b1214",G="#162a26",B="#2f4f48",J="#4a6b63";_.fillStyle=A,_.fillRect(0,0,1024,1024);const q=[],te=25;for(let oe=0;oe<te;oe++)q.push({x:Math.random()*1024,y:Math.random()*1024,r:10+Math.random()*20});const ie=(oe,Pe)=>{for(let re of q){const ue=oe-re.x,pe=Pe-re.y;if(ue*ue+pe*pe<re.r*re.r)return!0}return!1},le=150,fe=1024/le;for(let oe=0;oe<le;oe++){const Pe=oe/le,re=oe*fe,ue=.5+Math.pow(Pe,2.2)*3,pe=200*(1.1-Pe*.3);for(let ve=0;ve<pe;ve++){const $e=Math.random()*1024,Je=(Math.random()-.5)*fe*1.5,et=re+Je;if(ie($e,et))continue;const Ui=Math.random(),vt=(15+Math.random()*20)*ue;_.lineWidth=1*ue,_.lineCap="round";let zt=G;if(Math.random()>.6&&(zt=B),Math.random()>.9&&(zt=J),_.strokeStyle=zt,_.beginPath(),Ui<.4){const Jt=2+Math.floor(Math.random()*2),we=(Math.random()-.5)*10*ue,it=4*ue;for(let pt=0;pt<Jt;pt++){const Ct=$e+pt*it;_.moveTo(Ct,et),_.quadraticCurveTo(Ct+we,et-vt*.7,Ct+we*1.2,et-vt)}}else if(Ui<.8)for(let we=0;we<3;we++){const it=$e+(Math.random()-.5)*10*ue,pt=(Math.random()-.5)*30*ue,Ct=vt*(.8+Math.random()*.4);_.moveTo(it,et),_.quadraticCurveTo(it+pt*.5,et-Ct/2,it+pt,et-Ct)}else{const Jt=(Math.random()-.5)*15*ue,we=vt*1.3;_.moveTo($e,et),_.quadraticCurveTo($e+Jt,et-we*.8,$e+Jt*2.5,et-we)}_.stroke()}}return Ke},h=i-n,g=1037;(!r.hauntedPatternCanvas||r.hauntedPatternCanvas._cacheId!==g)&&(r.hauntedPatternCanvas=u(),r.hauntedPatternCanvas._cacheId=g),d.save(),d.drawImage(r.hauntedPatternCanvas,0,n,t,h),d.restore(),d.save(),d.globalCompositeOperation="overlay";const m=d.createRadialGradient(o,n,50,o,n+200,600);m.addColorStop(0,"rgba(255, 200, 50, 0.4)"),m.addColorStop(.3,"rgba(100, 100, 50, 0.1)"),m.addColorStop(1,"rgba(0, 0, 0, 0)"),d.fillStyle=m,d.transform(1,0,0,.3,0,n*.7),d.fillRect(0,n,t,i),d.restore();const p=[],b=32,v=35;let y=0;for(;p.length<b&&y<200;){y++;const x=y*13,ce=Math.pow(We(x),.8),Te=n+20+ce*(i-n-100),be=90+ce*320,Ke=(t-be)/2,_=We(x+7)>.5?1:-1,A=We(x+3)*(Ke-40),G=o+_*(be/2+20+A);let B=!1;for(let J of p){const q=J.x-G,te=J.y-Te,ie=Math.sqrt(q*q+te*te),le=v*(.6+ce*.4);if(ie<le){B=!0;break}}B||p.push({x:G,y:Te,z:ce,id:p.length})}p.sort((x,ce)=>x.y-ce.y),p.forEach(x=>{const ce=.6+x.z*1,Te=We(x.id+50);d.fillStyle="rgba(0, 0, 0, 0.5)",d.beginPath(),d.ellipse(x.x,x.y+5*ce,15*ce,6*ce,0,0,Math.PI*2),d.fill(),ir(d,x.x,x.y,ce,Te)});const T=70,S=c-30,P=70,w=150+(typeof Fe<"u"?Fe:0)+32;er(d,o,n,P,S,P,a,w);const E=T/1.8027,M=1.5*E,D=o-E,I=c-M,H=-t,k=I+1.5*(H-D);fs(d,D,I,H,k);const O=o+E,W=c-M,Z=t*2,N=W-1.5*(Z-O);fs(d,O,W,Z,N),tr(d,o,c,T),d.save(),d.strokeStyle="#FFFFFF",d.lineWidth=4,d.lineWidth=3,d.strokeRect(o-70,c-30,30,60),d.strokeRect(o+40,c-30,30,60),d.fillStyle="#FFFFFF",d.beginPath(),d.moveTo(o,c+10),d.lineTo(o+10,c),d.lineTo(o+10,c-10),d.lineTo(o-10,c-10),d.lineTo(o-10,c),d.fill(),d.restore();const $=75,V=18;d.save(),d.translate(o,w);const j="#212121",ge=3,se=V/ge;d.fillStyle=j,d.beginPath(),d.ellipse(0,V,$,$*.4,0,0,Math.PI*2),d.rect(-$,0,$*2,V),d.fill(),d.save();for(let x=0;x<ge;x++){const ce=x*se,Te=(x+1)*se,be=12,Ke=x%2*(Math.PI/be);for(let _=0;_<be/2+2;_++){const A=_*(Math.PI/(be/2))+Ke,G=A+Math.PI/(be/2)-.1;if(A>Math.PI-.1)continue;const B=(oe,Pe)=>({x:Math.cos(oe)*$,y:Math.sin(oe)*($*.4)+Pe}),J=B(A,ce),q=B(G,ce),te=B(A,Te),ie=B(G,Te);d.beginPath(),d.moveTo(J.x,J.y),d.lineTo(q.x,q.y),d.lineTo(ie.x,ie.y),d.lineTo(te.x,te.y),d.closePath();const le=x*99+_*13,fe=60+We(le)*20;d.fillStyle=`rgb(${fe}, ${fe}, ${fe})`,d.fill(),d.strokeStyle="#151515",d.lineWidth=1,d.stroke(),d.strokeStyle="rgba(255,255,255,0.4)",d.lineWidth=1,d.beginPath(),d.moveTo(J.x,J.y),d.lineTo(q.x,q.y),d.moveTo(J.x,J.y),d.lineTo(te.x,te.y),d.stroke(),d.strokeStyle="rgba(0,0,0,0.5)",d.beginPath(),d.moveTo(te.x,te.y),d.lineTo(ie.x,ie.y),d.lineTo(q.x,q.y),d.stroke()}}d.restore(),d.strokeStyle="#000000",d.lineWidth=2,d.beginPath(),d.ellipse(0,V,$,$*.4,0,Math.PI,0),d.stroke(),d.save(),d.scale(1,.4);const Q=15,Se=$,Ee=$*.6,ye=12,me=Math.PI*2/ye;for(let x=0;x<ye;x++){const ce=x*me,Te=(x+1)*me,be=90+We(x)*20;d.fillStyle=`rgb(${be}, ${be}, ${be})`,d.beginPath(),d.arc(0,0,Se,ce,Te),d.arc(0,0,Ee,Te,ce,!0),d.closePath(),d.fill(),d.stroke()}const Be=Q,Ne=8,Ve=Math.PI*2/Ne,Xe=Ve/2;for(let x=0;x<Ne;x++){const ce=Xe+x*Ve,Te=Xe+(x+1)*Ve,be=95+We(x+50)*20;d.fillStyle=`rgb(${be}, ${be}, ${be})`,d.beginPath(),d.arc(0,0,Ee,ce,Te),d.arc(0,0,Be,Te,ce,!0),d.closePath(),d.fill(),d.stroke()}d.fillStyle="#757575",d.beginPath(),d.arc(0,0,Q,0,Math.PI*2),d.fill(),d.stroke(),d.restore(),d.strokeStyle="#121212",d.lineWidth=2.5,d.beginPath(),d.ellipse(0,0,$,$*.4,0,0,Math.PI*2),d.stroke();const je=5;for(let x=0;x<je;x++){const ce=x/je*Math.PI*2+.5;if(Math.sin(ce)<-.2)continue;const Te=Math.cos(ce)*$,be=Math.sin(ce)*($*.4);d.save(),d.translate(Te,be),d.scale(.6,.6),d.rotate(Math.PI/4+Math.random()*.3),d.beginPath(),d.strokeStyle="rgba(255,255,255,0.25)",d.lineWidth=1,d.moveTo(0,0),d.lineTo(10,25),d.moveTo(0,0),d.lineTo(-12,22),d.moveTo(-6,12),d.lineTo(6,14),d.stroke(),d.restore()}d.restore(),d.save(),d.strokeStyle="#FFFFFF",d.lineWidth=3,d.strokeRect(o-70,c-30,30,60),d.strokeRect(o+40,c-30,30,60),d.fillStyle="#FFFFFF",d.beginPath(),d.moveTo(o,c+10),d.lineTo(o+10,c),d.lineTo(o+10,c-10),d.lineTo(o-10,c-10),d.lineTo(o-10,c),d.fill(),d.restore(),xl(d,t,i),typeof ss=="function"&&ss(d,t,i),d.restore(),e.drawImage(ai,0,0)}let ja=0,ms=0;function nr(e,t,i){const a=Date.now();ja===0&&(ja=a),ms+=a-ja,ja=a;const o=ms,n=[{id:0,xBase:t*.3,yBase:i*.2,r:60,speed:.002},{id:1,xBase:t*.7,yBase:i*.25,r:50,speed:-.002},{id:2,xBase:t*.4,yBase:i*.18,r:70,speed:.0015},{id:3,xBase:t*.5,yBase:i*.15,r:80,speed:.001},{id:4,xBase:t*.2,yBase:i*.3,r:30,speed:.003}];e.save(),e.fillStyle="#000",n.forEach(s=>{const l=o*s.speed+s.id*100,c=s.xBase+Math.cos(l)*s.r,f=s.yBase+Math.sin(l*1.5)*(s.r*.5),d=Math.sin(o*.015+s.id),u=9;e.beginPath(),e.moveTo(c,f),e.lineTo(c-u*2,f-u*d),e.lineTo(c-u,f+u/2),e.lineTo(c,f+u),e.lineTo(c+u,f+u/2),e.lineTo(c+u*2,f-u*d),e.fill()}),e.restore()}let Yt=null,Ri=null,Mi=null,no=0,on=0;function Js(e,t,i){e.save(),e.globalAlpha=1,e.globalCompositeOperation="source-over",e.clearRect(0,0,t,i),e.restore();const a=r.isGameOver;qs(e,t,i,!0);const o=Date.now()/1e3;Yl(e,t,i,o);const n=t<600?1.4:2.5,s=t/i,l=.5,f=Math.max(0,Math.min(1,(s-l)/(1.8-l))),d=i*(.7+f*.2),u=t*1.2,h=-t*.1,g=4096,m=2160,p=64,b=Math.min(t,g),v=Math.min(i,m),y=Math.ceil(b/p)*p,T=Math.ceil(v/p)*p;if(!Yt||no!==y||on!==T){t>g&&console.warn(`[HauntedRenderer] Clamping Cache Width: ${t} -> ${g}`),(!Yt||Math.abs(y-no)>p)&&console.log(`[HauntedRenderer] Regenerating Start Screen Cache ${y}x${T} (Bucket Aligned)`),typeof OffscreenCanvas<"u"?(Yt=new OffscreenCanvas(y,T),Ri=new OffscreenCanvas(y,T),Mi=new OffscreenCanvas(y,T)):(Yt=document.createElement("canvas"),Yt.width=y,Yt.height=T,Ri=document.createElement("canvas"),Ri.width=y,Ri.height=T,Mi=document.createElement("canvas"),Mi.width=y,Mi.height=T);const V=Yt.getContext("2d"),j=Ri.getContext("2d"),ge=Mi.getContext("2d");V.save();const se=V.createLinearGradient(0,d,0,i);se.addColorStop(0,"#151515"),se.addColorStop(1,"#000000"),V.fillStyle=se,V.fillRect(h,d-2,u,i-d+2),V.strokeStyle="rgba(10, 10, 10, 0.5)",V.lineWidth=2,V.beginPath();const Q=20*n,Se=40*n;for(let Xe=d;Xe<i;Xe+=Q){const je=Math.floor((Xe-d)/Q),x=je%2===0?0:Se/2;for(let ce=h-Se;ce<h+u;ce+=Se){const Te=Math.floor((ce-h)/Se);Xe-d<(i-d)*.7&&(V.strokeRect(ce+x,Xe,Se,Q),Math.sin(je*12.9898+Te*78.233)>.8&&(V.fillStyle="rgba(0,0,0,0.3)",V.fillRect(ce+x,Xe,Se,Q)))}}V.stroke();const Ee=V.createLinearGradient(0,i*.75,0,i);Ee.addColorStop(0,"rgba(0,0,0,0)"),Ee.addColorStop(1,"rgba(0,0,0,0.8)"),V.fillStyle=Ee,V.fillRect(0,i*.75,t,i*.25),V.fillStyle="#222",V.fillRect(h,d-5,u,10),V.restore();const ye=300*n,me=(t-ye)/2;let Be=0;me>0&&(Be=Math.ceil(me/(90*n)));const Ne=Math.min(Math.max(3,1+Be),7),Ve={cx:y/2,baseY:d,scaleX:n,scaleY:n,wingsPerSide:Ne};Ea(V,y,T,0,"STRUCTURE_ONLY",0,Ve),Ea(j,y,T,0,"WINDOWS_ONLY",0,Ve),Ea(ge,y,T,0,"WINDOWS_ONLY",0,Ve,"#ff0000"),no=y,on=T}e.drawImage(Yt,0,0,t,i),nr(e,t,i),e.save();const R=Math.sin(Date.now()/1e3)*.1+.9;e.globalAlpha=R,e.globalCompositeOperation="screen";const S=a?Mi:Ri;S&&e.drawImage(S,0,0,t,i),e.restore();const P=i*.82,w=e.createLinearGradient(0,P,0,i);w.addColorStop(0,"#121010"),w.addColorStop(1,"#000000"),e.fillStyle=w,e.beginPath(),e.moveTo(0,i),e.lineTo(0,P+40);const E=t*.3,M=t*.7;e.quadraticCurveTo(t*.15,P+10,E,P),e.lineTo(M,P),e.quadraticCurveTo(t*.85,P+10,t,P+40),e.lineTo(t,i),e.fill(),e.save();const D=400,I=V=>{let j=V+=1831565813;return j=Math.imul(j^j>>>15,j|1),j^=j+Math.imul(j^j>>>7,j|61),((j^j>>>14)>>>0)/4294967296};for(let V=0;V<D;V++){const j=I(V*123),ge=I(V*456),se=I(V*789),Q=j*t,Se=P+ge*(i-P),Ee=se*3+1;e.fillStyle=I(V*999)>.5?"#1a1a1a":"#050505",e.fillRect(Q,Se,Ee,Ee)}e.restore(),e.fillStyle="#050505";const H=Math.floor(t/30),k=V=>{const j=Math.sin(V)*1e4;return j-Math.floor(j)};for(let V=0;V<H;V++){const j=V/H,ge=t*j;let se=P;if(ge<E){const Q=ge/E;se=(P+40)*(1-Q)+P*Q}else if(ge>M){const Q=(ge-M)/(t-M);se=P*(1-Q)+(P+40)*Q}k(V*99)>.4&&Ql(e,ge,se+5,.6+k(V)*.4)}const O=t/2,W=P-50,Z=!1,N=r.isDailyChallenge?U.dailyHighScore:U.highScore;Ys(e,O,W,1.4,!0,N,Z),e.save();const $=e.createLinearGradient(0,i*.7,0,i);if($.addColorStop(0,"rgba(0,0,0,0)"),a?($.addColorStop(.5,"rgba(40, 10, 10, 0.4)"),$.addColorStop(1,"rgba(20, 0, 0, 0.9)")):($.addColorStop(.5,"rgba(10, 20, 30, 0.3)"),$.addColorStop(1,"rgba(0, 0, 0, 0.8)")),e.fillStyle=$,e.fillRect(0,i*.7,t,i*.3),e.restore(),e.textAlign="center",e.shadowColor="transparent",e.shadowOffsetX=0,e.shadowOffsetY=0,e.shadowBlur=0,a){const V=r.consecutiveFouls>=4;let j="GAME OVER",ge="#6200ea";V&&(j="BAT BROKEN!"),e.save(),e.font='40px "PressStart2PLocal"',e.strokeStyle="#000000",e.lineWidth=4,e.strokeText(j,t/2,i*.45),e.fillStyle=ge,e.fillText(j,t/2,i*.45),e.restore(),e.font='20px "PressStart2PLocal"',e.fillStyle="#eceff1",e.fillText(`SCORE: ${U.score}`,t/2,i*.52),Math.floor(Date.now()/800)%2===0&&(e.font='16px "PressStart2PLocal"',e.fillStyle="#ffffff",e.fillText("TAP TO RETRY",t/2,i*.6))}else{e.save();const V=Math.sin(Date.now()/300);e.globalAlpha=.6+(V+1)*.2,e.font='40px "PressStart2PLocal"',e.fillStyle="#80d8ff",e.strokeStyle="#000000",e.lineWidth=6,e.lineJoin="round",window.innerWidth<=600||window.innerHeight<=600?(e.strokeText("TAP TO",t/2,i*.48),e.fillText("TAP TO",t/2,i*.48),e.strokeText("START",t/2,i*.48+50),e.fillText("START",t/2,i*.48+50)):(e.strokeText("TAP TO START",t/2,i*.48),e.fillText("TAP TO START",t/2,i*.48)),e.restore()}}function _a(e,t){if(!(typeof document>"u"))try{console.log(`[HauntedRenderer] Warming up caches for ${e}x${t}...`);const i=document.createElement("canvas");i.width=1,i.height=1;const a=i.getContext("2d");Js(a,e,t);const o=e<600?.6:.8;Ys(a,0,0,o),js(a,e,t),console.log("[HauntedRenderer] Warmup Complete.")}catch(i){console.warn("[HauntedRenderer] Warmup Failed:",i)}}function sr(){console.log("[HauntedRenderer] Cleaning up Start Screen caches to free memory."),Yt=null,Ri=null,Mi=null,no=0,on=0}class lr{constructor(){this.activeEffect=null,this.timer=0,this.artifacts=[],this.glitchTimer=0,this.shakeElement=document.body}triggerEffect(t){this.activeEffect!==t&&(this.stopEffect(),this.activeEffect=t,t==="GLITCH_PERFECT"&&(this.timer=.6,this.shakeElement.classList.add("glitch-shake"),this._generateArtifacts(10)))}update(t){if(this.activeEffect){if(this.timer-=t,this.timer<=0){this.stopEffect();return}this.activeEffect==="GLITCH_PERFECT"&&this._updateGlitch(t)}}render(t){this.activeEffect&&this.activeEffect==="GLITCH_PERFECT"&&this._renderGlitch(t)}stopEffect(){this.activeEffect=null,this.timer=0,this.artifacts=[],this.shakeElement.classList.remove("glitch-shake")}_updateGlitch(t){this.glitchTimer+=t,this.glitchTimer>.05&&(this.glitchTimer=0,Math.random()>.3&&this._generateArtifacts(3)),this.artifacts.forEach(i=>i.life-=t*5),this.artifacts=this.artifacts.filter(i=>i.life>0)}_generateArtifacts(t){for(let i=0;i<t;i++)this.artifacts.push({x:Math.random()*K,y:Math.random()*de,w:Math.random()*200+20,h:Math.random()*50+2,color:Math.random()>.5?"#00ffff":"#ff00ff",life:Math.random()*.2+.1,offsetY:(Math.random()-.5)*10})}_renderGlitch(t){if(t.save(),t.globalCompositeOperation="exclusion",this.artifacts.forEach(i=>{t.fillStyle=i.color,t.globalAlpha=i.life*2,t.fillRect(i.x,i.y,i.w,i.h)}),Math.random()>.5){t.fillStyle="rgba(0, 0, 0, 0.1)";const i=Math.random()*de;t.fillRect(0,i,K,10)}t.restore()}}const un=new lr,Ji={[F.FASTBALL]:{name:"Fastball",colorName:"WHITE",colors:["#ffffff"],baseSpeed:.6,rotationSpeed:.15,windupDuration:1e3,chargeSound:null,specialLogic:null},[F.CURVEBALL]:{name:"Curveball",colorName:"PINK",colors:["#ff69b4"],baseSpeed:.5,rotationSpeed:.3,windupDuration:1e3,chargeSound:"playCurveCharge",specialLogic:"curve"},[F.CHANGEUP]:{name:"Changeup",colorName:"GOLD",colors:["#ffd700"],baseSpeed:.45,rotationSpeed:.05,windupDuration:1e3,chargeSound:"playChangeCharge",specialLogic:null},super_fastball:{name:"Super Fastball",colorName:"RED",colors:["#ff0000"],baseSpeed:.85,rotationSpeed:.4,windupDuration:1e3,chargeSound:"playSuperCharge",specialLogic:null},[F.STOPBALL]:{name:"Stopball",colorName:"PURPLE",colors:["#800080"],baseSpeed:.65,rotationSpeed:.2,windupDuration:1e3,chargeSound:"playEvilLaugh",specialLogic:"stop"},[F.GHOSTBALL]:{name:"Ghostball",colorName:"CYAN",colors:["#00ffff"],baseSpeed:.55,rotationSpeed:.2,windupDuration:1e3,chargeSound:"playGhostCharge",specialLogic:"ghost"},[F.STOP_CURVE]:{name:"Stop-Curve",colorName:"PURPLE/PINK",colors:["#800080","#ff69b4"],baseSpeed:.55,rotationSpeed:.3,windupDuration:2500,chargeSound:"playEvilLaugh",specialLogic:"stop_curve"},[F.GHOST_CURVE]:{name:"Ghost-Curve",colorName:"CYAN/PINK",colors:["#00ffff","#ff69b4"],baseSpeed:.55,rotationSpeed:.3,windupDuration:2500,chargeSound:"playGhostCharge",specialLogic:"ghost_curve"},[F.SPLITTER]:{name:"Splitter",colorName:"BLUE",colors:["#00008b"],baseSpeed:.35,rotationSpeed:.1,windupDuration:1e3,chargeSound:"playSplitterCharge",specialLogic:"splitter"},[F.ZIGZAG]:{name:"ZigZag",colorName:"Lime Green",colors:["#32CD32"],baseSpeed:.55,rotationSpeed:.2,windupDuration:1e3,chargeSound:"playZigZagCharge",throwSound:null,specialLogic:"zigzag"},[F.SUPER_CURVE]:{name:"Super-Curve",colorName:"RED/PINK",colors:["#ff0000","#ff69b4"],baseSpeed:.85,rotationSpeed:.4,windupDuration:2500,chargeSound:"playSuperCharge",specialLogic:"super_curve"},[F.SUPER_ZIGZAG]:{name:"Super-ZigZag",colorName:"RED/GREEN",colors:["#ff0000","#32CD32"],baseSpeed:.85,rotationSpeed:.4,windupDuration:2500,chargeSound:"playSuperCharge",throwSound:null,specialLogic:"super_zigzag"},[F.SUPER_SPLITTER]:{name:"Super-Splitter",colorName:"RED/BLUE",colors:["#ff0000","#00008b"],baseSpeed:.38,rotationSpeed:.4,windupDuration:2500,chargeSound:"playSuperCharge",throwSound:"playSplitter",specialLogic:"super_splitter"},[F.STOP_SPLITTER]:{name:"Stop-Splitter",colorName:"PURPLE/BLUE",colors:["#800080","#00008b"],baseSpeed:.35,rotationSpeed:.3,windupDuration:2500,chargeSound:"playEvilLaugh",throwSound:"playSplitter",specialLogic:"stop_splitter"},[F.STOP_ZIGZAG]:{name:"Stop-ZigZag",colorName:"PURPLE/GREEN",colors:["#800080","#32CD32"],baseSpeed:.55,rotationSpeed:.3,windupDuration:2500,chargeSound:"playEvilLaugh",throwSound:null,specialLogic:"stop_zigzag"},[F.GHOST_SPLITTER]:{name:"Ghost-Splitter",colorName:"CYAN/BLUE",colors:["#00FFFF","#00008b"],baseSpeed:.35,rotationSpeed:.3,windupDuration:2500,chargeSound:"playGhostCharge",throwSound:"playSplitter",specialLogic:"ghost_splitter"},[F.GHOST_ZIGZAG]:{name:"Ghost-ZigZag",colorName:"CYAN/GREEN",colors:["#00FFFF","#32CD32"],baseSpeed:.55,rotationSpeed:.3,windupDuration:2500,chargeSound:"playGhostCharge",throwSound:null,specialLogic:"ghost_zigzag"},[F.GHOST_CHANGEUP]:{name:"Ghost-Changeup",colorName:"CYAN/GOLD",colors:["#00FFFF","#ffd700"],baseSpeed:.35,rotationSpeed:.3,windupDuration:2500,chargeSound:"playGhostCharge",throwSound:"playPitch",specialLogic:"ghost_changeup"},[F.CURVE_SPLITTER]:{name:"Curve-Splitter",colorName:"PINK/BLUE",colors:["#ff69b4","#00008b"],baseSpeed:.35,rotationSpeed:.3,windupDuration:2500,chargeSound:"playCurveCharge",throwSound:"playSplitter",specialLogic:"curve_splitter"},[F.ZIGZAG_SPLITTER]:{name:"ZigZag-Splitter",colorName:"GREEN/BLUE",colors:["#32CD32","#00008b"],baseSpeed:.35,rotationSpeed:.3,windupDuration:2500,chargeSound:"playZigZagCharge",throwSound:"playSplitter",specialLogic:"zigzag_splitter"},[F.CURVE_CHANGEUP]:{name:"Curve-Changeup",colorName:"PINK/GOLD",colors:["#ff69b4","#ffd700"],baseSpeed:.35,rotationSpeed:.3,windupDuration:2500,chargeSound:"playCurveCharge",throwSound:"playPitch",specialLogic:"curve_changeup"},[F.SPLITTER_CHANGEUP]:{name:"Splitter-Changeup",colorName:"BLUE/GOLD",colors:["#00008b","#ffd700"],baseSpeed:.22,rotationSpeed:.3,windupDuration:2500,chargeSound:"playSplitterCharge",throwSound:"playSplitter",specialLogic:"splitter_changeup"},[F.ZIGZAG_CHANGEUP]:{name:"ZigZag-Changeup",colorName:"GREEN/GOLD",colors:["#32CD32","#ffd700"],baseSpeed:.35,rotationSpeed:.3,windupDuration:2500,chargeSound:"playZigZagCharge",throwSound:null,specialLogic:"zigzag_changeup"},[F.GHOST_STOP]:{name:"Ghost-Stop",colorName:"CYAN/PURPLE",colors:["#00FFFF","#800080"],baseSpeed:.55,rotationSpeed:.2,windupDuration:2500,chargeSound:"playGhostCharge",throwSound:null,specialLogic:"ghost_stop"},[F.GHOST_SUPER]:{name:"Ghost-Super",colorName:"CYAN/RED",colors:["#00FFFF","#ff0000"],baseSpeed:.85,rotationSpeed:.4,windupDuration:2500,chargeSound:"playGhostCharge",throwSound:null,specialLogic:"ghost_super"},[F.STOP_SUPER]:{name:"Stop-Super",colorName:"PURPLE/RED",colors:["#800080","#ff0000"],baseSpeed:.85,rotationSpeed:.4,windupDuration:2500,chargeSound:"playEvilLaugh",throwSound:null,specialLogic:"stop_super"},[F.STOP_CHANGEUP]:{name:"Stop-Changeup",colorName:"PURPLE/GOLD",colors:["#800080","#ffd700"],baseSpeed:.35,rotationSpeed:.2,windupDuration:2500,chargeSound:"playEvilLaugh",throwSound:null,specialLogic:"stop_changeup"}};function rr(){for(const e in Ca)delete Ca[e]}function nn(e,t,i,a,o,n={}){const s=r.pitcher.gender||"MALE",l=n&&Object.keys(n).length>0?n:r.pitcher.props||{},c=`${l.sunglasses?"sg":""}${l.beard?"bd":""}${l.goldChain?"gc":""}${l.spaceHelmet?"sh":""}`;let f="";r.pitcher.id==="MONITOR"&&r.perfectHitTimer>0&&(f="_sad");const u=(r.pitcher.id==="ROOKIE"||!r.pitcher.id)&&(t==="#ff0000"||t==="#FF0000")?`_red_${Math.floor(Date.now()/100)}`:"",h=`${e}_${t}_${i||"none"}_${a!==void 0?a:"full"}_${o||"default"}_${s}_${c}${f}_${r.pitcher.id||"NONE"}${u}`;if(Ca[h])return Ca[h];oo.width=Qe,oo.height=Qe,ct.clearRect(0,0,Qe,Qe);const g=s==="FEMALE",m=o==="#000000";if(ys(ct,ea,Pa,e,"#ffffff",null,"UNIFORM",g,m,o,l),ct.globalCompositeOperation="source-atop",a!==void 0){const v=Qe*a,y=Qe-v;ct.fillStyle=t,ct.fillRect(0,y,Qe,v)}else i?(ct.fillStyle=t,ct.fillRect(0,0,Qe/2,Qe),ct.fillStyle=i,ct.fillRect(Qe/2,0,Qe/2,Qe)):(ct.fillStyle=t,ct.fillRect(0,0,Qe,Qe));ct.globalCompositeOperation="source-over",ys(ct,ea,Pa,e,"#ffffff",null,"SKIN",g,m,o,l),sn(ct,ea,Pa,e,l);const p=document.createElement("canvas");return p.width=Qe,p.height=Qe,p.getContext("2d").drawImage(oo,0,0),Ca[h]=p,p}function sn(e,t,i,a,o={}){const n=(u,h,g,m,p)=>{e.fillStyle=p,e.fillRect(u,h,g,m)};if(r.pitcher.id==="MONITOR"){X.currentTheme.id,X.currentTheme.id;let u=t,h=i-14,g=32,m=26;a==="THROW"&&(u=t+5,h=i-12),e.fillStyle="#111111",e.fillRect(u+3,h+3,g-6,m-6),e.fillStyle="#00ff00",r.perfectHitTimer>0?(e.fillStyle="#00ff00",e.fillRect(u+10,h+6,4,4),e.fillRect(u+18,h+6,4,4),e.strokeStyle="#00ff00",e.lineWidth=2,e.strokeRect(u+13,h+15,6,6)):(e.fillRect(u+10,h+6,4,4),e.fillRect(u+18,h+6,4,4),e.fillRect(u+10,h+13,2,2),e.fillRect(u+20,h+13,2,2),e.fillRect(u+12,h+15,8,2));return}let s=i-10,l=t+8;if(a==="THROW"&&(l=t+13,s=i-8),r.pitcher.id==="SCARY"){e.save(),e.translate(t+16,i+32);const u=e.createRadialGradient(0,0,5,0,0,25);u.addColorStop(0,"rgba(0, 0, 0, 0.8)"),u.addColorStop(1,"rgba(0, 0, 0, 0)"),e.fillStyle=u,e.beginPath(),e.arc(0,0,25,0,Math.PI*2),e.fill(),e.restore()}const c=r.pitcher.gender==="FEMALE",f=r.pitcher.skinColor||"#ffccaa";if(c){const u=f==="#000000"||f==="#1a1a1a"||f==="#808080",h=u?f:"#FFD54F";e.fillStyle=h,e.beginPath(),e.arc(l+8,s+6,8.2,0,Math.PI*2),e.fill(),e.fillStyle=f,e.beginPath(),e.ellipse?e.ellipse(l+8,s+9,7,8.5,0,0,Math.PI*2):e.arc(l+8,s+9,7,0,Math.PI*2),e.fill(),u||(e.fillStyle="#1E88E5",e.beginPath(),e.arc(l+5,s+9,1.5,0,Math.PI*2),e.fill(),e.beginPath(),e.arc(l+11,s+9,1.5,0,Math.PI*2),e.fill(),e.strokeStyle="#D81B60",e.lineWidth=1.5,e.beginPath(),e.arc(l+8,s+10,3,.2*Math.PI,.8*Math.PI),e.stroke()),e.fillStyle=h,e.beginPath(),e.moveTo(l+1,s+4),e.bezierCurveTo(l,s-2,l+6,s-4,l+15,s+5),e.lineTo(l+15,s+9),e.bezierCurveTo(l+8,s+2,l+4,s+2,l+1,s+7),e.fill()}else r.pitcher.id==="SCARY"&&(e.fillStyle="#ff0000",e.fillRect(l+4,s+6,2,2),e.fillRect(l+10,s+6,2,2));r.bossModeActive,c||r.pitcher.id==="SCARY"&&(e.fillStyle="#ff0000",e.shadowColor="#ff0000",e.shadowBlur=10,e.fillRect(l+4,s+5,2,2),e.fillRect(l+10,s+5,2,2),e.shadowBlur=0),o.spaceHelmet&&(e.fillStyle="rgba(173, 216, 230, 0.5)",e.strokeStyle="rgba(255, 255, 255, 0.8)",e.lineWidth=2,e.beginPath(),e.arc(l+8,s+8,12,0,Math.PI*2),e.fill(),e.stroke(),e.beginPath(),e.arc(l+12,s+4,3,0,Math.PI*2),e.fillStyle="rgba(255, 255, 255, 0.9)",e.fill());const d=c?"#FF69B4":"#000000";a==="SET"?(n(t+2,i+32,10,4,d),n(t+20,i+32,10,4,d),n(t+10,i+12,12,10,"#ffffff")):a==="KICK"?(n(t+20,i+32,10,4,d),n(t-8,i+22,10,4,d),n(t+20,i+12,8,8,"#ffffff")):a==="THROW"?(n(t+35,i+32,10,4,d),n(t+5,i+32,10,4,d),n(t-5,i+10,8,8,"#ffffff")):(n(t+2,i+32,10,4,d),n(t+20,i+32,10,4,d))}function ys(e,t,i,a,o,n,s="ALL",l=null,c=!1,f=null,d={}){const h=l!==null?l:r.pitcher.gender==="FEMALE",g=d.sunglasses||!1,m=d.beard||!1,p=d.goldChain||!1,b=d.hatColor||null,v=c,y=f||r.pitcher.skinColor||"#ffccaa",T=s==="ALL"||s==="UNIFORM",R=s==="ALL"||s==="SKIN",S=(k,O,W,Z)=>{T&&(e.fillStyle=o,e.fillRect(k,O,W,Z))},P=(k,O,W,Z,N)=>{R&&(e.fillStyle=N,e.fillRect(k,O,W,Z))},w=(k,O)=>{if(R){if(r.pitcher.id==="MONITOR"){e.fillStyle="#d0d0c0",e.fillRect(k-8,O-4,32,26);return}if(h)e.fillStyle=y,e.beginPath(),e.arc(k+8,O+8,8,0,Math.PI*2),e.fill();else{const W=b||(v?"#ffffff":"#e74c3c");if(v)e.fillStyle=W,e.fillRect(k-2,O-4,20,6),e.fillStyle=y,e.fillRect(k,O,16,16);else if(e.fillStyle=y,e.fillRect(k,O,16,16),r.pitcher.id==="ACE")e.fillStyle="#000000",e.fillRect(k+1,O-8,14,8),e.fillRect(k,O-5,16,5),e.fillRect(k-1,O-1,2,8),e.fillRect(k+15,O-1,2,8);else if(r.pitcher.id==="ROOKIE"||b){const Z=b||"#e74c3c";e.fillStyle=Z,e.fillRect(k-2,O-4,20,6),e.fillStyle=Z,e.fillRect(k,O-6,16,4)}m&&(e.fillStyle="#000000",e.fillRect(k+2,O+12,12,1),e.fillRect(k-1,O+6,2,9),e.fillRect(k+15,O+6,2,9),e.fillRect(k,O+13,5,5),e.fillRect(k+11,O+13,5,5),e.fillRect(k+2,O+16,12,2),e.fillRect(k+7,O+14,2,2)),g&&(e.fillStyle="#000000",e.fillRect(k+1,O+4,6,5),e.fillRect(k+9,O+4,6,5),e.fillRect(k+7,O+4,2,1),e.fillRect(k+7,O+5,1,1),e.fillRect(k+8,O+5,1,1),e.fillStyle="#222222",e.fillRect(k+2,O+5,4,3),e.fillRect(k+10,O+5,4,3))}}},E=(k,O)=>{R&&p&&(e.strokeStyle="#B8860B",e.lineWidth=4,e.lineCap="round",e.beginPath(),e.moveTo(k+10,O+2),e.bezierCurveTo(k+10,O+14,k+22,O+14,k+22,O+2),e.stroke(),e.strokeStyle="#FFD700",e.lineWidth=3,e.setLineDash([2,1]),e.beginPath(),e.moveTo(k+10,O+2),e.bezierCurveTo(k+10,O+14,k+22,O+14,k+22,O+2),e.stroke(),e.setLineDash([]),e.shadowBlur=0)};let M=t+2,D=t+20,I=10;const H=d.shoeColor||r.pitcher.shoeColor||(h?"#FF69B4":"#000000");if(a==="SET")S(t,i,32,20),E(t,i),S(M,i+20,I,12),S(D,i+20,I,12),P(M,i+32,I,4,H),P(D,i+32,I,4,H),P(t+10,i+12,12,10,"#ffffff"),w(t+8,i-10);else if(a==="KICK")S(t,i,32,20),E(t,i),S(D,i+20,I,12),P(D,i+32,I,4,H),S(t-8,i+10,I,12),P(t-8,i+22,I,4,H),P(t+20,i+12,8,8,"#ffffff"),w(t+8,i-10);else if(a==="THROW"){S(t+5,i+2,32,20),E(t+5,i+2);let k=t+35,O=t+5;S(k,i+22,I,10),P(k,i+32,I,4,H),S(O,i+22,I,10),P(O,i+32,I,4,H),w(t+13,i-8),S(t+35,i+5,12,6),P(t-5,i+10,8,8,"#ffffff")}else S(t,i,32,20),E(t,i),S(M,i+20,I,12),S(D,i+20,I,12),P(M,i+32,I,4,H),P(D,i+32,I,4,H),w(t+8,i-10)}function cr(){let e=r.pitcher.baseColor,t=null,i;if(r.pitcher.state===Re.WINDUP){let p=Ji[r.pitcher.nextPitch];if(!p&&typeof r.pitcher.nextPitch=="string"&&(p=Ji[r.pitcher.nextPitch.trim().toLowerCase()]),r.showTutorial)r.settings?.noFlash||Math.floor(r.pitcher.timer/200)%2===0?e="#FF69B4":e="#FFFFFF";else if(p&&p.windupStyle==="fill"){e=p.colors[0];const b=r.pitcher.timer/r.pitcher.windupDuration;i=Math.floor(b*10)/10,i=Math.max(.1,Math.min(1,i))}else if(p&&p.colors)if(r.settings?.noFlash)p.colors.length>1?(e=p.colors[0],t=p.colors[1]):e=p.colors[0];else{const b=Math.floor(r.pitcher.timer/200)%2===0;p.colors.length>1?b?(e=p.colors[0],t=p.colors[1]):t=null:b?e=p.colors[0]:e="#FFFFFF"}}Array.isArray(e)&&(e=e[0]),Array.isArray(t)&&(t=t[0]);let a="IDLE";if(r.pitcher.state===Re.WINDUP){const p=r.pitcher.timer/r.pitcher.windupDuration;p<.3?a="SET":p<.7?a="KICK":a="THROW"}const n=!(r.pitcher.id==="SCARY")&&X.currentTheme?.pitcherAccessories?X.currentTheme.pitcherAccessories:{},l={...r.pitcher.props||{},...n};r.pitcher.id==="ACE"&&(l.sunglasses=!0,l.beard=!0,l.goldChain=!0);const c=nn(a,e,t,i,r.pitcher.skinColor,l),f=r.pitcher.scale||1,d=Qe*f,u=Qe*f,h=(Qe/2-ea)*(f-1),g=r.pitcher.x-ea*f-h,m=r.pitcher.y-Pa*f;if(C.save(),r.pitcher.rotation){const p=g+d/2,b=m+u/2;C.translate(p,b),C.rotate(r.pitcher.rotation),C.translate(-p,-b)}r.pitcher.gender==="FEMALE"&&dr(C,g,m,f,r.pitcher.skinColor,a),C.drawImage(c,g,m,d,u),C.restore()}function dr(e,t,i,a,o,n="IDLE"){const l=o==="#000000"||o==="#1a1a1a"?o:"#FFD54F";let c=t+(ea+8)*a,f=i+(Pa-2)*a;n==="THROW"&&(c+=5*a,f+=2*a);const d=c+12*a,u=f-9*a,h=(r.pitcher.timer||0)/200;let g=0;(r.pitcher.state===Re.WALK_ON||r.pitcher.state===Re.WALK_OFF)&&(g=Math.sin(h)*(2*a)),e.fillStyle=l,e.beginPath(),e.moveTo(d,u),e.quadraticCurveTo(d+8*a,u-2*a+g,d+14*a,u+12*a+g),e.quadraticCurveTo(d+8*a,u+6*a+g,d+2*a,u+4*a),e.fill(),e.beginPath(),e.arc(d+1*a,u+2*a,4*a,0,Math.PI*2),e.fill()}const pi={COMMON:{id:"COMMON",name:"Common",color:"#b0c3d9",order:0,dropRate:.55,glow:!1},RARE:{id:"RARE",name:"Rare",color:"#4b69ff",order:1,dropRate:.25,glow:"subtle"},EPIC:{id:"EPIC",name:"Epic",color:"#8847ff",order:2,dropRate:.13,glow:"medium"},LEGENDARY:{id:"LEGENDARY",name:"Legendary",color:"#ffd700",order:3,dropRate:.06,glow:"strong"},MYTHIC:{id:"MYTHIC",name:"Mythic",color:"#ff4444",order:4,dropRate:.01,glow:"intense"}},pn=[{id:"TIMBER",name:"Timber",rarity:"COMMON",color:"#8B4513",type:"wood"},{id:"MIDNIGHT",name:"Midnight",rarity:"COMMON",color:"#191970",type:"wood"},{id:"CHERRY",name:"Cherry",rarity:"COMMON",color:"#dc143c",type:"wood"},{id:"FROST",name:"Frost",rarity:"RARE",color:"#87CEEB",type:"crystal",effects:{iceFacets:{color:"#aaddff",speed:4e-4},particles:{type:"frost",chance:.1}}},{id:"VENOM",name:"Venom",rarity:"RARE",color:"#39ff14",type:"toxic",effects:{shimmer:{color:"#39ff14",style:"ooze",speed:1}}},{id:"EMBER",name:"Ember",rarity:"RARE",color:"#ff6347",type:"fire",effects:{burningCore:{color:"#ff4500",speed:1},particles:{type:"ember",speed:.5,chance:.1}}},{id:"MAGMA",name:"Magma",rarity:"EPIC",color:"#ff4500",type:"fire",effects:{particles:{type:"ember",speed:1.5,count:1},magmaFlow:{speed:.05}}},{id:"ZEUS",name:"Zeus",rarity:"EPIC",color:"#54a0ff",type:"energy",effects:{staticDischarge:{color:"#00ffff",chance:.2}}},{id:"SHADOW",name:"Shadow",rarity:"EPIC",color:"#2d2d2d",type:"dark",effects:{particles:{type:"smoke",chance:.3}}},{id:"DIAMOND",name:"Diamond",rarity:"LEGENDARY",color:"#b9f2ff",type:"crystal",effects:{aura:{color:"#b9f2ff",pulseSpeed:.6,blurMin:8,blurMax:18},hit:{type:"crystal_shatter",color:"#ffffff",secondaryColor:"#b9f2ff",particleCount:6}}},{id:"VOID",name:"Void",rarity:"LEGENDARY",color:"#1a0033",type:"dark",effects:{aura:{color:"#8b00ff",pulseSpeed:.8,blurMin:6,blurMax:14},hit:{type:"gravity_implode",color:"#8b00ff",secondaryColor:"#1a0033",particleCount:6}}},{id:"GLITCH",name:"Glitch",rarity:"MYTHIC",color:"#ff00ff",type:"energy",effects:{idle:{type:"rgb_split",intensity:3},trail:{color:"#00ff00",secondaryColor:"#ff00ff",count:2},shockwave:{type:"digital_ring",color:"#00ff00",secondaryColor:"#ff00ff",maxRadius:120}},textEffectClass:"perfect-hit-glitch"}],so={STANDARD:{id:"STANDARD",name:"Standard Crate",cost:10,description:"Contains any bat",guaranteedMinRarity:null,color:"#b0c3d9"},PREMIUM:{id:"PREMIUM",name:"Premium Crate",cost:50,description:"Guaranteed Rare+",guaranteedMinRarity:"RARE",color:"#ffd700"}},fr=.5;function hr(e,t=[]){const i=so[e];if(!i)throw new Error(`Unknown crate type: ${e}`);const a=i.guaranteedMinRarity?pi[i.guaranteedMinRarity].order:0,o=pn.filter(u=>pi[u.rarity].order>=a);let n=0;const s=o.map(u=>{const h=pi[u.rarity].dropRate;return n+=h,{bat:u,weight:h}});let l=Math.random()*n,c=s[s.length-1].bat;for(const u of s)if(l-=u.weight,l<=0){c=u.bat;break}const f=t.includes(c.id),d=f?Math.floor(i.cost*fr):0;return{bat:c,isDuplicate:f,refundAmount:d}}const Mt={STANDARD:{id:"STANDARD",name:"Pink Bat",color:"#ff69b4",type:"wood",draw(e,t,i){e.fillStyle=this.color,e.fillRect(0,-t/2,15,t),e.fillRect(15,-t/2-2,i,t+4)}},BLUE:{id:"BLUE",name:"Blue Camo",color:"#0000FF",type:"wood",pattern:"camo",rarity:"COMMON",draw(e,t,i){e.fillStyle=this.color,e.fillRect(0,-t/2,15,t),e.fillRect(15,-t/2-2,i,t+4)}},GOLD:{id:"GOLD",name:"Gold",color:"#FFD700",type:"metal",rarity:"LEGENDARY",effects:{aura:{color:"#FFD700",pulseSpeed:.5,blurMin:5,blurMax:15},hit:{type:"sparkle",color:"#FFD700",count:8}},draw(e,t,i){e.fillStyle="#B8860B",e.fillRect(0,-t/2,15,t);const a=e.createLinearGradient(15,-t/2,15,t/2);a.addColorStop(0,"#DAA520"),a.addColorStop(.3,"#FFD700"),a.addColorStop(.5,"#FFFFFF"),a.addColorStop(.7,"#FFD700"),a.addColorStop(1,"#DAA520"),e.fillStyle=a,e.fillRect(15,-t/2-2,i,t+4)}},LASER:{id:"LASER",name:"Neon",color:"#00ffff",type:"energy",rarity:"RARE",effects:{pulse:{speed:.001,color:"#ffffff",min:0,max:.8,blur:20}}}};pn.forEach(e=>{Mt[e.id]={id:e.id,name:e.name,color:e.color,type:e.type,rarity:e.rarity,effects:e.effects||null,textEffectClass:e.textEffectClass||null}});const qe={currentBat:Mt.STANDARD,setBat(e){Mt[e]&&(this.currentBat=Mt[e])}};class ze{constructor(t){this.setSeed(t)}setSeed(t){if(typeof t=="string"){let i=2166136261;for(let a=0;a<t.length;a++)i=Math.imul(i^t.charCodeAt(a),16777619);this.seed=i>>>0}else this.seed=t>>>0}random(){let t=this.seed+=1831565813;return t=Math.imul(t^t>>>15,t|1),t^=t+Math.imul(t^t>>>7,t|61),((t^t>>>14)>>>0)/4294967296}range(t,i){return this.random()*(i-t)+t}rangeInt(t,i){return Math.floor(this.random()*(i-t+1))+t}shuffle(t){for(let i=t.length-1;i>0;i--){const a=Math.floor(this.random()*(i+1));[t[i],t[a]]=[t[a],t[i]]}return t}choice(t){return t[Math.floor(this.random()*t.length)]}static getDailySeed(t=new Date){const i=t,a=i.getUTCFullYear(),o=String(i.getUTCMonth()+1).padStart(2,"0"),n=String(i.getUTCDate()).padStart(2,"0");return`${a}-${o}-${n}`}}const Gi=new ze(Date.now()),ur={TIMBER:{layers:[{type:"fill",color:"#8B4513"},{type:"rect",x:0,y:0,w:15,h:1,color:"#8B4513"},{type:"grip_tape",color:"rgba(0,0,0,0.1)",count:5}]},STANDARD:{layers:[{type:"fill",color:"#ff69b4"},{type:"rect",x:0,y:0,w:15,h:1,color:"#ff69b4"},{type:"grip_tape",color:"rgba(0,0,0,0.1)",count:5}]},MIDNIGHT:{layers:[{type:"fill",color:"#191970"},{type:"grip_tape",color:"rgba(255,255,255,0.1)",count:5}]},CHERRY:{layers:[{type:"fill",color:"#dc143c"},{type:"grip_tape",color:"rgba(0,0,0,0.2)",count:5}]},BLUE:{layers:[{type:"fill",color:"#b0c4de"},{type:"pattern",subtype:"blobs",color:"#6495ed",count:8,sizeMin:10,sizeMax:20},{type:"pattern",subtype:"blobs",color:"#4169e1",count:8,sizeMin:8,sizeMax:18},{type:"pattern",subtype:"blobs",color:"#191970",count:6,sizeMin:6,sizeMax:15},{type:"grip_tape",color:"rgba(0,0,0,0.4)",count:5}]},MAGMA:{layers:[{type:"fill",color:"#2d2d2d"},{type:"pattern",subtype:"voronoi_cracks",color:"#ff4500",count:18,lineWidth:2,maxDist:35},{type:"pattern",subtype:"cracks",color:"#ff6600",count:5,sizeMin:1,sizeMax:3}]},ZEUS:{layers:[{type:"fill",color:"#dfe6e9"},{type:"grip_tape",color:"rgba(0,0,0,0.15)",count:5},{type:"pattern",subtype:"lightning",color:"#00d2d3",glow:"#54a0ff"}]},FROST:{layers:[{type:"gradient",colors:["#e0f7ff","#87CEEB","#b0e0e6"],stops:[0,.5,1],direction:"vertical"},{type:"pattern",subtype:"shards",color:"rgba(255, 255, 255, 0.6)",count:10,sizeMin:2,sizeMax:5},{type:"rect",x:20,y:-.25,w:"rest",h:.1,color:"rgba(255, 255, 255, 0.4)"},{type:"glow",color:"#87CEEB",blur:6,alpha:.15}]},VENOM:{layers:[{type:"fill",color:"#1a1a1a"},{type:"pattern",subtype:"symbiote_tendrils",color:"#006400",count:5,lineWidth:3.5},{type:"pattern",subtype:"symbiote_tendrils",color:"#39ff14",count:4,lineWidth:2},{type:"pattern",subtype:"symbiote_matter",color:"#32cd32",count:6,sizeMin:2,sizeMax:5},{type:"glow",color:"#39ff14",blur:8,alpha:.2}]},EMBER:{layers:[{type:"gradient",colors:["#8b0000","#ff4500","#ff6347","#ffa500"],stops:[0,.3,.6,1]},{type:"pattern",subtype:"bubbles",color:"#ffff00",count:6,sizeMin:1,sizeMax:3,alpha:.5},{type:"glow",color:"#ff4500",blur:8,alpha:.2}]},SHADOW:{layers:[{type:"fill",color:"#0a0a0a"},{type:"gradient",colors:["rgba(136, 71, 255, 0.15)","rgba(0,0,0,0)","rgba(136, 71, 255, 0.15)"],stops:[0,.5,1],direction:"vertical",rect:{x:15,w:"rest"}},{type:"border",color:"#8847ff",blur:10,lineWidth:1.5,rect:{x:15,w:"rest"}}]},DIAMOND:{layers:[{type:"gradient",colors:["#e8e8e8","#b9f2ff","#ffffff","#e0e0ff","#b9f2ff","#f0f0ff"],stops:[0,.2,.4,.6,.8,1]},{type:"pattern",subtype:"sparkles",palette:["#ff6b6b","#4ecdc4","#45b7d1","#f9ca24","#a29bfe"],count:12,sizeMin:1,sizeMax:2.5},{type:"rect",x:20,y:-.25,w:40,h:.1,color:"rgba(255, 255, 255, 0.8)"},{type:"glow",color:"#b9f2ff",blur:10,alpha:.1,rect:{x:15,w:"rest"}}]},VOID:{layers:[{type:"gradient",colors:["#0a001a","#1a0033","#0d001a","#1a0033","#0a001a"],stops:[0,.3,.5,.7,1]},{type:"pattern",subtype:"rings",color:"rgba(100, 0, 200, 0.3)",count:5,center:{x:40,y:0}},{type:"pattern",subtype:"noise",color:"#fff",count:8,alphaMin:.3,alphaMax:.8},{type:"border",color:"rgba(100, 0, 200, 0.5)",blur:12,shadowColor:"#6400c8",lineWidth:1,rect:{x:15,w:"rest"}}]},GLITCH:{layers:[{type:"fill",color:"rgba(255, 0, 0, 0.6)",offset:{x:-1,y:-1}},{type:"fill",color:"rgba(0, 100, 255, 0.6)",offset:{x:2,y:1}},{type:"fill",color:"rgba(0, 255, 50, 0.5)"},{type:"pattern",subtype:"scanlines",color:"rgba(0, 0, 0, 0.3)",spacing:3},{type:"pattern",subtype:"glitch_blocks",palette:["#ff00ff","#00ffff","#ffff00","#ff0000"],count:6},{type:"pattern",subtype:"noise",color:"#fff",count:20,alpha:.6}]},GOLD:{layers:[{type:"fill",color:"#B8860B"},{type:"gradient",colors:["#DAA520","#FFD700","#FFFFFF","#FFD700","#DAA520"],stops:[0,.3,.5,.7,1],direction:"vertical",rect:{x:15,y:-.5,w:"rest",h:1}},{type:"grip_tape",color:"rgba(0,0,0,0.2)",count:5}]},LASER:{layers:[{type:"fill",color:"#00ffff"},{type:"glow",color:"#00ffff",blur:10},{type:"rect",x:15,y:.25,w:"rest",h:.5,color:"#e0ffff",blur:5}]}},oi=256;class pr{constructor(){this.cache={},this.iconCache={},this.ctx=null,this.canvas=null,this.rng=new ze(12345)}init(){this.canvas||(this.canvas=document.createElement("canvas"),this.canvas.width=oi,this.canvas.height=oi,this.ctx=this.canvas.getContext("2d",{willReadFrequently:!0}))}generate(t){this.init();const i=this.ctx,a=ke.BAT_WIDTH,o=ke.BAT_LENGTH,n=oi/2,s=oi/2;i.clearRect(0,0,oi,oi),i.save(),i.translate(n,s),this._drawBatById(i,t,a,o),i.restore();const l=document.createElement("canvas");return l.width=oi,l.height=oi,l.getContext("2d").drawImage(this.canvas,0,0),l}generateIcon(t){if(this.iconCache[t.id])return this.iconCache[t.id];const i=80,a=document.createElement("canvas");a.width=i,a.height=i;const o=a.getContext("2d"),n=ke.BAT_WIDTH,s=ke.BAT_LENGTH;return o.translate(i/2,i/2),o.rotate(-45*Math.PI/180),o.scale(1,1),o.translate(-32.5,0),this._drawBatById(o,t,n,s),this.iconCache[t.id]=a,a}clearIconCache(){this.iconCache={}}_drawBatById(t,i,a,o){this.rng.setSeed(i.id);const n=ur[i.id];if(n&&n.layers){this._renderLayers(t,n.layers,a,o,i);return}console.warn(`Bat visual definition not found for ID: ${i.id}`),t.fillStyle="#ff00ff",t.fillRect(0,-a/2,o+15,a)}_renderLayers(t,i,a,o,n){i.forEach(s=>{t.save(),this._applyLayer(t,s,a,o),t.restore()})}_applyLayer(t,i,a,o){const n=-a/2;switch(i.type){case"fill":t.fillStyle=i.color;const s=i.offset?i.offset.x:0,l=i.offset?i.offset.y:0;t.fillRect(s,n+l,15,a),t.fillRect(15+s,n-2+l,o,a+4);break;case"rect":case"box":this._clipToBatShape(t,a,o);const c=i.x||0,f=i.y!==void 0?n+i.y*a:n,d=i.w==="rest"?Math.max(0,o+15-c):i.w,u=i.h!==void 0?i.h*a:a;i.color&&(t.fillStyle=i.color),i.blur&&(t.shadowBlur=i.blur,t.shadowColor=i.shadowColor||i.color),t.fillRect(c,f,d,u),t.shadowBlur=0;break;case"border":const h=i.offset?i.offset.x:0,g=i.offset?i.offset.y:0;t.strokeStyle=i.color||"#fff",t.lineWidth=i.lineWidth||1,i.blur&&(t.shadowBlur=i.blur,t.shadowColor=i.shadowColor||i.color);const m=i.rect?i.rect.x:0;if(i.rect){const S=i.rect.w==="rest"?o+15-m:i.rect.w;t.strokeRect(m+h,n-2+g,S,a+4)}else t.strokeRect(15+h,n-2+g,o,a+4);t.shadowBlur=0;break;case"gradient":this._clipToBatShape(t,a,o);const p=i.rect?i.rect.x:0,b=i.rect&&i.rect.w==="rest"?o:i.rect?i.rect.w:o+15;let v;i.direction==="vertical"?v=t.createLinearGradient(p,-a/2,p,a/2):v=t.createLinearGradient(p,0,p+b,0),i.stops?i.stops.forEach((S,P)=>v.addColorStop(S,i.colors[P])):(v.addColorStop(0,i.colors[0]),v.addColorStop(1,i.colors[1])),t.fillStyle=v,i.rect?t.fillRect(p,-a/2-2,b,a+4):(t.fillRect(0,n,15,a),t.fillRect(15,n-2,o,a+4));break;case"glow":if(t.shadowBlur=i.blur,t.shadowColor=i.color,t.globalAlpha=i.alpha||1,t.fillStyle=i.color,i.rect){const S=i.rect.x,P=i.rect.w==="rest"?o+15-S:i.rect.w;t.fillRect(S,n-2,P,a+4)}else t.fillRect(0,n,15,a),t.fillRect(15,n-2,o,a+4);t.globalAlpha=1,t.shadowBlur=0;break;case"grip_tape":t.fillStyle=i.color;const y=i.count||5,T=2,R=3;for(let S=0;S<y;S++)t.fillRect(S*R,n,T,a);break;case"pattern":this._drawPattern(t,i,a,o);break}}_clipToBatShape(t,i,a){t.beginPath(),t.rect(0,-i/2,15,i),t.rect(15,-i/2-2,a,i+4),t.clip()}_clipToBarrel(t,i,a){t.beginPath(),t.rect(15,-i/2-2,a,i+4),t.clip()}_drawPattern(t,i,a,o){this._clipToBarrel(t,a,o);const n=i.count||1,s=i.color||"#fff";switch(t.fillStyle=s,t.strokeStyle=s,i.subtype){case"veins":t.lineWidth=1.5;for(let S=0;S<n;S++){t.beginPath();const P=15+this.rng.random()*(o-25),w=(this.rng.random()-.5)*(a-4);t.moveTo(P,w);for(let E=0;E<3;E++){const M=this.rng.range(3,10),D=(this.rng.random()-.5)*6;t.lineTo(P+M*(E+1),w+D)}t.stroke()}break;case"bubbles":for(let S=0;S<n;S++){const P=this.rng.range(20,75),w=(this.rng.random()-.5)*(a-4);t.beginPath();const E=this.rng.range(i.sizeMin||1,i.sizeMax||3);t.arc(P,w,E,0,Math.PI*2),t.fill()}break;case"sparkles":const l=i.palette||[s];for(let S=0;S<n;S++){const P=this.rng.range(10,70),w=(this.rng.random()-.5)*a,E=l[Math.floor(this.rng.random()*l.length)];t.fillStyle=E;const M=this.rng.range(i.sizeMin||1,i.sizeMax||2.5);t.save(),t.translate(P,w),t.rotate(Math.PI/4),t.fillRect(-M/2,-M/2,M,M),t.restore()}break;case"rings":const c=i.center?i.center.x:40,f=i.center?i.center.y:0;t.lineWidth=1;for(let S=3;S<3*n+3;S+=3)t.strokeStyle=`rgba(100, 0, 200, ${.3-S*.015})`,t.beginPath(),t.arc(c,f,S,0,Math.PI*2),t.stroke();break;case"noise":const d=i.alphaMin||.3,u=i.alphaMax||.8;for(let S=0;S<n;S++){const P=this.rng.range(10,75),w=(this.rng.random()-.5)*a;t.globalAlpha=this.rng.range(d,u),t.fillStyle=i.color,t.beginPath(),t.arc(P,w,.5,0,Math.PI*2),t.fill()}break;case"scanlines":const h=i.spacing||3;t.fillStyle=i.color;for(let S=-a/2-2;S<a/2+2;S+=h)t.fillRect(0,S,o+15,1);break;case"glitch_blocks":const g=i.palette||["#ff00ff","#00ffff","#ffff00","#ff0000"];for(let S=0;S<n;S++){const P=this.rng.range(5,65),w=(this.rng.random()-.5)*a,E=this.rng.range(3,10),M=this.rng.range(1,3);t.fillStyle=g[Math.floor(this.rng.random()*g.length)],t.globalAlpha=.7,t.fillRect(P,w,E,M)}break;case"blobs":for(let S=0;S<n;S++){t.beginPath();const P=this.rng.random()*(o+20)-5,w=(this.rng.random()-.5)*a*4,E=this.rng.range(i.sizeMin,i.sizeMax),M=this.rng.range(i.sizeMin*.8,i.sizeMax),D=this.rng.random()*Math.PI*2;t.save(),t.translate(P,w),t.rotate(D),t.moveTo(0,-M/2),t.bezierCurveTo(E/2,-M/2,E,0,E/2,M/2),t.bezierCurveTo(0,M,-E/2,M/2,-E/2,0),t.bezierCurveTo(-E,-M/2,-E/2,-M/2,0,-M/2),t.fill(),t.restore()}break;case"cracks":for(let S=0;S<n;S++){const P=15+this.rng.random()*(o-6),w=(this.rng.random()-.5)*a,E=this.rng.range(i.sizeMin,i.sizeMax),M=this.rng.range(i.sizeMin,i.sizeMax);t.fillRect(P,w,E,M)}break;case"voronoi_cracks":const m=[],p=i.count||20;for(let S=0;S<p;S++)m.push({x:15+this.rng.random()*(o-10),y:(this.rng.random()-.5)*(a-4)});t.lineWidth=i.lineWidth||1.5,t.lineCap="round",t.lineJoin="round",m.forEach((S,P)=>{m.map((E,M)=>({p:E,dist:Math.hypot(S.x-E.x,S.y-E.y),idx:M})).filter(E=>E.idx!==P).sort((E,M)=>E.dist-M.dist).slice(0,2).forEach(E=>{E.dist<(i.maxDist||30)&&(t.beginPath(),t.moveTo(S.x,S.y),t.lineTo(E.p.x,E.p.y),t.stroke())})});break;case"symbiote_tendrils":const b=i.count||4;t.lineCap="round";const v=(S,P,w,E,M,D)=>{if(E<=0)return;const I=S+Math.cos(w)*M,H=P+Math.sin(w)*M,k=S+Math.cos(w+(this.rng.random()-.5))*(M*.5),O=P+Math.sin(w+(this.rng.random()-.5))*(M*.5);t.beginPath(),t.lineWidth=D,t.moveTo(S,P),t.quadraticCurveTo(k,O,I,H),t.stroke();const W=this.rng.random()>.4?2:1;for(let Z=0;Z<W;Z++){const N=w+(this.rng.random()-.5)*1.5,$=M*.75,V=Math.max(.5,D*.7);v(I,H,N,E-1,$,V)}};for(let S=0;S<b;S++){const P=15+this.rng.random()*(o-40),w=(this.rng.random()-.5)*(a-10),E=(this.rng.random()-.5)*Math.PI*2;v(P,w,E,4,this.rng.range(15,25),i.lineWidth||2.5)}break;case"symbiote_matter":const y=i.count||8,T=i.color;for(let S=0;S<y;S++){const P=15+this.rng.random()*(o-15),w=(this.rng.random()-.5)*(a-8),E=this.rng.range(i.sizeMin,i.sizeMax);t.fillStyle=T,t.beginPath();const M=[],D=8;for(let Z=0;Z<D;Z++){const N=Z/D*Math.PI*2,$=E*(.8+this.rng.random()*.4);M.push({x:P+Math.cos(N)*$,y:w+Math.sin(N)*$})}t.moveTo(M[0].x,M[0].y);for(let Z=0;Z<M.length;Z++){const N=M[Z],$=M[(Z+1)%M.length],V=(N.x+$.x)/2,j=(N.y+$.y)/2;t.quadraticCurveTo(N.x,N.y,V,j)}t.closePath(),t.fill(),t.fillStyle="rgba(255, 255, 255, 0.4)",t.beginPath();const I=-Math.PI/4,H=E*.4,k=P+Math.cos(I)*H,O=w+Math.sin(I)*H;t.ellipse(k,O,E*.25,E*.15,I,0,Math.PI*2),t.fill(),t.fillStyle="rgba(0, 50, 0, 0.3)";const W=this.rng.random()>.5?2:1;for(let Z=0;Z<W;Z++){const N=this.rng.random()*Math.PI*2,$=this.rng.random()*E*.5;t.beginPath(),t.arc(P+Math.cos(N)*$,w+Math.sin(N)*$,E*.2,0,Math.PI*2),t.fill()}}break;case"lightning":const R=S=>{t.strokeStyle=S?i.color:"#fff",t.lineWidth=S?1.5:.8,S&&i.glow&&(t.shadowBlur=8,t.shadowColor=i.glow),t.beginPath(),[16,26,36,46,56,66].forEach(w=>{const E=(this.rng.random()-.5)*(a-4),M=(this.rng.random()-.5)*(a-4);t.moveTo(w,E),t.lineTo(w+10,M)}),t.stroke(),t.shadowBlur=0};R(!0),R(!1);break;case"shards":t.globalAlpha=i.alpha||1;for(let S=0;S<n;S++){const P=this.rng.random()*o+10,w=(this.rng.random()-.5)*a,E=this.rng.range(i.sizeMin,i.sizeMax);t.save(),t.translate(P,w),t.rotate(this.rng.random()*Math.PI),t.fillRect(-E/2,-E/2,E,E),t.restore()}t.globalAlpha=1;break}}}const gn=new pr,aa=12,Xt=4,Li=25,gr=2e3,oa=[];for(let e=0;e<aa;e++)oa.push({active:!1,x:0,y:0,vx:0,vy:0,life:0,maxLife:0,color:"#fff",size:4});const gi=[];for(let e=0;e<Xt;e++)gi.push({x:0,y:0,angle:0,valid:!1});let Ai=0,Ss=0,ba=0,Ts=0,lo=!1,ln=0,Ia=!1,ro=0,bs=12,co=0,fo=0,vs=!1,ho=!1,Cs=0,Ie={active:!1,timer:0,x1:0,y1:0,x2:0,y2:0,midX:0,midY:0},ri=null,ft=null;function mr(e){if(ri)return ri;ri=document.createElement("canvas"),ri.width=Li,ri.height=64;const t=ri.getContext("2d"),i=t.createLinearGradient(0,0,Li,0);return i.addColorStop(0,"rgba(255,255,255,0)"),i.addColorStop(.5,e||"rgba(255,255,255,0.5)"),i.addColorStop(1,"rgba(255,255,255,0)"),t.fillStyle=i,t.fillRect(0,0,Li,64),ri}function yr(e,t){const i=qe.currentBat;if(!i.effects)return;const a=r.bat.pivotX,o=r.bat.pivotY,n=r.bat.angle;if(i.effects.aura){const s=i.effects.aura;ln+=.02*(s.pulseSpeed||.6);const l=Math.sin(ln),c=s.blurMin+(s.blurMax-s.blurMin)*(.5+.5*l);e.save(),e.translate(a,o),e.rotate(n),e.shadowColor=s.color,e.shadowBlur=c,e.drawImage(t,-t.width/2,-t.height/2),e.shadowBlur=0,e.restore()}}function Sr(e,t){const i=qe.currentBat;if(!i.effects)return;const a=r.bat.pivotX,o=r.bat.pivotY,n=r.bat.angle,s=r.bat.swinging;r.isPaused||(Cs+=16.66);const l=Cs;if(r.perfectHitTimer>0&&!ho&&(ho=!0,_r(e,i,a,o,n)),r.perfectHitTimer<=0&&(ho=!1),i.effects.shimmer&&wr(e,i.effects.shimmer,t,a,o,n,l),i.effects.pulse&&Tr(e,i.effects.pulse,t,a,o,n,l),i.effects.iceFacets&&vr(e,i.effects.iceFacets,t,a,o,n,l),i.effects.burningCore&&Cr(e,i.effects.burningCore,t,a,o,n,l),i.effects.staticDischarge&&Pr(e,i.effects.staticDischarge,t,a,o,n),i.effects.magmaFlow&&br(e,i.effects.magmaFlow,t,a,o,n,l),i.effects.trail&&s&&(Rr(a,o,n,l),Mr(e,i.effects.trail,t)),!s&&vs)for(let c=0;c<Xt;c++)gi[c].valid=!1;vs=s,i.effects.idle&&!s&&Ar(e,i.effects.idle,t,a,o,n),i.effects.particles&&!r.isPaused&&kr(i.effects.particles,a,o,n),Er(e,r.isPaused),Ia&&Dr(e,i.effects.shockwave||i.effects.hit)}function Tr(e,t,i,a,o,n,s){const l=t.speed||.005,c=t.min!==void 0?t.min:.1,f=t.max!==void 0?t.max:.5,d=s*l,u=c+(f-c)*(.5+.5*Math.sin(d));e.save(),e.translate(a,o),e.rotate(n),e.globalCompositeOperation="lighter",e.globalAlpha=u;const h=ke.BAT_LENGTH,g=ke.BAT_WIDTH-4;e.shadowBlur=t.blur||10,e.shadowColor=t.color||"#fff",e.fillStyle=t.color||"#fff",e.fillRect(15,-g/2,h,g),e.restore()}function br(e,t,i,a,o,n,s){e.save(),e.translate(a,o),e.rotate(n);const l=ke.BAT_LENGTH,c=ke.BAT_WIDTH-2;e.beginPath(),e.rect(15,-c/2,l,c),e.clip();const f=Math.sin(s*.001)*.2+.8;e.globalCompositeOperation="overlay",e.globalAlpha=.6*f;const d=Math.sin(s*5e-4)*20,u=e.createLinearGradient(15+d,0,15+l+d,0);u.addColorStop(0,"#800000"),u.addColorStop(.5,"#ff4500"),u.addColorStop(1,"#800000"),e.fillStyle=u,e.fillRect(15,-c/2,l,c);const h=s*.01%100;e.globalCompositeOperation="lighter",e.globalAlpha=.4;const g=50,m=h%g;for(let p=-1;p<2;p++){const b=15+p*g+m;if(b>15+l||b+g<15)continue;const v=e.createLinearGradient(b,0,b+g,0);v.addColorStop(0,"#000000"),v.addColorStop(.5,"#ff8800"),v.addColorStop(1,"#000000"),e.fillStyle=v,e.fillRect(b,-c/2,g,c)}e.restore()}function vr(e,t,i,a,o,n,s){e.save(),e.translate(a,o),e.rotate(n);const l=ke.BAT_LENGTH,c=ke.BAT_WIDTH-2;e.beginPath(),e.rect(15,-c/2,l,c),e.clip();const f=t.speed||.002,d=s*f;e.globalCompositeOperation="overlay",e.globalAlpha=.5;const u=e.createLinearGradient(15,-10,15+l,10);u.addColorStop(0,"rgba(0, 255, 255, 0.2)"),u.addColorStop(.5,"rgba(255, 255, 255, 0.4)"),u.addColorStop(1,"rgba(0, 0, 139, 0.3)"),e.fillStyle=u,e.beginPath(),e.moveTo(15,-5),e.lineTo(65,-5),e.lineTo(40,5),e.fill(),e.globalCompositeOperation="color-dodge",e.globalAlpha=.6;const h=d*100%100,g=e.createLinearGradient(15+h,-10,45+h,10);g.addColorStop(0,"rgba(255,255,255,0)"),g.addColorStop(.5,"rgba(255,255,255,0.8)"),g.addColorStop(1,"rgba(255,255,255,0)"),e.fillStyle=g,e.beginPath(),e.moveTo(15+h-20,-c/2),e.lineTo(15+h+20,-c/2),e.lineTo(15+h,c/2),e.fill(),e.globalCompositeOperation="soft-light",e.globalAlpha=.4,e.strokeStyle="#fff",e.lineWidth=1,e.beginPath(),e.moveTo(25,-c/2),e.lineTo(35,0),e.lineTo(25,c/2),e.moveTo(45,-c/2),e.lineTo(55,0),e.lineTo(45,c/2),e.stroke(),e.restore()}function Cr(e,t,i,a,o,n,s){const l=t.speed||1,c=.5+.3*Math.sin(s*.003*l);e.save(),e.translate(a,o),e.rotate(n);const f=ke.BAT_LENGTH,d=ke.BAT_WIDTH-4;e.globalCompositeOperation="screen",e.globalAlpha=c,e.fillStyle=t.color||"#ff4500",e.beginPath(),e.roundRect(15,-d/2,f-5,d,5),e.fill(),e.globalCompositeOperation="overlay",e.globalAlpha=.3;const u=s*.05;e.beginPath();for(let h=15;h<15+f;h+=5){const g=Math.sin(h*.1-u)*3;e.moveTo(h,-d/2),e.lineTo(h,d/2+g)}e.strokeStyle="#ffcc00",e.lineWidth=2,e.clip(),e.stroke(),e.restore()}function Pr(e,t,i,a,o,n,s){if(!r.isPaused){if(!Ie.active){if(Math.random()>(t.chance||.04))return;Ie.active=!0,Ie.timer=10+Math.floor(Math.random()*10);const l=ke.BAT_LENGTH,c=ke.BAT_WIDTH;Ie.x1=15+Math.random()*l*.8,Ie.y1=(Math.random()-.5)*c;const f=10+Math.random()*20,d=(Math.random()-.5)*Math.PI;Ie.x2=Ie.x1+Math.cos(d)*f,Ie.y2=Ie.y1+Math.sin(d)*f,Ie.midX=(Ie.x1+Ie.x2)/2+(Math.random()-.5)*10,Ie.midY=(Ie.y1+Ie.y2)/2+(Math.random()-.5)*10}Ie.active&&(Ie.timer--,Ie.timer<=0&&(Ie.active=!1))}Ie.active&&(e.save(),e.translate(a,o),e.rotate(n),e.beginPath(),e.moveTo(Ie.x1,Ie.y1),e.lineTo(Ie.midX,Ie.midY),e.lineTo(Ie.x2,Ie.y2),e.strokeStyle=t.color||"#00ffff",e.lineWidth=1.5,e.globalCompositeOperation="lighter",e.shadowColor=t.color,e.shadowBlur=5,e.globalAlpha=.5+Math.random()*.5,e.stroke(),e.restore())}function Er(e,t){for(let i=0;i<aa;i++){const a=oa[i];if(!a.active)continue;if(!t){if(a.life++,a.life>=a.maxLife){a.active=!1;continue}a.x+=a.vx,a.y+=a.vy,a.type==="ember"&&(a.vx+=(Math.random()-.5)*.1)}const o=1-a.life/a.maxLife,n=a.size*o;e.fillStyle=a.color,e.globalAlpha=o,e.fillRect(a.x-n/2,a.y-n/2,n,n)}e.globalAlpha=1}function wr(e,t,i,a,o,n,s){const l=gr/(t.speed||1);if(!lo){s-Ts>l&&(lo=!0,ba=-Li,Ts=s);return}if(ba+=1,ba>i.width+Li){lo=!1;return}ft?(ft.width!==i.width||ft.height!==i.height)&&(ft.width=i.width,ft.height=i.height):(ft=document.createElement("canvas"),ft.width=i.width,ft.height=i.height);const c=ft.getContext("2d");c.clearRect(0,0,ft.width,ft.height),c.drawImage(i,0,0),c.globalCompositeOperation="source-in";const f=mr(t.color);c.drawImage(f,ba-Li,0,Li,i.height),c.globalCompositeOperation="source-over",e.save(),e.translate(a,o),e.rotate(n),e.globalCompositeOperation="lighter",e.globalAlpha=.4,e.drawImage(ft,-ft.width/2,-ft.height/2),e.restore()}function Rr(e,t,i,a){a-Ss<40||(Ss=a,gi[Ai].x=e,gi[Ai].y=t,gi[Ai].angle=i,gi[Ai].valid=!0,Ai=(Ai+1)%Xt)}function Mr(e,t,i){const a=Math.min(t.count||2,Xt);let o=0;for(let n=0;n<Xt&&o<a;n++){const s=((Ai-2-n)%Xt+Xt)%Xt,l=gi[s];if(!l.valid)continue;const c=.3-o*.1;if(c<=0)break;e.save(),e.globalAlpha=c,e.translate(l.x,l.y),e.rotate(l.angle),t.warp&&e.scale(1+o*.05,1-o*.03),e.drawImage(i,-i.width/2,-i.height/2),e.restore(),o++}}function Ar(e,t,i,a,o,n){if(t.type!=="rgb_split")return;const s=t.intensity||3,l=performance.now()*.002,c=Math.sin(l)*s,f=Math.cos(l*1.3)*s*.5;e.save(),e.globalCompositeOperation="lighter",e.globalAlpha=.15,e.translate(a+c,o+f),e.rotate(n),e.drawImage(i,-i.width/2,-i.height/2),e.restore(),e.save(),e.globalCompositeOperation="lighter",e.globalAlpha=.15,e.translate(a-c,o-f),e.rotate(n),e.drawImage(i,-i.width/2,-i.height/2),e.restore()}function _r(e,t,i,a,o){const n=t.effects;if(n.hit){const s=n.hit;Ir(i,a,o,s)}n.shockwave&&(Ia=!0,ro=0,co=i+Math.cos(o)*80,fo=a+Math.sin(o)*80)}function Ir(e,t,i,a){const o=Math.min(a.particleCount||4,aa),n=e+Math.cos(i)*80,s=t+Math.sin(i)*80;let l=0;for(let c=0;c<aa&&l<o;c++){const f=oa[c];if(!f.active){if(f.active=!0,f.x=n,f.y=s,f.life=0,f.maxLife=10+Math.floor(Math.random()*6),f.color=Math.random()>.5?a.color:a.secondaryColor||a.color,f.size=3+Math.random()*3,a.type==="gravity_implode"){const d=Math.random()*Math.PI*2,u=30+Math.random()*20;f.x=n+Math.cos(d)*u,f.y=s+Math.sin(d)*u,f.vx=-Math.cos(d)*3,f.vy=-Math.sin(d)*3}else{const d=i+(Math.random()-.5)*1.5,u=2+Math.random()*3;f.vx=Math.cos(d)*u,f.vy=Math.sin(d)*u}l++}}}function kr(e,t,i,a,o){if(!e||Math.random()>(e.chance||.1))return;let n=-1;for(let h=0;h<aa;h++)if(!oa[h].active){n=h;break}if(n===-1)return;const s=oa[n],l=ke.BAT_LENGTH,c=ke.BAT_WIDTH,f=15,d=f+Math.random()*(l-(f-15)),u=(Math.random()-.5)*c;s.active=!0,s.x=t+Math.cos(a)*d-Math.sin(a)*u,s.y=i+Math.sin(a)*d+Math.cos(a)*u,s.life=0,s.maxLife=30+Math.random()*20,s.size=2+Math.random()*2,s.type=e.type,e.type==="ember"?(s.color=Math.random()>.5?"#ffaa00":"#ff4500",s.vx=(Math.random()-.5)*.5,s.vy=-1-Math.random()):e.type==="frost"?(s.color="#ffffff",s.vx=(Math.random()-.5)*.2,s.vy=(Math.random()-.5)*.2,s.maxLife=10):e.type==="smoke"&&(s.color=Math.random()>.7?"#1a0b2e":"#000000",s.vx=(Math.random()-.5)*.3,s.vy=-.2-Math.random()*.3,s.size=3+Math.random()*5,s.maxLife=40+Math.random()*20,s.alpha=.6)}function Dr(e,t){if(!t){Ia=!1;return}if(ro++,ro>bs){Ia=!1;return}const i=ro/bs,a=1-i,o=t.maxRadius||100;if(t.type==="digital_ring"){const n=o*i;e.save(),e.strokeStyle=t.color||"#00ff00",e.globalAlpha=a*.8,e.lineWidth=3,e.strokeRect(co-n/2,fo-n/2,n,n),t.secondaryColor&&(e.strokeStyle=t.secondaryColor,e.globalAlpha=a*.5,e.strokeRect(co-n/2+3,fo-n/2-2,n-6,n+4)),e.restore()}else{const n=o*i;e.save(),e.strokeStyle=t.color||"#ffffff",e.globalAlpha=a*.7,e.lineWidth=3*(1-i)+1,e.beginPath(),e.arc(co,fo,n,0,Math.PI*2),e.stroke(),e.restore()}}function Qs(){lo=!1,ba=0,ri=null,ln=0,Ia=!1,ho=!1,Ie.active=!1;for(let e=0;e<aa;e++)oa[e].active=!1;for(let e=0;e<Xt;e++)gi[e].valid=!1}const wa={},Qi=200;function Ps(){_i=null,rn=-1,uo=null,Qs();for(const e in wa)delete wa[e]}function Lr(e){const t=qe.currentBat.id+"_"+e;if(wa[t])return wa[t];const i=document.createElement("canvas");i.width=Qi,i.height=Qi;const a=i.getContext("2d"),o=Qi/2,n=Qi/2;a.translate(o,n);const s=gn.generate(qe.currentBat);if(a.drawImage(s,-s.width/2,-s.height/2),e==="damaged"||e==="broken"){let l="#500000";qe.currentBat.id==="GOLD"&&(l="#B8860B"),qe.currentBat.id==="BLUE"&&(l="#000000"),a.fillStyle=l,a.fillRect(20,-4,2,2),a.fillRect(22,-2,2,2),a.fillRect(24,0,2,2),a.fillRect(35,4,2,2),a.fillRect(37,2,2,2),a.fillRect(39,0,2,2),a.fillRect(41,-2,2,2),a.fillRect(55,-4,2,2),a.fillRect(57,-2,2,2),a.fillRect(59,0,2,2)}if(e==="broken"){let l="#500000";qe.currentBat.id==="GOLD"&&(l="#B8860B"),qe.currentBat.id==="BLUE"&&(l="#000000"),a.fillStyle=l;for(let c=25;c<65;c+=3){const f=c%4===0?2:-2;a.fillRect(c,f,2,2)}a.fillRect(30,-6,4,2),a.fillRect(45,6,4,2),a.fillRect(60,-5,2,4)}if(e==="severed"){a.clearRect(15,-ke.BAT_WIDTH/2-2,ke.BAT_LENGTH+20,ke.BAT_WIDTH+4),a.fillStyle=qe.currentBat.color||"#ff0000",a.fillRect(15,-ke.BAT_WIDTH/2-2,10,ke.BAT_WIDTH+4);const c=45+15;a.fillRect(c,-ke.BAT_WIDTH/2-2+-10,25,ke.BAT_WIDTH+4)}return wa[t]=i,i}let uo=null,rn=-1,_i=null;function Or(){const e=r.consecutiveFouls,t=qe.currentBat.id;if(e!==rn||t!==uo||!_i){t!==uo&&Qs();let i="normal";e>=4?i="severed":e>=3?i="broken":e>=2&&(i="damaged"),_i=Lr(i),rn=e,uo=t}_i&&(yr(C,_i),C.save(),C.translate(r.bat.pivotX,r.bat.pivotY),C.rotate(r.bat.angle),C.drawImage(_i,-Qi/2,-Qi/2),C.restore(),Sr(C,_i))}function Br(){vo.width=ji,vo.height=ji;const e=ji/2,t=ji/2,i=Il/2;Ue.beginPath(),Ue.arc(e,t,i,0,Math.PI*2),Ue.fillStyle="#ffffff",Ue.fill(),Ue.save(),Ue.beginPath(),Ue.arc(e,t,i,0,Math.PI*2),Ue.clip(),Ue.strokeStyle="#ff0000",Ue.lineWidth=2,Ue.beginPath(),Ue.arc(e-i*1.2,t,i,-1,1),Ue.stroke(),Ue.beginPath(),Ue.arc(e+i*1.2,t,i,Math.PI-1,Math.PI+1),Ue.stroke(),Ue.restore(),Ue.beginPath(),Ue.arc(e,t,i,0,Math.PI*2),Ue.strokeStyle="#000000",Ue.lineWidth=1,Ue.stroke()}Br();function Gr(e,t=1){if(e.invisible)return;let i=e.x,a=e.y,o=e.rotationAngle;typeof e.prevX<"u"&&typeof e.prevY<"u"&&(i=e.prevX+(e.x-e.prevX)*t,a=e.prevY+(e.y-e.prevY)*t),typeof e.prevRotationAngle<"u"&&(o=e.prevRotationAngle+(e.rotationAngle-e.prevRotationAngle)*t);const n=i+e.size/2,s=a+e.size/2;if(e.invisible||(C.fillStyle="rgba(0, 0, 0, 0.5)",C.beginPath(),C.ellipse(n,s+e.size*1.2,e.size*.7,e.size*.25,0,0,Math.PI*2),C.fill()),e.trail&&e.trail.length>1){C.save(),C.lineCap="round",C.lineJoin="round",C.globalCompositeOperation="screen";const l=4;C.strokeStyle="rgba(255, 0, 50, 0.6)",C.lineWidth=e.size*.6,C.beginPath();for(let c=0;c<e.trail.length;c++){const f=e.trail[c];c===0?C.moveTo(f.x-l,f.y):C.lineTo(f.x-l,f.y)}C.lineTo(i+e.size/2-l,a+e.size/2),C.stroke(),C.strokeStyle="rgba(0, 200, 255, 0.6)",C.lineWidth=e.size*.6,C.beginPath();for(let c=0;c<e.trail.length;c++){const f=e.trail[c];c===0?C.moveTo(f.x+l,f.y):C.lineTo(f.x+l,f.y)}C.lineTo(i+e.size/2+l,a+e.size/2),C.stroke(),C.strokeStyle="rgba(255, 255, 255, 0.3)",C.lineWidth=e.size*.4,C.beginPath();for(let c=0;c<e.trail.length;c++){const f=e.trail[c];c===0?C.moveTo(f.x,f.y):C.lineTo(f.x,f.y)}C.lineTo(i+e.size/2,a+e.size/2),C.stroke(),C.restore()}C.save(),C.translate(n,s),C.rotate(o),C.drawImage(vo,-ji/2,-ji/2),C.restore()}function Fr(){const e=K/2+120,i=(r.bat?r.bat.pivotY:de*.85)+60,a=80,o=40;C.fillStyle="#d2b48c",C.beginPath(),C.roundRect(e,i,a,o,5),C.fill(),C.strokeStyle="#5a3a22",C.lineWidth=2,C.stroke();const n=8,s=24,l=e+16,c=i+o/2;for(let f=0;f<3;f++){const d=l+f*s;C.beginPath(),C.arc(d,c,n,0,Math.PI*2),f<U.strikes?(C.fillStyle="#ff0000",C.fill(),C.beginPath(),C.arc(d-2,c-2,2,0,Math.PI*2),C.fillStyle="#ffffff",C.fill()):(C.strokeStyle="#000000",C.lineWidth=2,C.stroke()),C.beginPath(),C.arc(d,c,n,0,Math.PI*2),C.strokeStyle="#000000",C.lineWidth=2,C.stroke()}}let Ci=null;const pa=60,Hr=30;function xs(){if(!r.showTutorial){ut&&ut.style.display!=="none"&&(ut.style.display="none");return}ut&&ut.style.display!=="flex"&&(ut.style.display="flex");const e=K,t=de,i=r.pitcher.x+r.pitcher.width/2,a=r.pitcher.y+r.pitcher.height/2+12;if(C.save(),C.fillStyle="rgba(0, 0, 0, 0.6)",C.beginPath(),C.rect(0,0,e,t),C.arc(i,a,pa,0,Math.PI*2,!0),C.fill(),!Ci){const f=(pa+Hr)*2;Ci=document.createElement("canvas"),Ci.width=f,Ci.height=f;const d=Ci.getContext("2d"),u=f/2,h=f/2;d.shadowColor="#FFD700",d.shadowBlur=20,d.strokeStyle="#FFD700",d.lineWidth=4,d.beginPath(),d.arc(u,h,pa,0,Math.PI*2),d.stroke()}const o=Ci.width;C.drawImage(Ci,i-o/2,a-o/2),C.shadowBlur=0;const n=a+pa+40,s=e/2;C.font='16px "PressStart2PLocal"',C.textAlign="center",C.textBaseline="top",C.strokeStyle="#000000",C.lineWidth=4,C.strokeText("WATCH PITCHER'S COLOR!",s,n),C.fillStyle="#FFFFFF",C.fillText("WATCH PITCHER'S COLOR!",s,n);const l=a+pa+10,c=i;C.fillStyle="#FFD700",C.beginPath(),C.moveTo(c,l),C.lineTo(c-10,l+15),C.lineTo(c+10,l+15),C.fill(),C.strokeStyle="#000000",C.lineWidth=2,C.beginPath(),C.moveTo(c,l),C.lineTo(c-10,l+15),C.lineTo(c+10,l+15),C.closePath(),C.stroke(),C.restore()}let Oi=null,va=null;const Ye=1024;let Pi=null,Xi=null,Ja=null,ni={w:0,h:0,isNight:null,r:0};function Es(e,t,i,a){Oi||Ur();const o=Math.min(t,i)*.9,n=t/2,s=i+o*.6;if(ni.w!==t||ni.h!==i||ni.isNight!==a||ni.r!==o){if(Pi=e.createRadialGradient(n,s-o*.6,o*.2,n,s,o),a?(Pi.addColorStop(0,"#102030"),Pi.addColorStop(1,"#050a10")):(Pi.addColorStop(0,"#1565c0"),Pi.addColorStop(.6,"#0d47a1"),Pi.addColorStop(1,"#002171")),a)Xi=null;else{const m=n-o*.3,p=s-o*.6;Xi=e.createRadialGradient(m,p,0,m,p,o*.6),Xi.addColorStop(0,"rgba(255, 255, 255, 0.2)"),Xi.addColorStop(1,"rgba(255, 255, 255, 0)")}Ja=e.createLinearGradient(0,i+50,0,i-o*1.2),Ja.addColorStop(0,"rgba(0,0,0,0.9)"),Ja.addColorStop(1,"rgba(0,0,0,0)"),ni={w:t,h:i,isNight:a,cx:n,cy:s,r:o}}const c=o*2.5,f=Date.now()*.015%c,d=Date.now()*.02%c;if(!ni.persistentGlowCache){const p=document.createElement("canvas");p.width=2e3,p.height=2e3;const b=p.getContext("2d"),v=2e3/2,y=2e3/2,T=b.createRadialGradient(v,v,y*.4,v,v,y);a?(T.addColorStop(0,"rgba(255, 30, 0, 0.6)"),T.addColorStop(1,"rgba(100, 0, 0, 0)")):(T.addColorStop(0,"rgba(100, 149, 237, 0.4)"),T.addColorStop(1,"rgba(0, 50, 255, 0)")),b.fillStyle=T,b.beginPath(),b.arc(v,v,y,0,Math.PI*2),b.fill(),ni.persistentGlowCache=p}const u=Math.sin(Date.now()/2500)*.05+.95;e.save(),e.translate(n,s);const h=o*2.2*u;e.drawImage(ni.persistentGlowCache,-h/2,-h/2,h,h),e.restore(),e.save(),e.beginPath(),e.arc(n,s,o,0,Math.PI*2),e.clip(),e.fillStyle=Pi,e.fill();const g=(m,p,b,v=1)=>{if(!m)return;e.globalAlpha=v,e.save(),e.translate(n,s);const y=-b/2-p;y<o&&y+b>-o&&e.drawImage(m,y,-b/2,b,b);const T=-b/2-p+b;T<o&&T+b>-o&&e.drawImage(m,T,-b/2,b,b),e.restore(),e.globalAlpha=1};if(a?(e.globalCompositeOperation="source-over",g(Oi,f,c,.3)):(e.globalCompositeOperation="source-over",g(Oi,f,c,1)),!a&&Xi){const m=n-o*.3,p=s-o*.6;e.fillStyle=Xi,e.beginPath(),e.arc(m,p,o*.7,0,Math.PI*2),e.fill()}g(va,d,c,a?.1:.6),e.fillStyle=Ja,e.fillRect(0,0,t,i),e.restore()}function Ur(){Oi=document.createElement("canvas"),Oi.width=Ye,Oi.height=Ye;const e=Oi.getContext("2d");e.clearRect(0,0,Ye,Ye);const t=7;for(let o=0;o<t;o++){let n=Math.random()*Ye,s=Math.random()*(Ye*.6)+Ye*.2;const c=Math.random()>.3?"#2e7d32":"#8d6e63";e.fillStyle=c;let f=3e3,d=n,u=s;for(let h=0;h<f;h++){let g=2+Math.random()*4;e.beginPath(),e.arc(d,u,g,0,Math.PI*2),e.fill(),d<50&&(e.beginPath(),e.arc(d+Ye,u,g,0,Math.PI*2),e.fill()),d>Ye-50&&(e.beginPath(),e.arc(d-Ye,u,g,0,Math.PI*2),e.fill()),d+=(Math.random()-.5)*8,u+=(Math.random()-.5)*8,Math.random()>.99&&(d+=(Math.random()-.5)*50,u+=(Math.random()-.5)*50),Math.hypot(d-n,u-s)>150&&(d=n+(Math.random()-.5)*50,u=s+(Math.random()-.5)*50),u=Math.max(50,Math.min(Ye-50,u))}}va=document.createElement("canvas"),va.width=Ye,va.height=Ye;const i=va.getContext("2d");i.clearRect(0,0,Ye,Ye),i.fillStyle="#ffffff";const a=20;for(let o=0;o<a;o++){let n=Math.random()*Ye,s=Math.random()*Ye,l=Math.random()*50+50;for(let c=0;c<l;c++){let f=5+Math.random()*15;i.globalAlpha=.1+Math.random()*.2,i.beginPath(),i.arc(n,s,f,0,Math.PI*2),i.fill(),n<50&&(i.beginPath(),i.arc(n+Ye,s,f,0,Math.PI*2),i.fill()),n>Ye-50&&(i.beginPath(),i.arc(n-Ye,s,f,0,Math.PI*2),i.fill()),n+=(Math.random()-.5)*60,s+=(Math.random()-.5)*20,s=Math.max(0,Math.min(Ye,s))}}}const Po=[],ga=[],cn=10,zr=8,No=[];for(let e=0;e<cn;e++)Po.push({active:!1,type:"FIGHTER",x:0,y:0,vx:0,size:0,color:"#fff",blinkOffset:0});for(let e=0;e<4;e++)el(e);function el(e){if(No[e])return No[e];const t=60,i=document.createElement("canvas");i.width=t,i.height=t;const a=i.getContext("2d"),o=[],n=8;for(let s=0;s<n;s++){const l=s/n*Math.PI*2,c=t*.4+(Math.random()-.5)*(t*.2);o.push({x:t/2+Math.cos(l)*c,y:t/2+Math.sin(l)*c})}return a.fillStyle="#4a4a4a",a.strokeStyle="#2a2a2a",a.lineWidth=2,a.beginPath(),o.forEach((s,l)=>{l===0?a.moveTo(s.x,s.y):a.lineTo(s.x,s.y)}),a.closePath(),a.fill(),a.stroke(),a.fillStyle="#3a3a3a",a.beginPath(),a.arc(t*.4,t*.4,t*.1,0,Math.PI*2),a.fill(),No[e]=i,i}function ws(e,t,i){ga.length<zr&&Math.random()>.95&&ga.push({x:Math.random()>.5?-100:t+100,y:Math.random()*i,vx:(Math.random()-.5)*.5,vy:(Math.random()-.5)*.5,size:30+Math.random()*30,rotation:Math.random()*Math.PI,rotSpeed:(Math.random()-.5)*.02,variant:Math.floor(Math.random()*4)}),e.save();for(let a=ga.length-1;a>=0;a--){let o=ga[a];if(o.x+=o.vx,o.y+=o.vy,o.rotation+=o.rotSpeed,o.x<-200||o.x>t+200||o.y<-200||o.y>i+200){ga.splice(a,1);continue}const n=el(o.variant);e.save(),e.translate(o.x,o.y),e.rotate(o.rotation),e.drawImage(n,-o.size/2,-o.size/2,o.size,o.size),e.restore()}e.restore()}function Wr(e,t,i){const a=Po.find(l=>!l.active);if(!a)return;const o=Math.random()>.6,n=Math.random()>.5?1:-1;let s=o?t*.1+Math.random()*t*.4:t*.6+Math.random()*t*.3;a.active=!0,a.type=o?"FIGHTER":"CARGO",a.x=n===1?-150:e+150,a.y=s,a.vx=n*(o?3+Math.random()*2:.5+Math.random()),a.size=o?10+Math.random()*5:40+Math.random()*30,a.color=i?"#ff4d4d":Math.random()>.5?"#00e5ff":"#ffffff",a.blinkOffset=Math.random()*1e3}function Vo(e,t,i,a){const o=Date.now();Po.filter(s=>s.active).length<cn&&Math.random()>.92&&Wr(t,i,a);for(let s=0;s<cn;s++){const l=Po[s];if(!l.active)continue;l.x+=l.vx;const c=Math.max(t+200,3e3);if(l.x<-c||l.x>c){l.active=!1;continue}e.save(),e.translate(l.x,l.y),l.vx<0&&e.scale(-1,1),l.type==="CARGO"?(e.fillStyle=a?"#0a0505":"#080810",e.fillRect(-l.size/2,-l.size/4,l.size,l.size/2),e.fillStyle=a?"#050202":"#05050a",e.fillRect(-l.size*1.5,-l.size/3,l.size,l.size*.6),Math.floor((o+l.blinkOffset)/1e3)%2===0&&(e.fillStyle="#aa0000",e.fillRect(l.size*.4,-l.size*.2,2,2))):(e.fillStyle=l.color,e.beginPath(),e.moveTo(l.size,0),e.lineTo(-l.size/2,-l.size/2),e.lineTo(-l.size/2,l.size/2),e.closePath(),e.fill(),e.strokeStyle=l.color,e.globalAlpha=.6,e.lineWidth=2,e.beginPath(),e.moveTo(-l.size/2,0),e.lineTo(-l.size*3,0),e.stroke(),e.globalAlpha=1,e.fillStyle="#fff",e.beginPath(),e.arc(0,0,2,0,Math.PI*2),e.fill()),e.restore()}}const Ge={x:-300,y:100,active:!1,hoverTimer:0};let Ot=null,Rs=null,Ms=null;function Nr(e){const t=e?"night":"day";if(Ot&&Ms===t)return Ot;Ot||(Ot=document.createElement("canvas"),Ot.width=600,Ot.height=400,Rs=Ot.getContext("2d"));const i=Rs,a=Ot.width,o=Ot.height;i.clearRect(0,0,a,o),i.save(),i.translate(a/2,o/2),Ms=t;const n=f=>{i.save(),i.scale(f,1),i.strokeStyle=e?"#444":"#666",i.lineWidth=4,i.beginPath(),i.moveTo(35,0),i.lineTo(80,0),i.stroke(),i.strokeStyle="#444",i.lineWidth=1,i.beginPath(),i.moveTo(40,-5),i.lineTo(75,5),i.moveTo(40,5),i.lineTo(75,-5),i.stroke();const d=e?"#001a4d":"#1a4d80",u=e?"#003366":"#2980b9",h="rgba(255, 255, 255, 0.2)";i.translate(80,0);for(let g=0;g<3;g++){const m=g*42,p=-35,b=40,v=70;i.fillStyle=d,i.fillRect(m,p,b,v),i.fillStyle=u;for(let y=0;y<4;y++)for(let T=0;T<2;T++)i.fillRect(m+2+T*19,p+2+y*17,17,15);i.fillStyle=h,i.beginPath(),i.moveTo(m,p),i.lineTo(m+b,p),i.lineTo(m,p+v/2),i.fill(),i.strokeStyle="#555",i.lineWidth=2,i.strokeRect(m,p,b,v)}i.restore()};n(1),n(-1);const s=60,l=70,c=i.createLinearGradient(0,-l/2,0,l/2);return e?(c.addColorStop(0,"#555"),c.addColorStop(.2,"#333"),c.addColorStop(.5,"#222"),c.addColorStop(.8,"#333"),c.addColorStop(1,"#555")):(c.addColorStop(0,"#bdc3c7"),c.addColorStop(.2,"#95a5a6"),c.addColorStop(.5,"#7f8c8d"),c.addColorStop(.8,"#95a5a6"),c.addColorStop(1,"#bdc3c7")),i.fillStyle=c,i.fillRect(-s/2,-l/2,s,l),i.fillStyle="rgba(0,0,0,0.3)",i.fillRect(-s/2,-l/2+20,s,2),i.fillRect(-s/2,-l/2+50,s,2),i.fillRect(-s/4,-l/2,2,20),i.fillRect(s/4,50-l/2,2,20),i.strokeStyle="#2c3e50",i.lineWidth=2,i.strokeRect(-s/2,-l/2,s,l),i.fillStyle="#444",i.fillRect(-15,-15,30,30),i.strokeStyle="#888",i.strokeRect(-15,-15,30,30),i.fillStyle="#222",i.beginPath(),i.arc(0,0,4,0,Math.PI*2),i.fill(),i.save(),i.translate(0,35),i.fillStyle="#333",i.fillRect(-15,0,30,10),i.restore(),i.restore(),Ot}function As(e,t,i,a,o=!1){if(o){Ge.active||(Ge.active=!0,Ge.x=t*.5,Ge.y=i*.45);const y=t*.5,T=i*.45;Ge.hoverTimer+=.02;const R=Math.sin(Ge.hoverTimer)*10,S=Math.cos(Ge.hoverTimer*.7)*5;Ge.x+=(y+S-Ge.x)*.1,Ge.y+=(T+R-Ge.y)*.1}else{Ge.active||(Ge.active=!0,Ge.x=-200,Ge.y=i*.5);const y=t*.5,T=i*.5;Ge.x+=(y-Ge.x)*.04,Ge.y+=(T-Ge.y)*.04,Math.abs(Ge.x-y)<10&&(Ge.hoverTimer+=.02,Ge.y+=Math.sin(Ge.hoverTimer)*.5)}const n=Ge.x,s=Ge.y,l=1.2,c=Date.now();e.save(),e.translate(n,s),e.scale(l,l),e.save(),e.translate(0,-35);const f=Math.sin(c/2e3)*.5;e.rotate(f),e.fillStyle=a?"#333":"#444",e.fillRect(-3,0,6,15),e.beginPath(),e.arc(0,-10,18,0,Math.PI,!0),e.fillStyle=a?"#888":"#ccc",e.fill(),e.strokeStyle=a?"#666":"#999",e.lineWidth=2,e.stroke(),e.beginPath(),e.moveTo(0,-10),e.lineTo(0,-35),e.strokeStyle="#fff",e.stroke(),e.fillStyle="red",e.beginPath(),e.arc(0,-35,2,0,Math.PI*2),e.fill(),e.restore();const d=Nr(a);e.drawImage(d,-d.width/2,-d.height/2);const u=206;Math.floor(c/500)%2===0&&(e.fillStyle="rgba(0, 255, 0, 0.4)",e.beginPath(),e.arc(u,0,8,0,Math.PI*2),e.fill(),e.fillStyle="#00ff00",e.beginPath(),e.arc(u,0,4,0,Math.PI*2),e.fill(),e.fillStyle="rgba(255, 0, 0, 0.4)",e.beginPath(),e.arc(-u,0,8,0,Math.PI*2),e.fill(),e.fillStyle="#ff0000",e.beginPath(),e.arc(-u,0,4,0,Math.PI*2),e.fill()),e.translate(0,35);const h=90,g=220,m=e.createLinearGradient(0,10,0,10+h);a?(m.addColorStop(0,"rgba(255, 0, 0, 0.6)"),m.addColorStop(.2,"rgba(255, 0, 0, 0.1)"),m.addColorStop(1,"rgba(255, 0, 0, 0)")):(m.addColorStop(0,"rgba(0, 229, 255, 0.6)"),m.addColorStop(.2,"rgba(0, 229, 255, 0.1)"),m.addColorStop(1,"rgba(0, 229, 255, 0)")),e.fillStyle=m,e.beginPath(),e.moveTo(-15,10),e.lineTo(15,10),e.lineTo(g/2,10+h),e.lineTo(-g/2,10+h),e.closePath(),e.fill(),e.strokeStyle=a?"rgba(255, 0, 0, 0.1)":"rgba(0, 229, 255, 0.1)",e.lineWidth=1;for(let y=0;y<5;y++){const T=20+y*15;e.beginPath(),e.moveTo(-g/4,T),e.lineTo(g/4,T),e.stroke()}const p=10+h-30;e.fillStyle="#ffffff",e.font='14px "PressStart2PLocal"',e.textAlign="center";const b=r.isDailyChallenge?"DAILY":"HIGH SCORE";e.fillText(b,0,p-20);let v=r.highScore||0;if(r.isDailyChallenge){const y=new Date,T=y.getUTCFullYear(),R=String(y.getUTCMonth()+1).padStart(2,"0"),S=String(y.getUTCDate()).padStart(2,"0"),P=`${T}-${R}-${S}`;v=parseInt(Y.getItem(`baseball_daily_score_${P}`,"0"))||0}e.font='24px "PressStart2PLocal"',e.fillStyle=r.isDailyChallenge?"#f1c40f":"#ffffff",e.fillText(v.toString(),0,p+15),e.restore()}let Bt=null;const st={w:0,h:0,vignette:null,glass:null,upperBeam:null,lowerBeam:null,core:null};function tl(e,t,i,a=!1){const o=e.createLinearGradient(0,0,0,i);a?(o.addColorStop(0,"#1a0000"),o.addColorStop(.5,"#000000"),o.addColorStop(1,"#220000")):(o.addColorStop(0,"#050520"),o.addColorStop(.5,"#1a0b2e"),o.addColorStop(1,"#000005")),e.fillStyle=o,e.fillRect(0,0,t,i),e.save();const n=(s,l,c,f)=>{const d=e.createRadialGradient(s,l,0,s,l,c);d.addColorStop(0,f),d.addColorStop(1,"rgba(0,0,0,0)"),e.fillStyle=d,e.beginPath(),e.arc(s,l,c,0,Math.PI*2),e.fill()};n(t*.2,i*.15,t*.25,"rgba(128, 0, 128, 0.2)"),n(t*.7,i*.2,t*.3,"rgba(255, 105, 180, 0.15)"),e.restore()}const Ro=(e,t)=>{const i=t||e*.28,a=140,o=i-a/2,n=i+a/2,s=64,l=o,c=l-s,f=c+2,d=n,u=25,h=d+u;return{floorTop:o,floorBottom:n,floorH:a,consoleTop:c,consoleBottom:l,consoleH:s,winBottom:f,cautionTop:d,cautionBottom:h,cautionH:u}},xi=(e,t,i,a,o)=>{e.save(),e.globalCompositeOperation="screen";let n=o;const s=()=>(n=(n*9301+49297)%233280,n/233280);((f,d,u,h)=>{const g=e.createRadialGradient(f,d,0,f,d,u);g.addColorStop(0,h),g.addColorStop(1,"rgba(0,0,0,0)"),e.fillStyle=g,e.beginPath(),e.arc(f,d,u,0,Math.PI*2),e.fill()})(t,i,a,"rgba(40, 0, 80, 0.4)");const c=150;for(let f=0;f<c;f++){const d=s()*Math.PI*2,u=s()*a*.8,h=t+Math.cos(d)*u,g=i+Math.sin(d)*u,m=a*.1+s()*a*.15;let p;const b=s();b<.4?p=`rgba(255, 64, 129, ${.1+s()*.1})`:b<.8?p=`rgba(48, 79, 254, ${.1+s()*.1})`:p=`rgba(0, 229, 255, ${.05+s()*.05})`;const v=e.createRadialGradient(h,g,0,h,g,m);v.addColorStop(0,p),v.addColorStop(1,"rgba(0,0,0,0)"),e.fillStyle=v,e.beginPath(),e.arc(h,g,m,0,Math.PI*2),e.fill()}e.restore()};function Vr(e,t,i,a){e.save();const n=Ro(i,a).winBottom,s=n;e.beginPath(),e.rect(0,0,t,n),e.clip();const l=0,c=t*.32,f=t*.68,d=t-f;xi(e,t*.2,s*.5,t*.3,101),xi(e,t*.8,s*.4,t*.3,202);const u=(g,m,p,b,v)=>{e.save();const y=p*1.15,T=e.createRadialGradient(g,m,p,g,m,y);if(T.addColorStop(0,"rgba(255,255,255,0.3)"),T.addColorStop(1,"rgba(255,255,255,0)"),e.fillStyle=T,e.beginPath(),e.arc(g,m,y,0,Math.PI*2),e.fill(),e.beginPath(),e.arc(g,m,p,0,Math.PI*2),e.fillStyle=b,e.fill(),e.save(),e.clip(),v==="moon"){e.fillStyle="rgba(0,0,0,0.15)";const S=(P,w,E)=>{e.beginPath(),e.ellipse(P,w,E,E*.7,Math.random(),0,Math.PI*2),e.fill()};S(g-p*.3,m-p*.2,p*.25),S(g+p*.4,m+p*.3,p*.2),S(g+p*.1,m+p*.5,p*.15),S(g-p*.2,m+p*.6,p*.1)}else v==="earth"?(e.fillStyle="#27ae60",e.beginPath(),e.moveTo(g-p*.7,m-p*.3),e.lineTo(g-p*.4,m-p*.5),e.lineTo(g-p*.2,m-p*.1),e.lineTo(g-p*.5,m+p*.4),e.lineTo(g-p*.8,m+p*.1),e.fill(),e.beginPath(),e.moveTo(g+p*.3,m-p*.6),e.lineTo(g+p*.6,m-p*.4),e.lineTo(g+p*.5,m+p*.2),e.lineTo(g+p*.2,m+p*.5),e.lineTo(g+p*.1,m-p*.1),e.fill(),e.beginPath(),e.arc(g,m+p*.6,p*.15,0,Math.PI*2),e.fill(),e.fillStyle="#ffffff",e.beginPath(),e.arc(g,m-p*.95,p*.2,0,Math.PI*2),e.fill(),e.fillStyle="rgba(255, 255, 255, 0.3)",e.fillRect(g-p*.8,m,p*1.6,p*.05),e.fillRect(g-p*.6,m-p*.4,p*1.2,p*.04),e.fillStyle="rgba(255, 255, 255, 0.2)",e.beginPath(),e.arc(g+p*.3,m-p*.3,p*.1,0,Math.PI*2),e.fill()):v==="orange"&&(e.fillStyle="rgba(255, 255, 255, 0.15)",e.beginPath(),e.rect(g-p,m-p*.3,p*2,p*.15),e.fill(),e.beginPath(),e.rect(g-p,m+p*.1,p*2,p*.1),e.fill(),e.beginPath(),e.rect(g-p,m+p*.5,p*2,p*.05),e.fill());e.restore();const R=e.createRadialGradient(g-p*.3,m-p*.3,p*.5,g,m,p);R.addColorStop(0,"rgba(0,0,0,0)"),R.addColorStop(1,"rgba(0,0,0,0.7)"),e.fillStyle=R,e.beginPath(),e.arc(g,m,p,0,Math.PI*2),e.fill(),e.fillStyle="rgba(10, 20, 40, 0.4)",e.fill(),e.restore()},h=Math.min(c,s)*.35;u(l+c*.3,s*.4,h,"#bdc3c7","moon"),u(l+c*.7,s*.7,h*1.2,"#8d6e63","mars"),u(f+d*.3,s*.6,h*1.3,"#3498db","earth"),u(f+d*.8,s*.3,h*1.1,"#d35400","orange"),e.restore()}function il(e,t,i,a){e.save();const s=Ro(i,a).winBottom,l=0,c=t*.32,f=t*.32,d=t*.68-f,u=t*.68,h=t-u,g=(v,y,T,R)=>{const S=e.createLinearGradient(v,y,v,y+R);S.addColorStop(0,"rgba(135, 206, 235, 0.2)"),S.addColorStop(1,"rgba(135, 206, 235, 0.05)"),e.fillStyle=S,e.fillRect(v,y,T,R)};g(l,0,c,s),g(f,0,d,s),g(u,0,h,s);const m=(v,y,T,R,S=!1)=>{const P=e.createLinearGradient(v,y,S?v+T:v,S?y:y+R);P.addColorStop(0,"#2c3e50"),P.addColorStop(.3,"#78909c"),P.addColorStop(.7,"#455a64"),P.addColorStop(1,"#2c3e50"),e.fillStyle=P,e.fillRect(v,y,T,R),e.fillStyle="rgba(0,0,0,0.5)",S?e.fillRect(v+T*.3,y,T*.4,R):e.fillRect(v,y+R*.3,T,R*.4),e.fillStyle="#111";const w=1.5;if(S)for(let E=10;E<R;E+=20)e.beginPath(),e.arc(v+T/2,y+E,w,0,Math.PI*2),e.fill();else for(let E=10;E<T;E+=40)e.beginPath(),e.arc(v+E,y+R/2,w,0,Math.PI*2),e.fill();e.fillStyle="rgba(255,255,255,0.15)",S?e.fillRect(v,y,1,R):e.fillRect(v,y,T,1)},p=16;m(f-p/2,0,p,s,!0),m(u-p/2,0,p,s,!0);const b=12;m(0,s-b,t,b,!1),m(0,0,t,12,!1),e.restore()}function _s(e,t,i){const a=(n,s,l,c,f)=>{e.save();const d=l*1.15,u=e.createRadialGradient(n,s,l,n,s,d);if(u.addColorStop(0,"rgba(255,255,255,0.3)"),u.addColorStop(1,"rgba(255,255,255,0)"),e.fillStyle=u,e.beginPath(),e.arc(n,s,d,0,Math.PI*2),e.fill(),e.beginPath(),e.arc(n,s,l,0,Math.PI*2),e.fillStyle=c,e.fill(),e.save(),e.clip(),f==="moon"||f==="rocky"){e.fillStyle="rgba(0,0,0,0.15)";const g=(m,p,b)=>{e.beginPath(),e.ellipse(m,p,b,b*.7,Math.random(),0,Math.PI*2),e.fill()};g(n-l*.3,s-l*.2,l*.25),g(n+l*.4,s+l*.3,l*.2),g(n+l*.1,s+l*.5,l*.15),g(n-l*.2,s+l*.6,l*.1)}else f==="earth"?(e.fillStyle="#27ae60",e.beginPath(),e.moveTo(n-l*.7,s-l*.3),e.lineTo(n-l*.4,s-l*.5),e.lineTo(n-l*.2,s-l*.1),e.lineTo(n-l*.5,s+l*.4),e.lineTo(n-l*.8,s+l*.1),e.fill(),e.beginPath(),e.moveTo(n+l*.3,s-l*.6),e.lineTo(n+l*.6,s-l*.4),e.lineTo(n+l*.5,s+l*.2),e.lineTo(n+l*.2,s+l*.5),e.lineTo(n+l*.1,s-l*.1),e.fill(),e.fillStyle="rgba(255, 255, 255, 0.2)",e.beginPath(),e.arc(n+l*.3,s-l*.3,l*.1,0,Math.PI*2),e.fill()):f==="gas"&&(e.fillStyle="rgba(255, 255, 255, 0.15)",e.beginPath(),e.rect(n-l,s-l*.3,l*2,l*.15),e.fill(),e.beginPath(),e.rect(n-l,s+l*.1,l*2,l*.1),e.fill(),e.beginPath(),e.rect(n-l,s+l*.5,l*2,l*.05),e.fill());e.restore();const h=e.createRadialGradient(n-l*.3,s-l*.3,l*.1,n,s,l);h.addColorStop(0,"rgba(0,0,0,0)"),h.addColorStop(.5,"rgba(0,0,0,0.1)"),h.addColorStop(1,"rgba(0,0,0,0.8)"),e.fillStyle=h,e.beginPath(),e.arc(n,s,l,0,Math.PI*2),e.fill(),e.fillStyle="rgba(10, 20, 40, 0.4)",e.beginPath(),e.arc(n,s,l,0,Math.PI*2),e.fill(),e.restore()},o=Math.min(t,i);a(t*.15,i*.5,o*.11,"#c0392b","rocky"),a(t*.28,i*.38,o*.05,"#4fc3f7","rocky"),a(t*.85,i*.45,o*.12,"#8e44ad","rocky"),a(t*.72,i*.65,o*.07,"#f39c12","gas")}let Gt=[],po=null;function al(){if(Gt.length===0)return;const e=Gt.shift();if(e)try{e()}catch(t){console.error("[SpaceRenderer] Warmup Task Failed:",t)}Gt.length>0&&(po=setTimeout(al,16))}function ol(e,t){if(Bt&&Bt.width===e&&Bt.height===t)return;console.log(`[SpaceRenderer] Starting Async Warmup: ${e}x${t}`),po&&clearTimeout(po),Gt=[],Bt||(Bt=document.createElement("canvas")),Bt.width=e,Bt.height=t;const i=Bt.getContext("2d"),a=i.createLinearGradient(0,0,0,t);a.addColorStop(0,"#050520"),a.addColorStop(.5,"#1a0b2e"),a.addColorStop(1,"#000005"),i.fillStyle=a,i.fillRect(0,0,e,t);const o=Math.min(e,t)*.6;_s(i,e,t),Gt.push(()=>xi(i,e*.1,t*.5,o,111)),Gt.push(()=>xi(i,e*.9,t*.55,o,444)),Gt.push(()=>xi(i,e*.2,t*.4,o*.8,222)),Gt.push(()=>xi(i,e*.8,t*.45,o*.8,333)),Gt.push(()=>_s(i,e,t)),Gt.push(()=>{const n=s=>sl(s,5,10);n("#ff0000"),n("#ffff00"),n("#00ff00"),n("#ffa500"),n("#ff8c00"),console.log("[SpaceRenderer] Surge Sprites Warmed Up")}),po=setTimeout(al,0)}function nl(e,t,i,a,o,n,s=!1,l=!0){e.save();const c=Ro(i,n);ol(t,i),Bt&&e.drawImage(Bt,0,0),s&&r.isGameOver&&(e.fillStyle="rgba(20, 0, 0, 0.6)",e.fillRect(0,0,t,i));const f=20,d="#2c3e50",u=a||t/2,h=o||i*.85,g=(z,ae,Me,_e)=>{e.save();const at=Math.atan2(_e-ae,Me-z),nt=Math.hypot(Me-z,_e-ae);e.translate(z,ae),e.rotate(at);const Tt=e.createLinearGradient(0,-f/2,0,f/2);Tt.addColorStop(0,"#2c3e50"),Tt.addColorStop(.5,"#546e7a"),Tt.addColorStop(1,"#2c3e50"),e.fillStyle=Tt,e.fillRect(0,-f/2,nt,f),e.strokeStyle=d,e.lineWidth=2,e.strokeRect(0,-f/2,nt,f),e.fillStyle="#2c3e50";for(let Dt=30;Dt<nt;Dt+=50)e.beginPath(),e.arc(Dt,0,4,0,Math.PI*2),e.fill(),e.fillStyle="rgba(255,255,255,0.3)",e.beginPath(),e.arc(Dt-1,-1,2,0,Math.PI*2),e.fill(),e.fillStyle="#2c3e50";e.restore()};g(u,h,0,h-u*1.5),g(u,h,t,h-(t-u)*1.5),g(u,h,t*.2,i),g(u,h,t*.8,i);const m=c.floorH,p=c.floorTop,b=c.floorBottom,v=c.consoleH,y=c.consoleBottom,T=c.consoleTop,R=e.createLinearGradient(0,T,0,y);R.addColorStop(0,"#2c3e50"),R.addColorStop(.5,"#546e7a"),R.addColorStop(1,"#2c3e50"),e.fillStyle=R,e.fillRect(0,T,t,v),e.strokeStyle="#1c2833",e.lineWidth=2,e.strokeRect(0,T,t,v);const S=(z,ae,Me)=>{e.beginPath(),e.arc(z,ae,7,0,Math.PI*2),e.fillStyle="#111",e.fill(),e.strokeStyle="#333",e.lineWidth=1,e.stroke(),e.beginPath(),e.arc(z,ae,5,0,Math.PI*2);const _e=e.createRadialGradient(z-2,ae-2,1,z,ae,6);_e.addColorStop(0,"#444"),_e.addColorStop(.5,"#222"),_e.addColorStop(1,"#000"),e.fillStyle=_e,e.fill(),e.strokeStyle=Me,e.globalAlpha=.5,e.lineWidth=1,e.stroke(),e.globalAlpha=1,e.fillStyle="rgba(255, 255, 255, 0.3)",e.beginPath(),e.arc(z-2,ae-2,1.5,0,Math.PI*2),e.fill()};S(t*.15,T+v*.3,"#500"),S(t*.18,T+v*.3,"#550"),S(t*.21,T+v*.3,"#050"),S(t*.85,T+v*.5,"#500"),S(t*.82,T+v*.5,"#530");const P=t*.35,w=T+5,E=t*.3,M=v-10;e.fillStyle="#111",e.fillRect(P-4,w-4,E+8,M+8),e.save();const D=e.createLinearGradient(0,p,0,b);D.addColorStop(0,"rgba(200, 200, 200, 0.05)"),D.addColorStop(.5,"rgba(255, 255, 255, 0.02)"),D.addColorStop(1,"rgba(200, 200, 200, 0.05)"),e.fillStyle=D,e.fillRect(0,p,t,m),e.strokeStyle="rgba(0, 255, 255, 0.15)",e.lineWidth=1,e.beginPath();for(let z=0;z<=t;z+=40)e.moveTo(z,p),e.lineTo(z,b);for(let z=p;z<=b;z+=10)e.moveTo(0,z),e.lineTo(t,z);e.stroke();const I=a||t*.5,H=n||p+m*.5,k=m*.35,O=(window.spaceRendererTime||Date.now())/500,W=.5+Math.sin(O)*.2,Z=e.createRadialGradient(I,H,0,I,H,k*.6);Z.addColorStop(0,`rgba(255, 165, 0, ${W*.3})`),Z.addColorStop(1,"rgba(0, 0, 0, 0)"),e.fillStyle=Z,e.beginPath(),e.arc(I,H,k*.6,0,Math.PI*2),e.fill(),e.fillStyle="rgba(0, 0, 0, 0.3)",e.beginPath(),e.arc(I,H,k*.6,0,Math.PI*2),e.fill(),e.strokeStyle="#1c2833",e.lineWidth=2,e.beginPath();for(let z=-k*.6;z<k*.6;z+=8){const ae=Math.sqrt(Math.pow(k*.6,2)-Math.pow(z,2));e.moveTo(I-ae,H+z),e.lineTo(I+ae,H+z)}e.stroke(),e.strokeStyle="#7f8c8d",e.lineWidth=4,e.beginPath(),e.arc(I,H,k,0,Math.PI*2),e.stroke(),e.strokeStyle="#000",e.lineWidth=1,e.beginPath(),e.arc(I,H,k-2,0,Math.PI*2),e.stroke(),e.restore();const N=b,$=i-N-i*.05;e.save(),e.fillStyle="rgba(10, 10, 15, 0.3)",e.fillRect(0,N,t,$),e.save(),e.beginPath(),e.rect(0,N,t,$),e.clip(),e.strokeStyle="rgba(0, 255, 255, 0.05)",e.lineWidth=1;const V=20,j=V*1.5,ge=V*Math.sqrt(3);for(let z=N;z<N+$+ge;z+=ge)for(let ae=0;ae<t+j;ae+=j*2){const Me=(_e,at)=>{e.beginPath();for(let nt=0;nt<6;nt++)e.lineTo(_e+V*Math.cos(nt*Math.PI/3),at+V*Math.sin(nt*Math.PI/3));e.closePath(),e.stroke()};Me(ae,z),Me(ae+j,z+ge/2)}e.restore(),e.strokeStyle="rgba(0, 255, 255, 0.3)",e.lineWidth=2,e.beginPath(),e.moveTo(0,N),e.lineTo(t,N),e.stroke(),e.restore();const se=b,Q=25,Se=se+Q,Ee=e.createLinearGradient(0,se,0,Se);Ee.addColorStop(0,"#2c3e50"),Ee.addColorStop(.5,"#546e7a"),Ee.addColorStop(1,"#2c3e50"),e.fillStyle=Ee,e.fillRect(0,se,t,Q);const ye=60,me=se+Q/2,Be=t*.05;for(let z=20;z<t;z+=ye)z<Be||z>t-Be||(e.beginPath(),e.arc(z,me,6,0,Math.PI*2),e.fillStyle="#111",e.fill(),e.fillStyle="#442200",e.beginPath(),e.arc(z,me,4,0,Math.PI*2),e.fill(),e.fillStyle="rgba(255, 255, 255, 0.4)",e.beginPath(),e.arc(z-1.5,me-1.5,1.5,0,Math.PI*2),e.fill());e.fillStyle="#1c2833",e.fillRect(0,se,t,2),e.fillRect(0,Se,t,4);const je=(h-Se)/1.5,x=u-je,ce=u+je,Te=40,be=12,Ke=(z,ae)=>{e.fillStyle="#34495e",e.fillRect(z-Te/2,ae-be/2,Te,be),e.strokeStyle="#1c2833",e.lineWidth=2,e.strokeRect(z-Te/2,ae-be/2,Te,be),e.fillStyle="#bdc3c7",e.beginPath(),e.arc(z-12,ae,3,0,Math.PI*2),e.fill(),e.beginPath(),e.arc(z+12,ae,3,0,Math.PI*2),e.fill()};Ke(x,Se),Ke(ce,Se);const _=t*.2,A=(t-_)/2,G=Se+4,B=i*.25,J=6;e.fillStyle="#2c3e50",e.fillRect(A,G,_,J),e.fillRect(A,G+B-J,_,J),e.fillRect(A,G,J,B),e.fillRect(A+_-J,G,J,B),e.fillStyle="rgba(0, 0, 0, 0.4)",e.fillRect(A+J,G+J,_-J*2,B-J*2);const q=.2,te=e.createLinearGradient(A,G,A+_,G);te.addColorStop(0,"rgba(0, 255, 255, 0)"),te.addColorStop(.2,`rgba(0, 255, 255, ${q*.2})`),te.addColorStop(.5,`rgba(0, 255, 255, ${q})`),te.addColorStop(.8,`rgba(0, 255, 255, ${q*.2})`),te.addColorStop(1,"rgba(0, 255, 255, 0)"),e.fillStyle=te,e.fillRect(A,G,_,B),e.fillStyle=`rgba(0, 255, 255, ${q*.5})`;for(let z=G;z<G+B;z+=4)Math.floor(z/20)%2===0&&e.fillRect(A+_*.4,z,_*.2,1);e.restore();const ie=10,le=_-ie*2,fe=(B-ie*3)/2,oe=(z,ae,Me,_e)=>{e.strokeStyle="#34495e",e.lineWidth=1,e.strokeRect(z,ae,Me,_e),e.fillStyle="#2c3e50";const at=3,nt=Me/(at+1);for(let Pt=1;Pt<=at;Pt++)e.fillRect(z+Pt*nt-1,ae,2,_e);const Tt=3,Dt=10;for(let Pt=ae+Dt;Pt<ae+_e-Dt;Pt+=Tt+Dt)e.fillStyle="#546e7a",e.fillRect(z+2,Pt,Me-4,Tt),e.fillStyle="rgba(255,255,255,0.1)",e.fillRect(z+2,Pt,Me-4,1),e.fillStyle="rgba(0,0,0,0.3)",e.fillRect(z+2,Pt+Tt-1,Me-4,1)};oe(A+ie,G+ie,le,fe),oe(A+ie,G+ie+fe+ie,le,fe);const Pe=(z,ae,Me,_e,at,nt)=>{e.beginPath(),e.moveTo(z,ae),e.quadraticCurveTo(z,ae+nt,Me,_e),e.strokeStyle=at,e.lineWidth=3,e.stroke()};Pe(A-40,Se,A,G+50,"#e74c3c",20),Pe(A-30,Se,A,G+60,"#2c3e50",20),Pe(A+_+40,Se,A+_,G+50,"#2ecc71",20),Pe(A+_+30,Se,A+_,G+60,"#2c3e50",20);const re=a||t/2,ue=o||i*.85,pe=t*.25,ve=(t-pe)/2,$e=ue+20,vt=b+25+4,zt=i*.25,we=vt+zt,it=$e-we;e.save();const pt=12,Ct=t*.2,_o=(t-Ct)/2,sa=(z,ae,Me)=>{const _e=e.createLinearGradient(z,ae,z+pt,ae);_e.addColorStop(0,"#2c3e50"),_e.addColorStop(.5,"#78909c"),_e.addColorStop(1,"#2c3e50"),e.fillStyle=_e,e.fillRect(z,ae-50,pt,50),e.fillStyle="#34495e",e.fillRect(z-2,ae-10,pt+4,8)};sa(_o-4,we),sa(_o+Ct-pt+4,we);const Ce=6;e.fillStyle="#2c3e50",e.fillRect(ve,we,pe,Ce),e.fillRect(ve,we+it-Ce,pe,Ce),e.fillRect(ve,we,Ce,it),e.fillRect(ve+pe-Ce,we,Ce,it),e.fillStyle="rgba(0, 0, 0, 0.4)",e.fillRect(ve+Ce,we+Ce,pe-Ce*2,it-Ce*2);const Wt=.2;e.save(),e.beginPath(),e.rect(ve+Ce,we+Ce,pe-Ce*2,it-Ce*2),e.clip();const Nt=e.createLinearGradient(ve,we,ve+pe,we);Nt.addColorStop(0,"rgba(0, 255, 255, 0)"),Nt.addColorStop(.2,`rgba(0, 255, 255, ${Wt*.2})`),Nt.addColorStop(.5,`rgba(0, 255, 255, ${Wt})`),Nt.addColorStop(.8,`rgba(0, 255, 255, ${Wt*.2})`),Nt.addColorStop(1,"rgba(0, 255, 255, 0)"),e.fillStyle=Nt,e.fillRect(ve,we,pe,it),e.fillStyle=`rgba(0, 255, 255, ${Wt*.5})`;for(let z=we;z<we+it;z+=4)Math.floor(z/20)%2===0&&e.fillRect(ve+pe*.4,z,pe*.2,1);e.restore(),e.strokeStyle="#1c2833",e.lineWidth=4,e.strokeRect(ve,we,pe,it),e.fillStyle="#2c3e50";const la=2,Da=pe/(la+1);for(let z=1;z<=la;z++)e.fillRect(ve+z*Da-2,we,4,it);const Qt=60,zi=15,xt=re-Qt/2,Wi=ue-10;e.fillStyle="#34495e",e.fillRect(xt,Wi,Qt,zi),e.strokeStyle="#1c2833",e.strokeRect(xt,Wi,Qt,zi),e.fillStyle="#bdc3c7",e.beginPath(),e.arc(xt+8,Wi+zi/2,3,0,Math.PI*2),e.fill(),e.beginPath(),e.arc(xt+Qt-8,Wi+zi/2,3,0,Math.PI*2),e.fill(),e.fillStyle="#111",e.beginPath(),e.arc(ve+10,we+10,4,0,Math.PI*2),e.fill(),e.beginPath(),e.arc(ve+pe-10,we+10,4,0,Math.PI*2),e.fill(),e.beginPath(),e.arc(ve+10,$e-10,4,0,Math.PI*2),e.fill(),e.beginPath(),e.arc(ve+pe-10,$e-10,4,0,Math.PI*2),e.fill(),e.strokeStyle="#546e7a",e.lineWidth=2;for(let z=we+30;z<$e;z+=30){e.beginPath(),e.moveTo(ve+10,z),e.lineTo(ve+pe-10,z),e.stroke(),e.fillStyle="#2c3e50";for(let ae=ve+20;ae<ve+pe-20;ae+=20)e.beginPath(),e.arc(ae,z,2,0,Math.PI*2),e.fill()}e.restore();const gt=$e,La=i*.08,kt=i-La,ra=kt,ei=ra-gt,Cn=pe,Pn=ve;if(ei>0){const Me=t;e.fillStyle="#1b2631",e.fillRect(0,gt,Me,ei),e.save(),e.beginPath(),e.rect(0,gt,Me,ei),e.clip();const _e=e.createLinearGradient(0,gt,0,ra);_e.addColorStop(0,"#1c2833"),_e.addColorStop(1,"#2c3e50"),e.fillStyle=_e,e.fill(),e.strokeStyle="rgba(255, 255, 255, 0.05)",e.lineWidth=1,e.beginPath();for(let rt=0;rt<0+Me;rt+=t*.1)e.moveTo(rt,gt),e.lineTo(rt,ra);e.stroke(),e.restore();const at=Pn-20,nt=Cn+40;e.fillStyle="#34495e",e.fillRect(at,gt,nt,ei),e.fillStyle="#546e7a",e.fillRect(at,gt,4,ei),e.fillRect(at+nt-4,gt,4,ei);const Tt=6,Dt=at+4,Pt=at+nt-10,Rn=rt=>{e.fillStyle="#37474f",e.fillRect(rt-2,ra-6,Tt+4,6);const Oa=e.createLinearGradient(rt,gt,rt+Tt,gt);Oa.addColorStop(0,"rgba(0, 229, 255, 0.2)"),Oa.addColorStop(.5,"rgba(224, 255, 255, 0.9)"),Oa.addColorStop(1,"rgba(0, 229, 255, 0.2)"),e.fillStyle=Oa,e.shadowBlur=15,e.shadowColor="#00e5ff",e.fillRect(rt,gt,Tt,ei-6),e.shadowBlur=0};Rn(Dt),Rn(Pt),e.restore();const Io=Pn+10,Mn=Cn-20;e.fillStyle="#000",e.fillRect(Io,gt+10,Mn,ei-20),e.strokeStyle="rgba(0, 229, 255, 0.15)",e.lineWidth=2,e.beginPath();for(let rt=Io+10;rt<Io+Mn;rt+=15)e.moveTo(rt,gt+10),e.lineTo(rt,ra-10);e.stroke()}l&&(e.save(),e.strokeStyle="#ffffff",e.lineWidth=3,e.strokeRect(re-70,ue-30,30,60),e.strokeRect(re+40,ue-30,30,60),e.fillStyle="#ffffff",e.beginPath(),e.moveTo(re,ue+10),e.lineTo(re+10,ue),e.lineTo(re+10,ue-10),e.lineTo(re-10,ue-10),e.lineTo(re-10,ue),e.closePath(),e.fill(),e.restore());const ca=e.createLinearGradient(0,kt,0,i);ca.addColorStop(0,"#546e7a"),ca.addColorStop(.1,"#37474f"),ca.addColorStop(.5,"#263238"),ca.addColorStop(1,"#101015"),e.fillStyle=ca,e.fillRect(0,kt,t,La),e.fillStyle="#78909c",e.fillRect(0,kt,t,4),e.fillStyle="#1c2326",e.fillRect(0,kt+4,t,2);const En=t*.2;for(let z=En;z<t;z+=En){e.fillStyle="#000",e.fillRect(z,kt+10,2,La-20),e.fillStyle="rgba(255,255,255,0.1)",e.fillRect(z+2,kt+10,1,La-20);const ae=z-60;if(ae>0){e.fillStyle="#111";for(let Me=kt+15;Me<i-10;Me+=6)e.fillRect(ae,Me,40,3)}}e.fillStyle="#111";for(let z=20;z<t;z+=40)e.beginPath(),e.arc(z,i-8,3,0,Math.PI*2),e.fill(),e.fillStyle="rgba(255,255,255,0.2)",e.beginPath(),e.arc(z-1,i-9,1,0,Math.PI*2),e.fill(),e.fillStyle="#111";const wn=(z,ae,Me,_e)=>{e.fillStyle="#222",e.fillRect(z,ae,Me,_e),e.fillStyle="#051e3e",e.fillRect(z+4,ae+4,Me-24,_e-8);const at=z+Me-16;e.fillStyle="#e74c3c",e.beginPath(),e.arc(at,ae+8,3,0,Math.PI*2),e.fill(),e.fillStyle="#f1c40f",e.beginPath(),e.arc(at,ae+18,3,0,Math.PI*2),e.fill(),e.fillStyle="#004400",e.fillRect(z+6,ae+6,4,4)};wn(20,kt+15,120,30),wn(t-140,kt+15,120,30),e.restore(),Vr(e,t,i,n),il(e,t,i,n),e.restore()}const $o={};function sl(e,t=6,i=10){const a=`${e}-${t}-${i}`;if($o[a])return $o[a];const o=i*2,n=document.createElement("canvas"),s=(t+o)*2;n.width=s,n.height=s;const l=n.getContext("2d"),c=s/2,f=s/2;l.beginPath(),l.arc(c,f,t,0,Math.PI*2);const d=l.createRadialGradient(c-t*.4,f-t*.4,t*.2,c,f,t+1);return d.addColorStop(0,"#fff"),d.addColorStop(.3,e),d.addColorStop(1,e),l.fillStyle=d,l.shadowColor=e,l.shadowBlur=i,l.fill(),l.shadowBlur=0,l.fillStyle="rgba(255, 255, 255, 0.9)",l.beginPath(),l.arc(c-t*.4,f-t*.4,t*.3,0,Math.PI*2),l.fill(),$o[a]=n,n}function $r(e,t,i,a){if(r.settings?.useLowPerformance)return;const o=Ro(i,a),n=o.consoleTop,s=o.consoleH,l=t*.35,c=s-10,f=t*.3,d=i-i*.08,h=o.cautionBottom+4,g=i*.25,m=t*.2,p=(t-m)/2,b=h+g,v=d,y=v-b,T=t*.3,R=(t-T)/2,S=l,P=n+5,w=f,E=c;r.isPaused||(window.spaceRendererTime||(window.spaceRendererTime=Date.now()),window.spaceRendererTime+=16.6);const M=window.spaceRendererTime||Date.now(),D=r.perfectHitTimer>0&&!r.settings.noFlash,I=r.isGameOver,H=D&&U.consecutivePerfectHits>=3;e.fillStyle=I?"#420d0d":"#051015",e.fillRect(S,P,w,E),e.save(),e.beginPath(),e.rect(S,P,w,E),e.clip();const k=I||H?"#ff0000":D?"#00e5ff":"#00ff00";e.strokeStyle=k,e.lineWidth=2,e.shadowBlur=5,e.shadowColor=e.strokeStyle,e.beginPath();const O=M*.002;for(let ye=0;ye<w;ye+=3){let me=D?Math.sin(ye*12.9898+M*.5)*Math.sin(ye*78.233+M*.1)*(E*.4):Math.sin(ye*.05+O)*(E*.35);e.lineTo(S+ye,P+E/2+me)}if(e.stroke(),e.shadowBlur=0,e.restore(),st.w!==t||st.h!==i){st.w=t,st.h=i;const ye=Math.max(t,i),me=e.createRadialGradient(t/2,i/2,ye*.35,t/2,i/2,ye*.85);me.addColorStop(0,"rgba(0,0,0,0)"),me.addColorStop(1,"rgba(20, 10, 30, 0.7)"),st.vignette=me;const Be=e.createLinearGradient(S,P,S+w,P+E);Be.addColorStop(0,"rgba(255,255,255,0.1)"),Be.addColorStop(.5,"rgba(255,255,255,0)"),Be.addColorStop(1,"rgba(255,255,255,0.05)"),st.glass=Be;const Ne=e.createLinearGradient(p,h,p+m,h);if(Ne.addColorStop(0,"rgba(0, 255, 255, 0)"),Ne.addColorStop(.2,"rgba(0, 255, 255, 0.2)"),Ne.addColorStop(.5,"rgba(0, 255, 255, 1.0)"),Ne.addColorStop(.8,"rgba(0, 255, 255, 0.2)"),Ne.addColorStop(1,"rgba(0, 255, 255, 0)"),st.upperBeam=Ne,y>0){const Xe=e.createLinearGradient(R,b,R+T,b);Xe.addColorStop(0,"rgba(0, 255, 255, 0)"),Xe.addColorStop(.2,"rgba(0, 255, 255, 0.2)"),Xe.addColorStop(.5,"rgba(0, 255, 255, 1.0)"),Xe.addColorStop(.8,"rgba(0, 255, 255, 0.2)"),Xe.addColorStop(1,"rgba(0, 255, 255, 0)"),st.lowerBeam=Xe}const Ve=e.createLinearGradient(0,v-40,0,v);Ve.addColorStop(0,"rgba(0, 229, 255, 0)"),Ve.addColorStop(1,"rgba(0, 229, 255, 1.0)"),st.core=Ve}if(e.fillStyle=st.glass,e.fillRect(S,P,w,E),D&&Math.sin(M/50)>0&&(e.shadowBlur=10,e.shadowColor="#ff0000",e.strokeStyle="#ff0000",e.lineWidth=4,e.strokeRect(l,n+5,f,c),e.shadowBlur=0),D){const ye=(x,ce,Te,be)=>{if(Math.sin(M/50+be)>0){const Ke=sl(Te,5,10),G=(5+20)*2;e.drawImage(Ke,x-G/2,ce-G/2)}},me=s;ye(t*.15,n+me*.3,"#ff0000",0),ye(t*.18,n+me*.3,"#ffff00",10),ye(t*.21,n+me*.3,"#00ff00",20),ye(t*.85,n+me*.5,"#ff0000",5),ye(t*.82,n+me*.5,"#ffa500",15);const Be=o.cautionTop,Ne=o.cautionH,Ve=Be+Ne/2,Xe=60,je=t*.05;for(let x=20;x<t;x+=Xe)x<je||x>t-je||ye(x,Ve,"#ff8c00",x)}const W=6,Z=M*.001,N=(Math.sin(Z)+1)/2,$=.02,j=$+N*(.25-$);if(e.save(),e.globalAlpha=j,e.fillStyle=st.upperBeam,e.fillRect(p+W,h+W,m-W*2,g-W*2),y>0&&st.lowerBeam){e.fillStyle=st.lowerBeam,e.fillRect(R+W,b+W,T-W*2,y-W*2),e.fillStyle=st.core;const ye=T,me=R,Be=ye-20,Ne=me+10;e.fillRect(Ne,v-30,Be,20)}e.globalAlpha=1,e.restore();const ge=20,se=d+15,Q=t-140,Se=d+15;M%2e3<1e3&&(e.fillStyle="rgba(0, 255, 0, 0.4)",e.fillRect(ge+2,se+2,12,12),e.fillRect(Q+2,Se+2,12,12),e.fillStyle="#00ff00",e.fillRect(ge+6,se+6,4,4),e.fillRect(Q+6,Se+6,4,4)),e.shadowBlur=0,e.fillStyle=st.vignette,e.fillRect(0,0,t,i),ll(e,t,i,o,M)}const Yo=new Uint8Array(500);function ll(e,t,i,a,o){if(!window.spaceStarCache||window.spaceStarCache.length!==500){window.spaceStarCache=[];for(let y=0;y<500;y++)window.spaceStarCache.push({x:Math.random(),y:Math.random(),size:.5+Math.random()*2,offset:Math.random()*1e4,speed:.002+Math.random()*.004})}let s,l,c,f,d,u,h,g,m,p=!1;a&&(p=!0,s=t*.05,l=a.consoleTop,c=a.consoleBottom,f=a.cautionTop,d=a.cautionBottom,m=t*.25,g=(t-m)/2,u=a.cautionBottom,h=i*.85);const b=o||Date.now(),v=window.spaceStarCache;for(let y=0;y<500;y++){const T=v[y],R=T.x*t,S=T.y*i;let P=!0;if(p&&(R<s||R>t-s||S>l&&S<c||S>f&&S<d||S>u&&S<h&&R>g&&R<g+m)&&(P=!1),!P){Yo[y]=255;continue}const w=Math.sin(b*T.speed+T.offset),E=Math.max(0,(w+1)/2);Yo[y]=Math.min(9,Math.floor(E*10))}e.save(),e.fillStyle="#ffffff";for(let y=0;y<10;y++){const T=(y+1)/10;e.globalAlpha=T;for(let R=0;R<500;R++)if(Yo[R]===y){const S=v[R];e.fillRect(S.x*t,S.y*i,S.size,S.size)}}e.globalAlpha=1,e.restore()}function Yr(e,t,i){const a=r.isGameOver,o=a;if(tl(e,t,i,o),Vo(e,t,i,o),e.canvas.style.cursor="pointer",ll(e,t,i,null,Date.now()),a){ws(e,t,i),Vo(e,t,i,!0),Es(e,t,i,!0),As(e,t,i,!0,!1),e.save(),e.textAlign="center",e.fillStyle="#ff0000",e.shadowColor="#ff0000",e.shadowBlur=20;const n=Math.min(t,i)*.08;e.font=`${n}px "PressStart2PLocal"`;let s="GAME OVER";r.consecutiveFouls>=4&&(s="BAT BROKEN!"),e.fillText(s,t/2,i*.2),e.fillStyle=r.isDailyChallenge?"#FFD700":"#ffffff",e.shadowBlur=10,e.font=`${n*.5}px "PressStart2PLocal"`,e.fillText(`SCORE: ${U.score}`,t/2,i*.35),(r.settings?.noFlash||Math.floor(Date.now()/500)%2===0)&&(e.fillStyle="#ffffff",e.shadowBlur=0,e.font=`${n*.5}px "PressStart2PLocal"`,e.fillText("TAP TO RETRY",t/2,i*.8)),e.restore()}else{ws(e,t,i),Vo(e,t,i,!1),Es(e,t,i,!1),As(e,t,i,!1,!0),e.save(),e.textAlign="center",e.font='40px "PressStart2PLocal"';const n=Math.sin(Date.now()/300);e.globalAlpha=.6+n*.4,e.fillStyle="#e0f7fa",e.shadowColor="#00e5ff",e.shadowBlur=15,window.innerWidth<=600||window.innerHeight<=600?(e.fillText("TAP TO",t/2,i*.72),e.fillText("START",t/2,i*.72+50)):e.fillText("TAP TO START",t/2,i*.75),e.restore()}}let Is=0,Qa=0;function Ra(){const e=Date.now()/1e3;Qa===0&&(Qa=e);const t=e-Qa;return Qa=e,r.isPaused||(Is+=t),Is}function mn(e,t,i,a,o=null){const n=o!==null?o:i*.1,s=e.createLinearGradient(0,0,0,n);a?(s.addColorStop(0,"#0a0a2a"),s.addColorStop(1,"#2c3e50")):(s.addColorStop(0,"#4facfe"),s.addColorStop(1,"#00f2fe")),e.fillStyle=s,e.fillRect(0,0,t,n);const l=t*.8,c=n*.35,f=a?Math.min(25,n*.5):Math.min(45,n*.7);a?(e.fillStyle="#fdfdea",e.shadowColor="#fdfdea",e.shadowBlur=15,e.beginPath(),e.arc(t*.2,c,f,0,Math.PI*2),e.fill(),e.shadowBlur=0):(e.fillStyle="#ffecb3",e.shadowColor="#ffc107",e.shadowBlur=30,e.beginPath(),e.arc(l,c,f,0,Math.PI*2),e.fill(),e.shadowBlur=0);const d=e.createLinearGradient(0,n,0,i);if(a?(d.addColorStop(0,"#000033"),d.addColorStop(1,"#001144")):(d.addColorStop(0,"#0277bd"),d.addColorStop(.3,"#00acc1"),d.addColorStop(1,"#26c6da")),e.fillStyle=d,e.fillRect(0,n+20,t,i-(n+20)),Xr(e,t*.55,n+1,.4,a),!a){const u=e.createLinearGradient(0,n-20,0,n+40);u.addColorStop(0,"rgba(255, 255, 255, 0)"),u.addColorStop(.4,"rgba(200, 240, 255, 0.5)"),u.addColorStop(1,"rgba(255, 255, 255, 0)"),e.fillStyle=u,e.fillRect(0,n-20,t,60)}qr(e,t,n,a)}function qr(e,t,i,a){const o=a?"#263238":"#546e7a",n=a?"#000000":"#37474f",s=(l,c,f)=>{e.save(),e.translate(l,c),e.scale(f,f),e.fillStyle=o,e.beginPath(),e.moveTo(0,0),e.lineTo(10,-15),e.lineTo(25,-5),e.lineTo(35,-20),e.lineTo(50,0),e.fill(),e.fillStyle=n,e.fillRect(0,-2,50,2),e.restore()};s(t*.25,i+40,.6),s(t*.22,i+45,.5),s(t*.8,i+80,.8),s(t*.85,i+75,.6)}function Xr(e,t,i,a,o){e.save(),e.translate(t,i),e.scale(a,a);const n=o?"#212121":"#455a64",s=o?"#1b5e20":"#2e7d32";e.fillStyle=n,e.beginPath(),e.moveTo(-40,0),e.lineTo(40,0),e.lineTo(35,4),e.lineTo(-38,4),e.closePath(),e.fill(),e.fillRect(20,-10,8,10),e.fillRect(22,-12,4,3),e.fillStyle=s,e.fillRect(-30,-5,12,5),e.fillRect(-15,-5,12,5),e.fillStyle=o?"#b71c1c":"#c62828",e.fillRect(-28,-9,10,4),e.fillRect(-12,-9,10,4),e.restore()}function ks(e,t,i,a,o,n=!1,s=0){const l=s?Math.sin(s*.8)*1.5:0,c=s?Math.sin(s*.5)*.05:0;e.save(),e.translate(t,i+l),n&&e.scale(-1,1),e.rotate(c),e.scale(a,a);const f=o?"#263238":"#37474f",d=o?"#b0bec5":"#ECEFF1";e.fillStyle=f,e.beginPath(),e.moveTo(-15,0),e.lineTo(15,0),e.lineTo(10,6),e.lineTo(-10,6),e.closePath(),e.fill(),e.strokeStyle=f,e.lineWidth=2,e.beginPath(),e.moveTo(0,0),e.lineTo(0,-25),e.stroke(),e.fillStyle=d,e.beginPath(),e.moveTo(2,-22),e.quadraticCurveTo(15,-12,2,-2),e.fill(),e.restore()}function Ds(e,t,i,a,o,n){const s=Math.sin(n*1.2)*2,l=Math.sin(n*.8)*.1;e.save(),e.translate(t,i+s),e.rotate(l),e.scale(a,a);const c=o?"#880e4f":"#d81b60",f=o?"#263238":"#546e7a";e.fillStyle=c,e.beginPath(),e.arc(0,0,6,0,Math.PI,!0),e.fill(),e.fillRect(-6,0,12,3),e.fillStyle=f,e.fillRect(-2,-10,4,10),e.fillRect(-4,-12,8,2),o&&(e.shadowBlur=10,e.shadowColor="red",e.fillStyle="#ff1744",e.beginPath(),e.arc(0,-13,1.5,0,Math.PI*2),e.fill()),e.restore()}function Kr(e,t,i,a,o,n=!1,s=0,l=!1){e.save(),e.translate(t,i),e.scale(a,a);const c=o?"#795548":"#ffe0b2",f=o?"#4e342e":"#ffcc80";if(e.fillStyle=f,e.beginPath(),e.ellipse(0,0,40,10,0,0,Math.PI*2),e.fill(),e.fillStyle=c,e.beginPath(),e.ellipse(0,-2,35,8,0,0,Math.PI*2),e.fill(),n){if(l&&r.gameActive){e.save(),e.translate(0,-35);const p=typeof U<"u"?U.score:0,b=Math.sin(p*123.456)*Math.PI*2,v=Math.sin(s*.8)*.2;e.rotate(b+v);const y=e.createLinearGradient(0,0,0,-120);y.addColorStop(0,"rgba(255, 215, 0, 0.6)"),y.addColorStop(1,"rgba(255, 215, 0, 0)"),e.fillStyle=y,e.beginPath(),e.moveTo(0,0),e.lineTo(-20,-120),e.lineTo(20,-120),e.closePath(),e.fill(),e.restore()}e.save(),e.beginPath(),e.moveTo(-8/2,0),e.lineTo(-8/3,-35),e.lineTo(8/3,-35),e.lineTo(8/2,0),e.clip();const g=4,m=35/g;for(let p=0;p<g;p++){const b=l?"#fff176":"#ffffff";e.fillStyle=p%2===0?o?"#37474f":b:"#d32f2f",e.fillRect(-8,-35+p*m,16,m)}e.restore(),e.fillStyle="#212121",e.fillRect(-4,-39,8,4),e.fillStyle=l&&r.gameActive?"#ffff00":"#ffeb3b",(o||l&&r.gameActive)&&(e.shadowBlur=l&&r.gameActive?20:10,e.shadowColor="#ffff00"),e.beginPath(),e.arc(0,-41,3,0,Math.PI*2),e.fill(),e.shadowBlur=0,e.fillStyle="#b71c1c",e.beginPath(),e.moveTo(-6,-43),e.lineTo(0,-47),e.lineTo(6,-43),e.fill()}e.restore()}function Mo(e,t,i,a=null,o=null){const n=Ra(),s=a!==null?a:i*.1,l=X.currentTheme,c=o!==null?o:l.getShorelineY?l.getShorelineY(i):i*.18,f=c-s;e.save();const d=r.isGameOver||r.isNight;e.beginPath(),e.moveTo(0,c),e.lineTo(0,s);for(let p=0;p<=t;p+=25){const b=s+Math.sin(p*.04+n*.4)*3+Math.sin(p*.12-n*.7)*1;e.lineTo(p,b)}e.lineTo(t,c),e.closePath(),e.fillStyle=d?"#000033":"#0277bd",e.fill();const u=r.perfectHitTimer>0&&U.consecutivePerfectHits>=1&&r.gameActive;Kr(e,t*.16,s+5,1.1,d,!0,n,u),e.strokeStyle="rgba(255, 255, 255, 0.25)",e.lineWidth=1,e.beginPath();for(let p=0;p<=t;p+=100){const b=Math.sin(p*.2+n*1.5)*1,v=s+Math.sin(p*.04+n*.4)*3+b;p===0?e.moveTo(p,v):e.lineTo(p,v)}e.stroke(),l._beachCache||(l._beachCache={h:0,isNight:null,waveGradients:[]});const h=l._beachCache,g=h.h!==i||h.isNight!==d;g&&(h.h=i,h.isNight=d,h.waveGradients=[]);const m=2;for(let p=0;p<m;p++){const b=(p+1)/(m+1),v=s+f*.1+f*.8*b,y=.2+p*.1,T=3+p*3;e.beginPath(),e.moveTo(0,c);for(let R=0;R<=t;R+=60){const S=Math.sin(R*.01+n*y)*T;e.lineTo(R,v+S)}if(e.lineTo(t,c),e.closePath(),g||!h.waveGradients[p]){const R=e.createLinearGradient(0,v-T,0,v+T*8),S=.08+p*.12;R.addColorStop(0,`rgba(255, 255, 255, ${S*.5})`),R.addColorStop(.3,`rgba(0, 188, 212, ${S})`),R.addColorStop(1,"rgba(0, 77, 64, 0)"),h.waveGradients[p]=R}e.fillStyle=h.waveGradients[p],e.fill(),p===0?(ks(e,t*.35,v,1,d,!1,n),ks(e,t*.62,v+2,.85,d,!0,n+1)):(Ds(e,t*.2,v+1,1.1,d,n+.5),Ds(e,t*.85,v-1,1,d,n+2.1))}if(U.consecutivePerfectHits>=1&&!r.settings?.noFlash&&!r.isGameOver&&r.gameActive){const p=r.perfectHitTimer>0,b=t*.8,v=s*.35,y=Math.min(45,s*.7);if(p){const S=(Math.sin(n*15)+1)*.5,P=y*(1.5+S*.5),w=e.createRadialGradient(b,v,y*.5,b,v,P);w.addColorStop(0,"rgba(255, 255, 210, 0.8)"),w.addColorStop(.4,"rgba(255, 215, 0, 0.6)"),w.addColorStop(1,"rgba(255, 165, 0, 0)"),e.fillStyle=w,e.beginPath(),e.arc(b,v,P,0,Math.PI*2),e.fill(),e.save(),e.translate(b,v),e.rotate(n*.5),e.fillStyle="rgba(255, 255, 255, 0.15)";for(let E=0;E<8;E++)e.rotate(Math.PI/4),e.beginPath(),e.moveTo(0,0),e.lineTo(20,-P*2),e.lineTo(-20,-P*2),e.closePath(),e.fill();e.restore()}const T=p?.3:.15;e.fillStyle=`rgba(255, 100, 0, ${T})`,e.globalCompositeOperation="overlay",e.fillRect(0,0,t,i),e.globalCompositeOperation="source-over";const R=Math.floor(n*5);for(let S=0;S<10;S++){let w=(R*9301+49297+S)%233280/233280;if(w>.5){const E=w*t%t,M=s+w*1e3%f;e.fillStyle="#fff",e.beginPath(),e.arc(E,M,2,0,Math.PI*2),e.fill()}}}e.restore()}function Zr(e,t,i){if(X.currentTheme.id!=="BEACH")return;const a=r.isNight||r.isGameOver,o=Ra(),n=X.currentTheme,s=n.getShorelineY?n.getShorelineY(i):i*.18,l=40/(t/i),c=Math.sin(o*.45),f=Math.sin(o*.9)*.15,d=(c+1)/2+f,u=d*Math.min(55,Math.max(15,l)),h=s+u;e.save();const g=a?"77, 208, 225":"178, 235, 242";for(let m=0;m<3;m++){const p=(.4+m*.15)*Math.max(0,d),b=u*(.5+m*.5),v=s+b,y=e.createLinearGradient(0,s,0,v+12);y.addColorStop(0,`rgba(${g}, ${.1*m})`),y.addColorStop(.3,`rgba(${g}, ${p})`),y.addColorStop(.7,`rgba(255, 255, 255, ${p*.9})`),y.addColorStop(1,"rgba(255, 255, 255, 0)"),e.fillStyle=y,e.beginPath(),e.moveTo(0,s);for(let T=0;T<=t;T+=40){const R=Math.sin(T*.015+o*.6+m)*8,S=Math.sin(T*.05-o*.9)*3;e.lineTo(T,v+R+S)}e.lineTo(t,s),e.fill()}for(let m=0;m<50;m++){const p=t*(m/50+Math.sin(m*123)%.02),b=h+Math.sin(p*.01+o*.5)*6;b>s&&(e.fillStyle=m%2===0?`rgba(${g}, ${.8*d})`:`rgba(255, 255, 255, ${.9*d})`,e.beginPath(),e.arc(p,b,Math.max(.1,.7+Math.sin(o+m)*1.2),0,Math.PI*2),e.fill())}e.restore()}function jr(e,t,i,a,o){e.save();const n="#8d6e63",s="#4e342e",l=(c,f,d,u)=>{e.save(),e.strokeStyle=s,e.lineWidth=6,e.beginPath(),e.moveTo(c,f),e.lineTo(d,u),e.stroke(),e.strokeStyle=n,e.lineWidth=4,e.setLineDash([8,4]),e.beginPath(),e.moveTo(c,f),e.lineTo(d,u),e.stroke(),e.restore()};l(a,o,t,o-(t-a)*1.5),l(a,o,0,o-a*1.5),e.restore()}function Jr(e,t,i){if(X.currentTheme.id!=="BEACH")return;const a=X.currentTheme,n=(a.getShorelineY?a.getShorelineY(i):i*.18)+20,s=i,l=s-n;qo(e,t*.28,n+l*.15,1.2),qo(e,t*.1,s-100,1.5),qo(e,t*.88,n+l*.35,1.3),Xo(e,t*.1,n+l*.6,1.5,"#ff7043"),Xo(e,t*.72,n+l*.08,1.2,"#ff8a65"),Xo(e,t*.92,n+l*.75,1.6,"#ef5350"),Ko(e,t*.2,n+l*.1,1.4,"#f8bbd0"),Ko(e,t*.03,n+l*.5,1.6,"#ffffff"),Ko(e,t*.95,n+l*.45,1.3,"#e1bee7")}function qo(e,t,i,a){e.save(),e.translate(t,i),e.scale(a,a),e.rotate(.3),e.fillStyle="rgba(0,0,0,0.15)",e.beginPath(),e.ellipse(0,4,18,5,0,0,Math.PI*2),e.fill(),e.fillStyle="#6d4c41",e.beginPath(),e.moveTo(-18,-3),e.quadraticCurveTo(-10,-5,5,-4),e.lineTo(18,-2),e.lineTo(20,3),e.quadraticCurveTo(5,6,-10,5),e.lineTo(-20,2),e.closePath(),e.fill(),e.strokeStyle="rgba(0,0,0,0.2)",e.lineWidth=1,e.beginPath(),e.moveTo(-12,1),e.lineTo(12,-1),e.stroke(),e.beginPath(),e.moveTo(-8,3),e.lineTo(8,2),e.stroke(),e.beginPath(),e.arc(5,0,1.5,0,Math.PI*2),e.stroke(),e.restore()}function Xo(e,t,i,a,o){e.save(),e.translate(t,i),e.scale(a,a),e.rotate(.5),e.fillStyle="rgba(0,0,0,0.1)",e.beginPath(),e.arc(0,2,7,0,Math.PI*2),e.fill(),e.fillStyle=o,e.beginPath();for(let n=0;n<5;n++){const s=n/5*Math.PI*2;e.lineTo(Math.cos(s)*10,Math.sin(s)*10),e.lineTo(Math.cos(s+Math.PI/5)*4,Math.sin(s+Math.PI/5)*4)}e.closePath(),e.fill(),e.fillStyle="rgba(255,255,255,0.3)";for(let n=0;n<5;n++){const s=n/5*Math.PI*2;e.beginPath(),e.arc(Math.cos(s)*5,Math.sin(s)*5,1,0,Math.PI*2),e.fill()}e.restore()}function Ko(e,t,i,a,o){e.save(),e.translate(t,i),e.scale(a,a),e.fillStyle="rgba(0,0,0,0.1)",e.beginPath(),e.ellipse(0,2,8,4,0,0,Math.PI*2),e.fill(),e.fillStyle=o,e.beginPath(),e.moveTo(-6,4),e.bezierCurveTo(-12,-10,12,-10,6,4),e.closePath(),e.fill(),e.strokeStyle="rgba(0,0,0,0.15)",e.lineWidth=.5;for(let n=-3;n<=3;n+=2)e.beginPath(),e.moveTo(n,-6),e.lineTo(n,2),e.stroke();e.restore()}function Qr(e,t,i,a,o,n,s=0){e.save(),e.translate(t,i),e.scale(a,a);const l=Math.abs(Math.sin(s*8))*.5,c=Math.sin(s*4)*.08;e.translate(0,-l),e.rotate(c);const f=o?"#b71c1c":"#ff5252",d=o?"#7f0000":"#d32f2f",u=o?"#ffcc80":"#ffe0b2",h=f,g="#ffffff",m="#000000";e.save(),e.translate(0,l),e.rotate(-c),e.fillStyle="rgba(0,0,0,0.2)",e.beginPath(),e.ellipse(0,5,25,8,0,0,Math.PI*2),e.fill(),e.restore(),e.strokeStyle=d,e.lineWidth=3,e.lineCap="round";const p=(R,S,P,w)=>{const E=R==="left"?-1:1,M=S/(P*1.5)*Math.PI,I=(w*3+M)%(Math.PI*2),H=Math.sin(I),k=Math.max(0,H)*6,O=Math.cos(I)*.5;e.beginPath(),e.moveTo(E*15,0);const W=E*(25+O),Z=5-k;e.lineTo(W,Z);const N=E*(28+O*1.5),$=12-Math.max(0,k*1.2);e.lineTo(N,$),e.stroke()};for(let R=0;R<3;R++)p("left",R,3,s),p("right",R,3,s);e.fillStyle=f,e.beginPath(),e.ellipse(0,0,20,14,0,0,Math.PI*2),e.fill(),e.fillStyle="rgba(255,255,255,0.15)",e.beginPath(),e.arc(-12,-5,2,0,Math.PI*2),e.fill(),e.beginPath(),e.arc(12,-3,3,0,Math.PI*2),e.fill(),e.beginPath(),e.arc(-8,6,1.5,0,Math.PI*2),e.fill(),e.fillStyle=u,e.beginPath(),e.ellipse(0,5,12,6,0,0,Math.PI*2),e.fill(),e.strokeStyle="#3e2723",e.lineWidth=1.5,e.beginPath(),e.arc(0,-4,6,.2,Math.PI-.2),e.stroke(),e.fillStyle="rgba(255, 100, 100, 0.3)",e.beginPath(),e.arc(-7,-4,2.5,0,Math.PI*2),e.fill(),e.beginPath(),e.arc(7,-4,2.5,0,Math.PI*2),e.fill();const b=(R,S,P)=>{e.save(),e.translate(R,S),P&&e.scale(-1,1),e.rotate(-.2+Math.sin(s*2)*.05),e.strokeStyle=f,e.lineWidth=5,e.beginPath(),e.moveTo(0,0),e.lineTo(-8,-6),e.stroke(),e.translate(-10,-9),e.rotate(-.4),e.fillStyle=h,e.beginPath(),e.moveTo(0,0),e.bezierCurveTo(5,5,15,0,10,-10),e.bezierCurveTo(5,-5,0,0,0,0),e.fill(),e.beginPath(),e.moveTo(2,-2),e.bezierCurveTo(8,-8,12,-15,4,-18),e.bezierCurveTo(2,-10,-2,-6,2,-2),e.fill(),e.restore()};b(-18,-2,!1),b(18,-2,!0);const v=(R,S)=>{const P=Math.sin(s*3)*1;e.strokeStyle=f,e.lineWidth=3,e.beginPath(),e.moveTo(R,S+5+P),e.lineTo(R,S+P),e.stroke(),e.fillStyle=g,e.beginPath(),e.arc(R,S+P,5,0,Math.PI*2),e.fill(),e.strokeStyle=d,e.lineWidth=1,e.stroke(),e.fillStyle=m,e.beginPath(),e.arc(R,S+P,2.5,0,Math.PI*2),e.fill(),e.fillStyle="#fff",e.beginPath(),e.arc(R+1.5,S-1.5+P,1,0,Math.PI*2),e.fill()};v(-6,-16),v(6,-16),e.save(),e.translate(28,-28),e.rotate(.1+Math.sin(s*2)*.05),e.fillStyle="#5d4037",e.fillRect(-2,0,4,45),e.fillStyle="#5d4037",e.fillRect(-25,-20,50,25),e.lineWidth=2,e.strokeStyle="#3e2723",e.strokeRect(-25,-20,50,25),e.fillStyle="#ffffff",e.font='6px "PressStart2PLocal"',e.textAlign="center";let y="HIGH",T=n;if(r.isDailyChallenge){y="DAILY";const R=new Date,S=R.getUTCFullYear(),P=String(R.getUTCMonth()+1).padStart(2,"0"),w=String(R.getUTCDate()).padStart(2,"0"),E=`${S}-${P}-${w}`;T=parseInt(Y.getItem(`baseball_daily_score_${E}`,"0"))||0}e.fillText(y,0,-12),e.fillStyle=r.isDailyChallenge?"#f1c40f":"#b71c1c",e.fillText(`${T}`,0,-3),e.restore(),e.restore()}function rl(e,t,i){const a=r.isGameOver,o=a,n=Ra(),s=i*.38,l=i*.65;mn(e,t,i,o,s),Mo(e,t,i,s,l),e.save();const c=l,f=i-c,d=o?"#3e2723":"#d7ccc8",u=o?"#21130d":"#8d6e63",h=e.createLinearGradient(0,c,0,i);h.addColorStop(0,d),h.addColorStop(1,o?"#1b100c":"#a1887f"),e.fillStyle=h,e.fillRect(0,c,t,f),e.strokeStyle=u,e.lineWidth=2,e.beginPath();const g=t/2;for(let w=-8;w<=8;w++){const E=g+w*(t/12),M=g+w*(t/3);e.moveTo(E,c),e.lineTo(M,i)}for(let w=c;w<i;w+=25)if(w%50===0){e.fillStyle=o?"#111":"#5d4037";for(let E=0;E<t;E+=40){const M=w%100/2;e.fillRect(E+M,w,4,4)}}e.stroke();const m=30,p=20,b=c-45;e.fillStyle="rgba(0,0,0,0.3)",e.fillRect(0,c,t,15),e.fillStyle=u,e.fillRect(0,b,t,m),e.fillStyle=o?"#5d4037":"#bcaaa4",e.fillRect(0,b,t,5),e.fillStyle=u;for(let w=0;w<=t;w+=t/6)e.fillRect(w-p/2,b,p,c-b),e.fillStyle=o?"#5d4037":"#bcaaa4",e.fillRect(w-p/2+2,b+m,3,c-b-m),e.fillStyle=u;const v=typeof U<"u"?U.highScore:0,y=t*.15,R=Math.sin(n*.5)*y,S=t*.5+R;Qr(e,S,i*.7,3.5,o,v,n),e.restore(),e.restore();const P=Math.min(t,i)*.08;if(e.textAlign="center",a){e.save(),e.fillStyle="#ff0000",e.shadowColor="#000",e.shadowBlur=4,e.font=`${P}px "PressStart2PLocal"`;let w="GAME OVER";r.consecutiveFouls>=4&&(w="BAT BROKEN!"),e.fillText(w,t/2,i*.3),e.fillStyle=r.isDailyChallenge?"#FFD700":"#ffffff",e.font=`${P*.6}px "PressStart2PLocal"`;const E=typeof U<"u"?U.score:r.score;e.fillText(`SCORE: ${E}`,t/2,i*.5);const M=Ra();(r.settings?.noFlash||Math.floor(M*2)%2===0)&&(e.fillStyle="#ffff00",e.shadowColor="#000",e.shadowBlur=2,t<=600||i<=600?(e.font=`${P*.6}px "PressStart2PLocal"`,e.fillText("TAP TO",t/2,i*.82),e.fillText("RETRY",t/2,i*.82+P*.7)):(e.font=`${P*.6}px "PressStart2PLocal"`,e.fillText("TAP TO RETRY",t/2,i*.87))),e.restore()}else{e.save();const w=Ra(),E=Math.sin(w*3.33);e.globalAlpha=.8+E*.2,e.fillStyle="#ffffff",e.shadowColor="#00e5ff",e.shadowBlur=10,e.shadowOffsetX=0,e.shadowOffsetY=0;const M=t<=600||i<=600;e.textAlign="center",M?(e.font=`${P*.6}px "PressStart2PLocal"`,e.fillText("TAP TO",t/2,i*.82),e.fillText("START",t/2,i*.82+P*.7)):(e.font=`${P*.6}px "PressStart2PLocal"`,e.fillText("TAP TO START",t/2,i*.87)),e.restore()}e.canvas.style.cursor="pointer"}function xr(e,t){const i=document.createElement("canvas");i.width=e||600,i.height=t||800;const a=i.getContext("2d"),o=X.currentTheme;if(o&&o.id==="BEACH"){o._beachCache||(o._beachCache={h:0,isNight:null,waveGradients:[]});const l=t||800,c=l*.1,f=l-c;o._beachCache.h=l,o._beachCache.isNight=!1,o._beachCache.waveGradients=[];for(let d=0;d<2;d++){const u=(d+1)/3,h=c+f*.1+f*.8*u,g=3+d*3,m=a.createLinearGradient(0,h-g,0,h+g*8),p=.08+d*.12;m.addColorStop(0,`rgba(255, 255, 255, ${p*.5})`),m.addColorStop(.3,`rgba(0, 188, 212, ${p})`),m.addColorStop(1,"rgba(0, 77, 64, 0)"),o._beachCache.waveGradients[d]=m}}try{mn(a,i.width,i.height,!1),Mo(a,i.width,i.height),rl(a,i.width,i.height)}catch{}const n=a.createLinearGradient(0,0,0,-120);n.addColorStop(0,"rgba(255, 215, 0, 0.6)"),n.addColorStop(1,"rgba(255, 215, 0, 0)"),a.fillStyle=n,a.fillRect(0,0,10,10);const s=a.createRadialGradient(50,50,10,50,50,100);s.addColorStop(0,"rgba(255, 255, 210, 0.8)"),s.addColorStop(.4,"rgba(255, 215, 0, 0.6)"),s.addColorStop(1,"rgba(255, 165, 0, 0)"),a.fillStyle=s,a.fillRect(0,0,100,100),console.log("[Beach] Effects Warmed Up (Full Pipeline)")}function e0(e,t,i,a){const o=a?"#3d1f0b":"#8B4513",n=a?"#000000":"#555555",s=a?"#002200":"#32CD32",l=a?"#001100":"#006400",c=a?"#001100":"#228B22",f=a?"#002200":"#006400";e.fillStyle=n;const d=i*.5;e.fillRect(t*.05,d,t*.9,150),e.fillStyle=a?"#111":"#444",e.beginPath(),e.moveTo(t*.05,d),e.bezierCurveTo(t*.05,d-60,t*.95,d-60,t*.95,d),e.fill(),cl(e,t,i,a);const u=(y,T)=>{e.fillStyle="#333",e.fillRect(y,T,20,60),e.fillStyle="#222",e.fillRect(y-10,T-20,40,20),e.fillStyle=a?"#ffffe0":"#ddd",a&&(e.shadowColor="#ffffe0",e.shadowBlur=20);for(let R=0;R<3;R++)for(let S=0;S<4;S++)e.fillRect(y-8+S*10,T-18+R*6,6,4);e.shadowBlur=0};u(t*.15,d-60),u(t*.8,d-60),e.fillStyle=f,e.beginPath(),e.moveTo(0,i*.6),e.bezierCurveTo(t*.2,i*.5,t*.4,i*.65,t*.6,i*.6),e.bezierCurveTo(t*.8,i*.55,t,i*.65,t,i*.65),e.lineTo(t,i),e.lineTo(0,i),e.fill(),e.fillStyle=c,e.beginPath(),e.moveTo(0,i*.65),e.bezierCurveTo(t*.25,i*.7,t*.5,i*.6,t*.75,i*.65),e.bezierCurveTo(t*.9,i*.68,t,i*.62,t,i*.62),e.lineTo(t,i),e.lineTo(0,i),e.fill();const h=e.createLinearGradient(0,i*.6,0,i);h.addColorStop(0,s),h.addColorStop(1,l),e.fillStyle=h,e.fillRect(0,i*.65,t,i*.35);const g=new ze("classic_static_world_noise");e.fillStyle="rgba(0,0,0,0.05)";for(let y=0;y<3e3;y++){const T=g.random()*t,R=i*.6+g.random()*i*.4;e.fillRect(T,R,1,2)}if(!a){e.fillStyle="#228B22";for(let y=0;y<50;y++){const T=g.random()*t,R=i*.65+g.random()*i*.35;(T<t*.35||T>t*.65)&&(e.fillRect(T,R,2,4),e.fillRect(T-2,R+2,2,2),e.fillRect(T+2,R+2,2,2))}}e.fillStyle=o,e.beginPath(),e.moveTo(t*.45,i*.6),e.lineTo(t*.55,i*.6),e.lineTo(t*.85,i),e.lineTo(t*.15,i),e.fill(),e.fillStyle=a?"rgba(0,0,0,0.3)":"rgba(60,40,20,0.15)";for(let y=0;y<800;y++){const T=t*.15+g.random()*t*.7,R=i*.6+g.random()*i*.4,S=(R-i*.6)/(i*.4),P=t*.05+S*(t*.35),w=t*.5;T>=w-P&&T<=w+P&&e.fillRect(T,R,2,2)}const m=(y,T,R,S,P)=>{const w=a?"#2a1a10":"#5C4033",E=a?"#3d2b1f":"#8B4513";e.strokeStyle=E,e.lineWidth=3*P,e.beginPath(),e.moveTo(y,T-8*P),e.lineTo(R,S-8*P),e.moveTo(y,T+2*P),e.lineTo(R,S+2*P),e.stroke(),e.fillStyle=w;const M=Math.sqrt(Math.pow(R-y,2)+Math.pow(S-T,2)),D=Math.floor(M/(25*P));for(let I=0;I<=D;I++){const H=I/D,k=y+(R-y)*H,O=T+(S-T)*H;e.fillRect(k-2*P,O-15*P,4*P,20*P)}};if(m(t*.45,i*.6,t*.15,i,1.5),m(t*.55,i*.6,t*.85,i,1.5),!window._classicTreeCache||window._classicTreeCacheIsNight!==a){const y=[],P=a?["#003300","#004400","#002200","#002600","#001a00"]:["#228B22","#006400","#2E8B57","#32CD32","#008000","#6B8E23"],w=a?"#2d1a08":"#8B4513";P.forEach(E=>{const M=document.createElement("canvas");M.width=160,M.height=320;const D=M.getContext("2d");D.scale(4,4);const I=6,H=12,k=(40-I)/2,O=80-H;D.fillStyle=w,D.fillRect(k,O,I,H),D.fillStyle=E;const W=(Z,N)=>{const V=O+Z,j=14*N,ge=V-18,se=V;D.beginPath(),D.moveTo(20,ge),D.lineTo(20+j,se),D.lineTo(20-j,se),D.closePath(),D.fill(),D.fillStyle="rgba(0,0,0,0.1)",D.beginPath(),D.moveTo(20,ge),D.lineTo(20+j,se),D.lineTo(20,se),D.fill(),D.fillStyle=E};W(0,1.2),W(-10,1),W(-20,.8),y.push(M)}),window._classicTreeCache=y,window._classicTreeCacheIsNight=a}const p=window._classicTreeCache,b=(y,T,R,S)=>{const P=p[S%p.length],w=40*R,E=80*R,M=17*R,D=68*R;e.drawImage(P,y-M,T-D,w,E)},v=[{x:t*.1,y:i*.7,scale:4},{x:t*.05,y:i*.75,scale:5},{x:t*.25,y:i*.65,scale:2.5},{x:t*.15,y:i*.62,scale:2},{x:t*.02,y:i*.68,scale:3},{x:t*.85,y:i*.75,scale:4.5},{x:t*.95,y:i*.7,scale:5},{x:t*.75,y:i*.63,scale:2},{x:t*.8,y:i*.61,scale:1.8},{x:t*.9,y:i*.66,scale:3.5}];v.sort((y,T)=>y.y-T.y),v.forEach((y,T)=>b(y.x,y.y,y.scale,T)),e.fillStyle=a?"#1a1a1a":"#555555",e.beginPath(),e.arc(t*.3,i*.8,5,0,Math.PI*2),e.fill(),e.beginPath(),e.arc(t*.75,i*.85,7,0,Math.PI*2),e.fill(),e.beginPath(),e.arc(t*.2,i*.9,4,0,Math.PI*2),e.fill()}function cl(e,t,i,a){const o=i*.5,n=t*.35,s=o-100,l=t*.3,c=50;e.fillStyle="#222",e.fillRect(n-10,s-10,l+20,c+20),e.fillStyle="#333",e.fillRect(n-40,s,30,c),e.fillRect(n+l+10,s,30,c),a||(e.fillStyle="#c0392b",e.fillRect(n-35,s+5,20,15),e.fillStyle="#2980b9",e.fillRect(n-35,s+25,20,15),e.fillStyle="#f1c40f",e.fillRect(n+l+15,s+5,20,15),e.fillStyle="#27ae60",e.fillRect(n+l+15,s+25,20,15)),e.fillStyle="#000",e.fillRect(n,s,l,c),e.fillStyle="#111",e.fillRect(n,s-30,l,20);for(let O=0;O<5;O++){const W=n+l/4*O;e.fillStyle=a?"#ffffcc":"#555",a&&(e.shadowColor="#ffffcc",e.shadowBlur=10),e.beginPath(),e.arc(W,s-35,4,0,Math.PI*2),e.fill(),e.shadowBlur=0}const f=20,d=5,u=4,h=l-u*2,g=c-u*2,m=Math.floor(h/f),p=Math.floor(g/d),b=Math.min(m,p)-1,v=b+1,y=f*v,T=d*v,R=(l-y)/2,S=(c-T)/2;e.fillStyle="#222";for(let O=0;O<d;O++)for(let W=0;W<f;W++)e.fillRect(n+R+W*v,s+S+O*v,b,b);const P={0:[[1,1,1],[1,0,1],[1,0,1],[1,0,1],[1,1,1]],1:[[0,1,0],[1,1,0],[0,1,0],[0,1,0],[1,1,1]],2:[[1,1,1],[0,0,1],[1,1,1],[1,0,0],[1,1,1]],3:[[1,1,1],[0,0,1],[1,1,1],[0,0,1],[1,1,1]],4:[[1,0,1],[1,0,1],[1,1,1],[0,0,1],[0,0,1]],5:[[1,1,1],[1,0,0],[1,1,1],[0,0,1],[1,1,1]],6:[[1,1,1],[1,0,0],[1,1,1],[1,0,1],[1,1,1]],7:[[1,1,1],[0,0,1],[0,0,1],[0,0,1],[0,0,1]],8:[[1,1,1],[1,0,1],[1,1,1],[1,0,1],[1,1,1]],9:[[1,1,1],[1,0,1],[1,1,1],[0,0,1],[1,1,1]]};e.fillStyle=r.isDailyChallenge?"#f1c40f":"#e74c3c",a&&(e.shadowColor=r.isDailyChallenge?"#f1c40f":"#e74c3c",e.shadowBlur=15);let w=r.highScore||0;if(r.isDailyChallenge){const O=new Date,W=O.getUTCFullYear(),Z=String(O.getUTCMonth()+1).padStart(2,"0"),N=String(O.getUTCDate()).padStart(2,"0"),$=`${W}-${Z}-${N}`;w=parseInt(Y.getItem(`baseball_daily_score_${$}`,"0"))||0}const E=w.toString(),M=3,D=1,I=E.length*M+(E.length-1)*D;let H=Math.floor((f-I)/2);for(let O=0;O<E.length;O++){const W=parseInt(E[O]);if(isNaN(W))continue;const Z=P[W];for(let N=0;N<5;N++)for(let $=0;$<3;$++)if(Z[N][$]){const V=H+O*(M+D)+$,j=N;e.fillRect(n+R+V*v,s+S+j*v,b,b)}}e.shadowBlur=0,e.fillStyle="#f1c40f",e.font='16px "PressStart2PLocal"',e.textAlign="center",e.textBaseline="middle";const k=r.isDailyChallenge?"DAILY":"HIGH SCORE";e.fillText(k,n+l/2,s-20)}function t0(){const i=document.createElement("canvas");i.width=400,i.height=400;const a=i.getContext("2d"),o=10,n=10,s=Vs,l=$s;for(let u=0;u<400;u+=n){const h=u/n%2===0?0:o/2;for(let g=0;g<400;g+=o){const m=g+h+(Math.random()*2-1),p=u+(Math.random()*2-1);if(Math.random()>.9)continue;const b=s[Math.floor(Math.random()*s.length)],v=l[Math.floor(Math.random()*l.length)];a.fillStyle=v,a.fillRect(m+1,p+4,o-2,6),a.fillStyle=b,a.fillRect(m+2,p,o-4,4)}}qt.width=4e3,qt.height=100,ma||(ma=document.createElement("canvas")),ma.width=4e3,ma.height=100;const c=Ml;ma.getContext("2d");const f=c.createPattern(i,"repeat");c.fillStyle=f,c.fillRect(0,0,qt.width,100);const d=document.createElement("canvas");d.width=400,d.height=400,d.getContext("2d")}let ma=null;const Ei=document.createElement("canvas");let go=!1;const tt={currentBannerMessage:null};function i0(){tt.currentBannerMessage=null,go=!1}const Ls=["Perfect Hit streaks earn bonus Coins!","4 Fouls in a row breaks your bat!","Daily Challenges reset at Midnight UTC.","Wait for the ball to reach the plate.","Unlock new bats in the Shop!","The Ace mixes up every pitch type.","High Scores unlock new Stadiums.","Foul balls save you from strikes.","Timing is everything!","Practice makes perfect!","Gold Bats sparkle on Perfect Hits!","I can see my house from here!","This plane runs on AA batteries.","Where is the pilot?","Do a barrel roll!","404: Cloud Not Found","If you read this, look down.","Physics are just suggestions.","Beware of low-flying birds.","Don't look down!","Why is the ball getting larger?","Have you tried turning it off and on?","Nice throw!","I saw a UFO earlier!","Bring back the hot dogs!","Swinging is mandatory.","Keep your eye on the... bird?","My other plane is a convertible.","Don't feed the clouds."];function a0(){return Ls[Math.floor(Math.random()*Ls.length)]}let $t=null,xa=null,Os=null;function yn(e){let t=e?"night":"day";r.bossModeActive&&!r.isGameOver&&(t="boss");const i=r.settings&&r.settings.theme?r.settings.theme:"classic";if((i==="space"||i==="moon")&&(t="space"),$t||($t=document.createElement("canvas"),xa=$t.getContext("2d")),$t.width===K&&$t.height===de&&Os===t)return $t;$t.width=K,$t.height=de,Os=t;const n=xa.createLinearGradient(0,0,0,de);return t==="boss"?(n.addColorStop(0,"#1a0a2e"),n.addColorStop(.4,"#000000"),n.addColorStop(1,"#2c0000")):t==="space"?(n.addColorStop(0,"#000000"),n.addColorStop(1,"#0a0a1a")):t==="night"?(n.addColorStop(0,"#000033"),n.addColorStop(1,"#191970")):(n.addColorStop(0,"#4facfe"),n.addColorStop(1,"#00f2fe")),xa.fillStyle=n,xa.fillRect(0,0,K,de),$t}function It(e,t=!0){ia.width=K,ia.height=de,r.lastStaticRenderMode=e;const i=Ns,a=K,o=de;if(t||i.clearRect(0,0,a,o),X.currentTheme.id==="SPACE"){i.clearRect(0,0,a,o),tl(i,a,o,e),At.width=a,At.height=o;const n=150+Fe+32;nl(an,a,o,a/2,r.bat.pivotY,n,e),il(an,a,o,n);return}if(X.currentTheme.id==="BEACH"){mn(i,a,o,e);return}if(X.currentTheme.id==="HAUNTED"){qs(i,a,o,e);return}if(t){const n=yn(e);i.drawImage(n,0,0)}e0(i,a,o,e)}function o0(){!X.currentTheme||X.currentTheme.id!=="CLASSIC"||cl(Ns,K,de,r.lastStaticRenderMode)}function n0(e){const t=document.getElementById("start-screen");if(X.currentTheme.id==="BEACH"){r.isGameOver?t&&t.style.display!=="none"&&(t.style.display="none"):t&&t.style.display==="none"&&!r.gameActive&&(t.style.display=""),rl(C,K,de);return}if(X.currentTheme.id==="HAUNTED"){r.isGameOver?t&&t.style.display!=="none"&&(t.style.display="none"):t&&t.style.display==="none"&&!r.gameActive&&(t.style.display=""),Js(C,K,de);return}if(X.currentTheme.id==="SPACE"){r.isGameOver?t&&t.style.display!=="none"&&(t.style.display="none"):t&&t.style.display==="none"&&!r.gameActive&&(t.style.display=""),Yr(C,K,de);return}else!r.gameActive&&t&&t.style.display==="none"&&(t.style.display="");const i=yn(r.isGameOver);C.drawImage(i,0,0);const a=Date.now()/1e3;if(r.isGameOver){C.fillStyle="#FFFFFF";for(let W=0;W<50;W++){const Z=(Math.sin(W*123.45)*.5+.5)*K,N=(Math.cos(W*67.89)*.5+.5)*de*.6;Math.random()>.95&&(C.globalAlpha=.5+Math.sin(a*5+W)*.5),C.fillRect(Z,N,2,2),C.globalAlpha=1}const D=K-80,I=60,H=4,k=(W,Z,N,$)=>{C.fillStyle="#DDDDDD",C.fillRect(D+W*H,I+Z*H,N*H,$*H)},O=(W,Z,N="#AAAAAA")=>{C.fillStyle=N,C.fillRect(D+W*H,I+Z*H,H,H)};k(4,0,6,1),k(2,1,10,1),k(1,2,12,2),k(0,4,14,6),k(1,10,12,2),k(2,12,10,1),k(4,13,6,1),O(3,4),O(4,4),O(3,5),O(4,5),O(9,8),O(10,8),O(9,9),O(10,9),O(7,2),O(8,2)}else{C.fillStyle="#FFD700",C.fillRect(K-60,20,30,30),C.fillStyle="#FFA500",C.fillRect(K-65,25,5,20),C.fillRect(K-25,25,5,20),C.fillRect(K-55,15,20,5),C.fillRect(K-55,50,20,5),C.strokeStyle="#000",C.lineWidth=2;const D=50+Math.sin(a)*10,H=a/20%1*(K+50)-20;C.beginPath(),C.moveTo(H,D),C.lineTo(H+5,D+3),C.lineTo(H+10,D),C.stroke(),C.beginPath(),C.moveTo(H-15,D+5),C.lineTo(H-10,D+8),C.lineTo(H-5,D+5),C.stroke()}const o=r.isGameOver?"rgba(50, 50, 100, 0.5)":"rgba(255, 255, 255, 0.8)";C.fillStyle=o;const s=a/50%1*(K+100)-50;C.fillRect(s,40,60,20),C.fillRect(s+10,30,40,10);const c=(a/65+.3)%1*(K+100)-50;C.fillRect(c,80,50,15),C.fillRect(c+10,70,30,10);const f=180,d=a/35%1,u=K+500,h=K+100-d*u,g=(D,I)=>{let k=r.isGameOver?"#CCCCCC":"#FFFFFF",O=r.isGameOver?"#1a3d6a":"#2a4d7a",W=r.isGameOver?"#AAAAAA":"#F0F0F0",Z=O;const N=($,V,j,ge,se)=>{C.fillStyle=se,C.fillRect(D+$*4,I+V*4,j*4,ge*4)};N(18,0,2,1,k),N(19,1,2,4,Z),N(18,1,1,4,k),N(17,4,1,1,k),N(4,4,16,2,k),N(3,5,1,1,k),N(1,6,2,1,k),N(1,6,19,3,O),N(3,9,10,1,O),N(2,4,2,1,"#87CEEB"),N(8,7,5,1,W),N(9,8,4,1,W),N(10,9,3,1,W),N(11,10,2,1,W),N(5,10,1,1,"#000"),N(5,9,1,1,"#555"),N(11,11,1,1,"#000")},m=4,p=h+21*m,b=f+3*m,v=20;if(tt.currentBannerMessage||(tt.currentBannerMessage=a0(),go=!1),!go){const D=` ${tt.currentBannerMessage} `,I=Ei.getContext("2d");I.font='10px "PressStart2PLocal"';const k=I.measureText(D).width+24,O=24;Ei.width!==k&&(Ei.width=k,Ei.height=O),I.clearRect(0,0,k,O),I.fillStyle="#FFF",I.fillRect(0,0,k,O),I.fillStyle="#008000",I.fillRect(0,0,4,O),I.fillStyle="#2a4d7a",I.fillRect(4,0,k-4,4),I.fillRect(4,O-4,k-4,4),I.fillStyle="#2a4d7a",I.textBaseline="middle",I.font='10px "PressStart2PLocal"',I.fillText(D,14,O/2+2),go=!0}const y=Ei.width,T=Ei.height,R=p+v,S=f-2,P=Math.sin(a*2)*3;C.strokeStyle="#1a3d6a",C.lineWidth=2,C.beginPath(),C.moveTo(p,b),C.lineTo(R,S+P),C.stroke(),C.beginPath(),C.moveTo(p,b),C.lineTo(R,S+T+P),C.stroke();for(let D=0;D<y;D+=2){const I=Math.sin(a*2+D*.15)*3,H=Math.min(2,y-D);C.drawImage(Ei,D,0,H,T,R+D,S+I,H,T)}g(h,f),e&&r.showFireworks&&e.draw(),tt.cachedFgCanvas||(tt.cachedFgCanvas=document.createElement("canvas"),tt.cachedFgCtx=tt.cachedFgCanvas.getContext("2d"),tt.lastFgMode=null);const w=r.isGameOver?"night":"day",E=tt.cachedFgCanvas.width===K&&tt.cachedFgCanvas.height===de,M=tt.lastFgMode===w;(!E||!M)&&(tt.cachedFgCanvas.width=K,tt.cachedFgCanvas.height=de,tt.lastFgMode=w,It(r.isGameOver,!1),tt.cachedFgCtx.clearRect(0,0,K,de),tt.cachedFgCtx.drawImage(ia,0,0)),C.drawImage(tt.cachedFgCanvas,0,0)}function Hi(e=null,t=null,i=null,a=null){const o=t||K,n=i||de,l=(a?yi[a]:X.currentTheme)||X.currentTheme,c=o/2,d=r.bat&&r.bat.pivotY?r.bat.pivotY:n*.85;let u;l.id==="SPACE"?u=150+Fe+32:u=r.pitcher&&typeof r.pitcher.y<"u"?r.pitcher.y+(r.pitcher.height||32)/2:n*.25;const h=e||(l.id==="SPACE"?an:Rl);if(e||(l.id==="SPACE"?(At.width!==o||At.height!==n)&&(At.width=o,At.height=n):(ki.width!==o||ki.height!==n)&&(ki.width=o,ki.height=n)),h.save(),l.id==="SPACE"){h.clearRect(0,0,o,n),nl(h,o,n,c,d,u),h.restore(),h.restore();return}if(l.id==="HAUNTED"){h.clearRect(0,0,o,n),or(h,o,n);return}l.id!=="BEACH"&&l.id!=="HAUNTED"&&h.clearRect(0,0,o,n);const g=d,m=o*1.4,p=Math.max(16,d-40);if(l.id==="BEACH"||(h.beginPath(),h.ellipse(c,g,Math.max(1,m),Math.max(1,p),0,0,Math.PI*2),h.rect(0,d,o,n-d),h.fillStyle=l.warningTrackColor,h.fill(),h.beginPath(),h.ellipse(c,g,Math.max(1,m-15),Math.max(1,p-15),0,0,Math.PI*2),h.fillStyle=l.grassColor,h.fill(),h.clip()),l.drawGrassPattern(h,o,n),h.restore(),h.save(),l.id==="BEACH"&&l.getShorelineY){const y=l.getShorelineY(n);h.beginPath(),h.rect(0,y,o,n-y),h.clip()}l.id!=="BEACH"&&(h.beginPath(),h.ellipse(c,g,Math.max(1,m-15),Math.max(1,p-15),0,0,Math.PI*2),h.clip()),h.fillStyle=l.dirtColor;const b=25;h.beginPath(),h.moveTo(c,d),h.lineTo(o,d-(o-c)*1.5),h.lineTo(o,d-(o-c)*1.5+b),h.lineTo(c+b,d+b),h.fill(),h.beginPath(),h.moveTo(c,d),h.lineTo(0,d-c*1.5),h.lineTo(0,d-c*1.5+b),h.lineTo(c-b,d+b),h.fill(),h.strokeStyle=l.lineColor,h.lineWidth=4,l.id==="BEACH"?jr(h,o,n,c,d):(h.beginPath(),h.moveTo(c,d),h.lineTo(o,d-(o-c)*1.5),h.moveTo(c,d),h.lineTo(0,d-c*1.5),h.stroke()),h.fillStyle=l.dirtColor,h.beginPath(),h.arc(c,d,70,0,Math.PI*2),h.fill();const v=r.pitcher&&typeof r.pitcher.y<"u"?r.pitcher.y+(r.pitcher.height||64)/2+10:n*.25+42;if(h.beginPath(),h.arc(c,v,45,0,Math.PI*2),h.fillStyle=l.moundColor,h.fill(),h.beginPath(),h.arc(c,v,35,0,Math.PI*2),h.fillStyle=l.dirtColor,h.fill(),l.id==="BEACH"&&(h.fillStyle="rgba(0,0,0,0.08)",h.beginPath(),h.arc(c,d,78,0,Math.PI*2),h.fill(),h.beginPath(),h.arc(c,v,52,0,Math.PI*2),h.fill()),h.strokeStyle="#ffffff",h.lineWidth=3,h.strokeRect(c-70,d-30,30,60),h.strokeRect(c+40,d-30,30,60),h.fillStyle="#ffffff",h.beginPath(),h.moveTo(c,d+10),h.lineTo(c+10,d),h.lineTo(c+10,d-10),h.lineTo(c-10,d-10),h.lineTo(c-10,d),h.fill(),h.restore(),l.id!=="BEACH"){const y=s0(h);h.save(),h.globalCompositeOperation="overlay",h.globalAlpha=.15,h.fillStyle=y,h.fillRect(0,0,o,n),h.restore()}l.id==="BEACH"&&Jr(h,o,n)}let eo=null;function s0(e){if(eo)return eo;const t=256,i=document.createElement("canvas");i.width=t,i.height=t;const a=i.getContext("2d"),o=a.createImageData(t,t),n=o.data;for(let s=0;s<n.length;s+=4){const l=Math.random()*255;n[s]=l,n[s+1]=l,n[s+2]=l,n[s+3]=255}return a.putImageData(o,0,0),eo=e.createPattern(i,"repeat"),eo}const Zo={};function l0(e){if(Zo[e])return Zo[e];const t=400,i=document.createElement("canvas");i.width=t,i.height=t;const a=i.getContext("2d"),o=t/de;a.scale(o,o);const n=(de-K)/2;return a.translate(n,0),Hi(a,K,de,e),Zo[e]=i,i}let jo=null;function r0(){if(jo)return jo;const e=200,t=800,i=document.createElement("canvas");i.width=e,i.height=t;const a=i.getContext("2d"),o=a.createLinearGradient(0,0,0,t);o.addColorStop(0,"rgba(255, 255, 255, 0.8)"),o.addColorStop(1,"rgba(255, 255, 255, 0)"),a.save(),a.fillStyle=o,a.beginPath(),a.moveTo(e*.45,0),a.lineTo(e*.55,0),a.lineTo(e,t),a.lineTo(0,t),a.closePath(),a.fill();const n=a.createLinearGradient(0,0,0,t);return n.addColorStop(0,"rgba(200, 230, 255, 0.1)"),n.addColorStop(1,"rgba(200, 230, 255, 0)"),a.fillStyle=n,a.fillRect(0,0,e,t),a.restore(),jo=i,i}r0();function c0(e,t,i,a,o,n=!1,s=1,l=1,c=null){if(r.isDailyChallenge||o>=300)return;let f=o%50/50,d=!1;if(n&&(f=1,d=!0),d&&(f=s,d=s>.01),f<=.001)return;const u=-Math.PI/2,h=u+Math.PI*2*f,g=4,m=c||"#FFD700";e.save();const p=y=>{e.beginPath(),l!==1?e.ellipse(t,i,y,y*l,0,u,h):e.arc(t,i,y,u,h)};let b=0,v=!1;if(f>=.8){const y=Date.now();let T=600;f>=1?T=100:f>=.9&&(T=300),b=(Math.sin(y/T*Math.PI)+1)*.5,v=!0,b>.95&&Date.now()-(Bs||0)>T&&(r.settings?.vibration&&navigator.vibrate&&navigator.vibrate(5),Bs=Date.now())}if(e.lineCap="round",v){const y=a+b*2;if(e.lineWidth=g+b*4,c)p(y),e.strokeStyle=m,e.stroke(),b>.1&&(p(y),e.strokeStyle=`rgba(255, 255, 255, ${b})`,e.stroke());else if(p(y),e.strokeStyle=m,e.stroke(),b>.1){p(y);const T=.6+b*.4;e.strokeStyle=`rgba(255, 255, 255, ${T})`,e.lineWidth=g*.8,e.stroke()}}else p(a),e.strokeStyle=m,e.lineWidth=g,e.stroke();e.restore()}let Bs=0;const Sn=[{id:"ROOKIE",name:"The Rookie",leagueId:0,minScoreInSeason:0,maxScoreInSeason:49,visuals:{gender:"MALE",skinColor:"#ffccaa",hatColor:"#e74c3c",walkSpeed:.18},pools:[{max:9,probs:{fastball:.5,curveball:.5}},{max:19,probs:{super_fastball:.4,fastball:.3,curveball:.3}},{max:29,probs:{super_fastball:.5,changeup:.5}},{max:39,probs:{zigzag:.4,super_fastball:.15,changeup:.15,fastball:.15,curveball:.15}},{max:49,probs:{fastball:.2,curveball:.2,super_fastball:.2,changeup:.2,zigzag:.2}}],seasonTwoTrick:F.GHOSTBALL},{id:"TECHNICIAN",name:"The Technician",leagueId:1,minScoreInSeason:50,maxScoreInSeason:99,visuals:{gender:"FEMALE",skinColor:"#ffdbac",hatColor:null,shoeColor:"#FF69B4",scale:1,walkSpeed:.18},pools:[{max:59,probs:{[F.STOPBALL]:.4,[F.FASTBALL]:.12,[F.CURVEBALL]:.12,[F.SUPER_FASTBALL]:.12,[F.CHANGEUP]:.12,[F.ZIGZAG]:.12}},{max:69,probs:{[F.SPLITTER]:.4,[F.FASTBALL]:.1,[F.CURVEBALL]:.1,[F.SUPER_FASTBALL]:.1,[F.CHANGEUP]:.1,[F.ZIGZAG]:.1,[F.STOPBALL]:.1}},{max:79,probs:{[F.GHOSTBALL]:.4,[F.FASTBALL]:.0857,[F.CURVEBALL]:.0857,[F.SUPER_FASTBALL]:.0857,[F.CHANGEUP]:.0857,[F.ZIGZAG]:.0857,[F.STOPBALL]:.0857,[F.SPLITTER]:.0857}},{max:99,probs:{[F.FASTBALL]:.125,[F.CURVEBALL]:.125,[F.SUPER_FASTBALL]:.125,[F.CHANGEUP]:.125,[F.ZIGZAG]:.125,[F.STOPBALL]:.125,[F.SPLITTER]:.125,[F.GHOSTBALL]:.125}}],seasonTwoTrick:F.STOP_CURVE},{id:"ACE",name:"The Ace",leagueId:2,minScoreInSeason:100,maxScoreInSeason:149,visuals:{gender:"MALE",skinColor:"#8d5524",hatColor:"#000000",shoeColor:"#FFD700",sunglasses:!0,beard:!0,goldChain:!0,scale:1,walkSpeed:.18},pools:[{max:109,probs:{SUPER_CURVE:.4,fastball:.075,curveball:.075,changeup:.075,splitter:.075,zigzag:.075,stopball:.075,ghostball:.075,super_fastball:.075}},{max:119,probs:{zigzag_splitter:.4,fastball:.0667,curveball:.0667,changeup:.0667,splitter:.0667,zigzag:.0667,stopball:.0667,ghostball:.0667,super_fastball:.0667,SUPER_CURVE:.0667}},{max:129,probs:{curve_changeup:.4,fastball:.06,curveball:.06,changeup:.06,splitter:.06,zigzag:.06,stopball:.06,ghostball:.06,super_fastball:.06,SUPER_CURVE:.06,zigzag_splitter:.06}},{max:139,probs:{super_zigzag:.4,fastball:.0545,curveball:.0545,changeup:.0545,splitter:.0545,zigzag:.0545,stopball:.0545,ghostball:.0545,super_fastball:.0545,SUPER_CURVE:.0545,zigzag_splitter:.0545,curve_changeup:.0545}},{max:149,probs:{curve_splitter:.4,fastball:.05,curveball:.05,changeup:.05,splitter:.05,zigzag:.05,stopball:.05,ghostball:.05,super_fastball:.05,SUPER_CURVE:.05,zigzag_splitter:.05,curve_changeup:.05,super_zigzag:.05}}],seasonTwoTrick:F.SUPER_ZIGZAG},{id:"SCARY",name:"The Legend",leagueId:4,minScoreInSeason:300,maxScoreInSeason:1/0,bossMode:!0,visuals:{gender:"MALE",skinColor:"#000000",hatColor:"#ffffff",shoeColor:"#ff0000",scale:1.1,walkSpeed:.08},pools:[{max:309,probs:{ghost_stop:.4,fastball:.02307,curveball:.02307,changeup:.02307,super_fastball:.02307,zigzag:.02307,stopball:.02307,splitter:.02307,ghostball:.02307,SUPER_CURVE:.02307,zigzag_splitter:.02307,curve_changeup:.02307,super_zigzag:.02307,curve_splitter:.02307,super_splitter:.02307,GHOST_CURVE:.02307,stop_super:.02307,ghost_zigzag:.02307,stop_zigzag:.02307,stop_splitter:.02307,ghost_changeup:.02307,zigzag_changeup:.02307,STOP_CURVE:.02307,splitter_changeup:.02307,ghost_splitter:.02307,stop_changeup:.02307,ghost_super:.02307}},{max:1/0,probs:{fastball:.037,curveball:.037,changeup:.037,super_fastball:.037,zigzag:.037,stopball:.037,splitter:.037,ghostball:.037,SUPER_CURVE:.037,zigzag_splitter:.037,curve_changeup:.037,super_zigzag:.037,curve_splitter:.037,ghost_stop:.037,super_splitter:.037,GHOST_CURVE:.037,stop_super:.037,ghost_zigzag:.037,stop_zigzag:.037,stop_splitter:.037,ghost_changeup:.037,zigzag_changeup:.037,STOP_CURVE:.037,splitter_changeup:.037,ghost_splitter:.037,stop_changeup:.037,ghost_super:.037}}],seasonTwoTrick:F.STOP_SUPER},{id:"MONITOR",name:"The Monitor",leagueId:3,minScoreInSeason:150,maxScoreInSeason:199,visuals:{gender:"MALE",style:"TV_HEAD",skinColor:"#888888",hatColor:null,shoeColor:"#00ff00",scale:1,walkSpeed:.18},pools:[{max:159,probs:{stop_zigzag:.4,fastball:.0462,curveball:.0462,changeup:.0462,super_fastball:.0462,zigzag:.0462,stopball:.0462,splitter:.0462,ghostball:.0462,SUPER_CURVE:.0462,zigzag_splitter:.0462,curve_changeup:.0462,super_zigzag:.0462,curve_splitter:.0462}},{max:169,probs:{super_splitter:.4,stop_zigzag:.0429,fastball:.0429,curveball:.0429,changeup:.0429,super_fastball:.0429,zigzag:.0429,stopball:.0429,splitter:.0429,ghostball:.0429,SUPER_CURVE:.0429,zigzag_splitter:.0429,curve_changeup:.0429,super_zigzag:.0429,curve_splitter:.0429}},{max:179,probs:{GHOST_CURVE:.4,super_splitter:.04,stop_zigzag:.04,fastball:.04,curveball:.04,changeup:.04,super_fastball:.04,zigzag:.04,stopball:.04,splitter:.04,ghostball:.04,SUPER_CURVE:.04,zigzag_splitter:.04,curve_changeup:.04,super_zigzag:.04,curve_splitter:.04}},{max:189,probs:{stop_super:.4,GHOST_CURVE:.0375,super_splitter:.0375,stop_zigzag:.0375,fastball:.0375,curveball:.0375,changeup:.0375,super_fastball:.0375,zigzag:.0375,stopball:.0375,splitter:.0375,ghostball:.0375,SUPER_CURVE:.0375,zigzag_splitter:.0375,curve_changeup:.0375,super_zigzag:.0375,curve_splitter:.0375}},{max:199,probs:{ghost_zigzag:.4,stop_super:.0353,GHOST_CURVE:.0353,super_splitter:.0353,stop_zigzag:.0353,fastball:.0353,curveball:.0353,changeup:.0353,super_fastball:.0353,zigzag:.0353,stopball:.0353,splitter:.0353,ghostball:.0353,SUPER_CURVE:.0353,zigzag_splitter:.0353,curve_changeup:.0353,super_zigzag:.0353,curve_splitter:.0353}}],seasonTwoTrick:F.GHOST_SUPER},{id:"ROOKIE",name:"The Rookie (Elite)",leagueId:0,minScoreInSeason:200,maxScoreInSeason:249,visuals:{gender:"MALE",skinColor:"#ffccaa",hatColor:"#e74c3c",walkSpeed:.18},pools:[{max:209,probs:{stop_splitter:.4,ghost_zigzag:.0333,stop_super:.0333,GHOST_CURVE:.0333,super_splitter:.0333,stop_zigzag:.0333,fastball:.0333,curveball:.0333,changeup:.0333,super_fastball:.0333,zigzag:.0333,stopball:.0333,splitter:.0333,ghostball:.0333,SUPER_CURVE:.0333,zigzag_splitter:.0333,curve_changeup:.0333,super_zigzag:.0333,curve_splitter:.0333}},{max:219,probs:{ghost_changeup:.4,stop_splitter:.0316,ghost_zigzag:.0316,stop_super:.0316,GHOST_CURVE:.0316,super_splitter:.0316,stop_zigzag:.0316,fastball:.0316,curveball:.0316,changeup:.0316,super_fastball:.0316,zigzag:.0316,stopball:.0316,splitter:.0316,ghostball:.0316,SUPER_CURVE:.0316,zigzag_splitter:.0316,curve_changeup:.0316,super_zigzag:.0316,curve_splitter:.0316}},{max:229,probs:{zigzag_changeup:.4,ghost_changeup:.03,stop_splitter:.03,ghost_zigzag:.03,stop_super:.03,GHOST_CURVE:.03,super_splitter:.03,stop_zigzag:.03,fastball:.03,curveball:.03,changeup:.03,super_fastball:.03,zigzag:.03,stopball:.03,splitter:.03,ghostball:.03,SUPER_CURVE:.03,zigzag_splitter:.03,curve_changeup:.03,super_zigzag:.03,curve_splitter:.03}},{max:239,probs:{STOP_CURVE:.4,zigzag_changeup:.0286,ghost_changeup:.0286,stop_splitter:.0286,ghost_zigzag:.0286,stop_super:.0286,GHOST_CURVE:.0286,super_splitter:.0286,stop_zigzag:.0286,fastball:.0286,curveball:.0286,changeup:.0286,super_fastball:.0286,zigzag:.0286,stopball:.0286,splitter:.0286,ghostball:.0286,SUPER_CURVE:.0286,zigzag_splitter:.0286,curve_changeup:.0286,super_zigzag:.0286,curve_splitter:.0286}},{max:249,probs:{splitter_changeup:.4,STOP_CURVE:.0273,zigzag_changeup:.0273,ghost_changeup:.0273,stop_splitter:.0273,ghost_zigzag:.0273,stop_super:.0273,GHOST_CURVE:.0273,super_splitter:.0273,stop_zigzag:.0273,fastball:.0273,curveball:.0273,changeup:.0273,super_fastball:.0273,zigzag:.0273,stopball:.0273,splitter:.0273,ghostball:.0273,SUPER_CURVE:.0273,zigzag_splitter:.0273,curve_changeup:.0273,super_zigzag:.0273,curve_splitter:.0273}}]},{id:"TECHNICIAN",name:"The Technician (Elite)",leagueId:1,minScoreInSeason:250,maxScoreInSeason:299,visuals:{gender:"FEMALE",skinColor:"#ffdbac",hatColor:null,shoeColor:"#FF69B4",scale:1,walkSpeed:.18},pools:[{max:259,probs:{ghost_splitter:.4,splitter_changeup:.0261,STOP_CURVE:.0261,zigzag_changeup:.0261,ghost_changeup:.0261,stop_splitter:.0261,ghost_zigzag:.0261,stop_super:.0261,GHOST_CURVE:.0261,super_splitter:.0261,stop_zigzag:.0261,fastball:.0261,curveball:.0261,changeup:.0261,super_fastball:.0261,zigzag:.0261,stopball:.0261,splitter:.0261,ghostball:.0261,SUPER_CURVE:.0261,zigzag_splitter:.0261,curve_changeup:.0261,super_zigzag:.0261,curve_splitter:.0261}},{max:269,probs:{stop_changeup:.4,ghost_splitter:.025,splitter_changeup:.025,STOP_CURVE:.025,zigzag_changeup:.025,ghost_changeup:.025,stop_splitter:.025,ghost_zigzag:.025,stop_super:.025,GHOST_CURVE:.025,super_splitter:.025,stop_zigzag:.025,fastball:.025,curveball:.025,changeup:.025,super_fastball:.025,zigzag:.025,stopball:.025,splitter:.025,ghostball:.025,SUPER_CURVE:.025,zigzag_splitter:.025,curve_changeup:.025,super_zigzag:.025,curve_splitter:.025}},{max:279,probs:{ghost_super:.4,stop_changeup:.024,ghost_splitter:.024,splitter_changeup:.024,STOP_CURVE:.024,zigzag_changeup:.024,ghost_changeup:.024,stop_splitter:.024,ghost_zigzag:.024,stop_super:.024,GHOST_CURVE:.024,super_splitter:.024,stop_zigzag:.024,fastball:.024,curveball:.024,changeup:.024,super_fastball:.024,zigzag:.024,stopball:.024,splitter:.024,ghostball:.024,SUPER_CURVE:.024,zigzag_splitter:.024,curve_changeup:.024,super_zigzag:.024,curve_splitter:.024}},{max:299,probs:{fastball:.0385,curveball:.0385,changeup:.0385,super_fastball:.0385,zigzag:.0385,stopball:.0385,splitter:.0385,ghostball:.0385,SUPER_CURVE:.0385,zigzag_splitter:.0385,curve_changeup:.0385,super_zigzag:.0385,curve_splitter:.0385,super_splitter:.0385,GHOST_CURVE:.0385,stop_super:.0385,ghost_zigzag:.0385,stop_splitter:.0385,ghost_changeup:.0385,zigzag_changeup:.0385,STOP_CURVE:.0385,splitter_changeup:.0385,ghost_splitter:.0385,stop_changeup:.0385,ghost_super:.0385,stop_zigzag:.0385}}]}];function dl(e){if(e>=300)return{seasonIndex:0,scoreInSeason:e};const t=400,i=Math.floor(e/t),a=e%t;return{seasonIndex:i,scoreInSeason:a}}function dn(e){const{scoreInSeason:t}=dl(e);return Sn.find(i=>t>=i.minScoreInSeason&&t<=i.maxScoreInSeason)}function Gs(e,t,i=!1){const{seasonIndex:a,scoreInSeason:o}=dl(t);if(!e||!e.pools)return F.FASTBALL;const n=a>=1,s=i?Gi.random():Math.random();if(n&&s<.1&&e.seasonTwoTrick)return e.seasonTwoTrick;const c=e.pools.find(u=>o<=u.max)||e.pools[e.pools.length-1],f=i?Gi.random():Math.random();let d=0;for(const[u,h]of Object.entries(c.probs))if(d+=h,f<d)return u;return F.FASTBALL}let Fs,Hs=0,to=0;function d0(){const e=Date.now()/1e3;to===0&&(to=e);const t=e-to;return to=e,r.isPaused||(Hs+=t),Hs}function fl(){const e=K;if(window.innerWidth===0||window.innerHeight===0)return;const t=window.innerWidth/window.innerHeight,i=600/800;let a,o;t>i?(o=800,a=o*t):(a=600,o=a/t),_l(a,o),Ut.width=a,Ut.height=o,C.imageSmoothingEnabled=!1,Ut.style.width=`${window.innerWidth}px`,Ut.style.height=`${window.innerHeight}px`;const n=Fe;de>qn?Xn((de-qn)/2):Xn(0);const s=Fe-n,l=e/2,f=K/2-l;r.pitcher&&(r.pitcher.x=K/2-r.pitcher.width/2,r.pitcher.y=150+Fe),r.bat&&(r.bat.pivotX=K/2-40,r.bat.pivotY=Al+Fe),r.balls&&r.balls.forEach(m=>{m.x+=f,m.startY+=s,m.y+=s,m.startX+=f,m.prevX+=f,m.prevY+=s,m.trail&&(m.trail.length=0)}),It(r.lastStaticRenderMode||!1),Hi(null,a,o);const g=110*(window.innerHeight/o)+20;He&&He.style.setProperty("--title-bottom-offset",`${g}px`),clearTimeout(Fs),Fs=setTimeout(()=>{const m=X.currentTheme?X.currentTheme.id:"CLASSIC";X.currentTheme&&X.currentTheme.warmup&&X.currentTheme.warmup(K,de);let p=new Set(["CLASSIC"]);try{const y=localStorage.getItem("baseball_unlockables");if(y){const T=JSON.parse(y),R=JSON.parse(T.d||y);R.stadiums&&R.stadiums.filter(S=>S.unlocked).forEach(S=>{const P={stadium_haunted:"HAUNTED",stadium_beach:"BEACH",stadium_space:"SPACE"};P[S.id]&&p.add(P[S.id])})}}catch{p=new Set(["CLASSIC","HAUNTED","BEACH","SPACE"])}const b=["HAUNTED","BEACH","SPACE"].filter(y=>y===m?!1:p.has(y));let v=800;b.forEach(y=>{setTimeout(()=>{r.gameActive||yi[y]&&yi[y].warmup&&(console.log(`[Warmup] Background loading: ${y}`),yi[y].warmup(K,de))},v),v+=1e3})},200)}function f0(){if(X.currentTheme.id!=="SPACE"&&X.currentTheme.id!=="HAUNTED"&&X.currentTheme.id!=="CLASSIC"&&X.currentTheme.id!=="BEACH"){const e=yn(r.isGameOver);C.drawImage(e,0,0)}if(ia.width>0&&C.drawImage(ia,0,0),X.currentTheme.id==="CLASSIC"&&(C.fillStyle="#1a1a1a",C.fillRect(0,0,K,100),qt.width>0)){const e=(qt.width-K)/2,t=Math.max(0,e),i=e<0?-e:0,a=Math.floor(Math.min(K,qt.width)),o=100;if(r.staticCrowdCache||(typeof OffscreenCanvas<"u"?r.staticCrowdCache=new OffscreenCanvas(a,o):(r.staticCrowdCache=document.createElement("canvas"),r.staticCrowdCache.width=a,r.staticCrowdCache.height=o)),r.staticCrowdCache.width!==a||!r.crowdData||r.crowdDataWidth!==a){r.staticCrowdCache.width=a,r.staticCrowdCache.height=o;const n=r.staticCrowdCache.getContext("2d"),s=[],l=200,c=Vs,f=$s,d=g=>{const m=Math.sin(g)*1e4;return m-Math.floor(m)};for(let g=0;g<l;g++){const m=g*1337,p=d(m),b=d(m+1),v=Math.floor(d(m+4)*2e3),y=800+Math.floor(d(m+5)*700);s.push({localX:Math.floor(p*a),py:Math.floor(b*100),skin:c[Math.floor(d(m+2)*c.length)],shirt:f[Math.floor(d(m+3)*f.length)],shift:v,cycleDuration:y})}r.crowdData=s,r.crowdDataWidth=a;const u=r.crowdData,h=u.length;for(let g=0;g<h;g++){const m=u[g];n.fillStyle=m.shirt,n.fillRect(m.localX,m.py+4,8,6),n.fillStyle=m.skin,n.fillRect(m.localX+1,m.py,6,4)}}if(C.drawImage(qt,Math.floor(t),0,a,o,Math.floor(i),0,a,o),C.drawImage(r.staticCrowdCache,Math.floor(i),0),U.consecutivePerfectHits>=1&&r.perfectHitTimer>0&&r.crowdData){const n=d0()*1e3,s=-4;C.save();const l=r.crowdData,c=l.length;for(let f=0;f<c;f++){const d=l[f];if((n+d.shift)%d.cycleDuration<300){const h=i+d.localX,g=d.py,m=t+d.localX;C.drawImage(qt,m,g,8,10,h,g,8,10),C.fillStyle=d.shirt,C.fillRect(h,g+4+s,8,6),C.fillStyle=d.skin,C.fillRect(h+1,g+s,6,4),C.fillStyle=d.skin,C.fillRect(h-1,g+2+s,2,4),C.fillRect(h+7,g+2+s,2,4)}}C.restore()}}if(X.currentTheme.id==="HAUNTED"&&$l(C,K,de),X.currentTheme.id==="BEACH"&&Mo(C,K,de),X.currentTheme.id==="SPACE"&&At.width>0){const e=150+Fe+32;C.drawImage(At,0,0),$r(C,At.width,At.height,e)}if(ki.width>0&&X.currentTheme.id!=="SPACE"){if(C.save(),X.currentTheme.id,X.currentTheme.id==="BEACH"&&X.currentTheme.getShorelineY){const e=C.canvas.height,t=X.currentTheme.getShorelineY(e);C.beginPath(),C.rect(0,t,C.canvas.width,e-t),C.clip()}C.drawImage(ki,0,0),C.restore(),X.currentTheme.id==="BEACH"&&Zr(C,K,de)}if(X.currentTheme.id==="HAUNTED"&&Jl(C,K,de),r.bossModeActive){const e=r.pitcher.state;(e===Re.WALK_ON||e===Re.WALK_OFF)&&(C.fillStyle="rgba(0, 0, 0, 0.6)",C.fillRect(0,0,K,de))}if(X.currentTheme.id==="CLASSIC"||X.currentTheme.id==="BEACH"||X.currentTheme.id==="HAUNTED"||X.currentTheme.id==="SPACE"){const e=K/2;let t=150+Fe+26;X.currentTheme.id==="SPACE"&&(t=150+Fe+32);let i=!1,a=1;if(!r.isDailyChallenge&&r.pitcher){const l=dn(U.score);if(l){const c=l.id!==r.pitcher.id,f=r.pitcher.state===Re.WALK_OFF||r.pitcher.state===Re.WALK_ON;if(c||f)if(i=!0,r.pitcher.state===Re.WALK_OFF){const d=K/2,u=-100,h=r.pitcher.x,g=d-u,m=h-u;a=Math.max(0,Math.min(1,m/g))}else r.pitcher.state===Re.WALK_ON&&(a=0)}}let o=48,n=1,s=null;X.currentTheme.id==="HAUNTED"?(o=80,n=.4,s="#00FFFF"):X.currentTheme.id==="SPACE"&&(o=49),c0(C,e,t,o,U.score,i,a,n,s)}if(r.aceFlashStartTime){const e=performance.now()-r.aceFlashStartTime;if(e<1e3){const t=e/1e3,i=1-Math.pow(1-t,3),a=K/2,o=r.pitcher.y+(r.pitcher.height||64)/2,s=K*1.5*i,l=C.createRadialGradient(a,o,0,a,o,s);l.addColorStop(0,`rgba(255, 255, 255, ${.9*(1-t)})`),l.addColorStop(.2,`rgba(255, 215, 0, ${.8*(1-t)})`),l.addColorStop(1,"rgba(255, 215, 0, 0)"),C.fillStyle=l,C.fillRect(0,0,K,de),C.strokeStyle=`rgba(255, 255, 255, ${.8*(1-t)})`,C.lineWidth=15*(1-t),C.beginPath(),C.arc(a,o,s*.8,0,Math.PI*2),C.stroke(),C.lineWidth=5*(1-t),C.stroke()}}if(r.showTutorial&&xs(),r.monitorEntranceStartTime){const e=performance.now()-r.monitorEntranceStartTime;e<1500?h0(C,e/1500):r.monitorEntranceStartTime=0}}function h0(e,t){const i=K,a=de,o=Math.floor(i/20),n=1-t;e.save(),e.font="bold 20px monospace",e.textAlign="center";for(let s=0;s<o;s++){const l=s*20+10,c=s*731,f=Math.floor(a/20),d=t*a*2;for(let u=0;u<f;u++){const h=(u*20+d)%a,g=Math.sin(u+c+t*10)>0?"1":"0",m=n*(.3+.7*Math.random());Math.random()>.95?(e.globalAlpha=n,e.fillStyle="#cfc"):(e.globalAlpha=m,e.fillStyle="#0f0"),e.fillText(g,l,h)}}e.restore()}function u0(){X.currentTheme.id==="HAUNTED"&&(r.bat&&(r.bat.pivotX,r.bat.pivotY),js(C,K,de)),un.render(C)}const yi={CLASSIC:{id:"CLASSIC",name:"Classic Field",grassColor:"#00a800",dirtColor:"#654321",lineColor:"#ffffff",warningTrackColor:"#a0522d",moundColor:"#503010",stripeColor:"rgba(0, 0, 0, 0.1)",drawGrassPattern(e,t,i){const o=Math.ceil(t/40);for(let n=0;n<o;n++)n%2!==0&&(e.fillStyle=this.stripeColor,e.fillRect(n*40,0,40,i))}},SPACE:{id:"SPACE",name:"Space Station",grassColor:"#1e272e",dirtColor:"#bdc3c7",lineColor:"#f39c12",warningTrackColor:"#2c3e50",moundColor:"#95a5a6",stripeColor:"rgba(255, 255, 255, 0.05)",pitcherAccessories:{spaceHelmet:!0},pitcherAccessories:{spaceHelmet:!0},walkOffType:"FLY_AWAY",warmup(e,t){ol(e,t)},drawGrassPattern(e,t,i){const o=30*Math.sqrt(3),s=60*.75;e.lineWidth=1,e.strokeStyle="#2f3640";const l=Math.ceil(i/o)+1,c=Math.ceil(t/s)+1;for(let d=0;d<l;d++)for(let u=0;u<c;u++){const h=u*s,g=d*o+(u%2===0?0:o/2);e.beginPath();for(let m=0;m<6;m++){const p=2*Math.PI/6*m,b=h+30*Math.cos(p),v=g+30*Math.sin(p);m===0?e.moveTo(b,v):e.lineTo(b,v)}e.closePath(),Math.random()>.95?(e.fillStyle="rgba(52, 152, 219, 0.1)",e.fill()):Math.random()>.98&&(e.fillStyle="rgba(231, 76, 60, 0.1)",e.fill()),e.stroke(),e.fillStyle="#353b48",e.fillRect(h-1,g-1,2,2)}const f=e.createRadialGradient(t/2,i/2,i/4,t/2,i/2,i);f.addColorStop(0,"rgba(0,0,0,0)"),f.addColorStop(1,"rgba(0,0,0,0.4)"),e.fillStyle=f,e.fillRect(0,0,t,i)}},BEACH:{id:"BEACH",name:"Sunny Beach",grassColor:"#f4e4bc",dirtColor:"#e0cda7",lineColor:"#ffffff",warningTrackColor:"#90d4e9",moundColor:"#d6c096",stripeColor:"rgba(0, 0, 0, 0.05)",pitcherAccessories:{sunglasses:!0},walkOffType:"SWIM",warmup(e,t){if(xr(e,t),typeof document<"u"){const i=document.createElement("canvas");i.width=1,i.height=1;const a=i.getContext("2d");this.drawGrassPattern(a,e,t),console.log("[ThemeManager] Beach Ground Cache Force-Generated")}},getShorelineY(e){const t=150+(Fe||0)+32;return Math.max(e*.1+20,t-120)},drawGrassPattern(e,t,i){if(!this._cachedGroundCanvas||this._cachedGroundCanvas.width!==t||this._cachedGroundCanvas.height!==i){this._cachedGroundCanvas=document.createElement("canvas"),this._cachedGroundCanvas.width=t,this._cachedGroundCanvas.height=i;const a=this._cachedGroundCanvas.getContext("2d");if(!this.sandPattern){const l=document.createElement("canvas"),c=128;l.width=c,l.height=c;const f=l.getContext("2d");f.fillStyle="#f4e4bc",f.fillRect(0,0,c,c);const d=f.getImageData(0,0,c,c),u=d.data;for(let h=0;h<u.length;h+=4){const g=(Math.random()-.5)*20;u[h]=Math.max(0,Math.min(255,u[h]+g)),u[h+1]=Math.max(0,Math.min(255,u[h+1]+g)),u[h+2]=Math.max(0,Math.min(255,u[h+2]+g))}f.putImageData(d,0,0),f.fillStyle="rgba(255, 255, 255, 0.4)";for(let h=0;h<40;h++)f.fillRect(Math.random()*c,Math.random()*c,1,1);this.sandPattern=a.createPattern(l,"repeat")}const o=this.getShorelineY(i);a.fillStyle=this.sandPattern,a.fillRect(0,o,t,i-o);const n=240;for(let l=o;l<i;l+=n){const c=a.createLinearGradient(0,l,0,l+n);c.addColorStop(0,"rgba(100, 80, 50, 0.15)"),c.addColorStop(.4,"rgba(100, 80, 50, 0)"),c.addColorStop(1,"rgba(255, 255, 255, 0.2)"),a.fillStyle=c,a.beginPath(),a.moveTo(0,l);for(let f=0;f<=t;f+=50){const d=l+Math.sin(f*.003+l)*20;a.lineTo(f,d)}a.lineTo(t,l+n),a.lineTo(0,l+n),a.fill()}const s=a.createRadialGradient(t/2,i*.7,50,t/2,i*.7,t*.6);s.addColorStop(0,"rgba(160, 140, 110, 0.4)"),s.addColorStop(1,"rgba(160, 140, 110, 0)"),a.fillStyle=s,a.fillRect(0,o,t,i-o)}e.drawImage(this._cachedGroundCanvas,0,0)}},HAUNTED:{id:"HAUNTED",name:"Haunted Mansion",grassColor:"#1a261a",dirtColor:"#2d3436",lineColor:"#dfe6e9",warningTrackColor:"#000000",moundColor:"#4b4b4b",stripeColor:"rgba(0,0,0,0.3)",pitcherAccessories:{halloweenMask:!0},walkOffType:"GHOST",warmup(e,t){_a(e,t)},drawGrassPattern(e,t,i){}}},X={currentTheme:yi.CLASSIC,setTheme(e){yi[e]&&(this.currentTheme=yi[e],typeof document<"u"&&document.body&&document.body.setAttribute("data-theme",e),rr())},init(){typeof document<"u"&&document.body&&this.currentTheme&&document.body.setAttribute("data-theme",this.currentTheme.id)}};X.init();const p0=Object.freeze(Object.defineProperty({__proto__:null,THEMES:yi,themeManager:X},Symbol.toStringTag,{value:"Module"})),ya={Heavy:"HEAVY",Medium:"MEDIUM",Light:"LIGHT"};class g0{constructor(){this.Haptics=null,this.initialized=!1,this.patterns={light:ya.Light,medium:ya.Medium,heavy:ya.Heavy,perfect:ya.Heavy,good:15,foul:15,failure:[60,50,60,50,100],unlock:[50,50,100,50,150],purchase:[60,40,60,40,100],locked:[30,50,30],equipped:[20,20,20],footstep:25,bossStep:ya.Heavy,bossEntrance:[100,50,100,50,200,50,400],r_common:[50],r_rare:[50,50,100],r_epic:[50,50,50,50,200],r_legendary:[100,50,100,50,100,50,500],r_mythic:[50,30,50,30,50,30,50,30,1e3]},this.init()}async init(){if(typeof window.Capacitor<"u")try{const{Haptics:t}=await Le(async()=>{const{Haptics:i}=await import("./index-Bw9m61A9.js");return{Haptics:i}},__vite__mapDeps([0,1]),import.meta.url);this.Haptics=t,this.initialized=!0}catch{console.log("Haptics native plugin not found.")}}async vibrate(t){if(!r.settings?.vibration)return;const i=this.patterns[t];try{if(this.initialized&&this.Haptics)typeof i=="string"?await this.Haptics.impact({style:i}):typeof i=="number"?await this.Haptics.vibrate({duration:i}):Array.isArray(i)&&this.vibrateSequence(i);else throw new Error("Native Haptics unavailable")}catch{if(navigator.vibrate){if(Array.isArray(i)||typeof i=="number")navigator.vibrate(i);else if(typeof i=="string"){const n={LIGHT:10,MEDIUM:25,HEAVY:50}[i]||25;navigator.vibrate(n)}}}}async vibrateSequence(t){for(let i=0;i<t.length;i++){const a=t[i];i%2===0&&a>0&&this.Haptics&&await this.Haptics.vibrate({duration:a}),await new Promise(o=>setTimeout(o,a))}}vibrateCustom(t){r.settings?.vibration&&(this.initialized&&this.Haptics?typeof t=="number"?this.Haptics.vibrate({duration:t}).catch(()=>{}):Array.isArray(t)&&this.vibrateSequence(t):navigator.vibrate&&navigator.vibrate(t))}}const ne=new g0;class m0{constructor(){this.isOpen=!1,this.init()}closeAndExit(){this.isOpen=!1,si&&(si.style.display="none"),L.playSettingsClose(),pl()}init(){this.loadSettings(),Ze.addEventListener("click",()=>this.openSettings()),Pl.addEventListener("click",()=>this.closeSettings()),Et.addEventListener("click",()=>{if(r.isDailyChallenge){ne.vibrate("medium"),L.playError();return}ne.vibrate("medium"),this.restartGame()}),si&&(si.onclick=t=>{t.stopPropagation(),t.target===si&&this.closeSettings()}),mt&&mt.addEventListener("click",()=>{if(r.isDailyChallenge&&!r.isGameOver){ne.vibrate("medium"),L.playError();return}if(r.isGameOver){this.closeAndExit();return}const t=document.getElementById("confirmation-modal"),i=document.getElementById("confirm-ok-btn"),a=document.getElementById("confirm-cancel-btn");if(t&&i&&a){const o=()=>{ne.vibrate("light"),t.style.display="none",L.playSettingsClose()};i.onclick=()=>{ne.vibrate("medium"),t.style.display="none",this.closeAndExit()},a.onclick=o,t.onclick=n=>{n.stopPropagation(),n.target===t&&o()},t.style.display="flex",L.playSettingsOpen()}else this.closeAndExit()}),Un.addEventListener("change",t=>this.updateSetting("swingOnRelease",t.target.checked)),zn.addEventListener("change",t=>this.updateSetting("vibration",t.target.checked)),Wn.addEventListener("change",t=>this.updateSetting("muteMusic",t.target.checked)),Nn.addEventListener("change",t=>this.updateSetting("muteSound",t.target.checked)),Vn.addEventListener("change",t=>this.updateSetting("colorBlindMode",t.target.checked)),$n.addEventListener("change",t=>this.updateSetting("noFlash",t.target.checked)),document.addEventListener("keydown",t=>{(t.key==="r"||t.key==="R")&&(this.isOpen&&r.gameActive&&!r.isDailyChallenge?(ne.vibrate("medium"),this.restartGame()):this.isOpen&&r.gameActive&&r.isDailyChallenge&&(ne.vibrate("medium"),L.playError()))})}loadSettings(){const t=localStorage.getItem("baseball_settings");if(t)try{const i=JSON.parse(t);r.settings={...r.settings,...i}}catch(i){console.error("Failed to parse settings",i)}this.syncUI(),this.applySideEffects()}syncUI(){r.settings&&(Un.checked=!!r.settings.swingOnRelease,zn.checked=!!r.settings.vibration,Wn.checked=!!r.settings.muteMusic,Nn.checked=!!r.settings.muteSound,Vn.checked=!!r.settings.colorBlindMode,$n.checked=!!r.settings.noFlash)}updateSetting(t,i){r.settings||(r.settings={}),r.settings[t]=i,this.saveSettings(),this.applySideEffects(t),L.playSettingsToggle()}saveSettings(){localStorage.setItem("baseball_settings",JSON.stringify(r.settings))}applySideEffects(t){if(t==="muteMusic"||!t)r.settings.muteMusic?L.stopTheme():!r.gameActive&&r.isGameOver&&(X.currentTheme&&X.currentTheme.id==="HAUNTED"?L.playHauntedTheme():L.playTheme());else if(t==="noFlash"&&r.isGameOver){const i=document.getElementById("restart-msg");i&&(i.style.animation=r.settings.noFlash?"none":"blink 1s infinite")}}openSettings(){ne.vibrate("medium"),this.isOpen=!0,si.style.display="flex",L.init().then(()=>{L.playSettingsOpen()}),r.gameActive?(Et.style.display="block",r.isDailyChallenge?(Et.classList.add("btn-blocked"),Et.style.opacity="",Et.style.filter="",Et.style.textDecoration=""):(Et.classList.remove("btn-blocked"),Et.style.opacity="1",Et.style.filter="none",Et.style.textDecoration="none")):Et.style.display="none",mt&&(!r.gameActive&&!r.isGameOver?mt.style.display="none":(mt.style.display="block",r.isDailyChallenge&&!r.isGameOver?(mt.classList.add("btn-blocked"),mt.style.opacity="",mt.style.filter="",mt.style.textDecoration=""):(mt.classList.remove("btn-blocked"),mt.style.opacity="1",mt.style.filter="none",mt.style.textDecoration="none")))}closeSettings(){ne.vibrate("medium"),this.isOpen=!1,si.style.display="none",Fi(!0),L.playSettingsClose()}restartGame(){this.closeSettings(),Si(r.isDailyChallenge,!1,"menu")}}const Rt=new m0,hl="data:image/svg+xml,%3csvg%20width='64'%20height='64'%20viewBox='0%200%2016%2016'%20xmlns='http://www.w3.org/2000/svg'%20shape-rendering='crispEdges'%3e%3c!--%20Base%20Shadow%20--%3e%3crect%20x='1'%20y='2'%20width='14'%20height='13'%20fill='%23263238'/%3e%3c!--%20Main%20Body%20(Dark%20Metal/Space)%20--%3e%3crect%20x='1'%20y='2'%20width='14'%20height='12'%20fill='%23455A64'/%3e%3c!--%20Gold%20Accents/Frame%20--%3e%3crect%20x='1'%20y='2'%20width='14'%20height='1'%20fill='%23FFC107'/%3e%3c!--%20Top%20--%3e%3crect%20x='1'%20y='13'%20width='14'%20height='1'%20fill='%23FFC107'/%3e%3c!--%20Bottom%20--%3e%3crect%20x='1'%20y='2'%20width='1'%20height='12'%20fill='%23FFC107'/%3e%3c!--%20Left%20--%3e%3crect%20x='14'%20y='2'%20width='1'%20height='12'%20fill='%23FFC107'/%3e%3c!--%20Right%20--%3e%3c!--%20Purple%20Energy%20Core%20--%3e%3crect%20x='3'%20y='4'%20width='10'%20height='8'%20fill='%23311B92'/%3e%3c!--%20Glowing%20Pulse%20(Cyan)%20--%3e%3crect%20x='5'%20y='6'%20width='6'%20height='4'%20fill='%2300E5FF'/%3e%3crect%20x='6'%20y='7'%20width='4'%20height='2'%20fill='%23E0F7FA'/%3e%3c!--%20Corner%20Reinforcements%20--%3e%3crect%20x='1'%20y='2'%20width='2'%20height='2'%20fill='%23FFA000'/%3e%3crect%20x='13'%20y='2'%20width='2'%20height='2'%20fill='%23FFA000'/%3e%3crect%20x='1'%20y='12'%20width='2'%20height='2'%20fill='%23FFA000'/%3e%3crect%20x='13'%20y='12'%20width='2'%20height='2'%20fill='%23FFA000'/%3e%3c!--%20Shimmer%20Overlay%20--%3e%3crect%20x='2'%20y='3'%20width='1'%20height='1'%20fill='%23FFFFFF'%20opacity='0.8'/%3e%3crect%20x='12'%20y='3'%20width='1'%20height='1'%20fill='%23FFFFFF'%20opacity='0.6'/%3e%3c/svg%3e",ul="data:image/svg+xml,%3csvg%20width='64'%20height='64'%20viewBox='0%200%2016%2016'%20xmlns='http://www.w3.org/2000/svg'%20shape-rendering='crispEdges'%3e%3c!--%20Base%20Shadow%20--%3e%3crect%20x='1'%20y='2'%20width='14'%20height='13'%20fill='%233E2723'/%3e%3c!--%20Main%20Wood%20Body%20--%3e%3crect%20x='1'%20y='2'%20width='14'%20height='12'%20fill='%238D6E63'/%3e%3c!--%20Planks%20(darker%20lines)%20--%3e%3crect%20x='2'%20y='5'%20width='12'%20height='1'%20fill='%235D4037'/%3e%3crect%20x='2'%20y='9'%20width='12'%20height='1'%20fill='%235D4037'/%3e%3c!--%20Corners%20(Metal)%20--%3e%3crect%20x='1'%20y='2'%20width='3'%20height='3'%20fill='%23BCAAA4'/%3e%3crect%20x='12'%20y='2'%20width='3'%20height='3'%20fill='%23BCAAA4'/%3e%3crect%20x='1'%20y='11'%20width='3'%20height='3'%20fill='%23BCAAA4'/%3e%3crect%20x='12'%20y='11'%20width='3'%20height='3'%20fill='%23BCAAA4'/%3e%3c!--%20Center%20Emblem%20(Diamond)%20--%3e%3crect%20x='6'%20y='6'%20width='4'%20height='4'%20fill='%23EFEBE9'/%3e%3crect%20x='7'%20y='7'%20width='2'%20height='2'%20fill='%23D32F2F'/%3e%3c!--%20Highlight%20Top%20Edge%20--%3e%3crect%20x='1'%20y='2'%20width='14'%20height='1'%20fill='%23D7CCC8'%20opacity='0.5'/%3e%3c/svg%3e";let mo=null;function y0(e,t="STANDARD"){return new Promise(i=>{mo=i;const{bat:a,isDuplicate:o,refundAmount:n}=e,s=pi[a.rarity];L.stopTheme();const l=document.getElementById("crate-reveal-img");l&&(l.src=new URL(Object.assign({"../assets/crate_premium.svg":hl,"../assets/crate_standard.svg":ul})[`../assets/crate_${t==="PREMIUM"?"premium":"standard"}.svg`],import.meta.url).href),Wa.style.display="block",Wa.className="crate-reveal-box",Na.style.display="none",Na.className="crate-reveal-card",tn.style.display="none",Lo.style.display="none",Bi.style.display="flex",L.playPurchase(),ne.vibrate("heavy"),setTimeout(()=>{Wa.classList.add("opening"),ne.vibrate("light"),S0(s);const c=document.createElement("div");c.className=`crate-reveal-burst rarity-${a.rarity}`,c.style.background=`radial-gradient(circle, ${s.color}66 0%, transparent 70%)`,Bi.appendChild(c),setTimeout(()=>{c.remove()},800),setTimeout(()=>{Wa.style.display="none",Na.classList.add(`rarity-${a.rarity}`),Gn.textContent=s.name,Gn.style.color=s.color;const f=Mt[a.id]||a,d=gn.generateIcon(f);Fn.innerHTML="";const u=document.createElement("img");u.src=d.toDataURL(),u.alt=a.name,u.draggable=!1,u.style.userSelect="none",u.style.webkitUserDrag="none",u.style.pointerEvents="none",Fn.appendChild(u),Cl.textContent=a.name,o&&(Lo.textContent=`DUPLICATE! +${n} coins`,Lo.style.display="block",U.updateCoinDisplay()),Na.style.display="block";const h=`r_${a.rarity?a.rarity.toLowerCase():"common"}`;ne.vibrate(h),s.order>=3?L.playPerfectHit&&L.playPerfectHit():(s.order>=2,L.playEquip()),setTimeout(()=>{tn.style.display="flex",o?So.style.display="none":So.style.display="inline-block"},400)},500)},2100)})}function S0(e,t){const i=document.getElementById("crate-reveal-overlay");i&&(i.className="",i.classList.add("active"),e.order>=4?(L.playThunder(.5),i.classList.add("mythic-preparing"),setTimeout(()=>{L.playPerfectHit("GLITCH"),L.playThunder(1),i.classList.add("mythic-reveal")},200)):e.order>=3?(L.playThunder(.8),L.playPerfectHit("LEGENDARY"),i.classList.add("shake-hard")):(e.order>=2&&(L.playCharge?L.playCharge():L.playLevelUp()),i.classList.add("shake-subtle")),setTimeout(()=>{i.classList.remove("shake-subtle","shake-hard","glitch-shake"),e.order>=4&&setTimeout(()=>i.classList.remove("mythic-reveal"),1e3)},1e3))}function Tn(e){Bi.style.display="none",Bi.classList.remove("mythic-preparing","mythic-reveal","active"),r.isGameOver&&(X.currentTheme&&X.currentTheme.id==="HAUNTED"?L.playHauntedTheme():L.playTheme()),mo&&(mo(e),mo=null)}So&&So.addEventListener("click",()=>{ne.vibrate("equipped"),Tn(!0)});Hn&&Hn.addEventListener("click",()=>{ne.vibrate("medium"),Tn(!1)});Bi&&Bi.addEventListener("click",e=>{tn.style.display==="flex"&&e.target===Bi&&(ne.vibrate("medium"),Tn(!1))});const Us=`data:image/svg+xml;charset=utf-8,${encodeURIComponent('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 10 10" shape-rendering="crispEdges"><rect x="3" y="0" width="4" height="1" fill="#DAA520" /><rect x="2" y="1" width="1" height="1" fill="#DAA520" /><rect x="3" y="1" width="4" height="1" fill="#FFD700" /><rect x="7" y="1" width="1" height="1" fill="#DAA520" /><rect x="1" y="2" width="1" height="1" fill="#DAA520" /><rect x="2" y="2" width="1" height="1" fill="#FFD700" /><rect x="3" y="2" width="2" height="1" fill="#FFFFFF" /><rect x="5" y="2" width="3" height="1" fill="#FFD700" /><rect x="8" y="2" width="1" height="1" fill="#DAA520" /><rect x="1" y="3" width="1" height="1" fill="#DAA520" /><rect x="2" y="3" width="1" height="1" fill="#FFD700" /><rect x="3" y="3" width="1" height="1" fill="#FFFFFF" /><rect x="4" y="3" width="3" height="1" fill="#000000" /><rect x="7" y="3" width="1" height="1" fill="#FFD700" /><rect x="8" y="3" width="1" height="1" fill="#DAA520" /><rect x="1" y="4" width="1" height="1" fill="#DAA520" /><rect x="2" y="4" width="2" height="1" fill="#FFD700" /><rect x="4" y="4" width="1" height="1" fill="#000000" /><rect x="5" y="4" width="3" height="1" fill="#FFD700" /><rect x="8" y="4" width="1" height="1" fill="#DAA520" /><rect x="1" y="5" width="1" height="1" fill="#DAA520" /><rect x="2" y="5" width="2" height="1" fill="#FFD700" /><rect x="4" y="5" width="1" height="1" fill="#000000" /><rect x="5" y="5" width="3" height="1" fill="#FFD700" /><rect x="8" y="5" width="1" height="1" fill="#DAA520" /><rect x="1" y="6" width="1" height="1" fill="#DAA520" /><rect x="2" y="6" width="2" height="1" fill="#FFD700" /><rect x="4" y="6" width="3" height="1" fill="#000000" /><rect x="7" y="6" width="1" height="1" fill="#FFD700" /><rect x="8" y="6" width="1" height="1" fill="#DAA520" /><rect x="1" y="7" width="1" height="1" fill="#DAA520" /><rect x="2" y="7" width="6" height="1" fill="#FFD700" /><rect x="8" y="7" width="1" height="1" fill="#DAA520" /><rect x="2" y="8" width="1" height="1" fill="#DAA520" /><rect x="3" y="8" width="4" height="1" fill="#FFD700" /><rect x="7" y="8" width="1" height="1" fill="#DAA520" /><rect x="3" y="9" width="4" height="1" fill="#DAA520" /></svg>')}`;class T0{constructor(){this.stadiums=[{id:"stadium_default",name:"Classic Field",cost:0,type:"stadium",unlocked:!0,equipped:!0,theme:"CLASSIC"},{id:"stadium_night",name:"Night Game",cost:1e6,type:"stadium",unlocked:!1,equipped:!1,theme:"NIGHT"},{id:"stadium_retro",name:"Retro Park",cost:25e5,type:"stadium",unlocked:!1,equipped:!1,theme:"RETRO"},{id:"stadium_space",name:"Space Station",cost:30,type:"stadium",unlocked:!1,equipped:!1,theme:"SPACE"},{id:"stadium_beach",name:"Sunny Beach",cost:20,type:"stadium",unlocked:!1,equipped:!1,theme:"BEACH"},{id:"stadium_haunted",name:"Haunted Mansion",cost:10,type:"stadium",unlocked:!1,equipped:!1,theme:"HAUNTED"}],this.bats=[{id:"bat_default",name:"Pink",cost:0,type:"bat",rarity:null,unlocked:!0,equipped:!0,color:"#ff69b4"},{id:"bat_blue",name:"Blue Camo",cost:1,type:"bat",rarity:"COMMON",unlocked:!1,equipped:!1,color:"#0000FF"},{id:"bat_gold",name:"Gold",cost:10,type:"bat",rarity:"LEGENDARY",unlocked:!1,equipped:!1,color:"#FFD700"},{id:"bat_laser",name:"Neon",cost:1,type:"bat",rarity:"RARE",unlocked:!1,equipped:!1,color:"#00ffff"}],this.crateBats=pn.map(t=>({id:t.id,name:t.name,rarity:t.rarity,type:"bat",unlocked:!1,equipped:!1,color:t.color})),this.activeTab="shop",this.isOpen=!1,this.isOddsOpen=!1,this.needsCollectionRefresh=!0,this.isPurchasing=!1,this.init()}init(){this.loadProgress(),this.renderItems(),this.setupEventListeners(),setTimeout(()=>{this.syncPendingPurchases(),this.syncInventoryFromServer()},2e3),this._initListeners()}_initListeners(){const t=document.getElementById("close-odds"),i=document.getElementById("crate-odds-modal");console.log("[Unlockables] _initListeners check:",{closeBtn:t,modal:i}),t&&(t.onclick=a=>{a.stopPropagation(),i&&(i.style.display="none"),this.isOddsOpen=!1,L.playUnlockablesClose(),ne.vibrate("medium")}),i&&(i.onclick=a=>{a.target===i&&(i.style.display="none",this.isOddsOpen=!1,L.playUnlockablesClose(),ne.vibrate("medium"))})}async syncPendingPurchases(){const t=JSON.parse(Y.getItem("baseball_pending_purchases")||"[]");if(t.length===0)return;console.log(`[Unlockables] Found ${t.length} pending offline purchases to sync...`);const{supabaseService:i}=await Le(async()=>{const{supabaseService:s}=await Promise.resolve().then(()=>mi);return{supabaseService:s}},void 0,import.meta.url),a=i.getClient();if(!a)return;const{data:{session:o}}=await a.auth.getSession();if(!o)return;try{await a.rpc("ensure_user_exists",{p_user_id:o.user.id})}catch(s){console.warn("[Unlockables] Failed to ensure user exists:",s)}const n=[];for(const s of t)try{console.log(`[Unlockables] Syncing purchase: ${s.id}`);const{data:l,error:c}=await a.rpc("purchase_item",{p_item_id:s.id,p_cost:s.cost,p_item_type:s.type});c?(console.warn(`[Unlockables] Sync failed for ${s.id}: ${c.message}`),n.push(s)):typeof l.new_balance=="number"?console.log(`[Unlockables] Synced ${s.id}. Server Balance: ${l.new_balance}`):console.warn(`[Unlockables] Synced ${s.id} but received invalid balance: ${l.new_balance}.`)}catch(l){console.error(`[Unlockables] Sync Error for ${s.id}`,l),n.push(s)}Y.setItem("baseball_pending_purchases",JSON.stringify(n)),await this.syncPendingEquips(a)}async syncInventoryFromServer(){const{supabaseService:t}=await Le(async()=>{const{supabaseService:a}=await Promise.resolve().then(()=>mi);return{supabaseService:a}},void 0,import.meta.url),i=t.getClient();if(i)try{const{data:{session:a}}=await i.auth.getSession();if(!a)return;console.log("[Unlockables] Syncing inventory from server...");const{data:o,error:n}=await i.from("inventory").select("item_id, item_type, equipped").eq("user_id",a.user.id);if(n)throw n;if(o&&o.length>0){let s=!1;o.forEach(l=>{if(l.item_type==="bat"){const c=this.crateBats.find(f=>f.id===l.item_id);c&&!c.unlocked&&(c.unlocked=!0,c.equipped=l.equipped,s=!0)}else if(l.item_type==="stadium"){const c=this.stadiums.find(f=>f.id===l.item_id);c&&!c.unlocked&&(c.unlocked=!0,c.equipped=l.equipped,s=!0)}}),s&&(console.log("[Unlockables] Inventory synced from server. Refreshing UI."),this.saveProgress(),this.renderItems())}}catch(a){console.warn("[Unlockables] Failed to sync inventory from server:",a.message)}}async syncPendingEquips(t){const i=["bat","stadium"];for(const a of i){const o=`pending_equip_${a}`,n=Y.getItem(o);if(n)try{const s=JSON.parse(n);console.log(`[Unlockables] Syncing pending equip: ${s.id}`);const{error:l}=await t.rpc("set_equipped_item",{p_item_id:s.id,p_item_type:s.type});l?console.warn(`[Unlockables] Failed to sync pending equip ${s.id}: ${l.message}`):(Y.removeItem(o),console.log(`[Unlockables] Pending equip synced: ${s.id}`))}catch(s){console.error("Error syncing pending equip",s)}}}setupEventListeners(){xe.addEventListener("click",()=>this.open()),vl.addEventListener("click",()=>this.close()),Sa.addEventListener("click",t=>{t.stopPropagation(),(!r.gameActive||r.isGameOver)&&(ne.vibrate("light"),this.open())}),Ta.addEventListener("click",t=>{t.target===Ta&&this.close()}),Ua&&Ua.addEventListener("click",()=>this.switchTab("shop")),za&&za.addEventListener("click",()=>this.switchTab("collection"))}open(){this.isOpen=!0,Ta.style.display="flex",this.updateCoinDisplay(),r.isPaused=!0,r.needsUnlockablesGlow=!1,xe&&xe.classList.remove("unlockables-glow"),L.init().then(()=>{L.playUnlockablesOpen()}),ne.vibrate("medium")}close(){this.isOpen=!1,Ta.style.display="none",r.isPaused=!1,L.playUnlockablesClose(),ne.vibrate("medium")}updateCoinDisplay(){en.textContent=U.coins}renderItems(){this.stadiums.sort((t,i)=>t.cost-i.cost),this.renderGrid(Dn,this.stadiums),this.renderOwnedBats(),this.renderCrates(),this.needsCollectionRefresh=!0}getBatIconDataUrl(t){if(!t._iconDataUrl){const i=this._resolveBatDef(t.id),a=gn.generateIcon(i);t._iconDataUrl=a.toDataURL()}return t._iconDataUrl}renderOwnedBats(){if(!da)return;da.innerHTML="";const t=[...this.bats.filter(o=>o.unlocked).map(o=>({...o,isStarter:!0})),...this.crateBats.filter(o=>o.unlocked)];if(t.length===0){da.innerHTML='<div style="grid-column: 1/-1; text-align: center; color: #888; font-size: 2vmin; padding: 2vmin;">Open crates to collect bats!</div>';return}const i={MYTHIC:5,LEGENDARY:4,EPIC:3,RARE:2,COMMON:1};t.sort((o,n)=>{const s=i[o.rarity]||0,l=i[n.rarity]||0;return s-l});const a=document.createDocumentFragment();t.forEach(o=>{const n=document.createElement("div");n.dataset.id=o.id;const s=o.rarity?`rarity-${o.rarity}`:"";n.className=`unlockable-item clickable unlocked owned-bat-item ${s} ${o.equipped?"equipped":""}`;const l=this.getBatIconDataUrl(o);let c;if(o.equipped)c='<div class="item-status equipped">EQUIPPED</div>';else{const f=o.rarity?pi[o.rarity]?.name||"":"Starter";c=`<div class="item-status owned" style="color: ${o.rarity&&pi[o.rarity]?.color||"#aaa"}">${f}</div>`}n.innerHTML=`
                <div class="item-name">${o.name.replace(" Bat","").replace(" bat","")}</div>
                <div class="item-icon"><img src="${l}" draggable="false" style="width:100%;height:100%;display:block;user-select:none;-webkit-user-drag:none;pointer-events:none;"></div>
                <div class="item-footer">${c}</div>
            `,n.onclick=()=>this.equipCrateBat(o),a.appendChild(n)}),da.appendChild(a)}switchTab(t){this.activeTab!==t&&(this.activeTab=t,ne.vibrate("light"),L.playSettingsToggle(),t==="shop"?(Ln.style.display="",On.style.display="none",Ua.classList.add("active"),za.classList.remove("active")):(Ln.style.display="none",On.style.display="",Ua.classList.remove("active"),za.classList.add("active"),this.renderCollection()))}renderCrates(){ko&&(ko.innerHTML="",Object.values(so).forEach(t=>{const i=document.createElement("div");i.className=`crate-card ${t.id.toLowerCase()}`;const a=new URL(Object.assign({"../assets/crate_premium.svg":hl,"../assets/crate_standard.svg":ul})[`../assets/crate_${t.id==="PREMIUM"?"premium":"standard"}.svg`],import.meta.url).href;i.innerHTML=`
                <div class="crate-info-btn">i</div>
                <div class="crate-emoji">
                    <img src="${a}" class="crate-icon-img" alt="${t.name}">
                </div>
                <div class="crate-name">${t.name}</div>
                <div class="crate-desc">${t.description}</div>
                <div class="crate-cost">
                    <img src="${Us}" alt="coins">
                    ${t.cost}
                </div>
            `;const o=i.querySelector(".crate-info-btn");o&&(o.onclick=n=>{n.stopPropagation(),ne.vibrate("medium"),this.showCrateOdds(t.id)}),i.onclick=()=>this.purchaseCrate(t.id),ko.appendChild(i)}))}showCrateOdds(t){this._initListeners();const i=document.getElementById("crate-odds-modal"),a=document.getElementById("odds-list"),o=document.getElementById("odds-title");if(!i||!a)return;const n=so[t];o&&(o.textContent=`${n.name} Odds`),a.innerHTML="",L.playUnlockablesOpen();const s=n.guaranteedMinRarity?pi[n.guaranteedMinRarity].order:0,l=Object.values(pi).filter(f=>f.order>=s),c=l.reduce((f,d)=>f+d.dropRate,0);l.forEach(f=>{const d=(f.dropRate/c*100).toFixed(1),u=document.createElement("div");u.className="odds-row",u.innerHTML=`
                <div class="odds-row-header">
                    <span style="color: ${f.color}">${f.name}</span>
                    <span>${d}%</span>
                </div>
                <div class="odds-bar-bg">
                    <div class="odds-bar-fill" style="width: ${d}%; background-color: ${f.color}"></div>
                </div>
            `,a.appendChild(u)}),i.style.display="flex",this.isOddsOpen=!0}renderCollection(t=!1){if(!Do||!this.needsCollectionRefresh&&!t)return;Do.innerHTML="";const i=document.createDocumentFragment(),a=[...this.bats.filter(s=>s.id!=="bat_default"),...this.crateBats],o=a.filter(s=>s.unlocked).length;Bn&&(Bn.textContent=`${o} / ${a.length} COLLECTED`),[{key:"COMMON",name:"Common",color:"#b0c3d9"},{key:"RARE",name:"Rare",color:"#4b69ff"},{key:"EPIC",name:"Epic",color:"#8847ff"},{key:"LEGENDARY",name:"Legendary",color:"#ffd700"},{key:"MYTHIC",name:"Mythic",color:"#ff4444"}].forEach(s=>{const l=a.filter(d=>d.rarity===s.key);if(l.length===0)return;l.sort((d,u)=>d.name.localeCompare(u.name));const c=l.filter(d=>d.unlocked).length,f=document.createElement("div");f.className=`collection-section-header rarity-header-${s.key||"STARTER"}`,f.innerHTML=`
                <span class="section-rarity-name" style="color: ${s.color}">${s.name}</span>
                <span class="section-rarity-count">${c}/${l.length}</span>
            `,i.appendChild(f),l.forEach(d=>{const u=document.createElement("div"),h=d.rarity?`rarity-${d.rarity}`:"";u.className=`collection-item ${h} ${d.unlocked?"":"locked"}`;const g=this.getBatIconDataUrl(d);u.innerHTML=`
                    <div class="bat-icon"><img src="${g}" alt="${d.name}" draggable="false"></div>
                    <div class="bat-name">${d.name}</div>
                `,i.appendChild(u)})}),Do.appendChild(i),this.needsCollectionRefresh=!1}async purchaseCrate(t){if(this.isPurchasing){console.log("[Unlockables] Purchase already in progress... blocking.");return}const i=so[t];if(i){this.isPurchasing=!0;try{if(!await U.deductCoins(i.cost,`crate_${t}`)){L.playError(),ne.vibrate("light"),this.isPurchasing=!1;return}const o=this.crateBats.filter(c=>c.unlocked).map(c=>c.id),n=hr(t,o),s=this.crateBats.find(c=>c.id===n.bat.id);s&&!n.isDuplicate&&(s.unlocked=!0),n.isDuplicate&&n.refundAmount>0&&(console.log(`[Unlockables] Duplicate detected. Refunding ${n.refundAmount} coins (SILENT).`),U.addCoins(n.refundAmount,!0)),this.saveProgress(),await y0(n,t)&&!n.isDuplicate&&s&&this.equipCrateBat(s),this.renderItems(),U.updateCoinDisplay()}catch(a){console.error("[Unlockables] Crate purchase error:",a)}finally{this.isPurchasing=!1}}}_resolveBatDef(t){return{bat_default:Mt.STANDARD,bat_blue:Mt.BLUE,bat_gold:Mt.GOLD,bat_laser:Mt.LASER}[t]||Mt[t]||Mt.STANDARD}_resolveBatKey(t){return{bat_default:"STANDARD",bat_blue:"BLUE",bat_gold:"GOLD",bat_laser:"LASER"}[t]||t}equipCrateBat(t){if(!t.unlocked)return;this.bats.forEach(n=>n.equipped=!1),this.crateBats.forEach(n=>n.equipped=!1);const i=this.bats.find(n=>n.id===t.id),a=this.crateBats.find(n=>n.id===t.id);i&&(i.equipped=!0),a&&(a.equipped=!0);const o=this._resolveBatKey(t.id);qe.setBat(o),Ps(),L.playEquip(),ne.vibrate("light"),this.saveProgress(),this.renderCollection(),this.renderOwnedBats()}renderGrid(t,i){t.innerHTML="";const a=document.createDocumentFragment();i.forEach(o=>{const n=document.createElement("div");n.dataset.id=o.id,n.className=`unlockable-item clickable ${o.unlocked?"unlocked":"locked"} ${o.equipped?"equipped":""}`,n.onclick=()=>this.handleItemClick(o);let s="";if(o.equipped)s='<div class="item-status equipped">EQUIPPED</div>';else if(o.unlocked)s='<div class="item-status owned">OWNED</div>';else{const u=o.id==="stadium_night"||o.id==="stadium_retro"?"?":o.cost.toLocaleString();s=`
                    <div class="item-cost">
                        <img src="${Us}" style="width: 1.2em; height: 1.2em;">
                        <span style="color: #ffffff; margin-left: 4px;">${u}</span>
                    </div>`}const c=o.unlocked?"":`<div class="lock-overlay">
            <svg viewBox="0 0 12 14" xmlns="http://www.w3.org/2000/svg" style="shape-rendering: crispEdges; width: 100%; height: 100%;">
                <!-- Shackle (Silver) -->
                <rect x="3" y="0" width="6" height="1" fill="#C0C0C0"/>
                <rect x="2" y="1" width="1" height="4" fill="#C0C0C0"/>
                <rect x="9" y="1" width="1" height="4" fill="#C0C0C0"/>
                <!-- Body (Gold) -->
                <rect x="1" y="5" width="10" height="9" fill="#FFD700"/>
                <!-- Highlight -->
                <rect x="2" y="6" width="1" height="1" fill="#FFFFFF" opacity="0.5"/>
                <rect x="3" y="6" width="7" height="1" fill="#FFFFFF" opacity="0.5"/>
                <!-- Keyhole (Black) -->
                <rect x="5" y="8" width="2" height="3" fill="#000"/>
            </svg></div>`;let f="";o.type==="stadium"?f=this.getStadiumIcon(o):o.type==="bat"&&(f=this.getBatIcon(o)),n.innerHTML=`
                <div class="item-name">${o.name}</div>
                <div class="item-icon-container">
                    <div class="item-icon">${f}</div>
                    ${c}
                </div>
                <div class="item-footer">
                    ${s}
                </div>
            `,a.appendChild(n)}),t.appendChild(a)}handleItemClick(t){if(console.log(`[Unlockables] Clicked item: ${t.name}, Equipped: ${t.equipped}`),t.equipped){L.playItemAlreadyEquipped(),ne.vibrate("equipped");return}t.unlocked?this.equipItem(t):U.coins>=t.cost?this.purchaseItem(t):this.purchaseItem(t)}async purchaseItem(t){if(console.log(`[Unlockables] Attempting purchase: ${t.name} (${t.id})`),!U.deductCoinsLocal(t.cost)){L.playError(),ne.vibrate("locked"),console.log("[Unlockables] Purchase Failed: Insufficient Local Funds");return}t.unlocked=!0,this.saveProgress(),this.updateCoinDisplay(),this.renderItems(),L.playPurchase(),ne.vibrate("purchase"),console.log(`[Unlockables] Local Purchase Successful: ${t.name}`),this.syncPurchaseToServer(t)}async syncPurchaseToServer(t){const{supabaseService:i}=await Le(async()=>{const{supabaseService:o}=await Promise.resolve().then(()=>mi);return{supabaseService:o}},void 0,import.meta.url),a=i.getClient();if(!a){console.warn("[Unlockables] Offline. Queuing purchase for server sync."),this.queuePendingPurchase(t);return}try{const{data:o,error:n}=await a.rpc("purchase_item",{p_item_id:t.id,p_cost:t.cost,p_item_type:t.type});if(n){if(n.message?.includes("already owned")){console.log(`[Unlockables] Item ${t.id} already owned on server - OK`);return}console.warn("[Unlockables] Server Sync Failed:",n.message),this.queuePendingPurchase(t)}else console.log(`[Unlockables] Server Sync Success for ${t.id}. Server Bal: ${o.new_balance}`)}catch(o){console.error("[Unlockables] Sync RPC Exception",o),this.queuePendingPurchase(t)}}purchaseItemLocal(t){U.deductCoinsLocal(t.cost)?(t.unlocked=!0,this.saveProgress(),this.queuePendingPurchase(t),this.updateCoinDisplay(),this.renderItems(),L.playPurchase(),ne.vibrate("purchase"),console.log(`[Unlockables] Offline Purchase Successful: ${t.name}`)):(L.playError(),ne.vibrate("locked"),console.log("[Unlockables] Offline Purchase Failed: Insufficient Funds"))}queuePendingPurchase(t){const i=JSON.parse(Y.getItem("baseball_pending_purchases")||"[]");i.find(a=>a.id===t.id)||(i.push({id:t.id,cost:t.cost,type:t.type,timestamp:Date.now()}),Y.setItem("baseball_pending_purchases",JSON.stringify(i)),console.log(`[Unlockables] Queued purchase sync for ${t.name}`))}equipItem(t){L.playEquip(),ne.vibrate("light"),(t.type==="stadium"?this.stadiums:this.bats).forEach(o=>o.equipped=!1),t.equipped=!0,t.equipped=!0,this.saveProgress(),this.updateEquippedUI(t),t.type==="stadium"&&(t.theme==="SPACE"||t.theme==="HAUNTED"||t.theme==="BEACH")?(this.showLoadingOverlay(t.theme),requestAnimationFrame(()=>{setTimeout(()=>{if(t.theme&&X.setTheme(t.theme),t.theme==="HAUNTED"&&_a){const o=K||window.innerWidth,n=de||window.innerHeight;_a(o,n)}else if(t.theme==="SPACE"&&X.currentTheme.warmup){const o=K||window.innerWidth,n=de||window.innerHeight;X.currentTheme.warmup(o,n)}else if(t.theme==="BEACH"&&X.currentTheme.warmup){const o=K||window.innerWidth,n=de||window.innerHeight;X.currentTheme.warmup(o,n)}It(!1),Hi(),requestAnimationFrame(()=>{this.applyEquippedItem(t),t.type==="stadium"&&this.close(),setTimeout(()=>this.hideLoadingOverlay(),500)})},500)})):(this.applyEquippedItem(t),t.type==="stadium"&&this.close()),this.syncEquippedItem(t)}async syncEquippedItem(t){const{supabaseService:i}=await Le(async()=>{const{supabaseService:o}=await Promise.resolve().then(()=>mi);return{supabaseService:o}},void 0,import.meta.url),a=i.getClient();if(!a){console.warn("[Unlockables] Offline. Queuing equip for server sync."),this.savePendingEquip(t);return}try{const{data:{session:o}}=await a.auth.getSession();if(o){const{error:l}=await a.rpc("ensure_user_exists",{p_user_id:o.user.id});l&&console.error("[Unlockables] ensure_user_exists FAILED:",l)}console.log(`[Unlockables] Syncing equip: ${t.id}`);const{data:n,error:s}=await a.rpc("set_equipped_item",{p_item_id:t.id,p_item_type:t.type});if(s)console.warn(`[Unlockables] Equip Sync Network Error: ${s.message}`),this.savePendingEquip(t);else{console.log(`[Unlockables] Equip Sync Result: ${n}`);const l=String(n).match(/Equipped=(\d+)/);if((l?parseInt(l[1]):null)===0){console.warn("[Unlockables] Server missed equip (Item likely missing). Attempting Backfill..."),await this.syncPurchaseToServer(t),console.log(`[Unlockables] Retrying equip for ${t.id}...`);const{data:f}=await a.rpc("set_equipped_item",{p_item_id:t.id,p_item_type:t.type});console.log(`[Unlockables] Retry Result: ${f}`)}else n&&String(n).startsWith("Error")&&this.savePendingEquip(t)}}catch(o){console.error("[Unlockables] Equip Sync Exception",o),this.savePendingEquip(t)}}savePendingEquip(t){const i=`pending_equip_${t.type}`;Y.setItem(i,JSON.stringify({id:t.id,type:t.type,timestamp:Date.now()}))}applyEquippedItem(t){if(t.type==="bat"){let a={bat_default:"STANDARD",bat_blue:"BLUE",bat_gold:"GOLD",bat_laser:"LASER"}[t.id];a||(a=t.id),qe.setBat(a),Ps()}else if(t.type==="stadium"&&t.theme){if(X.setTheme(t.theme),r.gameActive=!1,r.isGameOver=!1,r.bossModeActive=!1,r.showFireworks=!1,r.showFireworks=!1,L.stopTheme(),ot&&ot.classList.remove("wiggle-active"),He){He.style.display="block";const i='<div class="game-title"><div class="title-line" data-text="PERFECT">PERFECT</div><div class="title-line" data-text="DERBY">DERBY</div></div><div class="subtitle pulse">TAP TO <span class="mobile-block">START</span></div>',a=document.getElementById("start-content");a?a.innerHTML=i:He.innerHTML=`<div id="start-content">${i}</div>`}It(!1),Hi()}}showLoadingOverlay(t){let i=document.getElementById("global-loading-overlay"),a="INITIALIZING SYSTEM";t==="HAUNTED"?a="SUMMONING SPIRITS":t==="SPACE"?a="INITIALIZING SPACE SYSTEMS":t==="BEACH"&&(a="WAXING SURFBOARDS"),i||(i=document.createElement("div"),i.id="global-loading-overlay",i.style.position="fixed",i.style.top="0",i.style.left="0",i.style.width="100%",i.style.height="100%",i.style.background="rgba(0,0,0,0.85)",i.style.color="#fff",i.style.zIndex="10000",i.style.display="flex",i.style.flexDirection="column",i.style.alignItems="center",i.style.justifyContent="center",i.style.fontFamily="var(--font-display, monospace)",i.style.fontSize="4vmin",document.body.appendChild(i)),i.innerHTML=`<div class="pulse">LOADING...</div><div class="subtitle" style="font-size: 0.5em; margin-top: 20px; color: #888;">${a}</div>`,i.style.display="flex",r.isLoading=!0}hideLoadingOverlay(){const t=document.getElementById("global-loading-overlay");t&&(t.style.display="none"),r.isLoading=!1}saveProgress(){const t={stadiums:this.stadiums.map(i=>({id:i.id,unlocked:i.unlocked,equipped:i.equipped})),bats:this.bats.map(i=>({id:i.id,unlocked:i.unlocked,equipped:i.equipped})),crateBats:this.crateBats.map(i=>({id:i.id,unlocked:i.unlocked,equipped:i.equipped})),coins:r.coins};Y.setItem("baseball_unlockables",JSON.stringify(t))}loadProgress(){Y.migrate("baseball_unlockables");const t=Y.getItem("baseball_unlockables");if(t)try{const i=JSON.parse(t);i.stadiums&&i.stadiums.forEach(a=>{const o=this.stadiums.find(n=>n.id===a.id);o&&(o.unlocked=a.unlocked,o.equipped=a.equipped,o.equipped&&o.theme&&X.setTheme(o.theme))}),i.bats&&i.bats.forEach(a=>{const o=this.bats.find(n=>n.id===a.id);if(o&&(o.unlocked=a.unlocked,o.equipped=a.equipped,o.equipped&&o.type==="bat")){const n={bat_default:"STANDARD",bat_blue:"BLUE",bat_gold:"GOLD",bat_laser:"LASER"};qe.setBat(n[o.id]||"STANDARD")}}),i.crateBats&&i.crateBats.forEach(a=>{const o=this.crateBats.find(n=>n.id===a.id);o&&(o.unlocked=a.unlocked,o.equipped=a.equipped,o.equipped&&(this.bats.forEach(n=>n.equipped=!1),this.crateBats.forEach(n=>{n!==o&&(n.equipped=!1)}),qe.setBat(o.id)))})}catch(i){console.warn("Failed to parse unlockables. Resetting.",i),Y.removeItem("baseball_unlockables")}}getStadiumIcon(t){const i=`icon-${t.id}`;if(this._iconDataUrlCache||(this._iconDataUrlCache={}),this._iconDataUrlCache[t.theme])return`<img src="${this._iconDataUrlCache[t.theme]}" draggable="false" style="width: 100%; height: 100%; border-radius: 1vmin; display: block; user-select: none; -webkit-user-drag: none; pointer-events: none;">`;requestAnimationFrame(()=>{const s=l0(t.theme).toDataURL();this._iconDataUrlCache[t.theme]=s;const l=document.getElementById(i);l&&(l.src=s)});const o={CLASSIC:"linear-gradient(135deg, #2d8a4e, #1a5c32)",BEACH:"linear-gradient(135deg, #87CEEB, #f4e4bc)",SPACE:"linear-gradient(135deg, #0a0a2e, #1a1a4e)",HAUNTED:"linear-gradient(135deg, #2d1b4e, #1a0a2e)",NIGHT:"linear-gradient(135deg, #1a1a3e, #0a0a1e)",RETRO:"linear-gradient(135deg, #8B7355, #654321)"}[t.theme]||"linear-gradient(135deg, #333, #666)";return`<img id="${i}" src="" draggable="false" style="width: 100%; height: 100%; border-radius: 1vmin; display: block; user-select: none; -webkit-user-drag: none; pointer-events: none; background: ${o};">`}getBatIcon(t){return`<img src="${this.getBatIconDataUrl(t)}" draggable="false" style="width: 100%; height: 100%; display: block; user-select: none; -webkit-user-drag: none; pointer-events: none;">`}updateEquippedUI(t){const i=t.type==="stadium"?Dn:da;Array.from(i.children).forEach(a=>{const o=a.dataset.id,n=a.querySelector(".item-footer");o===t.id?(a.classList.add("equipped"),n&&(n.innerHTML='<div class="item-status equipped">EQUIPPED</div>')):a.classList.contains("equipped")&&(a.classList.remove("equipped"),n&&(n.innerHTML='<div class="item-status owned">OWNED</div>'))})}}const ci=new T0,fn={url:"https://yfxamjivfbrzmdfipcyc.supabase.co",key:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InlmeGFtaml2ZmJyem1kZmlwY3ljIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjUyMjcyNDgsImV4cCI6MjA4MDgwMzI0OH0.SyFt2GpS82vFsSbsboG6e3t01CoXlDLPAnXn_THBGWs"},b0=Object.freeze(Object.defineProperty({__proto__:null,SUPABASE_CONFIG:fn},Symbol.toStringTag,{value:"Module"}));class v0{constructor(){this.client=null,this.initialized=!1,this.authPromise=null}init(){if(this.initialized)return this.client;if(window.supabase)try{this.client=window.supabase.createClient(fn.url,fn.key),this.initialized=!0,console.log("Supabase Service: Initialized"),this.authPromise=this.ensureAuth()}catch(t){console.error("Supabase Service: Failed to initialize",t)}else console.error("Supabase Service: SDK not loaded");return this.client}async ensureAuth(){if(!this.client)return;const{data:{session:t}}=await this.client.auth.getSession();if(!t){console.log("Supabase: Attempting Anonymous Sign-in...");const{data:i,error:a}=await this.client.auth.signInAnonymously();a?(console.warn("Supabase Anon Auth Failed:",a.message),a.message.includes("Anonymous sign-ins are disabled")&&console.error("Developer Action Required: Enable 'Anonymous Sign-ins' in Supabase Dashboard (Authentication -> Providers).")):console.log("Supabase: Signed in anonymously",i.user.id)}}async waitForAuth(){return this.initialized||this.init(),this.authPromise&&await this.authPromise,this.client}getClient(){return this.initialized?this.client:this.init()}}const ka=new v0,mi=Object.freeze(Object.defineProperty({__proto__:null,supabaseService:ka},Symbol.toStringTag,{value:"Module"})),Ma={getUserId(){const e=ka.getClient();if(e&&e.auth){const i=e.auth.session;if(i&&typeof i=="object"&&i.user){const a=i.user.id,o=localStorage.getItem("baseball_user_id");return o!==a&&(console.log(`[UserManager] Adopting Cloud ID: ${a} (Replacing ${o})`),localStorage.setItem("baseball_user_id",a)),a}}let t=localStorage.getItem("baseball_user_id");return t||(typeof crypto<"u"&&crypto.randomUUID?t=crypto.randomUUID():t="user_"+Math.random().toString(36).substr(2,9)+Date.now().toString(36),localStorage.setItem("baseball_user_id",t)),t}},C0="https://timeapi.io/api/Time/current/zone?timeZone=UTC",P0="https://cdnjs.cloudflare.com/ajax/libs/json3/3.3.2/json3.min.js",io="baseball_time_anchor";class Kt{static async fetchServerTime(){try{console.log("[TimeAnchor] Attempting Primary (TimeAPI.io)...");let t=await this.tryFetch(C0,"dateTime",!0);return this.isValidDate(t)?(this.updateAnchor(t),t):(console.log("[TimeAnchor] Primary API failed. Attempting Secondary (CDN Head Check)..."),t=await this.fetchHeadDate(P0),this.isValidDate(t)?(this.updateAnchor(t),t):(console.log("[TimeAnchor] Secondary failed. Using Supabase Connection..."),t=await this.fetchViaSupabase(),this.isValidDate(t)?(this.updateAnchor(t),t):(console.warn("[TimeAnchor] All Time Sources failed. Using Local Fallback."),null)))}catch(t){return console.warn("[TimeAnchor] Network Error",t.message),null}}static isValidDate(t){return!t||isNaN(t.getTime())?!1:t.getUTCFullYear()>=2025}static async fetchViaSupabase(){try{const{SUPABASE_CONFIG:t}=await Le(async()=>{const{SUPABASE_CONFIG:c}=await Promise.resolve().then(()=>b0);return{SUPABASE_CONFIG:c}},void 0,import.meta.url),i=`${t.url}/rest/v1/`,a=t.key;console.log("[TimeAnchor] Fetching time headers from Supabase...");const o=new AbortController,n=setTimeout(()=>o.abort(),5e3),s=await fetch(i,{method:"HEAD",headers:{apikey:a,Authorization:`Bearer ${a}`},cache:"no-store",signal:o.signal});if(clearTimeout(n),!s.ok)return null;const l=s.headers.get("Date");if(l){const c=new Date(l);if(this.isValidDate(c))return c;console.warn(`[TimeAnchor] Supabase returned invalid date string: ${l}`)}return null}catch(t){return console.warn("[TimeAnchor] Supabase Header Check Failed",t),null}}static async fetchHeadDate(t){try{const i=new AbortController,a=setTimeout(()=>i.abort(),3e3),o=await fetch(t+"?_cb="+Date.now(),{method:"HEAD",cache:"no-store",signal:i.signal});if(clearTimeout(a),!o.ok)return null;const n=o.headers.get("Date");if(n){const s=new Date(n);if(this.isValidDate(s))return s}return null}catch(i){return console.warn("[TimeAnchor] CDN Head Check Failed",i.message),null}}static async tryFetch(t,i,a=!0){try{const o=new AbortController,n=setTimeout(()=>o.abort(),5e3);let s=t;if(a){const u=t.includes("?")?"&":"?";s=`${t}${u}_cb=${Date.now()}`}const l=await fetch(s,{signal:o.signal,cache:"no-store"});if(clearTimeout(n),!l.ok)throw new Error(`API Error ${l.status}`);const c=await l.json();let f=c[i];if(f||(c.datetime?f=c.datetime:c.dateTime?f=c.dateTime:c.milliSeconds&&(f=c.milliSeconds)),!f)throw new Error("Invalid JSON format");typeof f=="string"&&f.includes("T")&&!f.endsWith("Z")&&!f.includes("+")&&(f+="Z");const d=new Date(f);if(!this.isValidDate(d))throw new Error(`Invalid Date Parsed: ${d.toISOString()}`);return d}catch(o){return console.warn(`[TimeAnchor] Fetch failed for ${t}:`,o.message),null}}static updateAnchor(t){if(!this.isValidDate(t))return;const i={serverTime:t.getTime(),deviceTime:Date.now(),verifiedAt:Date.now()};Y.setItem(io,JSON.stringify(i)),console.log(`[TimeAnchor] Security Lease Renewed: ${t.toISOString()}`)}static async getTrustedTime(){const t=Y.getItem(io);if(t){const i=JSON.parse(t),a=Date.now()-i.verifiedAt,o=2880*60*1e3;if(a<o&&a>-864e5){const n=Date.now()-i.deviceTime;return new Date(i.serverTime+n)}}return await this.fetchServerTime()}static async verifyOrFetch(t){let i=this.isDateAllowed(t);if(!i.allowed&&(i.reasonCode==="MISSING_ANCHOR"||i.reasonCode==="EXPIRED_ANCHOR"||i.reasonCode==="FUTURE_BLOCK")){console.log(`[TimeAnchor] Auto-repairing security check for ${t} (${i.reasonCode})...`);const a=await this.fetchServerTime();a?console.log(`[TimeAnchor] Repair successful. New Server Time: ${a.toISOString()}`):console.warn("[TimeAnchor] Repair FAILED. Could not fetch server time."),i=this.isDateAllowed(t)}return i}static isDateAllowed(t){Y.migrate(io);const i=Y.getItem(io);if(!i)return console.warn("TimeAnchor: No security lease found. Online verification required."),{allowed:!1,reason:"Please connect to internet to verify date.",reasonCode:"MISSING_ANCHOR"};const a=JSON.parse(i),o=Date.now()-a.verifiedAt,n=1440*60*1e3,s=2*n;if(o>s||o<-n)return console.warn("TimeAnchor: Security lease expired or invalid (future timestamp)."),{allowed:!1,reason:"Time synchronization error. Connect to verify.",reasonCode:"EXPIRED_ANCHOR"};const l=new Date(a.serverTime),c=l.getUTCFullYear(),f=String(l.getUTCMonth()+1).padStart(2,"0"),d=String(l.getUTCDate()).padStart(2,"0"),u=`${c}-${f}-${d}`,[h,g,m]=t.split("-").map(Number),p=Date.UTC(h,g-1,m),b=Date.UTC(c,Number(f)-1,Number(d)),v=(p-b)/n;return console.log(`[TimeAnchor] Target: ${t} (${p}) | Valid: ${u} (${b}) | Diff: ${v.toFixed(2)} days`),v>2.5?(console.warn(`[TimeAnchor] BLOCK: Future Date detected. Diff: ${v.toFixed(2)} > 2.5`),{allowed:!1,reason:"Future Date Blocked",reasonCode:"FUTURE_BLOCK"}):{allowed:!0}}}const zs=Object.freeze(Object.defineProperty({__proto__:null,TimeAnchorManager:Kt},Symbol.toStringTag,{value:"Module"}));class E0{constructor(){this.client=null,this.initialized=!1,this.queueKey="baseball_leaderboard_queue"}init(){if(!this.initialized)try{ka.init(),this.client=ka.getClient(),this.initialized=!0,console.log("LeaderboardManager: Supabase initialized (via Service)"),Kt.fetchServerTime(),this.syncScores(),this.processRetryQueue()}catch(t){console.error("LeaderboardManager: Failed to initialize",t)}}async syncScores(){if(!this.initialized)return;console.log("LeaderboardManager: Syncing scores...");const t=localStorage.getItem("baseball_username");if(!t)return;let i=parseInt(Y.getItem("baseball_high_score_s1","0"))||0;if(i===0){const n=await this.getUserEntry("leaderboard");n&&n.score>0&&(console.log(`LeaderboardManager: Restored High Score ${n.score} from cloud.`),i=n.score,Y.setItem("baseball_high_score_s1",i),U.highScore=i,r.highScore=i)}i>0&&await this.submitScore(t,i,"leaderboard");const a=ze.getDailySeed(),o=parseInt(Y.getItem(`baseball_daily_score_${a}`,"0"))||0;o>0&&await this.submitScore(t,o,"daily_leaderboard")}async submitScore(t,i,a="leaderboard",o=null){if(!this.initialized||!this.client)return{error:"Not initialized"};if(U.isTainted)return console.warn("LeaderboardManager: Submission REJECTED. Score is tainted (Dev Mode)."),{success:!0,ignored:!0,reason:"Tainted"};if(a==="daily_leaderboard"){const n=await Kt.fetchServerTime(),s=ze.getDailySeed();if(n){const l=n.getUTCFullYear(),c=String(n.getUTCMonth()+1).padStart(2,"0"),f=String(n.getUTCDate()).padStart(2,"0"),d=`${l}-${c}-${f}`;if(s>d)return console.error("Security Block: Attempted future score submission"),{error:"Future Date Blocked"}}else return console.warn("Security: Offline submission deferred."),{error:"Offline - Score Saved Locally",queued:!0}}try{const{data:{session:n}}=await this.client.auth.getSession();if(o||(a==="daily_leaderboard"?o=`daily_${ze.getDailySeed()}`:o="classic"),!n)return console.log("LeaderboardManager: Security: No Session (Offline). Deferring."),this.addToQueue(t,i,a,o),{error:"Offline (Deferred)",queued:!0};const s=Ma.getUserId(),l=await Kt.getTrustedTime(),c=l?l.getTime():Date.now(),f=Y.signPayload(s,i,c,o);console.log("LeaderboardManager: Submitting via Secure RPC...",{score:i,details:o});const d={p_user_id:s,p_username:t,p_score:i,p_timestamp:c,p_details:o,p_signature:f},{data:u,error:h}=await this.client.rpc("submit_score_secure",d);if(h)throw console.error("LeaderboardManager: RPC Error",h),h;return u&&!u.success?(console.warn("LeaderboardManager: Server rejected score:",u.error),{error:u.error}):{success:!0}}catch(n){return console.error("LeaderboardManager: Failed to submit score",n),this.addToQueue(t,i,a,o),{error:n.message,queued:!0}}}addToQueue(t,i,a,o){console.log("LeaderboardManager: Queuing score for later retry...");const n=JSON.parse(Y.getItem(this.queueKey)||"[]");n.some(l=>l.score===i&&l.table===a&&l.details===o)||(n.push({username:t,score:i,table:a,details:o,timestamp:Date.now()}),Y.setItem(this.queueKey,JSON.stringify(n)))}async processRetryQueue(){if(!this.initialized)return;const t=Y.getItem(this.queueKey);if(!t)return;let i=JSON.parse(t);if(i.length===0)return;console.log(`LeaderboardManager: Processing ${i.length} pending items...`);const a=[];for(const o of i)try{(await this.submitScoreInternal(o)).success?console.log(`LeaderboardManager: Recovered score ${o.score} on ${o.table}`):a.push(o)}catch{a.push(o)}a.length<i.length?Y.setItem(this.queueKey,JSON.stringify(a)):a.length===0&&Y.removeItem(this.queueKey)}async submitScoreInternal(t){try{return(await this.submitScore(t.username,t.score,t.table)).error?{success:!1}:{success:!0}}catch{return{success:!1}}}async getUserEntry(t="leaderboard",i=null){if(!this.initialized||!this.client)return null;const a=Ma.getUserId();try{let o=this.client.from(t).select("score, username, rank").select("score, username").eq("user_id",a).maybeSingle();t==="daily_leaderboard"&&i&&(o=o.eq("score_date",i));const{data:n,error:s}=await o;if(s)throw s;return n}catch(o){return console.error("LeaderboardManager: User entry fetch error",o),null}}async getLeaderboard(t=100,i="leaderboard",a=null){if(!this.initialized||!this.client)return{error:"Service Not Initialized"};try{let o=this.client.from(i).select("username, score, created_at, user_id").order("score",{ascending:!1}).limit(t);if(i==="daily_leaderboard"){let l=a;if(!l){const c=new Date,f=c.getUTCFullYear(),d=String(c.getUTCMonth()+1).padStart(2,"0"),u=String(c.getUTCDate()).padStart(2,"0");l=`${f}-${d}-${u}`}o=o.eq("score_date",l)}const{data:n,error:s}=await o;if(s)throw s;return n}catch(o){return console.error("LeaderboardManager: Fetch error",o),{error:o.message||"Unknown Error"}}}async getUserRank(t,i="leaderboard",a=null){if(!this.initialized||!this.client)return null;try{let o=this.client.from(i).select("*",{count:"exact",head:!0}).gt("score",t);if(i==="daily_leaderboard"){let h=a;if(!h){const g=new Date,m=g.getUTCFullYear(),p=String(g.getUTCMonth()+1).padStart(2,"0"),b=String(g.getUTCDate()).padStart(2,"0");h=`${m}-${p}-${b}`}o=o.eq("score_date",h)}const{count:n,error:s}=await o;if(s)throw s;let l=this.client.from(i).select("*",{count:"exact",head:!0});if(i==="daily_leaderboard"){let h=a;if(!h){const g=new Date,m=g.getUTCFullYear(),p=String(g.getUTCMonth()+1).padStart(2,"0"),b=String(g.getUTCDate()).padStart(2,"0");h=`${m}-${p}-${b}`}l=l.eq("score_date",h)}const{count:c,error:f}=await l;if(f)throw f;const d=n+1,u=c>0?(d/c*100).toFixed(1):0;return{rank:d,total:c,percentile:u}}catch(o){return console.error("LeaderboardManager: Rank fetch error",o),null}}flagSession(t){console.warn(`ðŸš¨ Leaderboard Manager: Cheating attempt logged - ${t}`);const i=JSON.parse(localStorage.getItem("baseball_cheat_flags")||"[]");i.push({reason:t,timestamp:Date.now(),userId:Ma.getUserId()}),localStorage.setItem("baseball_cheat_flags",JSON.stringify(i.slice(-10)))}}const di=new E0,Ao=Object.freeze(Object.defineProperty({__proto__:null,leaderboardManager:di},Symbol.toStringTag,{value:"Module"}));function bn(e,t="SECURITY ALERT"){console.log("[SecurityUI] Modal Requested:",e),Zn&&(Zn.innerText=t),jn&&(jn.textContent=e),ti&&(ti.style.display="flex",ti.style.pointerEvents="auto");try{L&&L.playError(),ne&&ne.vibrate("medium")}catch(o){console.warn("[SecurityUI] Sound error:",o)}const i=o=>{o&&(o.preventDefault(),o.stopPropagation()),ti&&(ti.style.display="none");try{L&&L.playSettingsClose()}catch{}},a=document.getElementById("security-close-btn")||kl;a&&(a.onclick=i),ti&&(ti.onclick=o=>{o.target===ti&&i(o)})}const w0=Object.freeze(Object.defineProperty({__proto__:null,showSecurityModal:bn},Symbol.toStringTag,{value:"Module"}));class R0{constructor(){this.isOpen=!1,this.username=localStorage.getItem("baseball_username")||null,this.pendingScore=null,this.pendingTable=null,this.isSyncing=!1,this.currentTab="all-time",this.init(),setTimeout(()=>this.syncLocalScore(),2e3),this.currentViewDate=new Date}init(){St.addEventListener("click",()=>this.open()),El.addEventListener("click",()=>this.close()),wl.addEventListener("click",()=>this.submitName()),Vt&&Vt.addEventListener("keydown",t=>{t.key==="Enter"&&(t.preventDefault(),this.submitName())}),Ki.addEventListener("click",t=>{t.target===Ki&&this.close()}),Vi&&Vi.addEventListener("click",()=>this.switchTab("all-time")),$i&&$i.addEventListener("click",()=>this.switchTab("daily")),Kn&&Kn.addEventListener("click",()=>this.changeDate(-1)),Ya&&Ya.addEventListener("click",()=>this.changeDate(1))}async changeDate(t){this.currentViewDate||(this.currentViewDate=new Date);const i=new Date(this.currentViewDate);i.setUTCDate(this.currentViewDate.getUTCDate()+t);const a=i.getUTCFullYear(),o=String(i.getUTCMonth()+1).padStart(2,"0"),n=String(i.getUTCDate()).padStart(2,"0"),s=`${a}-${o}-${n}`;if(t>0){const l=await Kt.verifyOrFetch(s);if(!l.allowed){bn(l.reason),console.log("Leaderboard Nav Blocked: Future Date");return}}this.currentViewDate.setUTCDate(this.currentViewDate.getUTCDate()+t),L&&L.playSettingsToggle(),this.updateDailyUI(),this.loadLeaderboard("daily"),this.updatePersonalBest()}open(t="all-time"){ne.vibrate("medium"),this.isOpen=!0,Ki.style.display="flex",r.isPaused=!0,Ta.style.display="none",si.style.display="none",jt.style.display="none",this.switchTab(t),this.syncLocalScore(),t==="daily"&&this.updateDailyUI(),L&&L.init().then(()=>{L.playUnlockablesOpen()})}close(){this.isOpen&&(ne.vibrate("medium"),this.isOpen=!1,Ki.style.display="none",!r.isGameOver&&r.gameActive&&(r.isPaused=!1),L&&L.playUnlockablesClose())}async updatePersonalBest(){let t=0,i="leaderboard",a=null;if(this.currentTab==="daily"){i="daily_leaderboard";const o=this.currentViewDate||new Date,n=o.getUTCFullYear(),s=String(o.getUTCMonth()+1).padStart(2,"0"),l=String(o.getUTCDate()).padStart(2,"0");a=`${n}-${s}-${l}`;const c=new Date;if(o.getUTCFullYear()===c.getUTCFullYear()&&o.getUTCMonth()===c.getUTCMonth()&&o.getUTCDate()===c.getUTCDate()){const d=ze.getDailySeed();t=parseInt(Y.getItem(`baseball_daily_score_${d}`,"0"))||0}else{const d=await di.getUserEntry(i,a);t=d?d.score:0}}else Le(()=>Promise.resolve().then(()=>_0),void 0,import.meta.url).then(o=>{}),t=parseInt(Y.getItem("baseball_high_score_s1","0"))||0;if(fa.textContent=t>0?t:"-",t>0){fa.textContent=`${t} (Loading...)`;const o=await di.getUserRank(t,i,a);o?o.rank<=100?fa.textContent=`${t} (#${o.rank})`:fa.textContent=`${t} (Top ${o.percentile}%)`:fa.textContent=t}}async loadLeaderboard(t="all-time"){if(this.currentTab===t&&(Va.style.display="none",Oo&&(Oo.style.display="none"),ha.style.display="none",Ni.style.display="block"),!this.username){this.currentTab===t&&(Ni.style.display="none",t==="all-time"&&(ha.style.display="flex",Vt&&Vt.focus()));return}let i="leaderboard",a=null;if(t==="daily"){i="daily_leaderboard";const n=this.currentViewDate||new Date,s=n.getUTCFullYear(),l=String(n.getUTCMonth()+1).padStart(2,"0"),c=String(n.getUTCDate()).padStart(2,"0");a=`${s}-${l}-${c}`}let o=await di.getLeaderboard(100,i,a);if(o&&!o.error){let n=0;const s=ze.getDailySeed();if(t==="daily"?(!this.currentViewDate||this.currentViewDate.toDateString()===new Date().toDateString())&&(n=parseInt(Y.getItem(`baseball_daily_score_${s}`,"0"))||0):n=parseInt(Y.getItem("baseball_high_score_s1","0"))||0,n>0){const l=Ma.getUserId();let c=!1;for(let f of o)if(f.user_id===l&&f.username===this.username){n>f.score&&(f.score=n,f.isOptimistic=!0),c=!0;break}if(!c){const f=o.length>0?o[o.length-1].score:-1;(o.length<100||n>f)&&o.push({rank:0,score:n,username:this.username,user_id:l,isOptimistic:!0})}o.sort((f,d)=>d.score-f.score),o.forEach((f,d)=>{f.rank=d+1}),o.length>100&&(o=o.slice(0,100))}}this.renderList(o,t)}renderList(t,i){let a=Va;if(i==="daily"&&(a=Oo),!a)return;if(this.currentTab===i?(Ni.style.display="none",a.style.display="flex",a.style.flexDirection="column"):a.style.display="none",a.innerHTML="",t&&t.error){a.innerHTML=`
                <div style="text-align:center; padding: 20px; color: #ff5555;">
                    SERVICE UNAVAILABLE<br>
                    <span style="font-size: 0.6em; color: #aaa;">${t.error.toUpperCase()}</span>
                </div>`;return}if(t===null){a.innerHTML=`
                <div style="text-align:center; padding: 20px; color: #ff5555;">
                    CONNECTION FAILED<br>
                    <span style="font-size: 0.8em; color: #aaa;">OFFLINE MODE</span>
                </div>`;return}if(!t||t.length===0){a.innerHTML='<div style="text-align:center; padding: 20px; color: #666;">NO SCORES YET</div>';return}const o=Ma.getUserId();t.forEach((n,s)=>{const l=s+1;let c="";l===1?c="gold":l===2?c="silver":l===3&&(c="bronze");const f=document.createElement("div");f.className=`leaderboard-row ${c}`;const d=n.user_id===o;let u=n.username;d&&(f.classList.add("current-user-row"),u+=" (YOU)",setTimeout(()=>{const p=f;p.isConnected&&p.scrollIntoView({behavior:"smooth",block:"nearest"})},100));const h=document.createElement("div");h.className="leaderboard-rank",h.textContent=`#${l}`;const g=document.createElement("div");g.className="leaderboard-name",g.textContent=u;const m=document.createElement("div");m.className="leaderboard-score",m.textContent=n.score.toLocaleString(),f.appendChild(h),f.appendChild(g),f.appendChild(m),a.appendChild(f)})}async submitName(){const t=Vt.value.trim().toUpperCase(),i=/^[A-Z]+$/,a=["NIG","FUK","CNT","KKK","ASS","CUM","FAG","WOP","JAP","POO","TIT","DIK","SEX","GAY","JEW","AZN","FCK","FUC","COC","COK","PEE","VAG","SHT","WTF","HIV","STD","LSD","GOD","DYK","FGT","NGR","PCP","XXX","GER"];if(t.length<1||!i.test(t)||a.includes(t)){Vt.classList.add("input-error"),Vt.classList.add("shake-animation"),setTimeout(()=>{Vt.classList.remove("input-error"),Vt.classList.remove("shake-animation")},500);return}this.username=t,localStorage.setItem("baseball_username",this.username),ne.vibrate("medium"),ha.style.display="none",Ni.style.display="block";try{await this.processPendingScore(),await this.syncLocalScore()}catch(o){console.error("Error during score submission flow:",o)}this.loadLeaderboard(this.currentTab)}async checkAndSubmitScore(t,i="leaderboard"){t<=0||(this.username?(console.log(`Submitting score: ${t} for ${this.username} on table: ${i}`),await di.submitScore(this.username,t,i)):(this.pendingScore=t,this.pendingTable=i,this.open()))}async processPendingScore(){if(this.pendingScore&&this.username){const t=this.pendingTable||"leaderboard";console.log(`Submitting PENDING score: ${this.pendingScore} for ${this.username} on table: ${t}`),await di.submitScore(this.username,this.pendingScore,t),this.pendingScore=null,this.pendingTable=null}}async syncLocalScore(){if(!this.username||this.isSyncing)return;const t=r.highScore;if(t>0){this.isSyncing=!0,console.log(`Attempting to sync local best (${t}) to server...`);try{await di.submitScore(this.username,t)}finally{this.isSyncing=!1}}}updateDailyUI(){if(!hi)return;const t=ze.getDailySeed(),i=r.lastDailyDate,a=this.currentViewDate||new Date;a.getUTCFullYear(),String(a.getUTCMonth()+1).padStart(2,"0");const o=String(a.getUTCDate()).padStart(2,"0"),n=new Date,s=a.getUTCFullYear()===n.getUTCFullYear()&&a.getUTCMonth()===n.getUTCMonth()&&a.getUTCDate()===n.getUTCDate();if(Yn){const l=a.toLocaleString("en-US",{month:"short",timeZone:"UTC"}).toUpperCase();Yn.innerText=`${l} ${o}`}Ya&&(Ya.style.visibility=s?"hidden":"visible"),hi&&(hi.style.display=s?"block":"none"),Zi&&(Zi.parentElement.style.visibility=s?"visible":"hidden"),s&&(bo&&(bo.innerText=r.dailyStreak),i!==t?(To.innerText="FREE",Zi.className="stat-value free",ui&&(ui.style.display="none")):(To.innerText="20",Zi.className="stat-value cost",ui&&(ui.style.display="block")))}switchTab(t){this.currentTab!==t&&L&&L.playSettingsToggle(),this.currentTab=t,Va&&(Va.style.display="none"),$a&&($a.style.display="none"),ha&&(ha.style.display="none"),Ni&&(Ni.style.display="none"),Vi&&(Vi.className="tab-btn"),$i&&($i.className="tab-btn"),t==="all-time"?(Vi&&Vi.classList.add("active"),this.loadLeaderboard("all-time")):t==="daily"&&($i&&$i.classList.add("active"),$a&&($a.style.display="flex"),this.currentViewDate=new Date,this.updateDailyUI(),this.loadLeaderboard("daily")),this.updatePersonalBest()}}const Zt=new R0;class M0{constructor(){this.boundHandleKeyDown=this.handleKeyDown.bind(this),this.boundHandleTouchStart=this.handleTouchStart.bind(this),this.boundHandleTouchEnd=this.handleTouchEnd.bind(this),this.boundHandleMouseDown=this.handleMouseDown.bind(this),this.boundHandleMouseUp=this.handleMouseUp.bind(this),this.boundHandleClick=this.handleClick.bind(this),this.lastPhysicalInputTime=0,this.touchStartX=0,this.touchStartY=0}markInput(){this.lastPhysicalInputTime=performance.now()}init(){window.addEventListener("keydown",t=>{this.markInput(),this.boundHandleKeyDown(t)}),window.addEventListener("keyup",t=>{this.markInput(),this.handleKeyUp(t)}),window.addEventListener("touchstart",t=>{this.markInput(),this.boundHandleTouchStart(t)},{passive:!1}),window.addEventListener("touchend",t=>{this.markInput(),this.boundHandleTouchEnd(t)},{passive:!1}),window.addEventListener("mousedown",t=>{this.markInput(),this.boundHandleMouseDown(t)}),window.addEventListener("mouseup",t=>{this.markInput(),this.boundHandleMouseUp(t)}),Ae&&Ae.addEventListener("click",t=>{t.stopPropagation(),ta()}),window.addEventListener("contextmenu",t=>t.preventDefault()),window.addEventListener("pointerdown",t=>{t.target.closest('button, .clickable, #settings-btn, #pause-btn, #unlockables-btn, #leaderboard-btn, .close-btn, input[type="checkbox"], #daily-prev-btn, #daily-next-btn, #message-overlay, .nav-arrow')&&ne.vibrate("light")})}handleKeyDown(t){if(!r.transitioning&&t.isTrusted&&!t.target.matches("input, textarea")){if(t.code==="Space"){if(r.isLoading||r.showTutorial)return;if(r.gameActive)!r.settings?.swingOnRelease&&!r.isPaused&&Ii();else if(He.style.display!=="none"){if(Rt.isOpen||ci.isOpen||ci.isOddsOpen||Zt.isOpen)return;L.init().then(()=>Si(r.isDailyChallenge,!1,"game_over"))}}if(t.code==="Escape"){if(Rt.isOpen){Rt.closeSettings();return}Ae.style.pointerEvents!=="none"&&ta()}if(t.code==="KeyP"){if(Rt.isOpen)return;Ae.style.pointerEvents!=="none"&&ta()}t.code==="KeyS"&&(Rt.isOpen?Rt.closeSettings():(r.isPaused||!r.gameActive)&&Rt.openSettings()),t.code==="KeyD"&&Ga&&(Ga.style.display==="none"?Ga.style.display="block":Ga.style.display="none")}}isUIClick(t){return t.closest("#pause-btn")||t.closest("#settings-btn")||t.closest("#settings-modal")||t.closest("#unlockables-btn")||t.closest("#unlockables-modal")||t.closest("#leaderboard-btn")||t.closest("#leaderboard-modal")||t.closest("#daily-retry-modal")||t.closest("#security-modal")||t.closest("#confirmation-modal")||t.closest("#crate-reveal-overlay")||t.closest("#crate-odds-modal")||t.closest("#feedback-btn")||t.closest("#coin-container")}handleTouchStart(t){if(r.transitioning||!t.isTrusted||this.isUIClick(t.target)||r.isLoading||(t.preventDefault(),t.touches&&t.touches.length>0&&(this.touchStartX=t.touches[0].clientX,this.touchStartY=t.touches[0].clientY),!r.gameActive)||r.showTutorial)return;!r.settings?.swingOnRelease&&!r.isPaused&&Ii()}handleTouchEnd(t){if(!r.transitioning&&t.isTrusted&&!this.isUIClick(t.target)){if(t.preventDefault(),!r.gameActive){const i=t.changedTouches[0].clientX,a=t.changedTouches[0].clientY;if(Math.hypot(i-this.touchStartX,a-this.touchStartY)<30){if(Rt.isOpen||ci.isOpen||ci.isOddsOpen||Zt.isOpen)return;L.init().then(()=>Si(r.isDailyChallenge,!1,"game_over"))}return}r.gameActive&&!r.showTutorial&&!r.isPaused&&r.settings?.swingOnRelease&&Ii()}}handleMouseDown(t){if(r.transitioning||!t.isTrusted||this.isUIClick(t.target)||r.isLoading)return;if(!r.gameActive){if(Rt.isOpen||ci.isOpen||ci.isOddsOpen||Zt.isOpen)return;L.init().then(()=>Si(r.isDailyChallenge,!1,"game_over"));return}if(r.showTutorial)return;!r.settings?.swingOnRelease&&!r.isPaused&&Ii()}handleMouseUp(t){r.transitioning||t.isTrusted&&(this.isUIClick(t.target)||r.gameActive&&!r.showTutorial&&!r.isPaused&&r.settings?.swingOnRelease&&Ii())}handleKeyUp(t){r.transitioning||t.code==="Space"&&r.gameActive&&!r.showTutorial&&!r.isPaused&&r.settings?.swingOnRelease&&Ii()}handleClick(t){}}const yo=new M0;class A0{#e=Math.floor(Math.random()*16777215);#s=0;#l=0;#d=0;#f=0;#a=0;#o=0;#S=0;#h=null;#p=null;#n=!1;#t=0;#i=0;#m=!1;#g=null;#y=null;_lastSyncTimestamp=0;constructor(){Y.migrate("baseball_coins"),Y.migrate("baseball_local_delta"),Y.migrate("baseball_local_perfects_delta");const t=ze.getDailySeed();Y.migrate(`baseball_daily_score_${t}`),this.#s=0^this.#e,this.#a=0^this.#e,this.#o=0^this.#e;const i=parseInt(Y.getItem("baseball_high_score_s1","0"))||0;this.#d=i^this.#e;const a=parseInt(Y.getItem(`baseball_daily_score_${t}`,"0"))||0;this.#f=a^this.#e;const o=parseInt(Y.getItem("baseball_coins","0"))||0;this.#l=o^this.#e;const n=parseInt(Y.getItem("baseball_local_delta")||"0");this.#t=n;const s=parseInt(Y.getItem("baseball_local_perfects_delta")||"0");this.#i=s;const l=Y.getItem("baseball_last_synced_balance");if(l!==null&&n===0){const c=parseInt(l)||0;this.#t=Math.max(0,o-c),this.#c(),Y.removeItem("baseball_last_synced_balance"),console.log(`[ScoreManager] Migrated from lastSynced (${c}) to localDelta (${this.#t})`)}this.startCoins=this.coins,this.initialHighScore=this.highScore,this.initialDailyHigh=this.dailyHighScore,this.fetchServerBalance()}async startSession(){return this.#y=null,this.#g=(async()=>{try{console.log("[ScoreManager] Session Tracking Disabled (Optimization)")}catch{console.warn("[ScoreManager] Failed to start server session (Offline?)")}return null})(),this.#g}get score(){return this.#s^this.#e}get coins(){return this.#l^this.#e}get strikes(){return this.#a^this.#e}get consecutivePerfectHits(){return this.#o^this.#e}get highScore(){return this.#d^this.#e}set highScore(t){this.#d=t^this.#e}get dailyHighScore(){return this.#f^this.#e}set dailyHighScore(t){this.#f=t^this.#e}reset(){this.#s=0^this.#e,this.#a=0^this.#e,this.#o=0^this.#e,this.startCoins=this.coins,this.#n=!1,this.sessionPerfects=0,this.initialHighScore=this.highScore;const t=ze.getDailySeed();Y.migrate(`baseball_daily_score_${t}`);const i=parseInt(Y.getItem(`baseball_daily_score_${t}`,"0"))||0;this.dailyHighScore=i,this.initialDailyHigh=i,this.updateScoreDisplay(),this.updateCoinDisplay(),Lt&&(Lt.style.display="none"),wi&&(wi.style.display="none")}get isTainted(){return this.#n}get localDelta(){return this.#t}#c(){Y.setItem("baseball_local_delta",this.#t.toString()),Y.setItem("baseball_local_perfects_delta",this.#i.toString())}#v(){this.#t=0,this.#i=0,this.#c()}#r(){const t=this.#s^this.#e,i=this.#l^this.#e,a=this.#d^this.#e,o=this.#f^this.#e,n=this.#a^this.#e,s=this.#o^this.#e;this.#e=Math.floor(Math.random()*16777215),this.#s=t^this.#e,this.#l=i^this.#e,this.#d=a^this.#e,this.#f=o^this.#e,this.#a=n^this.#e,this.#o=s^this.#e}registerHit(t){if(!r.gameActive&&!r.isGameOver)return;if(!r.gameActive){console.warn("Iron Umpire: Hit rejected (Game Not Active)");return}if(yo&&yo.lastPhysicalInputTime){const o=performance.now()-yo.lastPhysicalInputTime;if(o>2e3){console.warn(`Iron Umpire: Hit rejected (No recent input). Delta: ${o.toFixed(2)}ms`),o>5e3&&(this.isTainted=!0);return}}const i=performance.now();if(i-this.#S<100)return;this.#S=i;let a=0;if(t==="PERFECT"){let o=this.#o^this.#e;o++,this.#o=o^this.#e,a=1,o===2&&(a=2),o===3&&(a=3),o===4&&(a=4),o>=5&&(a=5),this.showPointsPopup(a,!0,r.settings?.noFlash),this.sessionPerfects||(this.sessionPerfects=0),this.sessionPerfects++,this.#i++,this.#c()}else t==="GOOD"&&(a=1,this.#o=0^this.#e,this.showPointsPopup(1,!1,r.settings?.noFlash));if(a>0){let o=this.#s^this.#e;o+=a,this.#s=o^this.#e,this.addCoins(a)}else this.#r();this.updateScoreDisplay(),this.updateCoinDisplay(),this.checkHighScore()}registerStrike(){let t=this.#a^this.#e;t++,this.#a=t^this.#e,this.#r()}resetStrikes(){this.#a=0^this.#e,this.#r()}setStrikes(t){this.#a=t^this.#e,this.#r()}setMultiplier(t){this.#o=t^this.#e,this.#r()}registerFoul(){this.#o=0^this.#e,this.#r()}async deductCoins(t,i="generic_spend"){if(this.coins<t)return console.warn(`[ScoreManager] Deduct Failed: Insufficient funds (Local=${this.coins} < ${t})`),!1;const{supabaseService:a}=await Le(async()=>{const{supabaseService:l}=await Promise.resolve().then(()=>mi);return{supabaseService:l}},void 0,import.meta.url),{showSecurityModal:o}=await Le(async()=>{const{showSecurityModal:l}=await Promise.resolve().then(()=>w0);return{showSecurityModal:l}},void 0,import.meta.url),n=a.getClient();if(!n){const l=this.deductCoinsLocal(t);return l&&this.#u(t,i),l}const{data:{user:s}}=await n.auth.getUser();if(!s){const l=this.deductCoinsLocal(t);return l&&this.#u(t,i),l}try{const{data:l,error:c}=await n.rpc("deduct_coins",{p_amount:t,p_reason:i});if(c){console.warn("[ScoreManager] Deduct Coins Failed:",c.message),console.warn("[ScoreManager] Falling back to local deduction...");const f=this.deductCoinsLocal(t);return f&&c.message!=="Insufficient funds"&&this.#u(t,i),f}if(l&&l.success)return console.log(`[ScoreManager] Deducted ${t} coins. New Bal: ${l.new_balance}`),this.setAuthoritativeBalance(l.new_balance),!0;if(l?.error==="Insufficient funds"){console.warn("[ScoreManager] Server says insufficient funds. Checking local...");const f=this.deductCoinsLocal(t);return f&&this.#u(t,i),f}return!1}catch(l){console.error("[ScoreManager] Deduct RPC Error",l),console.warn("[ScoreManager] Falling back to local deduction due to error...");const c=this.deductCoinsLocal(t);return c&&this.#u(t,i),c}}addCoins(t,i=!1){if(!t||t<=0)return;let a=this.#l^this.#e;a+=t,this.#l=a^this.#e,this.#t+=t,this.#c(),console.log(`[ScoreManager] addCoins(+${t}) -> Balance: ${a}, Delta: ${this.#t}${i?" (SILENT)":""}`),i||this.updateCoinDisplay(),this.#r(),this.saveCoins(!0)}deductCoinsLocal(t){let i=this.#l^this.#e;return i>=t?(i-=t,this.#l=i^this.#e,this.updateCoinDisplay(),this.#r(),this.saveCoins(!0),console.log(`[ScoreManager] Local Deduction: -${t}. Balance: ${i}`),!0):(console.warn(`[ScoreManager] Local Deduction Failed: Insufficient Funds (${i} < ${t})`),!1)}updateScoreDisplay(){Oe&&(Oe.innerText=`Score: ${this.score}`)}updateCoinDisplay(){lt&&(lt.innerText=`${this.coins}`),en&&(en.textContent=this.coins)}saveCoins(t=!1){if(r.coins=this.coins,this.#h&&clearTimeout(this.#h),t){Y.setItem("baseball_coins",this.coins),this.#h=null;return}this.#h=setTimeout(()=>{Y.setItem("baseball_coins",this.coins),this.#h=null},2e3)}checkHighScore(){if(r.isDailyChallenge){if(this.score>this.dailyHighScore){if(this.dailyHighScore=this.score,!this.#n){const i=`baseball_daily_score_${ze.getDailySeed()}`;Y.setItem(i,this.dailyHighScore)}return!0}return!1}return this.score>this.highScore?(this.score>this.initialHighScore&&this.score>1,this.highScore=this.score,r.highScore=this.highScore,this.#n||(this.#p&&clearTimeout(this.#p),this.#p=setTimeout(()=>{Y.setItem("baseball_high_score_s1",this.highScore),this.#p=null},2e3)),X.currentTheme&&X.currentTheme.id!=="SPACE"&&o0(),!0):!1}showPointsPopup(t,i=!1,a=!1){requestAnimationFrame(()=>{t>1&&Lt&&(Lt.innerText=`+${t}`,Lt.style.display="block",Lt.classList.remove("perfect-hit","perfect-hit-glitch"),a||(qe.currentBat.textEffectClass?Lt.classList.add(qe.currentBat.textEffectClass):Lt.classList.add("perfect-hit")),setTimeout(()=>{Lt.style.display="none",Lt.classList.remove("perfect-hit","perfect-hit-glitch")},1e3))})}animateCoinGain(t){const i=this.coins-(this.startCoins||0);if(i>0&&wi&&lt){wi.innerText=`+${i}`,wi.style.display="block";const a=this.startCoins||0;let o=a;const n=this.coins,s=1500,l=performance.now(),c=f=>{const d=f-l,u=Math.min(d/s,1),h=1-Math.pow(1-u,3);o=Math.floor(a+i*h),lt.innerText=`${o}`,u<1?requestAnimationFrame(c):(lt.innerText=`${n}`,setTimeout(()=>{wi.style.display="none",t&&t()},1e3))};requestAnimationFrame(c)}else t&&t()}hasNewRecord(){return this.highScore>this.initialHighScore&&this.score===this.highScore}async updateDailyStreak(){if(!r.isDailyChallenge||this.#n)return;const{TimeAnchorManager:t}=await Le(async()=>{const{TimeAnchorManager:h}=await Promise.resolve().then(()=>zs);return{TimeAnchorManager:h}},void 0,import.meta.url),a=await t.getTrustedTime()||new Date,o=ze.getDailySeed(a),n=Y.getItem("baseball_daily_streak_updated_date");if(n===o){console.log(`Daily Challenge: Streak already updated for ${o}. Current: ${r.dailyStreak}`);return}const s=Date.UTC(a.getUTCFullYear(),a.getUTCMonth(),a.getUTCDate()-1),l=new Date(s),c=l.getUTCFullYear(),f=String(l.getUTCMonth()+1).padStart(2,"0"),d=String(l.getUTCDate()).padStart(2,"0"),u=`${c}-${f}-${d}`;n===u?r.dailyStreak++:r.dailyStreak=1,r.lastDailyDate=o,Y.setItem("baseball_daily_streak",r.dailyStreak),Y.setItem("baseball_last_daily_date",r.lastDailyDate),Y.setItem("baseball_daily_streak_updated_date",o),console.log(`Daily Challenge: Streak updated to ${r.dailyStreak}`)}async validateStartupStreak(){const t=Y.getItem("baseball_daily_streak_updated_date");if(!r.dailyStreak||r.dailyStreak===0)return;if(!t&&!r.lastDailyDate){r.dailyStreak=0;return}const{TimeAnchorManager:i}=await Le(async()=>{const{TimeAnchorManager:g}=await Promise.resolve().then(()=>zs);return{TimeAnchorManager:g}},void 0,import.meta.url),o=await i.getTrustedTime()||new Date,n=ze.getDailySeed(o);if(t===n)return;const s=Date.UTC(o.getUTCFullYear(),o.getUTCMonth(),o.getUTCDate()-1),l=new Date(s),c=l.getUTCFullYear(),f=String(l.getUTCMonth()+1).padStart(2,"0"),d=String(l.getUTCDate()).padStart(2,"0"),u=`${c}-${f}-${d}`,h=t||r.lastDailyDate;h!==u&&h!==n&&(console.log(`Daily Challenge: Streak broken (Last: ${h}, Yest: ${u}). Visual Reset to 0.`),r.dailyStreak=0,Y.setItem("baseball_daily_streak",0))}#C(t){this.#n=!0,console.error(`ðŸš¨ Iron Umpire: Cheating attempt detected - ${t}`),typeof window<"u"&&Le(()=>Promise.resolve().then(()=>Ao),void 0,import.meta.url).then(i=>{const a=i.leaderboardManager;a&&a.flagSession&&a.flagSession(t)}).catch(()=>{console.warn("[Iron Umpire] Could not report to server")})}enableDevMode(t){return t==="iron_umpire_2026"?(this.#n=!0,console.log("%c[DEV MODE ENABLED] SCORES ARE NOW TAINTED.","color: red; font-weight: bold; font-size: 14px;"),he.innerText="DEV MODE ACTIVE",he.style.color="red",Le(()=>Promise.resolve().then(()=>Fo),void 0,import.meta.url).then(i=>{window.gameState=i.gameState,console.log("%c[DEV] gameState exposed to window","color: orange")}),window.testWalkOff=async(i="TECHNICIAN")=>{const o=(await Le(()=>Promise.resolve().then(()=>Fo),void 0,import.meta.url)).gameState;if(!o.gameActive){console.warn("[DEV] âŒ Start a game first!"),console.log("[DEV] Hint: Click 'PLAY BALL!' or run: document.querySelector('.start-btn').click()");return}o.isPaused&&(console.log("[DEV] Unpausing game..."),(await Le(()=>Promise.resolve().then(()=>U0),void 0,import.meta.url)).togglePause(),await new Promise(s=>setTimeout(s,100))),o.pitcher.nextPitcherId=i,o.pitcher.state="walk_off",o.pitcher.timer=0,o.balls=[],console.log(`[DEV] âœ… Triggering walk-off to ${i}`),console.log(`[DEV] Theme: ${window.themeManager?.currentTheme?.id||"UNKNOWN"}`),console.log(`[DEV] Walk-off type: ${window.themeManager?.currentTheme?.walkOffType||"CLASSIC"}`),console.log("[DEV] Watch the pitcher swim away!")},window.debugStatus=()=>{Le(()=>Promise.resolve().then(()=>Fo),void 0,import.meta.url).then(i=>{const a=i.gameState;console.log("=== ðŸŽ® GAME STATUS ==="),console.log(`Active: ${a.gameActive?"âœ…":"âŒ"}`),console.log(`Paused: ${a.isPaused?"â¸ï¸":"â–¶ï¸"}`),console.log(`Over: ${a.isGameOver?"ðŸ’€":"ðŸ”¥"}`),console.log(`Pitcher State: ${a.pitcher.state}`),console.log(`Pitcher ID: ${a.pitcher.id}`),console.log(`Theme: ${window.themeManager?.currentTheme?.id}`),console.log(`Walk-off Type: ${window.themeManager?.currentTheme?.walkOffType||"CLASSIC"}`),console.log("=====================")})},Le(()=>Promise.resolve().then(()=>p0),void 0,import.meta.url).then(i=>{window.themeManager=i.themeManager,window.THEMES=i.THEMES,console.log("%c[DEV] themeManager exposed to window","color: orange")}),!0):(console.warn("Access Denied"),!1)}setScore(t){if(!this.#n){console.warn("Iron Umpire: Score manipulation blocked. Dev mode not active.");return}this.#s=t^this.#e,this.updateScoreDisplay(),console.log(`[DEV] Score set to ${t}`)}get isTainted(){return this.#n}set isTainted(t){t===!0&&(this.#n=!0)}saveGame(){if(!r.gameActive||r.isGameOver){Y.removeItem("baseball_saved_game");return}const t={score:this.score,strikes:this.strikes,isDailyChallenge:r.isDailyChallenge,dailySeed:r.isDailyChallenge?ze.dailySeed:null,pitcher:{id:r.pitcher.id,skinColor:r.pitcher.skinColor,hatColor:r.pitcher.hatColor,gender:r.pitcher.gender,props:r.pitcher.props,scale:r.pitcher.scale},timestamp:Date.now()};Y.setItem("baseball_saved_game",JSON.stringify(t)),console.log("Game Saved Securely (Encrypted)")}loadGame(){const t=Y.getItem("baseball_saved_game");if(!t)return!1;try{const i=JSON.parse(t);if(Date.now()-i.timestamp>1440*60*1e3)return Y.removeItem("baseball_saved_game"),!1;if(i.isDailyChallenge){const a=ze.getDailySeed();if(i.dailySeed!==a)return Y.removeItem("baseball_saved_game"),!1;ze.setSeed(a),r.isDailyChallenge=!0,Oe.style.color="#FFD700"}else r.isDailyChallenge=!1,Oe.style.color="#fff";return this.#s=i.score^this.#e,this.#a=i.strikes^this.#e,r.gameActive=!0,r.isPaused=!0,r.isGameOver=!1,r.pitcher.id=i.pitcher.id,r.pitcher.skinColor=i.pitcher.skinColor,r.pitcher.hatColor=i.pitcher.hatColor,r.pitcher.gender=i.pitcher.gender,r.pitcher.props=i.pitcher.props,r.pitcher.scale=i.pitcher.scale||1,r.pitcher.state="IDLE",r.pitcher.timer=0,i}catch(i){return console.error("Failed to load secure save:",i),Y.removeItem("baseball_saved_game"),!1}}async fetchServerBalance(){if(this.#m){console.log("[ScoreManager] Sync already in progress - skipping");return}this.#m=!0;try{const{supabaseService:t}=await Le(async()=>{const{supabaseService:T}=await Promise.resolve().then(()=>mi);return{supabaseService:T}},void 0,import.meta.url),i=t.getClient();if(!i){console.log("[ScoreManager] Offline - skipping server sync");return}const{data:{session:a}}=await i.auth.getSession();if(!a){console.log("[ScoreManager] No session - skipping sync");return}const o=a.user,{data:n,error:s}=await i.from("user_stats").select("total_coins").eq("user_id",o.id).limit(1);if(s||!n||n.length===0){console.log("[ScoreManager] No user_stats found (New User?)");return}await this.#b(i);const{data:l,error:c}=await i.from("user_stats").select("total_coins").eq("user_id",o.id).limit(1);if(c)return;const f=l[0]?.total_coins||0,d=this.coins,u=this.#t,h=Y.getItem("baseball_pending_purchases");let g=0;if(h)try{const T=JSON.parse(h);Array.isArray(T)&&(g=T.reduce((R,S)=>R+(S.cost||0),0))}catch{}const m=Y.getItem("baseball_pending_deductions");let p=0;if(m)try{const T=JSON.parse(m);Array.isArray(T)&&(p=T.reduce((R,S)=>R+(S.amount||0),0))}catch{}const b=g+p,v=Math.max(0,f-b);console.log(`[ScoreManager] Sync: Server=${f}, Effective=${v}, Local=${d}, Delta=${u}, PendingTotal=${b}`);const y=Math.max(0,v+u);if(u===0){if(d===v){console.log("[ScoreManager] Sync: Already in sync");return}if(d>v){const T=d-v;console.log(`[ScoreManager] Pushing diff ${T}...`),await this.#T(T)}else b===0?(console.log(`[ScoreManager] Updating local to match server (${f})`),this.setAuthoritativeBalance(f)):console.log("[ScoreManager] Keeping local (pending transactions exist)");return}if(u>0||this.#i>0){console.log(`[ScoreManager] Pushing unsynchronized earnings (Coins: ${u}, Perfects: ${this.#i})...`);const T=await this.#T();T?(this.#t=Math.max(0,this.#t-T.coinsSynced),this.#i=Math.max(0,this.#i-T.perfectsSynced),this.#c(),console.log(`[ScoreManager] Push successful - deltas reduced (Synced Coins: ${T.coinsSynced})`)):console.warn("[ScoreManager] Push failed - deltas preserved for retry")}r.gameActive||(this.startCoins=this.coins),this._lastSyncTimestamp=Date.now()}catch(t){console.warn("[ScoreManager] Fetch Balance Warning:",t)}finally{this.#m=!1}}async#T(){const t=this.#t,i=this.#i;if(t<=0&&i<=0)return!1;const{supabaseService:a}=await Le(async()=>{const{supabaseService:n}=await Promise.resolve().then(()=>mi);return{supabaseService:n}},void 0,import.meta.url),o=a.getClient();if(!o)return!1;console.log(`[ScoreManager] Pushing offline delta (Coins: +${t}, Perfects: +${i}) to server...`);try{const{data:n,error:s}=await o.rpc("update_user_coins",{p_delta:t,p_perfects:i});if(s)throw s;return console.log("[ScoreManager] Delta Sync Success."),{coinsSynced:t,perfectsSynced:i}}catch(n){return console.error(`[ScoreManager] Delta Push Failed: ${n.message}`),null}}setAuthoritativeBalance(t){const i=t+this.#t;console.log(`[ScoreManager] Setting balance to: ${i} (Server: ${t} + Delta: ${this.#t})`),this.#l=i^this.#e,this._lastSyncTimestamp=Date.now(),r.gameActive||(this.startCoins=i),this.#r(),this.updateCoinDisplay(),this.saveCoins()}#u(t,i){const a=Y.getItem("baseball_pending_deductions")||"[]";let o=[];try{o=JSON.parse(a)}catch{o=[]}o.push({amount:t,reason:i,timestamp:Date.now()}),Y.setItem("baseball_pending_deductions",JSON.stringify(o)),console.log(`[ScoreManager] Queued pending deduction: -${t} (${i})`)}async#b(t){const i=Y.getItem("baseball_pending_deductions");if(!i)return 0;let a=[];try{a=JSON.parse(i)}catch{return 0}if(a.length===0)return 0;console.log(`[ScoreManager] Syncing ${a.length} pending deductions...`);const o=[];let n=0;for(const s of a)try{const{data:l,error:c}=await t.rpc("deduct_coins",{p_amount:s.amount,p_reason:s.reason||"sync_deduction"});c?(console.warn(`[ScoreManager] Failed to sync deduction ${s.amount}: ${c.message}`),o.push(s)):n+=s.amount}catch(l){console.error("Error syncing deduction",l),o.push(s)}return o.length<a.length&&Y.setItem("baseball_pending_deductions",JSON.stringify(o)),o.length===0&&Y.removeItem("baseball_pending_deductions"),n}async syncSession(){const t=this.coins-(this.startCoins||0),i=this.#t,a=Math.max(t,i);if(a<=0){console.log("[ScoreManager] No earnings to sync");return}console.log(`[ScoreManager] Syncing Session: SessionEarnings=${t}, Delta=${i}, Pushing=${a}`),this.#g&&(console.log("Waiting for Session Handshake..."),await this.#g),this.#y;const{supabaseService:o}=await Le(async()=>{const{supabaseService:s}=await Promise.resolve().then(()=>mi);return{supabaseService:s}},void 0,import.meta.url),n=o.getClient();if(!n){console.warn("[ScoreManager] Sync Skipped: No RPC Client (Offline?)");return}try{const s=Y.hash("gameplay_trace",`${this.score}-${this.#e}-${Date.now()}`),l=Math.floor((r.activeSessionTime||0)/1e3),c=this.sessionPerfects||0,{data:f,error:d}=await n.rpc("update_user_coins",{p_delta:a,p_perfects:c});if(d)throw d;const u=typeof f=="number"?f:f?.new_balance;u!=null?(console.log("[ScoreManager] Session Sync Success. Server Balance:",u),this.#t=Math.max(0,this.#t-a),this.#i=Math.max(0,this.#i-c),this.#c(),this.startCoins=this.coins,this.sessionPerfects=0,this.#y=null):console.warn("[ScoreManager] Sync Rejected: Invalid Data",f)}catch(s){console.error("[ScoreManager] Sync RPC Failed",s)}}}window.enableDevTools=e=>U.enableDevMode(e);window.setGameScore=e=>U.setScore(e);const U=new A0;window.__addCoins=e=>{console.warn("ðŸš¨ Iron Umpire: Honeypot triggered"),U.isTainted=!0,console.error("ðŸš¨ Iron Umpire: Cheating attempt detected - honeypot_coins"),Le(()=>Promise.resolve().then(()=>Ao),void 0,import.meta.url).then(t=>{t.leaderboardManager.flagSession&&t.leaderboardManager.flagSession("honeypot_coins")})};window.__setScore=e=>{console.warn("ðŸš¨ Iron Umpire: Honeypot triggered"),U.isTainted=!0,console.error("ðŸš¨ Iron Umpire: Cheating attempt detected - honeypot_score"),Le(()=>Promise.resolve().then(()=>Ao),void 0,import.meta.url).then(t=>{t.leaderboardManager.flagSession&&t.leaderboardManager.flagSession("honeypot_score")})};window.__unlockAll=()=>{console.warn("ðŸš¨ Iron Umpire: Honeypot triggered"),U.isTainted=!0,console.error("ðŸš¨ Iron Umpire: Cheating attempt detected - honeypot_unlock"),Le(()=>Promise.resolve().then(()=>Ao),void 0,import.meta.url).then(e=>{e.leaderboardManager.flagSession&&e.leaderboardManager.flagSession("honeypot_unlock")})};const _0=Object.freeze(Object.defineProperty({__proto__:null,scoreManager:U},Symbol.toStringTag,{value:"Module"})),Eo=new hn(()=>({x:0,y:0,startX:0,startY:0,size:10,speedY:0,speedX:0,baseSpeedY:0,type:"FASTBALL",timeAlive:0,active:!1,hasPaused:!1,pauseTimer:0,invisible:!1,rotationAngle:0,rotationSpeed:0,prevRotationAngle:0,strikeCounted:!1,curveDirection:1,hit:!1,spin:0,trail:[]}),(e,t,i,a,o,n,s,l)=>{e.x=t,e.y=i,e.prevX=t,e.prevY=i,e.startX=t,e.startY=i,e.size=10,e.speedY=o,e.speedX=n,e.baseSpeedY=o,e.type=a,e.timeAlive=0,e.active=!0,e.hasPaused=!1,e.pauseTimer=0,e.invisible=!1,e.rotationAngle=0,e.prevRotationAngle=0,e.rotationSpeed=s,e.strikeCounted=!1,e.curveDirection=l,e.hit=!1,e.spin=0,e.hitType=null,e.trail.length=0},20);function I0(){r.balls.forEach(e=>Eo.release(e)),r.balls.length=0}const k0={update:(e,t,i)=>{const a=e/16.667;for(let o=r.balls.length-1;o>=0;o--){const n=r.balls[o];if(n.hit&&n.hitType==="PERFECT"&&qe.currentBat.id==="GLITCH"?(n.trail.push({x:n.x,y:n.y}),n.trail.length>5&&n.trail.shift()):n.trail.length>0&&(n.trail.length=0),n.hit)n.prevX=n.x,n.prevY=n.y,n.prevRotationAngle=n.rotationAngle,n.x+=n.speedX,n.y+=n.speedY,n.invisible=!1,n.spin&&(n.speedX+=n.spin*a),n.rotationAngle+=n.rotationSpeed*3*a;else{if(n.timeAlive+=e,n.prevX=n.x,n.prevY=n.y,n.prevRotationAngle=n.rotationAngle,Jn[n.type]&&Jn[n.type](n,e))continue;n.rotationAngle+=n.rotationSpeed*a,n.y+=n.speedY,!n.hit&&!n.strikeCounted&&n.y>r.bat.pivotY+60&&(n.strikeCounted=!0,r.lastPitchResult="STRIKE",U.registerStrike(),U.registerFoul(),he.innerText="STRIKE!",he.className="foul-text",L.playStrike(),i&&i(!0),r.consecutiveFouls=0,U.strikes>=3?t&&t("STRIKE_OUT"):setTimeout(()=>{he.innerText.includes("STRIKE")&&(he.innerText="",he.className="")},1e3))}if(n.timeAlive>1e4){Eo.release(n),r.balls.splice(o,1);continue}(n.y>de||n.y<-50||n.x<-50||n.x>K+50)&&(Eo.release(n),r.balls.splice(o,1),r.balls.length===0&&i&&i(!0))}}},ao=new hn(()=>({x:0,y:0,vx:0,vy:0,color:"#fff",alpha:1,decay:.01,gravity:.05,active:!1}),(e,t,i,a)=>{e.x=t,e.y=i,e.color=a;const o=Math.random()*Math.PI*2,n=Math.random()*3+1;e.vx=Math.cos(o)*n,e.vy=Math.sin(o)*n,e.alpha=1,e.decay=Math.random()*.015+.005,e.gravity=.05,e.active=!0},500),Jo=new hn(()=>({x:0,y:0,targetY:0,speed:6,color:"#fff",exploded:!1,active:!1,trail:[]}),(e,t,i)=>{e.x=t,e.y=Ut.height,e.targetY=i,e.speed=6;const a=["#ff0000","#00ff00","#0000ff","#ffff00","#ff00ff","#00ffff","#ffffff"];e.color=a[Math.floor(Math.random()*a.length)],e.exploded=!1,e.active=!0,e.trail.length=0},10),_t={fireworks:[],particles:[],timer:0,interval:500,reset(){this.fireworks.forEach(e=>Jo.release(e)),this.particles.forEach(e=>ao.release(e)),this.fireworks.length=0,this.particles.length=0,this.timer=this.interval},update(e,t=!0){const i=X.currentTheme&&X.currentTheme.id==="SPACE";if(this.timer+=e,t&&!i&&this.timer>this.interval){this.timer=0;const a=Math.random()*Ut.width,o=Math.random()*(Ut.height/2),n=Jo.get(a,o);this.fireworks.push(n)}for(let a=this.fireworks.length-1;a>=0;a--){const o=this.fireworks[a];if(!o.exploded){o.y-=o.speed,o.trail.push({x:o.x,y:o.y,alpha:1}),o.trail.length>8&&o.trail.shift();for(let n of o.trail)n.alpha-=.15;o.y<=o.targetY&&(o.exploded=!0,this.spawnParticles(o.x,o.y,o.color),L.playFirework(),Jo.release(o),this.fireworks.splice(a,1))}}for(let a=this.particles.length-1;a>=0;a--){const o=this.particles[a];if(o.x+=o.vx,o.y+=o.vy,o.vy+=o.gravity,o.alpha-=o.decay,o.alpha<=0){ao.release(o);const n=this.particles[this.particles.length-1];this.particles[a]=n,this.particles.pop()}}},spawnParticles(e,t,i){if(!(this.particles.length>300))for(let a=0;a<50;a++){const o=ao.get(e,t,i);this.particles.push(o)}},spawnImpactParticles(e,t,i="#ffffff"){for(let a=0;a<15;a++){const o=ao.get(e,t,i);o.vx*=1.5,o.vy*=1.5,o.decay=.05,this.particles.push(o)}},draw(){for(const e of this.fireworks)if(!e.exploded){for(const t of e.trail)C.globalAlpha=Math.max(0,t.alpha),C.fillStyle=e.color,C.fillRect(t.x-1,t.y-1,3,3);C.globalAlpha=1,C.fillStyle=e.color,C.fillRect(e.x-2,e.y-2,5,5)}if(this.particles.length>0){let e="",t=-1;C.beginPath();for(const i of this.particles){if(i.alpha<=.01)continue;i.color!==e&&(e=i.color,C.fillStyle=e);const a=Math.round(i.alpha*20)/20;a!==t&&(t=a,C.globalAlpha=t),C.fillRect(i.x|0,i.y|0,3,3)}C.globalAlpha=1}}};class D0{checkCollisions(t,i,a){if(r.bat.swinging)for(let o=r.balls.length-1;o>=0;o--){const n=r.balls[o];if(!n.active)continue;const s=n.x-r.bat.pivotX,l=n.y-r.bat.pivotY,c=s*s+l*l,f=Math.atan2(l,s);let d=r.bat.angle%(Math.PI*2);d>Math.PI&&(d-=Math.PI*2);let u=Math.abs(d-f);u>Math.PI&&(u=Math.PI*2-u);const h=u<1.2,g=ke.BAT_LENGTH+20,m=ke.BAT_LENGTH-5,p=ke.BAT_LENGTH+8,b=ke.BAT_LENGTH-25,v=c>0&&c<g*g,y=!0,T=n.x>r.bat.pivotX-10,R=n.y<r.bat.pivotY+30;if(h&&v&&y&&T&&R){n.active=!1,a(!0),n.strikeCounted&&(U.setStrikes(U.strikes-1),n.strikeCounted=!1,r.gameActive||(r.gameActive=!0,He.style.display="none",Oe.style.display="block",L.stopTheme()));const S=r.bat.angle,P=c>=b*b&&c<m*m,w=c>=m*m&&c<p*p,E=c>=p*p&&c<g*g,M=S<.5&&S>-3,D=P&&M||w||E,I=12*(t/16.667),H=.08;if(D){let k;const O=(Math.random()-.5)*.4;if(E){const W=(Math.random()-.5)*.4;k=Xa+.15+W,he.innerText="GOOD HIT!",he.className=""}else if(w){const W=(Math.random()-.5)*.3;k=Go+W,he.innerText="PERFECT HIT!",he.className="perfect-hit"}else{let Z=(Math.max(-2,Math.min(.5,S))- -1)/(.5- -1);Z=Math.max(0,Math.min(1,Z)),k=Go+Z*(qa-Go),k+=O,he.innerText="GOOD HIT!",he.className=""}k=Math.max(Xa+H,Math.min(qa-H,k)),n.speedX=Math.cos(k)*I,n.speedY=Math.sin(k)*I,w?(r.lastPitchResult="HIT",n.hitType="PERFECT",U.registerHit("PERFECT"),requestAnimationFrame(()=>{if(ne.vibrate("perfect"),qe.currentBat.id==="GOLD"&&_t.spawnImpactParticles(n.x+n.size/2,n.y+n.size/2,"#ffd700"),he.innerText="PERFECT HIT!",r.settings?.noFlash)he.className="";else{const W=qe.currentBat.textEffectClass;W?(he.className=W,qe.currentBat.id==="GLITCH"&&un.triggerEffect("GLITCH_PERFECT")):he.className="perfect-hit"}L.playPerfectHit(qe.currentBat.id),r.perfectHitTimer=1500}),U.consecutivePerfectHits>=3):(r.lastPitchResult="HIT",n.hitType="GOOD",U.registerHit("GOOD"),he.innerText="GOOD HIT!",he.className="",he.className="",L.playHit(),ne.vibrate("good")),r.consecutiveFouls=0,U.updateScoreDisplay(),U.checkHighScore(),setTimeout(()=>{he.innerText.includes("HIT")&&(he.innerText="",he.className="")},1e3)}else{if(r.lastPitchResult="FOUL",U.registerFoul(),r.consecutiveFouls++,r.consecutiveFouls>=4){L.playBatBreak(),L.playBatBreak(),ne.vibrate("failure"),document.body.style.animation="shake 0.5s cubic-bezier(.36,.07,.19,.97) both",setTimeout(()=>{document.body.style.animation=""},500),he.innerText="BAT BROKEN!",he.className="foul-text",setTimeout(()=>{i&&i("BAT_BROKEN")},500),n.speedX=0,n.speedY=5,n.hit=!0;return}let k;const O=Math.random();if(O<.3){const W=.08+Math.random()*.05;Math.random()>.5?(k=qa+W,n.spin=.03+Math.random()*.03):(k=Xa-W,n.spin=-(.03+Math.random()*.03))}else if(O<.7){const W=.25+Math.random()*.5;Math.random()>.5?(k=qa+W,n.spin=.05+Math.random()*.05):(k=Xa-W,n.spin=-(.05+Math.random()*.05))}else Math.random()>.5?(k=.2+Math.random()*1,n.spin=.02):(k=Math.PI-(.2+Math.random()*1),n.spin=-.02);n.speedX=Math.cos(k)*I,n.speedY=Math.sin(k)*I,L.playHit(),ne.vibrate("foul"),setTimeout(()=>{L.playFoul();let W="FOUL";S>-1.3?W="FOUL<br>(LATE SWING)":S<-1.8&&(W="FOUL<br>(EARLY SWING)"),he.innerHTML=W,he.className="foul-text",U.strikes<2&&U.registerStrike()},600),setTimeout(()=>{he.innerText.includes("FOUL")&&(he.innerText="",he.className="")},2e3)}n.hit=!0;break}}}}const L0=new D0;class O0{update(t){if(!r.isDailyChallenge){const i=dn(U.score);i&&i.id!==r.pitcher.id&&r.pitcher.state===Re.IDLE&&r.balls.length===0&&(r.pitcher.nextPitcherId=i.id,r.pitcher.state=Re.WALK_OFF,r.pitcher.timer=0,U.score<300&&(U.setStrikes(0),r.consecutiveFouls=0,r.balls.length>0&&(r.balls=[]),he.innerHTML="<div style='width:100%; text-align:center'>STRIKES</div><div style='width:100%; text-align:center'>CLEARED!</div>",he.className="strikes-cleared",he.style.color="#FFD700",It(!1),L.playStrikesCleared&&L.playStrikesCleared(),setTimeout(()=>{he.innerText.includes("STRIKES")&&(he.innerText="",he.className="",he.style.color="")},4e3)))}r.startMessage&&r.startMessage.active&&r.pitcher.state!==Re.WALK_ON&&r.pitcher.state!==Re.WALK_OFF||(r.pitcher.state===Re.IDLE?this.handleIdle(t):r.pitcher.state===Re.WALK_OFF?this.handleWalkOff(t):r.pitcher.state===Re.WALK_ON?this.handleWalkOn(t):r.pitcher.state===Re.WINDUP?this.handleWindup(t):r.pitcher.state===Re.BACKFLIP&&this.handleBackflip(t))}handleIdle(t){let i=0;if(r.totalPitches===0?i=1500:(r.lastPitchResult==="STRIKE"||r.lastPitchResult==="FOUL")&&(i=1e3),r.pitcher.timer>i){if(r.pitcher.state=Re.WINDUP,Fi(!1),r.pitcher.timer=0,r.totalPitches++,r.totalPitches>1&&(r.showTutorial=!1,r.tutorialSeen=!0),(r.totalPitches===1||U.score===0)&&!r.tutorialSeen&&!r.isDailyChallenge)r.pitcher.nextPitch=F.CURVEBALL,r.pitcher.windupDuration=4e3;else{const o=dn(U.score);if(o&&r.pitcher.freshArm)o.id==="TECHNICIAN"?(r.pitcher.nextPitch=F.STOPBALL,r.pitcher.freshArm=!1):o.id==="ACE"?(r.pitcher.nextPitch=F.SUPER_CURVE,r.pitcher.freshArm=!1):o.id==="SCARY"?(r.pitcher.nextPitch=F.GHOST_STOP,r.pitcher.freshArm=!1):r.pitcher.nextPitch=Gs(o,U.score,r.isDailyChallenge);else if(r.isDailyChallenge){const n=Object.keys(Ji);r.pitcher.nextPitch=Gi.choice(n)}else r.pitcher.nextPitch=Gs(o,U.score)}const a=Ji[r.pitcher.nextPitch];r.showTutorial||(r.pitcher.windupDuration=a.windupDuration||1e3),a.chargeSound&&L[a.chargeSound]&&L[a.chargeSound]()}}handleWalkOff(t){r.pitcher.timer+=t;const i=X.currentTheme.walkOffType;if(i==="FLY_AWAY"){r.pitcher.x-=.2*t;const a=Math.PI*2/1200;r.pitcher.rotation=(r.pitcher.rotation||0)-a*t,r.pitcher.y=150+Fe+Math.sin(r.pitcher.timer/100)*10,r.pitcher.flyAwayTriggered||(L.playWoosh&&L.playWoosh(),r.pitcher.flyAwayTriggered=!0)}else if(i==="SWIM"){const a=-Math.PI/2,o=r.pitcher.rotation||0;Math.abs(o-a)>.1?r.pitcher.rotation=o+(a-o)*.1:r.pitcher.rotation=a,r.pitcher.x-=.15*t,r.pitcher.y=150+Fe+Math.sin(r.pitcher.timer/300)*15,r.pitcher.rotation+=Math.sin(r.pitcher.timer/150)*.1}else r.pitcher.x-=.18*t,r.pitcher.rotation=0,Math.floor(r.pitcher.timer/160)%2===0?(r.pitcher.y=150+Fe-2,r.pitcher.stepTriggeredOff||(r.pitcher.gender==="FEMALE"&&L.playLightStep?L.playLightStep():r.pitcher.id==="XXX"&&L.playThud?L.playThud():L.playNormalStep&&L.playNormalStep(),r.pitcher.stepTriggeredOff=!0)):(r.pitcher.y=150+Fe+2,r.pitcher.stepTriggeredOff=!1);r.pitcher.x<-100&&this.transitionToNextPitcher()}transitionToNextPitcher(){r.pitcher.state=Re.WALK_ON,r.pitcher.x=K+50,r.pitcher.timer=0;const t=Sn.find(i=>i.id===r.pitcher.nextPitcherId);t?(r.pitcher.id=t.id,r.pitcher.freshArm=!0,r.pitcher.skinColor=t.visuals.skinColor,r.pitcher.gender=t.visuals.gender,r.pitcher.scale=t.visuals.scale||1,r.pitcher.hatColor=t.visuals.hatColor,r.pitcher.shoeColor=t.visuals.shoeColor,r.pitcher.walkSpeed=t.visuals.walkSpeed||.18,r.pitcher.props={sunglasses:t.visuals.sunglasses,beard:t.visuals.beard,goldChain:t.visuals.goldChain,hatColor:t.visuals.hatColor,shoeColor:t.visuals.shoeColor},r.pitcher.flyAwayTriggered=!1,r.pitcher.rotation=0,r.bossModeActive=t.id!=="ROOKIE"):(r.pitcher.id="ROOKIE",r.pitcher.skinColor="#ffccaa",r.pitcher.gender="MALE",r.pitcher.scale=1,r.bossModeActive=!1)}handleWalkOn(t){r.pitcher.timer+=t;let i=r.pitcher.walkSpeed||.18,a=160;r.pitcher.id==="SCARY"&&(a=300),r.pitcher.x-=i*t,Math.floor(r.pitcher.timer/a)%2===0?(r.pitcher.y=150+Fe-2,r.pitcher.stepTriggeredOn||(r.pitcher.id==="SCARY"?this.playWalkSound():r.pitcher.gender==="FEMALE"&&L.playLightStep?L.playLightStep():r.pitcher.id==="XXX"&&L.playThud?L.playThud():L.playNormalStep&&L.playNormalStep(),r.pitcher.stepTriggeredOn=!0)):(r.pitcher.y=150+Fe+2,r.pitcher.stepTriggeredOn=!1),r.pitcher.x<=K/2-r.pitcher.width/2&&(r.pitcher.x=K/2-r.pitcher.width/2,r.pitcher.state=Re.IDLE,r.pitcher.timer=-1e3,(r.pitcher.id==="TECHNICIAN"||r.pitcher.id==="ACE")&&(r.bossModeActive=!0),this.playEntranceEffects())}playWalkSound(){if(r.pitcher.id==="SCARY"){const t=document.getElementById("game-container");t&&(t.classList.remove("shake-screen"),t.offsetWidth,t.classList.add("shake-screen")),L.playThud&&L.playThud(),ne.vibrate("bossStep")}else r.pitcher.id==="ACE"?L.playAceStep&&L.playAceStep():r.pitcher.gender==="FEMALE"?L.playLightStep&&L.playLightStep():L.playNormalStep&&L.playNormalStep()}playEntranceEffects(){r.pitcher.id==="ACE"?(L.playAceEntrance&&L.playAceEntrance(),r.aceFlashStartTime=performance.now()):r.pitcher.gender==="FEMALE"?(document.body.classList.add("sparkle-effect"),L.playCheer&&L.playCheer(),setTimeout(()=>{document.body.classList.remove("sparkle-effect")},1500)):r.pitcher.id==="SCARY"?(r.pitcher.skinColor="#000000",document.body.classList.add("fracture-effect"),L.playRoar&&L.playRoar(),L.playThunder&&L.playThunder(),ne.vibrate("bossEntrance"),setTimeout(()=>{document.body.classList.remove("fracture-effect")},600)):r.pitcher.id==="MONITOR"&&(r.monitorEntranceStartTime=performance.now(),L.playDigitalEntrance&&L.playDigitalEntrance(),ne.vibrate("bossEntrance"))}handleWindup(t){r.pitcher.timer+=t,this.updateColorBlindIndicator(),r.pitcher.timer>1250&&!r.pitcher.chargeSoundPlayed&&this.playChargeSound(),r.pitcher.timer>r.pitcher.windupDuration&&this.throwBall(t)}updateColorBlindIndicator(){const t=Ji[r.pitcher.nextPitch];if(r.settings?.colorBlindMode){if(wt.style.display!=="block"&&(wt.style.display="block",wt.style.textShadow="2px 2px 0 #000"),window.innerWidth/window.innerHeight>=.7)wt.style.top="20vh";else{const o=r.pitcher.y/de*100;wt.style.top=`${o}%`}let a="";if(t.colors.length>1&&t.colorName.includes("/")){const o=t.colorName.split("/");o.forEach((n,s)=>{const l=t.colors[s]||"#ffffff";a+=`<span style="color: ${l}">${n}</span>`,s<o.length-1&&(a+='<span style="color: #ffffff">/</span>')})}else a=`<span style="color: ${t.colors[0]}">${t.colorName}</span>`;wt.innerHTML!==a&&(wt.innerHTML=a)}else wt.style.display!=="none"&&(wt.style.display="none")}handleBackflip(t){r.pitcher.timer+=t;const i=600;if(r.pitcher.timer<i){const a=r.pitcher.timer/i;r.pitcher.rotation=-a*Math.PI*2,r.pitcher.y=150+Fe-Math.sin(a*Math.PI)*50}else r.pitcher.rotation=0,r.pitcher.y=150+Fe,r.pitcher.state=Re.IDLE,r.pitcher.timer=0}playChargeSound(){const t=r.pitcher.nextPitch;t===F.SUPER_ZIGZAG||t===F.STOP_ZIGZAG||t===F.GHOST_ZIGZAG?L.playZigZagCharge():t===F.SUPER_CURVE||t===F.STOP_CURVE||t===F.GHOST_CURVE?L.playCurveCharge():t===F.GHOST_CHANGEUP||t===F.CURVE_CHANGEUP||t===F.SPLITTER_CHANGEUP||t===F.STOP_CHANGEUP||t===F.ZIGZAG_CHANGEUP?L.playChangeCharge():t===F.CURVE_SPLITTER||t===F.ZIGZAG_SPLITTER||t===F.SUPER_SPLITTER||t===F.GHOST_SPLITTER||t===F.STOP_SPLITTER?L.playSplitterCharge():(t===F.GHOST_STOP||t===F.GHOST_SUPER||t===F.STOP_SUPER)&&(t===F.GHOST_STOP?L.playEvilLaugh():L.playSuperCharge()),r.pitcher.chargeSoundPlayed=!0}throwBall(t){r.pitcher.state=Re.IDLE,r.pitcher.timer=0,r.pitcher.chargeSoundPlayed=!1,wt.style.display="none",r.showTutorial&&(r.showTutorial=!1);let i=1,a=0;const o=Ji[r.pitcher.nextPitch];let n=o.rotationSpeed||.2;if(r.isDailyChallenge){const f=U.score+dt.DAILY_SCORE_OFFSET;i=dt.BASE_MULTIPLIER+Math.log10(f/10+1)*dt.LOG_FACTOR,a=(o.baseSpeed||.4)*i*Gi.range(.95,1.05)}else{const f=U.score,d=dt.TRANSITION_SCORE;if(f<d)i=dt.BASE_MULTIPLIER+Math.pow(f,dt.POWER_EXPONENT)*dt.POWER_FACTOR;else{const u=dt.BASE_MULTIPLIER+Math.pow(d,dt.POWER_EXPONENT)*dt.POWER_FACTOR,h=dt.BASE_MULTIPLIER+Math.log10(d/10+1)*dt.LOG_FACTOR,g=u-h;i=dt.BASE_MULTIPLIER+Math.log10(f/10+1)*dt.LOG_FACTOR+g}a=(o.baseSpeed||.4)*i}let s=0,l=1;r.isDailyChallenge?l=Gi.random()>.5?1:-1:l=Math.random()>.5?1:-1;const c=Eo.get(r.pitcher.x+r.pitcher.width/2-5,r.pitcher.y+r.pitcher.height,r.pitcher.nextPitch,a*t,s,n,l);r.balls.push(c),o.throwSound&&L[o.throwSound]?L[o.throwSound]():L.playPitch()}}const B0=new O0;class Ft{static init(t,i){this.startGame=t,this.returnToTitleScreen=i,this.bindRetryEvents()}static setupRetryModal(){Ht&&(Ht.innerText=20,Ht.style.color="#fff"),De&&(De.onclick=async i=>{i.stopPropagation(),De.style.opacity="0.5",De.style.pointerEvents="none",await U.deductCoins(20,"daily_retry")?(L.playPurchase(),ne.vibrate("purchase"),ht&&(ht.style.display="none"),this.startGame&&this.startGame(!0,!0)):(L.playError(),ne.vibrate("medium"),De.style.opacity="1",De.style.pointerEvents="auto",De.innerText="NEED COINS")}),Bo&&(Bo.innerText="HOME",Bo.onclick=i=>{i.stopPropagation(),L.playSettingsClose(),ht&&(ht.style.display="none"),this.returnToTitleScreen&&this.returnToTitleScreen()}),U.coins>=20?De&&(De.disabled=!1,De.style.opacity="1",De.innerText="RETRY",De.style.cursor="pointer",De.style.pointerEvents="auto"):(Ht&&(Ht.style.color="#e74c3c"),De&&(De.disabled=!1,De.innerText="NEED COINS",De.classList.add("btn-disabled-visual")))}static bindRetryEvents(){ht&&(ht.onclick=t=>{t.target===ht&&(L.playSettingsClose(),ht.style.display="none")})}static async attemptEntry(t,i="generic"){const a=ze.getDailySeed(),o=r.lastDailyDate,n=await Kt.verifyOrFetch(a);return n.allowed?(Kt.fetchServerTime(),t?!0:o!==a?(console.log("Daily Challenge: Free Entry Used"),r.lastDailyDate=a,Y.setItem("baseball_last_daily_date",a),!0):!1):(bn(n.reason),!1)}static setupGame(t){if(!t){r.isDailyChallenge=!1,Oe.style.color="#fff",U.setStrikes(0),r.startMessage.active=!1,bt&&(bt.style.display="none");return}r.isDailyChallenge=!0,r.showTutorial=!1,Gi.setSeed(ze.getDailySeed()),Oe.style.color="#FFD700";const i=Sn.reduce((h,g)=>(h.find(m=>m.id===g.id)||h.push(g),h),[]),a=ze.getDailySeed();Gi.setSeed(a);const n=parseInt(a.replace(/-/g,""))%i.length,s=i[n];this._applyPitcherToGameState(s),U.setStrikes(2),Fa&&(Fa.innerText="ONE STRIKE"),_n&&(_n.innerText="1 STRIKE = GAME OVER"),Fa&&(Fa.style.color="#FF0000"),bt&&(bt.style.display="flex"),r.startMessage.active=!0;const l=K+60,c=K/2-16,f=l-c;r.pitcher.width=32;const d=r.pitcher.walkSpeed||.18,u=f/d;r.startMessage.timer=Math.max(1e3,u-750),L.playError()}static _applyPitcherToGameState(t){r.pitcher.id=t.id,r.pitcher.skinColor=t.visuals.skinColor,r.pitcher.hatColor=t.visuals.hatColor,r.pitcher.gender=t.visuals.gender,r.pitcher.shoeColor=t.visuals.shoeColor||null,r.pitcher.scale=t.visuals.scale||1,r.pitcher.walkSpeed=t.visuals.walkSpeed||.18,r.pitcher.props={sunglasses:t.visuals.sunglasses||!1,beard:t.visuals.beard||!1,goldChain:t.visuals.goldChain||!1},r.pitcher.x=K+60,r.pitcher.state=Re.WALK_ON}static updateButtonState(){if(!hi)return;const t=ze.getDailySeed(),i=r.lastDailyDate;bo&&(bo.innerText=r.dailyStreak),i!==t?(To.innerText="FREE",Zi.className="daily-badge free",ui&&(ui.style.display="none")):(To.innerText="20",Zi.className="daily-badge cost",ui&&(ui.style.display="block"))}}let Aa=!0;function ta(){r.gameActive&&(r.isPaused=!r.isPaused,document.body.classList.toggle("game-paused",r.isPaused),jt.style.display=r.isPaused?"flex":"none",r.isPaused?(Ae.innerHTML="&#9658;",Ae.style.fontSize="8vmin",Ae.style.paddingLeft=""):(Ae.innerHTML='<div class="pause-bar"></div><div class="pause-bar"></div>',Ae.style.fontSize="",Ae.style.paddingLeft=""),Ae.style.display=r.isPaused||r.gameActive?"flex":"none",r.isPaused?(Ze.style.display="block",r.startMessage&&r.startMessage.active&&bt&&(bt.style.display="none"),L.audioContext&&L.playPause(!0),r.balls.forEach(e=>{e.prevX=e.x,e.prevY=e.y,e.prevRotationAngle=e.rotationAngle})):(jt.style.display="none",Ze.style.display="none",r.startMessage&&r.startMessage.active&&bt&&(bt.style.display="flex"),L.audioContext&&L.playPause(!1),r.lastTime=performance.now()))}function pl(){if(console.log("Returning to Title Screen..."),r.gameActive=!1,r.isPaused=!1,r.isGameOver=!1,r.isDailyChallenge=!1,r.bossModeActive=!1,r.showFireworks=!1,L.stopTheme(),jt&&(jt.style.display="none"),Ze&&(Ze.style.display="block"),Ze&&(Ze.style.display="block"),ot&&(ot.style.display="flex",ot.classList.remove("wiggle-active")),ut&&(ut.style.visibility="hidden"),r.showTutorial=!1,Oe&&(Oe.style.visibility="hidden"),lt&&(lt.style.visibility="visible"),Sa&&(Sa.style.display="flex",Sa.parentElement&&(Sa.parentElement.style.display="flex")),Ba&&(Ba.style.display="block",Ba.style.visibility="visible",Ba.style.opacity="1"),U&&U.updateCoinDisplay(),Ae&&(Ae.style.display="none",Ae.innerHTML='<div class="pause-bar"></div><div class="pause-bar"></div>',Ae.style.paddingLeft="",Ae.style.fontSize=""),He){He.style.display="block";const e='<div class="game-title"><div class="title-line" data-text="PERFECT">PERFECT</div><div class="title-line" data-text="DERBY">DERBY</div></div><div class="subtitle pulse">TAP TO <span class="mobile-block">START</span></div>',t=document.getElementById("start-content");t?t.innerHTML=e:He.innerHTML=`<div id="start-content">${e}</div>`}xe&&(xe.style.display="flex"),St&&(St.style.display="flex"),It(!1),Hi()}async function Si(e=!1,t=!1,i="generic"){if(!Aa)return;if(e){const n=ze.getDailySeed();if(!Kt.isDateAllowed(n).allowed){await Ft.attemptEntry(t,i);return}if(r.lastDailyDate===n&&!t){if(i==="game_over"){L.playUnlockablesOpen(),ht&&(ht.style.display="flex"),Ft.setupRetryModal();return}const c=20;if(U.coins<c){L.playError(),ht&&(ht.style.display="flex"),Ft.setupRetryModal();return}if(await U.deductCoins(c,"daily_retry"))L.playPurchase(),Ft.setupGame(!0);else{L.playError();return}}else{if(!await Ft.attemptEntry(t,i))return;Ft.setupGame(!0)}}else Ft.setupGame(!1);Ae.style.display="flex",Ze.style.display="none",Ae.style.display="flex",Ze.style.display="none",ot&&(ot.style.display="none",ot.classList.remove("wiggle-active")),xe&&(xe.style.display="none"),St&&(St.style.display="none"),He.style.display="none",Ki&&(Ki.style.display="none"),ut&&(ut.style.display="none"),r.needsUnlockablesGlow=!1,xe&&xe.classList.remove("unlockables-glow"),!r.tutorialSeen&&!e?r.pendingUnlockablesGlow=!0:r.pendingUnlockablesGlow=!1,L.stopTheme(),sr(),r.gameActive=!0,r.isPaused=!1,r.isGameOver=!1,It(!1),Hi(),jt.style.display="none",e||(r.pitcher.id="ROOKIE",r.pitcher.skinColor="#ffccaa",r.pitcher.hatColor="#e74c3c",r.pitcher.props={hatColor:"#e74c3c"},r.pitcher.gender="MALE",r.pitcher.shoeColor=null,r.pitcher.baseColor="#ffffff",r.pitcher.bossType=null,r.pitcher.freshArm=!1,r.pitcher.scale=1),e||(r.showTutorial=!r.tutorialSeen),U.reset(),U.startSession(),e&&U.setStrikes(2),Oe.innerText=`Score: ${U.score}`,r.totalPitches=0,U.setMultiplier(0),r.consecutiveFouls=0,Oe.innerText=`Score: ${U.score}`,_t.reset(),r.showFireworks=!1,U.updateCoinDisplay(),wi.style.display="none",Oe.style.visibility="visible",U.updateCoinDisplay(),Oe.style.visibility="visible",Oe.parentElement.style.display="flex";const a=document.getElementById("coin-container");a?(a.style.display="none",a.style.visibility="hidden"):lt&&lt.parentElement&&(lt.parentElement.style.display="none"),he.innerText="",wt.style.display="none",He.style.display="none",I0(),r.lastTime=performance.now(),r.accumulator=0,r.pitcher.state=Re.IDLE,r.sessionStartTime=Date.now(),r.activeSessionTime=0,r.lastActiveTick=Date.now(),r.perfectHitTimer=0,r.pitcher.timer=0,r.showFireworks=!1,r.timeScale=1,r.bossModeActive=!1,r.bossLevel=0,r.nextBossType=null;const o=document.querySelector("canvas");o&&(o.style.cursor="default"),r.isDailyChallenge?r.pitcher.state=Re.WALK_ON:(r.pitcher.x=K/2-r.pitcher.width/2,r.pitcher.state=Re.IDLE),r.pitcher.y=150+Fe,r.perfectHitTimer=0,r.score===0&&!r.tutorialSeen&&!r.isDailyChallenge?r.showTutorial=!0:r.showTutorial=!1,Fi(!0),localStorage.removeItem("baseball_saved_game"),r.isGameOver=!1}async function G0(e,t="generic"){return await Ft.attemptEntry(e,t)}function F0(){Ht&&(Ht.innerText=20,Ht.style.color="#fff"),U.coins>=20?De&&(De.disabled=!1,De.style.opacity="1",De.innerText="RETRY",De.style.cursor="pointer"):(Ht&&(Ht.style.color="#e74c3c"),De&&(De.disabled=!1,De.innerText="NEED COINS",De.classList.add("btn-disabled-visual")))}function gl(){r.isDailyChallenge=!1,localStorage.removeItem("baseball_saved_game"),r.isGameOver=!1,r.gameActive=!1,r.perfectHitTimer=0,L.stopTheme(),U.reset(),r.showFireworks=!1,_t.reset(),r.bossModeActive=!1,He.style.display="block",fi?fi.innerHTML=`
            <div class="game-title">
                <div class="title-line" data-text="PERFECT">PERFECT</div>
                <div class="title-line" data-text="DERBY">DERBY</div>
            </div>
            <div class="subtitle pulse">TAP TO <span class="mobile-block">START</span></div>
        `:He.innerHTML=`
            <div class="game-title">
                <div class="title-line" data-text="PERFECT">PERFECT</div>
                <div class="title-line" data-text="DERBY">DERBY</div>
            </div>
            <div class="subtitle pulse">TAP TO <span class="mobile-block">START</span></div>
        `,Ze&&(Ze.style.display="block"),Ze&&(Ze.style.display="block"),ot&&(ot.style.display="flex",ot.classList.remove("wiggle-active")),xe&&(xe.style.display="flex"),St&&(St.style.display="block"),ut&&(ut.style.display="none"),It(!1),Oe.style.color="#fff",ht&&(ht.style.display="none"),Zt&&Zt.close(),jt&&(jt.style.display="none"),Oe&&Oe.parentElement&&(Oe.parentElement.style.display="flex");const e=document.getElementById("coin-container");e?(e.style.display="flex",e.style.visibility="visible"):lt&&lt.parentElement&&(lt.parentElement.style.display="flex"),bt&&(bt.style.display="none"),fi?fi.innerHTML=`
            <div class="game-title">
                <div class="title-line" data-text="PERFECT">PERFECT</div>
                <div class="title-line" data-text="DERBY">DERBY</div>
            </div>
            <div class="subtitle pulse">TAP TO <span class="mobile-block">START</span></div>
            ${r.isMobile?'<span class="mobile-block"><br>(TAP ZONES)</span>':""}
        `:He.innerHTML=`
            <div class="game-title">
                <div class="title-line" data-text="PERFECT">PERFECT</div>
                <div class="title-line" data-text="DERBY">DERBY</div>
            </div>
            <div class="subtitle pulse">TAP TO <span class="mobile-block">START</span></div>
            ${r.isMobile?'<span class="mobile-block"><br>(TAP ZONES)</span>':""}
        `,Ze&&(Ze.style.display="block"),xe&&(xe.style.display="flex"),St&&(St.style.display="block"),He.style.display="block"}function wo(e=null){if(r.transitioning)return;if(e&&!r.isGameOver&&!r.transitioning){if(r.transitioning=!0,r.gameActive=!1,Fi(!1),Aa=!1,He&&(He.style.display="none"),Ze&&(Ze.style.display="none"),r.balls.forEach(s=>{s.prevX=s.x,s.prevY=s.y,s.prevRotationAngle=s.rotationAngle}),Ha){Ha.style.display="flex";let s="GAME OVER",l="BETTER LUCK NEXT TIME",c=null;e==="STRIKE_OUT"?(s="STRIKE OUT!",l="THREE STRIKES, YOU'RE OUT",c=()=>L.playStrike()):e==="BAT_BROKEN"&&(s="BAT BROKEN!",l="TOO MANY FOULS",c=()=>L.playBatBreak()),In&&(In.innerText=s),kn&&(kn.innerText=l),c&&c()}setTimeout(()=>{r.transitioning=!1,Ha&&(Ha.style.display="none"),wo()},2e3);return}r.gameActive=!1,r.isGameOver=!0,Aa=!1,U.checkHighScore();const t=X.currentTheme&&X.currentTheme.id==="CLASSIC";U.score>50&&U.hasNewRecord()&&t&&(r.showFireworks=!0,_t.reset()),i0(),localStorage.removeItem("baseball_saved_game"),Ze.style.display="block",Ze.style.display="block",ot&&(ot.style.display="flex",ot.classList.add("wiggle-active")),xe&&(xe.style.display="flex"),St&&(St.style.display="block"),ut&&(ut.style.display="none"),r.pendingUnlockablesGlow&&!r.isDailyChallenge&&(r.needsUnlockablesGlow=!0,r.pendingUnlockablesGlow=!1,xe&&xe.classList.add("unlockables-glow")),It(!0),r.isDailyChallenge?`${U.dailyHighScore}`:`${U.highScore}`;const a=r.isDailyChallenge?"#FFD700":"#ffffff";console.log(`[Game Over] isDaily: ${r.isDailyChallenge}, color: ${a}`),fi?fi.innerHTML=`
            <span style="color: #ff0000; font-size: 1.2em;">GAME OVER</span><br>
            <span style="font-size: 1.0em; display: block; margin-top: 10px; animation: none; color: ${a} !important;">SCORE: ${U.score}</span>
            <span id="restart-msg" style="font-size: 0.8em; display: block; margin-top: 20px; animation: blink 1s infinite linear; color: #fff;">TAP TO RETRY</span>
        `:He.innerHTML=`
            <span style="color: #ff0000; font-size: 1.2em;">GAME OVER</span><br>
            <span style="font-size: 1.0em; display: block; margin-top: 10px; animation: none; color: ${a} !important;">SCORE: ${U.score}</span>
            <span id="restart-msg" style="font-size: 0.8em; display: block; margin-top: 20px; animation: blink 1s infinite linear; color: #fff;">TAP TO RETRY</span>
        `,He.style.display="block",He.style.display="block",r.isDailyChallenge&&U.updateDailyStreak().catch(s=>console.warn("[Daily] Streak update failed",s)),Oe.parentElement.style.display="flex",Oe.parentElement.style.display="flex",Oe.style.visibility="hidden";const o=document.getElementById("coin-container");o?(o.style.display="flex",o.style.visibility="visible"):lt.parentElement.style.display="flex",he.innerText="",X.currentTheme&&X.currentTheme.id==="HAUNTED"?L.playHauntedTheme():L.playTheme();const n=r.isDailyChallenge?"daily_leaderboard":"leaderboard";Zt.checkAndSubmitScore(U.score,n),setTimeout(()=>{Aa=!0},1e3),Ae.style.display="none",Fi(!0),U.saveCoins(!0),U.animateCoinGain(),U.syncSession().catch(s=>console.error("Sync Failed",s))}function Ii(){if(r.isPaused)return;if(!r.gameActive){if(!Aa)return;L.init().then(()=>{Si()});return}const e=Date.now();e-r.lastSwingTime<Dl||r.bat.swinging||(r.lastSwingTime=e,r.bat.swinging=!0,r.bat.angle=Math.PI,L.playSwing())}function ml(e){r.gameActive&&He.style.display!=="none"&&(He.style.display="none",fi&&(fi.style.display="none")),un.update(e/1e3),document.visibilityState==="visible"&&(r.activeSessionTime+=e),r.balls.length===0&&(r.pitcher.timer+=e),r.perfectHitTimer>0&&(r.perfectHitTimer-=e),r.startMessage&&r.startMessage.active&&(r.startMessage.timer-=e,r.startMessage.timer<=0&&(r.startMessage.active=!1,bt&&(bt.style.display="none"))),r.isDailyChallenge&&Oe.style.color!=="rgb(255, 215, 0)"&&Oe.style.color!=="#FFD700"&&(Oe.style.color="#FFD700"),B0.update(e),k0.update(e,wo,Fi),r.bat.swinging&&(r.bat.angle+=r.bat.swingSpeed*(e/16),r.bat.angle<=-Math.PI&&(r.bat.angle=Math.PI,r.bat.swinging=!1)),L0.checkCollisions(e,t=>{t==="BAT_BROKEN"&&wo("BAT_BROKEN")},Fi)}function yl(){Ft.updateButtonState()}function vn(){U.saveGame()}function H0(){return U.loadGame()?(r.pitcher.state=Re.IDLE,r.pitcher.timer=0,r.pitcher.x=K/2-r.pitcher.width/2,r.pitcher.y=150+Fe,r.balls=[],He.style.display="none",jt.style.display="block",Ze.style.display="block",Oe.style.visibility="visible",Oe.parentElement.style.display="flex",U.updateScoreDisplay(),lt.parentElement.style.display="none",xe&&(xe.style.display="none"),St&&(St.style.display="none"),It(!1),Hi(),console.log("Game Restored from Secure Disk"),!0):!1}Ft.init(Si,gl);const U0=Object.freeze(Object.defineProperty({__proto__:null,attemptDailyEntry:G0,gameOver:wo,loadSavedGame:H0,returnToTitle:pl,returnToTitleScreen:gl,saveGame:vn,setupDailyRetryModal:F0,startGame:Si,swing:Ii,togglePause:ta,update:ml,updateDailyButtonState:yl},Symbol.toStringTag,{value:"Module"})),Qo=512,xo=[{name:"Audio System Warmup",action:async()=>{L&&(await L.init(),L.warmup&&L.warmup())}},{name:"Perfect Hit GPU Pipeline",draw:e=>{const t=Qo,i=e.createRadialGradient(t/2,t/2,10,t/2,t/2,t/2);i.addColorStop(0,"rgba(255, 255, 210, 0.8)"),i.addColorStop(.4,"rgba(255, 215, 0, 0.6)"),i.addColorStop(1,"rgba(255, 165, 0, 0)"),e.fillStyle=i,e.beginPath(),e.arc(t/2,t/2,t/2,0,Math.PI*2),e.fill();const a=e.createLinearGradient(0,0,t,0);a.addColorStop(0,"rgba(0, 255, 255, 0)"),a.addColorStop(.5,"rgba(0, 255, 255, 1.0)"),a.addColorStop(1,"rgba(0, 255, 255, 0)"),e.fillStyle=a,e.fillRect(0,0,t,t),e.globalCompositeOperation="overlay",e.fillStyle="rgba(255, 100, 0, 0.3)",e.fillRect(0,0,t,t),e.globalCompositeOperation="screen",e.fillStyle="rgba(180, 220, 255, 0.4)",e.fillRect(0,0,t,t),e.globalCompositeOperation="source-over",e.shadowBlur=10,e.shadowColor="#ff0000",e.strokeStyle="#ff0000",e.lineWidth=4,e.strokeRect(50,50,t-100,t-100),e.shadowBlur=15,e.shadowColor="#00e5ff",e.fillStyle="#00e5ff",e.beginPath(),e.arc(t/2,t/2,10,0,Math.PI*2),e.fill(),e.shadowBlur=0;const o=document.createElement("canvas");o.width=64,o.height=64;const n=o.getContext("2d");if(n.fillStyle="#ff0000",n.fillRect(0,0,64,64),e.drawImage(o,0,0,32,32,100,100,32,32),typeof OffscreenCanvas<"u"){const s=new OffscreenCanvas(64,64),l=s.getContext("2d");l.fillStyle="#111",l.fillRect(0,0,64,64),e.drawImage(s,0,0)}}},{name:"Beach Sun Flare & Island Glow (Perfect Hit)",requiredTheme:"BEACH",draw:e=>{const t=r.perfectHitTimer,i=U.consecutivePerfectHits,a=r.settings;r.perfectHitTimer=1,U.setMultiplier(3),r.settings={...a,noFlash:!1};for(let o=0;o<3;o++)Mo(e,Qo,Qo);r.perfectHitTimer=t,U.setMultiplier(i),r.settings=a}},{name:"Space Warp (Perfect Hit)",requiredTheme:"SPACE",draw:e=>{["#ff0000","#ffff00","#00ff00","#ffa500","#ff8c00"].forEach(i=>{const a=document.createElement("canvas");a.width=50,a.height=50;const o=a.getContext("2d"),n=o.createRadialGradient(25,25,2,25,25,6);n.addColorStop(0,"#fff"),n.addColorStop(.3,i),n.addColorStop(1,i),o.fillStyle=n,o.shadowColor=i,o.shadowBlur=10,o.beginPath(),o.arc(25,25,5,0,Math.PI*2),o.fill(),o.shadowBlur=0,e.drawImage(a,0,0)})}},{name:"Monitor Shocked Face",draw:e=>{const t=r.perfectHitTimer;r.perfectHitTimer=1;const i=r.pitcher;r.pitcher={id:"MONITOR"},sn(e,64,64,1),r.perfectHitTimer=t,r.pitcher=i}},{name:"Fireworks Particles",draw:e=>{_t.spawnParticles(64,64,"#ff0000"),_t.draw(),_t.reset()}},{name:"Pitcher Sprites (Current Daily)",draw:e=>{try{const t=r.pitcher||{skinColor:"#ffccaa",gender:"MALE",props:{hatColor:"#e74c3c"}},i=t.skinColor||"#ffccaa",a=t.props||{},o=["IDLE","SET","KICK","THROW"],n=["#ffffff","#ff0000"];o.forEach(s=>{n.forEach(l=>{typeof nn=="function"&&nn(s,l,null,"full",i,a)})}),sn(e,64,64,1)}catch(t){console.warn("[Preloader] Pitcher warmup failed (Non-fatal):",t)}}},{name:"Haunted Mansion Storm",requiredTheme:"HAUNTED",draw:e=>{if(_a){const t=K||window.innerWidth,i=de||window.innerHeight;_a(t,i)}}}];async function z0(e,t){console.log("[Preloader] Starting effect warmup...");const i=document.createElement("canvas");i.width=512,i.height=512;const a=i.getContext("2d",{willReadFrequently:!0});for(let o=0;o<xo.length;o++){if(t&&t.aborted){console.log("[Preloader] Warmup aborted.");break}const n=xo[o];if(n.requiredTheme&&n.requiredTheme!==(X.currentTheme?.id||"CLASSIC")){console.log(`[Preloader] Skipped (not equipped): ${n.name}`);continue}try{if(a.clearRect(0,0,512,512),n.action&&await n.action(),n.draw){n.draw(a);const s=a.getImageData(0,0,1,1).data}console.log(`[Preloader] Warmed up: ${n.name}`)}catch(s){console.warn(`[Preloader] Failed to warmup ${n.name}:`,s)}if(e){const s=Math.round((o+1)/xo.length*100);e(s,`Loading: ${n.name}`),await new Promise(l=>setTimeout(l,20))}}i.width=1,i.height=1,console.log("[Preloader] Warmup complete.")}function Sl(e){try{r.lastTime===0&&(r.lastTime=e);let t=(e-r.lastTime)*Ol.TIME_SCALE;for(r.lastTime=e,t>100&&(t=100),r.accumulator+=t;r.accumulator>=Yi;)r.gameActive&&!r.isPaused?(ml(Yi),_t.update(Yi,!1)):!r.gameActive&&r.showFireworks&&_t.update(Yi),r.accumulator-=Yi;C.clearRect(0,0,Ut.width,Ut.height);const i=r.accumulator/Yi;r.gameActive||r.transitioning?(f0(),cr(),Or(),r.balls.forEach(a=>Gr(a,i)),u0(),_t.draw(),Fr(),xs()):n0(_t),requestAnimationFrame(Sl)}catch(t){console.error("CRITICAL GAMELOOP ERROR:",t),r.gameActive=!1}}async function W0(){try{if(typeof window.Capacitor<"u"){const{App:e}=await Le(async()=>{const{App:o}=await import("./index-dbv-4xsI.js");return{App:o}},__vite__mapDeps([2,1]),import.meta.url),{StatusBar:t}=await Le(async()=>{const{StatusBar:o}=await import("./index-DbeBRm09.js");return{StatusBar:o}},__vite__mapDeps([3,1]),import.meta.url),{SplashScreen:i}=await Le(async()=>{const{SplashScreen:o}=await import("./index-CEbq_H6s.js");return{SplashScreen:o}},__vite__mapDeps([4,1]),import.meta.url),a=async()=>{await t.hide().catch(()=>{}),await i.hide().catch(()=>{})};await a(),e.addListener("appStateChange",({isActive:o})=>{o?(a(),L._checkAndResume()):L.suspendAudio()}),window.addEventListener("touchend",a),window.addEventListener("click",a),e.addListener("backButton",({canGoBack:o})=>{r.gameActive&&!r.isPaused&&!r.isGameOver?Ae&&Ae.style.display!=="none"&&Ae.style.pointerEvents!=="none"&&ta():r.isPaused?ta():Zt&&Zt.modal.style.display==="flex"?Zt.close():Rt.isOpen?Rt.closeSettings():r.isDailyChallenge&&r.gameActive})}}catch{console.log("Native mode disabled (Web/Browser).")}}const Ws=async()=>{console.log("Game Loading...");let e=document.getElementById("global-loading-overlay");e||(e=document.createElement("div"),e.id="global-loading-overlay",e.style.position="fixed",e.style.top="0",e.style.left="0",e.style.width="100%",e.style.height="100%",e.style.background="rgba(0,0,0,1)",e.style.zIndex="90",e.style.display="block",document.body.appendChild(e)),requestAnimationFrame(()=>{document.body.offsetWidth,fl(),L.init(),requestAnimationFrame(()=>{document.body.classList.add("play-intro"),console.log("[DEBUG] Intro Animation Triggered (Safe)")}),typeof window.Capacitor<"u"&&window.Capacitor.isNativePlatform()&&(setTimeout(()=>L.playIntroReveal(),450),setTimeout(()=>L.playIntroImpact(),1050))}),W0(),console.log("[DEBUG] initGame: Starting..."),di.init(),console.log("[DEBUG] initGame: Leaderboard Init Called");try{const n=ka.waitForAuth(),s=new Promise((l,c)=>{setTimeout(()=>c(new Error("Auth Timeout")),2e3)});await Promise.race([n,s]),U.fetchServerBalance(),U.validateStartupStreak(),console.log("[DEBUG] initGame: Auth & Sync Complete")}catch(n){console.warn(`[DEBUG] initGame: Auth/Sync skipped (${n.message}). Starting game offline.`)}U.updateCoinDisplay(),t0(),console.log("[DEBUG] initGame: Crowd Generated");const t=setTimeout(()=>{if(r.isLoading&&document.getElementById("global-loading-overlay")){console.warn("Loading taking too long. Showing Failsafe Reset.");const n=document.getElementById("global-loading-overlay");if(document.getElementById("failsafe-reset-btn"))return;const s=document.createElement("button");s.id="failsafe-reset-btn",s.textContent="STUCK? RESET DATA",s.style.marginTop="20px",s.style.padding="10px 20px",s.style.background="#ff4444",s.style.color="white",s.style.border="none",s.style.borderRadius="5px",s.style.cursor="pointer",s.style.fontFamily="inherit",s.style.fontSize="16px",s.style.pointerEvents="auto",s.style.zIndex="10001",s.onclick=()=>{confirm("This will clear your save data and high scores to fix the loading error. Continue?")&&(localStorage.clear(),window.location.reload())},n.appendChild(s)}},5e3),i=new AbortController,a=i.signal;try{console.log("[DEBUG] Starting Preloader...");const n=z0(c=>{},a),s=new Promise(c=>setTimeout(()=>{c("timeout")},3e3));await Promise.race([n,s])==="timeout"?(console.warn("Preloader timed out - Aborting background tasks."),i.abort()):console.log("[DEBUG] Preloader Finished Successfully.")}catch(n){console.error("Preload failed or timed out:",n)}const o=X.currentTheme;if(o&&o.warmup){console.log(`[DEBUG] Startup: Warming up ${o.id} Cache...`);const n=e.querySelector("div");if(n){const s={HAUNTED:"SUMMONING SPIRITS...",SPACE:"ENTERING ORBIT...",BEACH:"WAXING BOARDS...",CLASSIC:"MOWING GRASS..."};n.innerText=s[o.id]||"LOADING..."}try{const s=window.innerWidth||GAME_WIDTH,l=window.innerHeight||GAME_HEIGHT;o.warmup(s,l)}catch(s){console.warn("Theme warmup failed:",s)}}e.style.transition="opacity 0.5s",requestAnimationFrame(()=>{e.style.opacity="0"}),setTimeout(()=>{clearTimeout(t),e.parentNode&&e.parentNode.removeChild(e),r.isLoading=!1,document.body.classList.add("loading-complete"),typeof window.Capacitor<"u"&&window.Capacitor.isNativePlatform()},800),It(!1),hi&&(hi.style.display="flex",U.validateStartupStreak(),yl(),hi.addEventListener("click",n=>{n.stopPropagation(),ne.vibrate("medium"),console.log("Daily Challenge Button Clicked"),Si(!0)}),hi.addEventListener("touchstart",n=>{n.stopPropagation()},{passive:!1})),typeof ot<"u"&&ot&&ot.addEventListener("click",n=>{n.stopPropagation(),ne.vibrate("medium"),console.log("Feedback Button Clicked: Generating Smart Link...");const s=U.highScore||0,l=localStorage.getItem("baseball_username")||"N/A";let c="Web";typeof window.Capacitor<"u"?c=window.Capacitor.isNativePlatform()?"Android_App":"Web_Mobile":/Mobi|Android/i.test(navigator.userAgent)?c="Mobile_Browser":c="PC_Browser";const f="https://docs.google.com/forms/d/e/1FAIpQLSdYRPa0zwJ1ZpBerKdjKKpuLKunedoiuoMTOEgCjCrfIjDSTw/viewform",d=new URLSearchParams({usp:"pp_url","entry.571653272":s,"entry.612925055":l,"entry.1950205778":c}),u=`${f}?${d.toString()}`;window.open(u,"_blank")}),requestAnimationFrame(Sl)};document.readyState==="complete"||document.readyState==="interactive"?Ws():window.addEventListener("load",Ws);window.addEventListener("resize",fl);yo.init();document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"?(ci.saveProgress(),vn()):document.visibilityState==="visible"&&Kt.fetchServerTime()});window.addEventListener("pagehide",()=>{ci.saveProgress(),vn()});export{Le as _};
