const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./index-Qs8-2f79.js","./index-DGoMKXoD.js","./index-DlaQ9LD2.js","./index-DbeBRm09.js","./index-fe9Xyqf8.js"])))=>i.map(i=>d[i]);
(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))i(o);new MutationObserver(o=>{for(const n of o)if(n.type==="childList")for(const s of n.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&i(s)}).observe(document,{childList:!0,subtree:!0});function a(o){const n={};return o.integrity&&(n.integrity=o.integrity),o.referrerPolicy&&(n.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?n.credentials="include":o.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(o){if(o.ep)return;o.ep=!0;const n=a(o);fetch(o.href,n)}})();const rs="modulepreload",cs=function(e,t){return new URL(e,t).href},Oo={},Be=function(t,a,i){let o=Promise.resolve();if(a&&a.length>0){let f=function(c){return Promise.all(c.map(u=>Promise.resolve(u).then(h=>({status:"fulfilled",value:h}),h=>({status:"rejected",reason:h}))))};const s=document.getElementsByTagName("link"),r=document.querySelector("meta[property=csp-nonce]"),d=r?.nonce||r?.getAttribute("nonce");o=f(a.map(c=>{if(c=cs(c,i),c in Oo)return;Oo[c]=!0;const u=c.endsWith(".css"),h=u?'[rel="stylesheet"]':"";if(i)for(let m=s.length-1;m>=0;m--){const p=s[m];if(p.href===c&&(!u||p.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${c}"]${h}`))return;const g=document.createElement("link");if(g.rel=u?"stylesheet":rs,u||(g.as="script"),g.crossOrigin="",g.href=c,d&&g.setAttribute("nonce",d),document.head.appendChild(g),u)return new Promise((m,p)=>{g.addEventListener("load",m),g.addEventListener("error",()=>p(new Error(`Unable to preload CSS for ${c}`)))})}))}function n(s){const r=new Event("vite:preloadError",{cancelable:!0});if(r.payload=s,window.dispatchEvent(r),!r.defaultPrevented)throw s}return o.then(s=>{for(const r of s||[])r.status==="rejected"&&n(r.reason);return t().catch(n)})},Dt=document.getElementById("gameCanvas"),b=Dt.getContext("2d",{alpha:!1,desynchronized:!0}),Ve=document.getElementById("start-screen"),ia=document.getElementById("start-content"),He=document.getElementById("score"),Ft=document.getElementById("score-plus"),ot=document.getElementById("coin-display"),ii=document.getElementById("coin-container"),yi=document.getElementById("coin-icon"),pa=document.getElementById("coin-plus"),Te=document.getElementById("feedback"),vt=document.getElementById("pitch-indicator"),Si=document.getElementById("debug-console"),De=document.getElementById("pause-btn"),Wt=document.getElementById("pause-overlay"),ct=document.getElementById("tutorial-volume"),mt=document.getElementById("message-overlay"),Ti=document.getElementById("message-text"),Go=document.getElementById("message-subtext"),bi=document.getElementById("transition-overlay"),Bo=document.getElementById("transition-title"),Fo=document.getElementById("transition-subtitle"),et=document.getElementById("feedback-btn"),Xe=document.getElementById("settings-btn"),Qt=document.getElementById("settings-modal"),bt=document.getElementById("restart-game"),ht=document.getElementById("home-btn"),je=document.getElementById("unlockables-btn"),oi=document.getElementById("unlockables-modal"),ds=document.getElementById("close-unlockables"),fs=document.getElementById("stadium-grid"),hs=document.getElementById("bat-grid"),us=document.getElementById("unlockables-coin-display"),ps=document.getElementById("close-settings"),Ho=document.getElementById("toggle-release"),Uo=document.getElementById("toggle-vibration"),Vo=document.getElementById("toggle-music"),zo=document.getElementById("toggle-sound"),Wo=document.getElementById("toggle-colorblind"),$o=document.getElementById("toggle-noflash"),pt=document.getElementById("leaderboard-btn"),Oa=document.getElementById("leaderboard-modal"),gs=document.getElementById("close-leaderboard"),vi=document.getElementById("leaderboard-list"),wa=document.getElementById("leaderboard-loading"),ja=document.getElementById("personal-best-display"),Ja=document.getElementById("name-entry-container"),Ht=document.getElementById("player-name-input"),ms=document.getElementById("submit-name-btn"),_a=document.getElementById("tab-all-time"),Ia=document.getElementById("tab-daily"),Ci=document.getElementById("daily-section"),oa=document.getElementById("daily-challenge-btn"),Ga=document.getElementById("daily-cost-container"),Ui=document.getElementById("daily-cost-value"),na=document.getElementById("daily-cost-icon"),Vi=document.getElementById("daily-streak-value"),Yo=document.getElementById("daily-date"),ji=document.getElementById("daily-list"),Pa=document.createElement("canvas"),ys=Pa.getContext("2d"),Sa=document.createElement("canvas"),Ss=Sa.getContext("2d"),sa=document.createElement("canvas"),Ts=sa.getContext("2d"),Li=document.createElement("canvas"),st=Li.getContext("2d"),zi=document.createElement("canvas"),ze=zi.getContext("2d"),Ct=document.createElement("canvas"),mo=Ct.getContext("2d");let Q=600,Ee=800;const No=800,bs=680;function vs(e,t){Q=e,Ee=t}let qe=0;function qo(e){qe=e}const si={},Ke=80,Va=20,li=20,Cs=13,Ba=32;function Ra(e){e?(De.style.opacity="1",De.style.pointerEvents="auto",De.style.cursor="pointer"):(De.style.opacity="0",De.style.pointerEvents="none",De.style.cursor="default")}const rt=document.getElementById("daily-retry-modal"),kt=document.getElementById("retry-cost-display"),Ji=document.getElementById("retry-cancel-btn"),Ge=document.getElementById("retry-confirm-btn"),Xo=document.getElementById("daily-prev-btn"),Pi=document.getElementById("daily-next-btn"),Xt=document.getElementById("security-modal"),Zo=document.getElementById("security-title"),Ko=document.getElementById("security-message"),Ps=document.getElementById("security-close-btn");document.getElementById("confirmation-modal");document.getElementById("confirm-ok-btn");document.getElementById("confirm-cancel-btn");const Rs=600,As=60,ka=1e3/As,Qi=-Math.PI/2,Ri=-1,Ai=-2.2,F={FASTBALL:"fastball",CURVEBALL:"curveball",CHANGEUP:"changeup",SPLITTER:"splitter",SUPER_FASTBALL:"super_fastball",SUPER_SPLITTER:"super_splitter",GHOSTBALL:"ghostball",STOPBALL:"stopball",STOP_CURVE:"STOP_CURVE",GHOST_CURVE:"GHOST_CURVE",SUPER_CURVE:"SUPER_CURVE",SUPER_ZIGZAG:"super_zigzag",STOP_SPLITTER:"stop_splitter",STOP_ZIGZAG:"stop_zigzag",GHOST_SPLITTER:"ghost_splitter",GHOST_ZIGZAG:"ghost_zigzag",GHOST_CHANGEUP:"ghost_changeup",CURVE_SPLITTER:"curve_splitter",ZIGZAG_SPLITTER:"zigzag_splitter",CURVE_CHANGEUP:"curve_changeup",SPLITTER_CHANGEUP:"splitter_changeup",ZIGZAG_CHANGEUP:"zigzag_changeup",GHOST_STOP:"ghost_stop",GHOST_SUPER:"ghost_super",STOP_SUPER:"stop_super",STOP_CHANGEUP:"stop_changeup",ZIGZAG:"zigzag"},Fe=Object.freeze({IDLE:"idle",WINDUP:"windup",PITCHING:"pitching",WALK_OFF:"walk_off",WALK_ON:"walk_on",BACKFLIP:"backflip"}),lt=Object.freeze({BASE_MULTIPLIER:.9,LOG_FACTOR:.6,DAILY_SCORE_OFFSET:150,TRANSITION_SCORE:150,POWER_EXPONENT:.8,POWER_FACTOR:.015}),it=Object.freeze({BAT_LENGTH:50,BAT_WIDTH:12}),Es={TIME_SCALE:1},On=["#ffccaa","#e0ac69","#d2b48c","#8d5524"],Gn=["#ffffff","#e74c3c","#3498db","#f1c40f","#95a5a6","#2ecc71","#9b59b6","#34495e"],Ta=function(e){function t(P,M){return P>>>M|P<<32-M}for(var a=Math.pow,i=a(2,32),o="",n=[],s=e.length*8,r=Ta.h=Ta.h||[],d=Ta.k=Ta.k||[],f=d.length,c={},u=2;f<64;u++)if(!c[u]){for(var h=0;h<313;h+=u)c[h]=u;r[f]=a(u,.5)*i|0,d[f++]=a(u,1/3)*i|0}for(e+="Â€";e.length%64-56;)e+="\0";for(var h=0;h<e.length;h++){var g=e.charCodeAt(h);if(g>>8)return;n[h>>2]|=g<<(3-h)%4*8}n[n.length]=s/i|0,n[n.length]=s;for(var g=0;g<n.length;){var m=n.slice(g,g+=16),p=r;r=r.slice(0,8);for(var h=0;h<64;h++){var T=m[h-15],v=m[h-2],y=r[0],S=r[4],_=r[7]+(t(S,6)^t(S,11)^t(S,25))+(S&r[5]^~S&r[6])+d[h]+(m[h]=h<16?m[h]:m[h-16]+(t(T,7)^t(T,18)^T>>>3)+m[h-7]+(t(v,17)^t(v,19)^v>>>10)|0),A=(t(y,2)^t(y,13)^t(y,22))+(y&r[1]^y&r[2]^r[1]&r[2]);r=[_+A|0].concat(r),r[4]=r[4]+_|0}for(var h=0;h<8;h++)r[h]=r[h]+p[h]|0}for(var h=0;h<8;h++)for(var g=3;g+1;g--){var E=r[h]>>g*8&255;o+=(E<16?0:"")+E.toString(16)}return o},Ms="94a08da1",ws="fecbb6e8",_s="b4699053",Is="8c7b50b2",ks="super_baseball_secret_salt_v1_",Ds=()=>navigator.userAgent+(window.screen.width+"x"+window.screen.height);class Y{static getSecret(){return Ms+ws+_s+Is}static hash(t,a,i=null){const o=i||this.getSecret(),n=`${t}|${a}|${o}`;return Ta(n)}static setItem(t,a){const i=String(a),o=this.hash(t,i),n={d:i,s:o};try{localStorage.setItem(t,JSON.stringify(n))}catch(s){console.warn("SecureStorage: Write failed",s)}}static getItem(t,a=null){const i=localStorage.getItem(t);if(!i)return a;try{const o=JSON.parse(i);if(!o.s||o.d===void 0)return console.warn(`SecureStorage: Invalid envelope for ${t}.`),a;const n=this.hash(t,o.d);if(o.s===n)return o.d;const s=this.hash(t,o.d,ks);if(o.s===s)return console.log(`SecureStorage: Upgrading ${t} from V1 to V2...`),this.upgrade(t,o.d),o.d;const r=`${t}|${o.d}|${this.getSecret()}|${Ds()}`,d=Ta(r);return o.s===d?(console.log(`SecureStorage: Recovered ${t} from device-bound payload. Upgrading...`),this.upgrade(t,o.d),o.d):(console.error(`SecureStorage: TAMPER DETECTED for ${t}. Signature mismatch.`),a)}catch{return a}}static upgrade(t,a){setTimeout(()=>{this.setItem(t,a)},0)}static removeItem(t){localStorage.removeItem(t)}static migrate(t){const a=localStorage.getItem(t);if(!a)return;let i=!1;try{const o=JSON.parse(a);o&&o.s&&o.d!==void 0&&(i=!0)}catch{}if(!i){if(t==="baseball_coins"||t==="baseball_local_delta"){const o=parseInt(a),n=1e3;if(isNaN(o)||o>n){console.warn(`SecureStorage: Migration BLOCKED for ${t}. Value ${o} exceeds legacy safety limit (${n}). Resetting to 0.`),this.setItem(t,"0");return}if(o<0){this.setItem(t,"0");return}}console.log(`SecureStorage: Migrating raw legacy data for ${t}...`),this.setItem(t,a)}}static signPayload(t,a,i,o){const n=this.getSecret(),s=`${t}|${a}|${i}|${o}|${n}`;return Ta(s)}}const l={gameActive:!1,isPaused:!1,isLoading:!0,showTutorial:!0,tutorialSeen:!1,needsUnlockablesGlow:!1,pendingUnlockablesGlow:!1,settings:{swingOnRelease:!1,vibration:!0,noFlash:!1,muteMusic:!1,muteSound:!1,colorBlindMode:!1},showFireworks:!1,score:0,coins:parseInt(Y.getItem("baseball_coins","0"))||0,highScore:parseInt(Y.getItem("baseball_high_score_s1","0"))||0,initialHighScore:0,totalPitches:0,consecutiveFouls:0,lastTime:0,accumulator:0,isGameOver:!1,lastPitchResult:null,lastSwingTime:0,lastStaticRenderMode:null,bossModeActive:!1,monitorEntranceStartTime:0,isDailyChallenge:!1,dailyRetries:0,dailyStreak:parseInt(Y.getItem("baseball_daily_streak","0"))||0,lastDailyDate:Y.getItem("baseball_last_daily_date")||null,startMessage:{text:"",color:"#ffffff",active:!1,timer:0},pitcher:{id:"ROOKIE",x:0,y:150,width:32,height:32,baseColor:"#ffffff",color:"#ffffff",state:Fe.IDLE,timer:0,idleDuration:1e3,windupDuration:1e3,nextPitch:F.FASTBALL,chargeSoundPlayed:!1},bat:{x:0,y:0,angle:Math.PI,swinging:!1,swingSpeed:-.3,pivotX:0,pivotY:0},balls:[]},xi=Object.freeze(Object.defineProperty({__proto__:null,gameState:l},Symbol.toStringTag,{value:"Module"}));class Co{constructor(t,a,i=10){this.createFn=t,this.resetFn=a,this.pool=[];for(let o=0;o<i;o++)this.pool.push(this.createFn())}get(...t){let a;return this.pool.length>0?a=this.pool.pop():a=this.createFn(),this.resetFn&&this.resetFn(a,...t),a}release(t){this.pool.push(t)}clear(){this.pool=[]}}class ae{static playSwing(t,a){const i=t.currentTime,o=t.createOscillator(),n=t.createGain();o.type="sawtooth",o.frequency.setValueAtTime(200,i),o.frequency.exponentialRampToValueAtTime(100,i+.1),n.gain.setValueAtTime(.15,i),n.gain.exponentialRampToValueAtTime(.01,i+.1),o.connect(n),n.connect(a),o.start(i),o.stop(i+.1)}static playHit(t,a){const i=t.currentTime,o=t.createOscillator(),n=t.createGain();o.type="square",o.frequency.setValueAtTime(800,i),o.frequency.exponentialRampToValueAtTime(200,i+.15),n.gain.setValueAtTime(.3,i),n.gain.exponentialRampToValueAtTime(.01,i+.15),o.connect(n),n.connect(a),o.start(i),o.stop(i+.15)}static playPerfectHit(t,a){const i=t.currentTime,o=[523.25,659.25,783.99,1046.5],n=.1,s=.08;o.forEach((c,u)=>{const h=t.createOscillator(),g=t.createGain(),m=i+u*s;h.type="square",h.frequency.value=c,g.gain.setValueAtTime(.2,m),g.gain.exponentialRampToValueAtTime(.01,m+n),h.connect(g),g.connect(a),h.start(m),h.stop(m+n)});const r=t.createOscillator(),d=t.createGain(),f=i+o.length*s;r.type="triangle",r.frequency.setValueAtTime(1200,f),r.frequency.linearRampToValueAtTime(2e3,f+.3),d.gain.setValueAtTime(.1,f),d.gain.linearRampToValueAtTime(.01,f+.3),r.connect(d),d.connect(a),r.start(f),r.stop(f+.3)}static playFoul(t,a){const i=t.currentTime,o=t.createOscillator(),n=t.createGain();o.type="sawtooth",o.frequency.setValueAtTime(150,i),o.frequency.exponentialRampToValueAtTime(50,i+.3),n.gain.setValueAtTime(.2,i),n.gain.linearRampToValueAtTime(.01,i+.3),o.connect(n),n.connect(a),o.start(i),o.stop(i+.3)}static playPause(t,a,i){const o=t.currentTime,n=t.createOscillator(),s=t.createGain();n.type="square",i?(n.frequency.setValueAtTime(660,o),n.frequency.setValueAtTime(440,o+.1)):(n.frequency.setValueAtTime(440,o),n.frequency.setValueAtTime(660,o+.1)),s.gain.setValueAtTime(.1,o),s.gain.linearRampToValueAtTime(.01,o+.2),n.connect(s),s.connect(a),n.start(o),n.stop(o+.2)}static playSettingsToggle(t,a){const i=t.currentTime,o=t.createOscillator(),n=t.createGain();o.type="square",o.frequency.setValueAtTime(800,i),o.frequency.exponentialRampToValueAtTime(1200,i+.05),n.gain.setValueAtTime(.05,i),n.gain.exponentialRampToValueAtTime(.01,i+.05),o.connect(n),n.connect(a),o.start(i),o.stop(i+.05)}static playSettingsOpen(t,a){const i=t.currentTime,o=t.createOscillator(),n=t.createGain();o.type="square",o.frequency.setValueAtTime(500,i),o.frequency.linearRampToValueAtTime(300,i+.1),n.gain.setValueAtTime(.1,i),n.gain.linearRampToValueAtTime(.01,i+.1),o.connect(n),n.connect(a),o.start(i),o.stop(i+.1)}static playSettingsClose(t,a){const i=t.currentTime,o=t.createOscillator(),n=t.createGain();o.type="square",o.frequency.setValueAtTime(300,i),o.frequency.linearRampToValueAtTime(500,i+.1),n.gain.setValueAtTime(.1,i),n.gain.linearRampToValueAtTime(.01,i+.1),o.connect(n),n.connect(a),o.start(i),o.stop(i+.1)}static playPurchase(t,a){const i=t.currentTime;[1200,1500,1800,2200].forEach((s,r)=>{const d=t.createOscillator(),f=t.createGain(),c=i+r*.05;d.type="sine",d.frequency.setValueAtTime(s,c),f.gain.setValueAtTime(.1,c),f.gain.exponentialRampToValueAtTime(.01,c+.1),d.connect(f),f.connect(a),d.start(c),d.stop(c+.1)}),[523.25,659.25,783.99,1046.5].forEach((s,r)=>{const d=t.createOscillator(),f=t.createGain();d.type="triangle",d.frequency.setValueAtTime(s,i),f.gain.setValueAtTime(0,i),f.gain.linearRampToValueAtTime(.1,i+.1),f.gain.exponentialRampToValueAtTime(.01,i+.6),d.connect(f),f.connect(a),d.start(i),d.stop(i+.6)})}static playError(t,a){const i=t.currentTime,o=t.createOscillator(),n=t.createGain();o.type="sawtooth",o.frequency.setValueAtTime(150,i),o.frequency.linearRampToValueAtTime(100,i+.15),n.gain.setValueAtTime(.2,i),n.gain.exponentialRampToValueAtTime(.01,i+.15),o.connect(n),n.connect(a),o.start(i),o.stop(i+.15)}static playUnlockablesOpen(t,a){this.playSettingsOpen(t,a)}static playUnlockablesClose(t,a){this.playSettingsClose(t,a)}static playItemAlreadyEquipped(t,a){const i=t.currentTime,o=t.createOscillator(),n=t.createGain();o.type="sine",o.frequency.setValueAtTime(150,i),o.frequency.exponentialRampToValueAtTime(100,i+.1),n.gain.setValueAtTime(.1,i),n.gain.linearRampToValueAtTime(.01,i+.1),o.connect(n),n.connect(a),o.start(i),o.stop(i+.1)}static playStrike(t,a){const i=t.currentTime,o=t.createOscillator(),n=t.createGain();o.type="sawtooth",o.frequency.setValueAtTime(100,i),o.frequency.linearRampToValueAtTime(80,i+.2),n.gain.setValueAtTime(.25,i),n.gain.exponentialRampToValueAtTime(.01,i+.2),o.connect(n),n.connect(a),o.start(i),o.stop(i+.2)}static playStrikesCleared(t,a){const i=t.currentTime,o=t.createOscillator(),n=t.createGain(),s=[349.23,440,523.25,659.25],r=.08;o.type="triangle",s.forEach((d,f)=>{o.frequency.setValueAtTime(d,i+f*r)}),n.gain.setValueAtTime(.1,i),n.gain.setValueAtTime(.1,i+s.length*r),n.gain.exponentialRampToValueAtTime(.01,i+s.length*r+.3),o.connect(n),n.connect(a),o.start(i),o.stop(i+s.length*r+.3)}static playLevelUp(t,a){const i=t.currentTime,o=[440,554,659,880,1108,1318],n=.1,s=.08;o.forEach((r,d)=>{const f=t.createOscillator(),c=t.createGain(),u=i+d*s;f.type="square",f.frequency.value=r,c.gain.setValueAtTime(.1,u),c.gain.linearRampToValueAtTime(.01,u+n),f.connect(c),c.connect(a),f.start(u),f.stop(u+n)})}static playPitch(t,a){const i=t.currentTime,o=t.createOscillator(),n=t.createGain();o.type="sawtooth",o.frequency.setValueAtTime(300,i),o.frequency.exponentialRampToValueAtTime(150,i+.08),n.gain.setValueAtTime(.12,i),n.gain.exponentialRampToValueAtTime(.01,i+.08),o.connect(n),n.connect(a),o.start(i),o.stop(i+.08)}static playCurveCharge(t,a){const i=t.currentTime,o=t.createOscillator(),n=t.createGain(),s=t.createOscillator(),r=t.createGain();o.type="triangle",o.frequency.setValueAtTime(200,i),o.frequency.linearRampToValueAtTime(400,i+.8),s.frequency.value=10,r.gain.value=20,s.connect(r),r.connect(o.frequency),n.gain.setValueAtTime(.1,i),n.gain.linearRampToValueAtTime(.01,i+.8),o.connect(n),n.connect(a),o.start(i),s.start(i),o.stop(i+.8),s.stop(i+.8)}static playChangeCharge(t,a){const i=t.currentTime,o=t.createOscillator(),n=t.createGain();o.type="square",o.frequency.setValueAtTime(100,i),o.frequency.linearRampToValueAtTime(200,i+.8),n.gain.setValueAtTime(.05,i),n.gain.linearRampToValueAtTime(.01,i+.8),o.connect(n),n.connect(a),o.start(i),o.stop(i+.8)}static playSuperCharge(t,a){const i=t.currentTime,o=t.createOscillator(),n=t.createGain();o.type="sawtooth",o.frequency.setValueAtTime(400,i),o.frequency.exponentialRampToValueAtTime(1200,i+.8),n.gain.setValueAtTime(.1,i),n.gain.linearRampToValueAtTime(.01,i+.8),o.connect(n),n.connect(a),o.start(i),o.stop(i+.8)}static playSplitterCharge(t,a){const i=t.currentTime,o=t.createOscillator(),n=t.createGain(),s=t.createOscillator(),r=t.createGain();o.type="sawtooth",o.frequency.setValueAtTime(400,i),o.frequency.exponentialRampToValueAtTime(40,i+.8),s.type="square",s.frequency.setValueAtTime(15,i),s.frequency.linearRampToValueAtTime(60,i+.8),r.gain.value=100,s.connect(r),r.connect(o.frequency),n.gain.setValueAtTime(.2,i),n.gain.linearRampToValueAtTime(.01,i+.8),o.connect(n),n.connect(a),o.start(i),s.start(i),o.stop(i+.8),s.stop(i+.8)}static playZigZagCharge(t,a){const i=t.currentTime,o=t.createOscillator(),n=t.createGain(),s=t.createOscillator(),r=t.createGain();o.type="sine",o.frequency.setValueAtTime(400,i),o.frequency.linearRampToValueAtTime(600,i+.8),s.type="square",s.frequency.value=12,r.gain.value=50,s.connect(r),r.connect(o.frequency),n.gain.setValueAtTime(.15,i),n.gain.linearRampToValueAtTime(.01,i+.8),o.connect(n),n.connect(a),o.start(i),s.start(i),o.stop(i+.8),s.stop(i+.8)}static playStopCharge(t,a){const i=t.currentTime,o=t.createOscillator(),n=t.createGain();o.type="sawtooth",o.frequency.setValueAtTime(100,i),o.frequency.exponentialRampToValueAtTime(300,i+1),n.gain.setValueAtTime(.15,i),n.gain.linearRampToValueAtTime(.01,i+1),o.connect(n),n.connect(a),o.start(i),o.stop(i+1)}static playEvilLaugh(t,a){const i=t.currentTime;[0,.2,.4].forEach((o,n)=>{const s=t.createOscillator(),r=t.createGain();s.type="sawtooth",s.frequency.setValueAtTime(400-n*50,i+o),s.frequency.linearRampToValueAtTime(300-n*50,i+o+.15),r.gain.setValueAtTime(.2,i+o),r.gain.exponentialRampToValueAtTime(.01,i+o+.15),s.connect(r),r.connect(a),s.start(i+o),s.stop(i+o+.15)})}static playGhostCharge(t,a){const i=t.currentTime,o=t.createOscillator(),n=t.createOscillator(),s=t.createGain();o.type="sine",n.type="triangle",o.frequency.setValueAtTime(300,i),o.frequency.linearRampToValueAtTime(600,i+.8),n.frequency.setValueAtTime(305,i),n.frequency.linearRampToValueAtTime(605,i+.8),s.gain.setValueAtTime(.1,i),s.gain.linearRampToValueAtTime(.01,i+.8),o.connect(s),n.connect(s),s.connect(a),o.start(i),n.start(i),o.stop(i+.8),n.stop(i+.8)}static playThud(t,a){const i=t.currentTime;[45,48,90].forEach(r=>{const d=t.createOscillator(),f=t.createGain(),c=t.createBiquadFilter();d.type="sawtooth",d.frequency.value=r,c.type="lowpass",c.frequency.value=200,f.gain.setValueAtTime(0,i),f.gain.linearRampToValueAtTime(.6,i+.05),f.gain.exponentialRampToValueAtTime(.01,i+.25),d.connect(c),c.connect(f),f.connect(a),d.start(i),d.stop(i+.3)});const n=t.createOscillator(),s=t.createGain();n.type="sine",n.frequency.value=30,s.gain.setValueAtTime(.8,i),s.gain.exponentialRampToValueAtTime(.01,i+.3),n.connect(s),s.connect(a),n.start(i),n.stop(i+.3)}static playNormalStep(t,a,i){const o=t.currentTime;if(i){const r=t.createBufferSource();r.buffer=i;const d=t.createBiquadFilter();d.type="lowpass",d.frequency.value=2500;const f=t.createGain();f.gain.setValueAtTime(.5,o),f.gain.exponentialRampToValueAtTime(.01,o+.15),r.connect(d),d.connect(f),f.connect(a),r.start(o),r.stop(o+.15)}const n=t.createOscillator(),s=t.createGain();n.type="triangle",n.frequency.setValueAtTime(100,o),n.frequency.exponentialRampToValueAtTime(50,o+.1),s.gain.setValueAtTime(.5,o),s.gain.exponentialRampToValueAtTime(.01,o+.1),n.connect(s),s.connect(a),n.start(o),n.stop(o+.1)}static playRoar(t,a,i){const o=t.currentTime,n=t.createOscillator(),s=t.createOscillator(),r=t.createGain(),d=t.createGain();n.type="sawtooth",n.frequency.setValueAtTime(150,o),n.frequency.exponentialRampToValueAtTime(50,o+1.5),s.type="square",s.frequency.value=45,r.gain.setValueAtTime(200,o),r.gain.exponentialRampToValueAtTime(50,o+1.5),s.connect(r),r.connect(n.frequency),d.gain.setValueAtTime(0,o),d.gain.linearRampToValueAtTime(.6,o+.1),d.gain.exponentialRampToValueAtTime(.01,o+1.5),n.connect(d),d.connect(a),n.start(o),s.start(o),n.stop(o+1.5),s.stop(o+1.5)}static playBatBreak(t,a){const i=t.currentTime,o=t.createOscillator(),n=t.createGain();o.type="sawtooth",o.frequency.setValueAtTime(150,i),o.frequency.exponentialRampToValueAtTime(50,i+.1),n.gain.setValueAtTime(.5,i),n.gain.exponentialRampToValueAtTime(.01,i+.1),o.connect(n),n.connect(a),o.start(i),o.stop(i+.1);const s=t.createOscillator(),r=t.createGain();s.type="square",s.frequency.value=1e3,r.gain.setValueAtTime(.3,i),r.gain.exponentialRampToValueAtTime(.01,i+.2),s.connect(r),r.connect(a),s.start(i),s.stop(i+.2)}static playFirework(t,a,i){const o=t.currentTime,n=t.createOscillator(),s=t.createGain();if(n.type="square",n.frequency.setValueAtTime(600,o),n.frequency.exponentialRampToValueAtTime(150,o+.4),s.gain.setValueAtTime(.3,o),s.gain.exponentialRampToValueAtTime(.01,o+.3),n.connect(s),s.connect(a),n.start(o),n.stop(o+.4),i){const r=t.createBufferSource();r.buffer=i;const d=t.createGain();d.gain.setValueAtTime(.4,o),d.gain.exponentialRampToValueAtTime(.01,o+.3);const f=t.createBiquadFilter();f.type="lowpass",f.frequency.value=5e3,r.connect(f),f.connect(d),d.connect(a),r.start(o),r.stop(o+.3)}}static playThunder(t,a,i,o=1){if(!i)return;const n=t.currentTime,s=t.createBufferSource();s.buffer=i;const r=t.createBiquadFilter(),d=t.createGain();r.type="lowpass",r.frequency.setValueAtTime(800,n),r.frequency.exponentialRampToValueAtTime(100,n+1.5),d.gain.setValueAtTime(o,n),d.gain.exponentialRampToValueAtTime(.01,n+1.5),s.connect(r),r.connect(d),d.connect(a),s.start(n),s.stop(n+1.5)}static playFanfare(t,a){const i=t.currentTime;[{f:523.25,t:0,d:.15},{f:523.25,t:.15,d:.15},{f:523.25,t:.3,d:.15},{f:659.25,t:.45,d:.3},{f:523.25,t:.75,d:.15},{f:783.99,t:.9,d:.6}].forEach(n=>{const s=t.createOscillator(),r=t.createGain();s.type="sawtooth",s.frequency.setValueAtTime(n.f,i+n.t),r.gain.setValueAtTime(0,i+n.t),r.gain.linearRampToValueAtTime(.2,i+n.t+.05),r.gain.linearRampToValueAtTime(.15,i+n.t+n.d-.05),r.gain.linearRampToValueAtTime(0,i+n.t+n.d),s.connect(r),r.connect(a),s.start(i+n.t),s.stop(i+n.t+n.d)})}static playDigitalEntrance(t,a){const i=t.currentTime,o=1,n=t.createOscillator(),s=t.createGain();n.type="square",n.frequency.setValueAtTime(400,i),n.frequency.exponentialRampToValueAtTime(800,i+.5),n.frequency.exponentialRampToValueAtTime(100,i+1);const r=t.createOscillator(),d=t.createGain();r.type="square",r.frequency.value=30,d.gain.value=50,r.connect(d),d.connect(n.frequency),s.gain.setValueAtTime(0,i),s.gain.linearRampToValueAtTime(.15,i+.1),s.gain.linearRampToValueAtTime(.1,i+.5),s.gain.exponentialRampToValueAtTime(.01,i+o),n.connect(s),s.connect(a),n.start(i),r.start(i),n.stop(i+o),r.stop(i+o);const f=t.createOscillator(),c=t.createGain();f.type="square",f.frequency.setValueAtTime(2e3,i),f.frequency.setValueAtTime(3e3,i+.1),f.frequency.setValueAtTime(2500,i+.2),c.gain.setValueAtTime(.05,i),c.gain.exponentialRampToValueAtTime(.01,i+.3),f.connect(c),c.connect(a),f.start(i),f.stop(i+.3)}static playCheer(t,a,i){if(!i)return;const o=t.currentTime,n=t.createBufferSource();n.buffer=i;const s=t.createBiquadFilter(),r=t.createGain();s.type="bandpass",s.frequency.setValueAtTime(1e3,o),s.Q.value=.5,r.gain.setValueAtTime(0,o),r.gain.linearRampToValueAtTime(.4,o+.5),r.gain.exponentialRampToValueAtTime(.01,o+2),n.connect(s),s.connect(r),r.connect(a),n.start(o),n.stop(o+2)}static playLightStep(t,a){const i=t.currentTime,o=t.createOscillator(),n=t.createGain();o.type="triangle",o.frequency.setValueAtTime(800,i),o.frequency.exponentialRampToValueAtTime(400,i+.05),n.gain.setValueAtTime(.1,i),n.gain.exponentialRampToValueAtTime(.01,i+.05),o.connect(n),n.connect(a),o.start(i),o.stop(i+.05)}static playAceStep(t,a,i){const o=t.currentTime;if(i){const r=t.createBufferSource();r.buffer=i;const d=t.createBiquadFilter();d.type="lowpass",d.frequency.value=1200;const f=t.createGain();f.gain.setValueAtTime(.4,o),f.gain.exponentialRampToValueAtTime(.01,o+.12),r.connect(d),d.connect(f),f.connect(a),r.start(o),r.stop(o+.12)}const n=t.createOscillator(),s=t.createGain();n.type="sine",n.frequency.setValueAtTime(80,o),n.frequency.exponentialRampToValueAtTime(40,o+.1),s.gain.setValueAtTime(.3,o),s.gain.exponentialRampToValueAtTime(.01,o+.1),n.connect(s),s.connect(a),n.start(o),n.stop(o+.1)}static playAceEntrance(t,a){const i=t.currentTime;[261.63,329.63,392,493.88,587.33].forEach((n,s)=>{const r=t.createOscillator(),d=t.createGain(),f=t.createOscillator(),c=t.createGain();f.type="sine",f.frequency.value=n*.5,c.gain.value=100,f.connect(c),c.connect(r.frequency),r.type="sine",r.frequency.setValueAtTime(n,i),d.gain.setValueAtTime(0,i),d.gain.linearRampToValueAtTime(.1,i+.2),d.gain.exponentialRampToValueAtTime(.01,i+1.5),r.connect(d),d.connect(a),r.start(i),f.start(i),r.stop(i+1.5),f.stop(i+1.5)})}static playWoosh(t,a,i){if(!i)return;const o=t.currentTime,n=t.createBufferSource();n.buffer=i;const s=t.createBiquadFilter(),r=t.createGain();s.type="bandpass",s.frequency.setValueAtTime(400,o),s.frequency.exponentialRampToValueAtTime(1200,o+.3),s.frequency.exponentialRampToValueAtTime(200,o+.8),s.Q.value=1,r.gain.setValueAtTime(0,o),r.gain.linearRampToValueAtTime(.4,o+.2),r.gain.linearRampToValueAtTime(.01,o+.8),n.connect(s),s.connect(r),r.connect(a),n.start(o),n.stop(o+.8)}static playKick(t,a,i){const o=t.createOscillator(),n=t.createGain();o.frequency.setValueAtTime(150,i),o.frequency.exponentialRampToValueAtTime(.01,i+.5),n.gain.setValueAtTime(.8,i),n.gain.exponentialRampToValueAtTime(.01,i+.5),o.connect(n),n.connect(a),o.start(i),o.stop(i+.5)}static playSnare(t,a,i,o){if(!o)return;const n=t.createBufferSource();n.buffer=o;const s=t.createGain();s.gain.setValueAtTime(.4,i),s.gain.exponentialRampToValueAtTime(.01,i+.2),n.connect(s),s.connect(a),n.start(i),n.stop(i+.2);const r=t.createOscillator(),d=t.createGain();r.frequency.setValueAtTime(250,i),r.frequency.exponentialRampToValueAtTime(100,i+.1),d.gain.setValueAtTime(.3,i),d.gain.exponentialRampToValueAtTime(.01,i+.1),r.connect(d),d.connect(a),r.start(i),r.stop(i+.1)}static playHiHat(t,a,i,o){if(!o)return;const n=t.createBufferSource();n.buffer=o;const s=t.createBiquadFilter();s.type="highpass",s.frequency.value=8e3;const r=t.createGain();r.gain.setValueAtTime(.15,i),r.gain.exponentialRampToValueAtTime(.01,i+.05),n.connect(s),s.connect(r),r.connect(a),n.start(i),n.stop(i+.05)}static playBassNote(t,a,i,o,n){const s=t.createOscillator(),r=t.createGain();s.type="triangle",s.frequency.setValueAtTime(i,o),r.gain.setValueAtTime(.5,o),r.gain.exponentialRampToValueAtTime(.01,o+n),s.connect(r),r.connect(a),s.start(o),s.stop(o+n)}static playMelodyNote(t,a,i,o,n){const s=t.createOscillator(),r=t.createGain();s.type="square",s.frequency.setValueAtTime(i,o),r.gain.setValueAtTime(.05,o),r.gain.exponentialRampToValueAtTime(.01,o+n-.05);const d=t.createOscillator(),f=t.createGain();d.type="sawtooth",d.frequency.setValueAtTime(i-2,o),f.gain.setValueAtTime(.03,o),f.gain.exponentialRampToValueAtTime(.01,o+n-.05),s.connect(r),r.connect(a),s.start(o),s.stop(o+n),d.connect(f),f.connect(a),d.start(o),d.stop(o+n)}static _playBopSound(t,a,i,o){const n=t.createOscillator(),s=t.createGain();n.type="sine",n.frequency.setValueAtTime(400,i),n.frequency.exponentialRampToValueAtTime(300,i+.3),s.gain.setValueAtTime(o,i),s.gain.exponentialRampToValueAtTime(.01,i+.3),n.connect(s),s.connect(a),n.start(i),n.stop(i+.35)}static playEquip(t,a){this._playBopSound(t,a,t.currentTime,.3)}static playPurchase(t,a){const i=t.currentTime;[1200,1500,1800,2200].forEach((s,r)=>{const d=t.createOscillator(),f=t.createGain(),c=i+r*.05;d.type="sine",d.frequency.setValueAtTime(s,c),f.gain.setValueAtTime(.1,c),f.gain.exponentialRampToValueAtTime(.01,c+.1),d.connect(f),f.connect(a),d.start(c),d.stop(c+.1)}),[523.25,659.25,783.99,1046.5].forEach((s,r)=>{const d=t.createOscillator(),f=t.createGain();d.type="triangle",d.frequency.setValueAtTime(s,i),f.gain.setValueAtTime(0,i),f.gain.linearRampToValueAtTime(.1,i+.1),f.gain.exponentialRampToValueAtTime(.01,i+.6),d.connect(f),f.connect(a),d.start(i),d.stop(i+.6)})}static playZigZag(t,a){const i=t.currentTime,o=t.createOscillator(),n=t.createGain(),s=t.createOscillator(),r=t.createGain();o.type="square",o.frequency.setValueAtTime(800,i),o.frequency.exponentialRampToValueAtTime(100,i+.5),s.type="sawtooth",s.frequency.value=60,r.gain.value=500,s.connect(r),r.connect(o.frequency),n.gain.setValueAtTime(.3,i),n.gain.exponentialRampToValueAtTime(.01,i+.5),o.connect(n),n.connect(a),o.start(i),o.stop(i+.5),s.start(i),s.stop(i+.5)}static playKick(t,a,i){const o=t.createOscillator(),n=t.createGain();o.frequency.setValueAtTime(150,i),o.frequency.exponentialRampToValueAtTime(.01,i+.5),n.gain.setValueAtTime(.8,i),n.gain.exponentialRampToValueAtTime(.01,i+.5),o.connect(n),n.connect(a),o.start(i),o.stop(i+.5)}static playSnare(t,a,i,o){if(!o)return;const n=t.createBufferSource();n.buffer=o;const s=t.createGain();s.gain.setValueAtTime(.4,i),s.gain.exponentialRampToValueAtTime(.01,i+.2),n.connect(s),s.connect(a),n.start(i),n.stop(i+.2);const r=t.createOscillator(),d=t.createGain();r.frequency.setValueAtTime(250,i),r.frequency.exponentialRampToValueAtTime(100,i+.1),d.gain.setValueAtTime(.3,i),d.gain.exponentialRampToValueAtTime(.01,i+.1),r.connect(d),d.connect(a),r.start(i),r.stop(i+.1)}static playHiHat(t,a,i,o){if(!o)return;const n=t.createBufferSource();n.buffer=o;const s=t.createBiquadFilter();s.type="highpass",s.frequency.value=8e3;const r=t.createGain();r.gain.setValueAtTime(.15,i),r.gain.exponentialRampToValueAtTime(.01,i+.05),n.connect(s),s.connect(r),r.connect(a),n.start(i),n.stop(i+.05)}static playBassNote(t,a,i,o,n){const s=t.createOscillator(),r=t.createGain();s.type="triangle",s.frequency.setValueAtTime(i,o),r.gain.setValueAtTime(.5,o),r.gain.exponentialRampToValueAtTime(.01,o+n),s.connect(r),r.connect(a),s.start(o),s.stop(o+n)}static playMelodyNote(t,a,i,o,n){const s=t.createOscillator(),r=t.createGain();s.type="square",s.frequency.setValueAtTime(i,o),r.gain.setValueAtTime(.05,o),r.gain.exponentialRampToValueAtTime(.01,o+n-.05);const d=t.createOscillator(),f=t.createGain();d.type="sawtooth",d.frequency.setValueAtTime(i-2,o),f.gain.setValueAtTime(.03,o),f.gain.exponentialRampToValueAtTime(.01,o+n-.05),s.connect(r),r.connect(a),s.start(o),s.stop(o+n),d.connect(f),f.connect(a),d.start(o),d.stop(o+n)}static playTheme(t,a,i){const s=.6382978723404256/4,r=261.63,d=293.66,f=329.63,c=392,u=440,h=523.25,g=65.41,m=87.31,p=98,T=110,v={K:[1,0,0,1,0,0,1,0,0,0,1,0,0,1,0,0],S:[0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0],H:[1,0,1,0,1,0,1,0,1,0,1,0,1,1,1,0]},y={0:{note:r,len:2},2:{note:h,len:2},4:{note:u,len:2},6:{note:c,len:2},8:{note:f,len:2},10:{note:c,len:2},12:{note:d,len:8},32:{note:r,len:2},34:{note:h,len:2},36:{note:u,len:2},38:{note:c,len:2},40:{note:f,len:2},42:{note:c,len:2},44:{note:u,len:8}},S={0:{note:g,len:3},3:{note:g,len:1},4:{note:g,len:2},7:{note:m,len:1},8:{note:p,len:4},14:{note:p,len:2},16:{note:g,len:3},20:{note:g,len:2},24:{note:p,len:4},30:{note:T,len:2},32:{note:m,len:3},36:{note:m,len:2},40:{note:g,len:4},46:{note:g,len:2},48:{note:p,len:3},52:{note:p,len:2},56:{note:g,len:4},62:{note:g,len:2}};let _=0,A=t.currentTime;const E=typeof i=="object"?i:null;return(function P(){for(;A<t.currentTime+.1;){const M=_%16,I=_%64;if(v.K[M]&&ae.playKick(t,a,A),v.S[M]&&ae.playSnare(t,a,A,E),v.H[M]&&ae.playHiHat(t,a,A,E),y[I]){const L=y[I];ae.playMelodyNote(t,a,L.note,A,L.len*s)}if(S[I]){const L=S[I];ae.playBassNote(t,a,L.note,A,L.len*s)}A+=s,_++}return setTimeout(P,25)})()}static playHauntedTheme(t,a,i){const s=.6382978723404256/4,r=261.63,d=293.66,f=311.13,c=392,u=415.3,h=523.25,g=65.41,m=98,p=87.31,T={0:{note:r,len:4},4:{note:h,len:4},8:{note:u,len:4},12:{note:c,len:4},16:{note:f,len:4},20:{note:c,len:4},24:{note:d,len:12},48:{note:r,len:4},52:{note:h,len:4},56:{note:u,len:4},60:{note:c,len:4},64:{note:f,len:4},68:{note:c,len:4},72:{note:u,len:12}},v={0:{note:g,len:6},12:{note:m,len:6},24:{note:m,len:6},36:{note:g,len:6},48:{note:g,len:6},60:{note:g,len:6},72:{note:p,len:6},84:{note:m,len:6}};let y=0,S=t.currentTime;const _=typeof i=="object"?i:null,A=(M,I,L)=>{const w=t.createOscillator(),U=t.createGain(),k=t.createOscillator(),B=t.createGain();w.type="triangle",w.frequency.setValueAtTime(M,I),k.frequency.value=4.5,B.gain.value=6,k.connect(B),B.connect(w.frequency),U.gain.setValueAtTime(0,I),U.gain.linearRampToValueAtTime(.12,I+.05),U.gain.exponentialRampToValueAtTime(.08,I+L-.1),U.gain.linearRampToValueAtTime(0,I+L),w.connect(U),U.connect(a),w.start(I),k.start(I),w.stop(I+L),k.stop(I+L)},E=(M,I,L)=>{const w=t.createOscillator(),U=t.createGain();w.type="sawtooth",w.frequency.setValueAtTime(M,I);const k=t.createBiquadFilter();k.type="lowpass",k.frequency.value=150,U.gain.setValueAtTime(.15,I),U.gain.exponentialRampToValueAtTime(.01,I+L),w.connect(k),k.connect(U),U.connect(a),w.start(I),w.stop(I+L)},P=M=>{if(!_)return;const I=t.createBufferSource();I.buffer=_;const L=t.createBiquadFilter();L.type="lowpass",L.frequency.setValueAtTime(200,M),L.frequency.linearRampToValueAtTime(600,M+2),L.frequency.linearRampToValueAtTime(100,M+4);const w=t.createGain();w.gain.setValueAtTime(0,M),w.gain.linearRampToValueAtTime(.1,M+1),w.gain.linearRampToValueAtTime(0,M+4),I.connect(L),L.connect(w),w.connect(a),I.start(M),I.stop(M+4)};return(function M(){for(;S<t.currentTime+.1;){const I=y%96;if(I%48===0&&P(S),T[I]){const L=T[I];A(L.note,S,L.len*s)}if(v[I]){const L=v[I];E(L.note,S,L.len*s)}S+=s,y++}return setTimeout(M,25)})()}static playIntroReveal(t,a){this.playPerfectHit(t,a)}static playIntroImpact(t,a){const i=t.currentTime,o=t.createOscillator(),n=t.createGain();o.type="sine",o.frequency.setValueAtTime(120,i),o.frequency.exponentialRampToValueAtTime(30,i+.5),n.gain.setValueAtTime(.8,i),n.gain.exponentialRampToValueAtTime(.01,i+.5),o.connect(n),n.connect(a),o.start(i),o.stop(i+.5);const s=t.sampleRate*.2,r=t.createBuffer(1,s,t.sampleRate),d=r.getChannelData(0);for(let h=0;h<s;h++)d[h]=Math.random()*2-1;const f=t.createBufferSource();f.buffer=r;const c=t.createBiquadFilter();c.type="lowpass",c.frequency.setValueAtTime(800,i),c.frequency.exponentialRampToValueAtTime(100,i+.2);const u=t.createGain();u.gain.setValueAtTime(.6,i),u.gain.exponentialRampToValueAtTime(.01,i+.2),f.connect(c),c.connect(u),u.connect(a),f.start(i)}static playIntroSlam(t,a){const i=t.currentTime,o=t.createOscillator(),n=t.createGain();o.type="sine",o.frequency.setValueAtTime(60,i),o.frequency.exponentialRampToValueAtTime(30,i+.4),n.gain.setValueAtTime(.8,i),n.gain.exponentialRampToValueAtTime(.01,i+.4),o.connect(n),n.connect(a),o.start(i),o.stop(i+.4),[261.63,329.63,392].forEach((f,c)=>{const u=t.createOscillator(),h=t.createGain();u.type="sawtooth",u.frequency.value=f+c*1.5,h.gain.setValueAtTime(0,i),h.gain.linearRampToValueAtTime(.2,i+.02),h.gain.exponentialRampToValueAtTime(.01,i+.5);const g=t.createBiquadFilter();g.type="lowpass",g.frequency.setValueAtTime(3e3,i),g.frequency.linearRampToValueAtTime(500,i+.3),u.connect(g),g.connect(h),h.connect(a),u.start(i),u.stop(i+.5)});const r=t.createOscillator(),d=t.createGain();r.type="triangle",r.frequency.setValueAtTime(2e3,i),r.frequency.exponentialRampToValueAtTime(4e3,i+.2),d.gain.setValueAtTime(.05,i),d.gain.exponentialRampToValueAtTime(.01,i+.2),r.connect(d),d.connect(a),r.start(i),r.stop(i+.2)}}class Ls{constructor(){this.audioContext=null,this.initialized=!1,this.themeOscillators=[],this.themeTimer=null,this.themePlaying=!1,this.noiseBuffer=null,this.masterGain=null,this.themeGain=null}init(){return this.initialized?Promise.resolve():(document.addEventListener("visibilitychange",()=>this._handleVisibilityChange()),window.addEventListener("pageshow",()=>this._handleVisibilityChange()),document.addEventListener("touchstart",()=>this._handleInteraction()),document.addEventListener("click",()=>this._handleInteraction()),new Promise(t=>{try{this.audioContext=new(window.AudioContext||window.webkitAudioContext),this.masterGain=this.audioContext.createGain(),this.masterGain.connect(this.audioContext.destination),this.audioContext.resume().catch(()=>{}),this._finishInit(),t()}catch{console.warn("Web Audio API not supported"),t()}}))}_handleVisibilityChange(){document.hidden?this.suspendAudio():this._checkAndResume()}_handleInteraction(){this._checkAndResume()}_checkAndResume(){this.audioContext&&(this.audioContext.state==="suspended"||this.audioContext.state==="interrupted")&&this.audioContext.resume().catch(()=>{})}suspendAudio(){this.audioContext&&this.audioContext.state==="running"&&this.audioContext.suspend().catch(()=>{})}_finishInit(){if(this.initialized)return;const t=this.audioContext.createBuffer(1,1,22050),a=this.audioContext.createBufferSource();a.buffer=t,a.connect(this.audioContext.destination),a.start(0);const i=this.audioContext.createOscillator(),o=this.audioContext.createGain();i.type="sine",i.frequency.value=1,o.gain.value=1e-4,i.connect(o),o.connect(this.audioContext.destination),i.start(0),this.initialized=!0}_createNoiseBuffer(){if(this.noiseBuffer)return;const t=this.audioContext.sampleRate*2,a=this.audioContext.createBuffer(1,t,this.audioContext.sampleRate),i=a.getChannelData(0);for(let o=0;o<t;o++)i[o]=Math.random()*2-1;this.noiseBuffer=a}warmup(){if(!this.initialized)return;const t=this.audioContext,a=t.currentTime;console.log("[SoundManager] Warming up DSP (Safe Mode)..."),["sawtooth","square","triangle","sine"].forEach(i=>{const o=t.createOscillator(),n=t.createGain();o.type=i,o.frequency.value=440,n.gain.value=0,o.connect(n),n.connect(this.masterGain),o.start(a),o.stop(a+.05)});for(let i=0;i<5;i++){const o=t.createOscillator(),n=t.createGain();o.type="square",n.gain.value=0,o.connect(n),n.connect(this.masterGain),o.start(a),o.stop(a+.05)}this.noiseBuffer||this._createNoiseBuffer()}playSwing(){l.settings?.muteSound||!this.initialized||ae.playSwing(this.audioContext,this.masterGain)}playPause(t){l.settings?.muteSound||!this.initialized||ae.playPause(this.audioContext,this.masterGain,t)}playHit(){l.settings?.muteSound||!this.initialized||ae.playHit(this.audioContext,this.masterGain)}playPerfectHit(){l.settings?.muteSound||!this.initialized||ae.playPerfectHit(this.audioContext,this.masterGain)}playFoul(){l.settings?.muteSound||!this.initialized||ae.playFoul(this.audioContext,this.masterGain)}playStrike(){l.settings?.muteSound||!this.initialized||ae.playStrike(this.audioContext,this.masterGain)}playStrikesCleared(){l.settings?.muteSound||!this.initialized||ae.playStrikesCleared(this.audioContext,this.masterGain)}playLevelUp(){l.settings?.muteSound||!this.initialized||ae.playLevelUp(this.audioContext,this.masterGain)}playPitch(){l.settings?.muteSound||!this.initialized||ae.playPitch(this.audioContext,this.masterGain)}playCurveCharge(){l.settings?.muteSound||!this.initialized||ae.playCurveCharge(this.audioContext,this.masterGain)}playChangeCharge(){l.settings?.muteSound||!this.initialized||ae.playChangeCharge(this.audioContext,this.masterGain)}playSuperCharge(){l.settings?.muteSound||!this.initialized||ae.playSuperCharge(this.audioContext,this.masterGain)}playSplitterCharge(){l.settings?.muteSound||!this.initialized||ae.playSplitterCharge(this.audioContext,this.masterGain)}playZigZagCharge(){l.settings?.muteSound||!this.initialized||ae.playZigZagCharge(this.audioContext,this.masterGain)}playStopCharge(){l.settings?.muteSound||!this.initialized||ae.playStopCharge(this.audioContext,this.masterGain)}stopTheme(){if(this.themePlaying=!1,this.themeTimer&&(clearTimeout(this.themeTimer),this.themeTimer=null),this.themeGain){const t=this.audioContext.currentTime;this.themeGain.gain.cancelScheduledValues(t),this.themeGain.gain.setValueAtTime(this.themeGain.gain.value,t),this.themeGain.gain.linearRampToValueAtTime(0,t+.05),setTimeout(()=>{!this.themePlaying&&this.themeGain&&(this.themeGain.disconnect(),this.themeGain=null)},100)}}playEvilLaugh(){l.settings?.muteSound||!this.initialized||ae.playEvilLaugh(this.audioContext,this.masterGain)}playGhostCharge(){l.settings?.muteSound||!this.initialized||ae.playGhostCharge(this.audioContext,this.masterGain)}playThud(){l.settings?.muteSound||!this.initialized||ae.playThud(this.audioContext,this.masterGain)}playNormalStep(){l.settings?.muteSound||!this.initialized||(this.noiseBuffer||this._createNoiseBuffer(),ae.playNormalStep(this.audioContext,this.masterGain,this.noiseBuffer))}playRoar(){l.settings?.muteSound||!this.initialized||(this.noiseBuffer||this._createNoiseBuffer(),ae.playRoar(this.audioContext,this.masterGain,this.noiseBuffer))}playBatBreak(){l.settings?.muteSound||!this.initialized||ae.playBatBreak(this.audioContext,this.masterGain)}playFirework(){l.settings?.muteSound||!this.initialized||(this.noiseBuffer||this._createNoiseBuffer(),ae.playFirework(this.audioContext,this.masterGain,this.noiseBuffer))}playSettingsOpen(){l.settings?.muteSound||!this.initialized||ae.playSettingsOpen(this.audioContext,this.masterGain)}playSettingsClose(){l.settings?.muteSound||!this.initialized||ae.playSettingsClose(this.audioContext,this.masterGain)}playSettingsToggle(){l.settings?.muteSound||!this.initialized||ae.playSettingsToggle(this.audioContext,this.masterGain)}playUnlockablesOpen(){l.settings?.muteSound||!this.initialized||ae.playUnlockablesOpen(this.audioContext,this.masterGain)}playUnlockablesClose(){l.settings?.muteSound||!this.initialized||ae.playUnlockablesClose(this.audioContext,this.masterGain)}playItemAlreadyEquipped(){l.settings?.muteSound||!this.initialized||(this.audioContext.state==="suspended"&&this.audioContext.resume(),ae.playItemAlreadyEquipped(this.audioContext,this.masterGain))}playEquip(){if(l.settings?.muteSound||!this.audioContext&&!this.initialized)return;const t=this.audioContext;t&&t.state==="suspended"&&t.resume(),t&&ae.playEquip(t,this.masterGain)}playZigZag(){l.settings?.muteSound||!this.initialized||ae.playZigZag(this.audioContext,this.masterGain)}playPurchase(){l.settings?.muteSound||!this.initialized||ae.playPurchase(this.audioContext,this.masterGain)}playError(){l.settings?.muteSound||!this.initialized||ae.playError(this.audioContext,this.masterGain)}playThunder(t=1){l.settings?.muteSound||!this.initialized||(this.noiseBuffer||this._createNoiseBuffer(),ae.playThunder(this.audioContext,this.masterGain,this.noiseBuffer,t))}playFanfare(){l.settings?.muteSound||!this.initialized||ae.playFanfare(this.audioContext,this.masterGain)}playCheer(){l.settings?.muteSound||!this.initialized||(this.noiseBuffer||this._createNoiseBuffer(),ae.playCheer(this.audioContext,this.masterGain,this.noiseBuffer))}playLightStep(){l.settings?.muteSound||!this.initialized||ae.playLightStep(this.audioContext,this.masterGain)}playAceStep(){l.settings?.muteSound||!this.initialized||(this.noiseBuffer||this._createNoiseBuffer(),ae.playAceStep(this.audioContext,this.masterGain,this.noiseBuffer))}playAceEntrance(){l.settings?.muteSound||!this.initialized||ae.playAceEntrance(this.audioContext,this.masterGain)}playWoosh(){l.settings?.muteSound||!this.initialized||(this.noiseBuffer||this._createNoiseBuffer(),ae.playWoosh(this.audioContext,this.masterGain,this.noiseBuffer))}playDigitalEntrance(){l.settings?.muteSound||!this.initialized||ae.playDigitalEntrance(this.audioContext,this.masterGain)}playTheme(){l.settings?.muteMusic||!this.initialized||this.themePlaying||(this.themePlaying=!0,this.themeGain&&this.themeGain.disconnect(),this.themeGain=this.audioContext.createGain(),this.themeGain.gain.value=1,this.themeGain.connect(this.masterGain),this.noiseBuffer||this._createNoiseBuffer(),this.themeTimer=ae.playTheme(this.audioContext,this.themeGain,this.noiseBuffer))}playHauntedTheme(){l.settings?.muteMusic||!this.initialized||this.themePlaying||(this.themePlaying=!0,this.themeGain&&this.themeGain.disconnect(),this.themeGain=this.audioContext.createGain(),this.themeGain.gain.value=.8,this.themeGain.connect(this.masterGain),this.noiseBuffer||this._createNoiseBuffer(),this.themeTimer=ae.playHauntedTheme(this.audioContext,this.themeGain,this.noiseBuffer))}playIntroSlam(){l.settings?.muteSound||!this.initialized||ae.playIntroSlam(this.audioContext,this.masterGain)}playIntroReveal(){l.settings?.muteSound||!this.initialized||ae.playIntroReveal(this.audioContext,this.masterGain)}playIntroImpact(){l.settings?.muteSound||!this.initialized||ae.playIntroImpact(this.audioContext,this.masterGain)}}const D=new Ls,jo={[F.STOPBALL]:(e,t)=>{const a=l.bat.pivotY-e.startY,o=(e.y-e.startY)/a;return!e.hasPaused&&o>=.5&&(e.hasPaused=!0,e.pauseTimer=400),e.pauseTimer>0?(e.pauseTimer-=t,e.prevX=e.x,e.prevY=e.y,e.prevRotationAngle=e.rotationAngle,!0):!1},[F.GHOSTBALL]:(e,t)=>{const a=l.bat.pivotY-e.startY,o=(e.y-e.startY)/a;return o>.4&&o<.7?e.invisible=!0:e.invisible=!1,!1},[F.STOP_CURVE]:(e,t)=>{const a=l.bat.pivotY-e.startY,i=e.y-e.startY,o=i/a;if(!e.hasPaused&&o>=.5&&(e.hasPaused=!0,e.pauseTimer=400),e.pauseTimer>0)return e.pauseTimer-=t,e.prevX=e.x,e.prevY=e.y,e.prevRotationAngle=e.rotationAngle,!0;const n=Math.max(0,Math.min(1,i/a));let s=0;if(n<.75){const r=n/.75*Math.PI;s=Math.sin(r)*50,s=s*e.curveDirection}return e.x=e.startX+s,!1},[F.GHOST_CURVE]:(e,t)=>{const a=l.bat.pivotY-e.startY,i=e.y-e.startY,o=i/a;o>.4&&o<.7?e.invisible=!0:e.invisible=!1;const n=Math.max(0,Math.min(1,i/a));let s=0;if(n<.75){const r=n/.75*Math.PI;s=Math.sin(r)*50,s=s*e.curveDirection}return e.x=e.startX+s,!1},[F.SPLITTER]:(e,t)=>{const a=l.bat.pivotY-e.startY;return(e.y-e.startY)/a>.2?e.speedY=e.baseSpeedY*2.6:e.speedY=e.baseSpeedY*.6,!1},[F.CURVEBALL]:(e,t)=>{const a=l.bat.pivotY-e.startY,i=e.y-e.startY,o=Math.max(0,Math.min(1,i/a));let n=0;if(o<.75){const s=o/.75*Math.PI;n=Math.sin(s)*50,n=n*e.curveDirection}return e.x=e.startX+n,!1},[F.ZIGZAG]:(e,t)=>{const a=l.bat.pivotY-e.startY,i=e.y-e.startY,o=Math.max(0,Math.min(1,i/a));let n=0;return o<.25?n=o/.25*75:o<.5?n=75-(o-.25)/.25*150:o<.75?n=-75+(o-.5)/.25*75:n=0,e.x=e.startX+n*e.curveDirection,!1},[F.SUPER_CURVE]:(e,t)=>{const a=l.bat.pivotY-e.startY,i=e.y-e.startY,o=Math.max(0,Math.min(1,i/a));let n=0;if(o<.75){const s=o/.75*Math.PI;n=Math.sin(s)*75,n=n*e.curveDirection}return e.x=e.startX+n,!1},[F.SUPER_ZIGZAG]:(e,t)=>{const a=l.bat.pivotY-e.startY,i=e.y-e.startY,o=Math.max(0,Math.min(1,i/a));let n=0;return o<.25?n=o/.25*75:o<.5?n=75-(o-.25)/.25*150:o<.75?n=-75+(o-.5)/.25*75:n=0,e.x=e.startX+n*e.curveDirection,!1},[F.SUPER_SPLITTER]:(e,t)=>{const a=l.bat.pivotY-e.startY;return(e.y-e.startY)/a>.2?e.speedY=e.baseSpeedY*2.6:e.speedY=e.baseSpeedY*.6,!1},[F.STOP_SPLITTER]:(e,t)=>{const a=l.bat.pivotY-e.startY,o=(e.y-e.startY)/a;return!e.hasPaused&&o>=.5&&(e.hasPaused=!0,e.pauseTimer=400),e.pauseTimer>0?(e.pauseTimer-=t,e.prevX=e.x,e.prevY=e.y,e.prevRotationAngle=e.rotationAngle,!0):(o>.2?e.speedY=e.baseSpeedY*2.6:e.speedY=e.baseSpeedY*.6,!1)},[F.STOP_ZIGZAG]:(e,t)=>{const a=l.bat.pivotY-e.startY,i=e.y-e.startY,o=Math.max(0,Math.min(1,i/a));if(!e.hasPaused&&o>=.5&&(e.hasPaused=!0,e.pauseTimer=400),e.pauseTimer>0)return e.pauseTimer-=t,e.prevX=e.x,e.prevY=e.y,e.prevRotationAngle=e.rotationAngle,!0;let n=0;o<.25?n=o/.25*75:o<.5?n=75-(o-.25)/.25*150:o<.75?n=-75+(o-.5)/.25*75:n=0,e.x=e.startX+n*e.curveDirection},[F.GHOST_SPLITTER]:(e,t)=>{const a=l.bat.pivotY-e.startY,o=(e.y-e.startY)/a;return o>.4&&o<.7?e.invisible=!0:e.invisible=!1,o>.2?e.speedY=e.baseSpeedY*2.6:e.speedY=e.baseSpeedY*.6,!1},[F.GHOST_ZIGZAG]:(e,t)=>{const a=l.bat.pivotY-e.startY,i=e.y-e.startY,o=Math.max(0,Math.min(1,i/a));o>.4&&o<.7?e.invisible=!0:e.invisible=!1;let n=0;return o<.25?n=o/.25*75:o<.5?n=75-(o-.25)/.25*150:o<.75?n=-75+(o-.5)/.25*75:n=0,e.x=e.startX+n*e.curveDirection,!1},[F.GHOST_CHANGEUP]:(e,t)=>{const a=l.bat.pivotY-e.startY,o=(e.y-e.startY)/a;return o>.4&&o<.7?e.invisible=!0:e.invisible=!1,!1},[F.CURVE_SPLITTER]:(e,t)=>{const a=l.bat.pivotY-e.startY,i=e.y-e.startY,o=Math.max(0,Math.min(1,i/a));let n=0;if(o<.75){const s=o/.75*Math.PI;n=Math.sin(s)*50,n=n*e.curveDirection}return e.x=e.startX+n,o>.2?e.speedY=e.baseSpeedY*2.6:e.speedY=e.baseSpeedY*.6,!1},[F.ZIGZAG_SPLITTER]:(e,t)=>{const a=l.bat.pivotY-e.startY,i=e.y-e.startY,o=Math.max(0,Math.min(1,i/a));let n=0;return o<.25?n=o/.25*75:o<.5?n=75-(o-.25)/.25*150:o<.75?n=-75+(o-.5)/.25*75:n=0,e.x=e.startX+n*e.curveDirection,o>.2?e.speedY=e.baseSpeedY*2.6:e.speedY=e.baseSpeedY*.6,!1},[F.CURVE_CHANGEUP]:(e,t)=>{const a=l.bat.pivotY-e.startY,i=e.y-e.startY,o=Math.max(0,Math.min(1,i/a));let n=0;if(o<.75){const s=o/.75*Math.PI;n=Math.sin(s)*50,n=n*e.curveDirection}return e.x=e.startX+n,!1},[F.SPLITTER_CHANGEUP]:(e,t)=>{const a=l.bat.pivotY-e.startY;return(e.y-e.startY)/a>.2?e.speedY=e.baseSpeedY*2.5:e.speedY=e.baseSpeedY*.6,!1},[F.ZIGZAG_CHANGEUP]:(e,t)=>{const a=l.bat.pivotY-e.startY,i=e.y-e.startY,o=Math.max(0,Math.min(1,i/a));let n=0;return o<.25?n=o/.25*75:o<.5?n=75-(o-.25)/.25*150:o<.75?n=-75+(o-.5)/.25*75:n=0,e.x=e.startX+n*e.curveDirection,!1},[F.GHOST_STOP]:(e,t)=>{const a=l.bat.pivotY-e.startY,i=e.y-e.startY,o=Math.max(0,Math.min(1,i/a));return o>.4&&o<.7?e.invisible=!0:e.invisible=!1,!e.hasPaused&&o>=.5&&(e.hasPaused=!0,e.pauseTimer=400),e.pauseTimer>0?(e.pauseTimer-=t,e.prevX=e.x,e.prevY=e.y,e.prevRotationAngle=e.rotationAngle,!0):!1},[F.GHOST_SUPER]:(e,t)=>{const a=l.bat.pivotY-e.startY,i=e.y-e.startY,o=Math.max(0,Math.min(1,i/a));return o>.4&&o<.7?e.invisible=!0:e.invisible=!1,!1},[F.STOP_SUPER]:(e,t)=>{const a=l.bat.pivotY-e.startY,i=e.y-e.startY,o=Math.max(0,Math.min(1,i/a));return!e.hasPaused&&o>=.5&&(e.hasPaused=!0,e.pauseTimer=400),e.pauseTimer>0?(e.pauseTimer-=t,e.prevX=e.x,e.prevY=e.y,e.prevRotationAngle=e.rotationAngle,!0):!1},[F.STOP_CHANGEUP]:(e,t)=>{const a=l.bat.pivotY-e.startY,i=e.y-e.startY,o=Math.max(0,Math.min(1,i/a));return!e.hasPaused&&o>=.5&&(e.hasPaused=!0,e.pauseTimer=400),e.pauseTimer>0?(e.pauseTimer-=t,e.prevX=e.x,e.prevY=e.y,e.prevRotationAngle=e.rotationAngle,!0):!1}};let Qa=null,Jo=0;function Os(e){const i=Math.ceil(140*e),o=Math.ceil(180*e);let n;typeof OffscreenCanvas<"u"?n=new OffscreenCanvas(i,o):(n=document.createElement("canvas"),n.width=i,n.height=o);const s=n.getContext("2d");s.translate(i/2,40*e),s.scale(e,e);const r="#1a1d23",d="#2c3036";s.fillStyle=r,s.fillRect(-80/2,0,80,120),s.fillStyle="#111",s.fillRect(-25,10,8,100),s.fillRect(17,10,8,100),s.fillRect(-4,15,8,90),s.fillStyle=d,s.fillRect(-80/2-10,100,100,20),s.beginPath(),s.moveTo(-80/2-15,0),s.lineTo(80/2+15,0),s.lineTo(80/2+5,25),s.lineTo(-80/2-5,25),s.fill();const f=-5;s.fillStyle="#0a0a0a",s.beginPath(),s.arc(0,f,35,0,Math.PI,!1),s.fill(),s.strokeStyle="#000",s.lineWidth=4,s.beginPath(),s.moveTo(-35,f),s.lineTo(-45,f-40),s.moveTo(35,f),s.lineTo(45,f-40),s.stroke(),s.save();const c=m=>{let p=m+=1831565813;return p=Math.imul(p^p>>>15,p|1),p^=p+Math.imul(p^p>>>7,p|61),((p^p>>>14)>>>0)/4294967296};s.fillStyle="rgba(0,0,0,0.15)";const u=150,h=-80/2,g=0;for(let m=0;m<u;m++){const p=h+c(m*11)*80,T=g+c(m*33)*120,v=c(m*55)*3+1;s.fillRect(p,T,v,v)}return s.fillStyle="rgba(0,0,0,0.3)",s.fillRect(-26,10,2,100),s.fillRect(16,10,2,100),s.restore(),n}function Bn(e,t,a,i=1,o=!1,n=0,s=!1){(!Qa||Jo!==i)&&(Qa=Os(i),Jo=i);const r=Qa.width;Qa.height,e.drawImage(Qa,t-r/2,a-40*i);const d=l.isGameOver&&!s,f=n,g=(d?"RED":"CYAN")==="RED"?{core:"#fbe9e7",mid:"#ff7043",outer:"#b71c1c",glow:"rgba(255, 87, 34, 0.4)",text:"#3e2723"}:{core:"#e0f7fa",mid:"#4dd0e1",outer:"#006064",text:"#006064"};e.save(),e.translate(t,a),e.scale(i,i);const p=-5-60,T=Date.now()/1e3,v=Math.sin(T*3)*.1+1;e.save(),e.shadowColor=g.mid,e.shadowBlur=80*v,e.fillStyle="rgba(0,0,0,0)",e.beginPath(),e.arc(0,p,60,0,Math.PI*2),e.fill(),e.restore();const y=(E,P,M,I,L)=>{e.save(),e.globalAlpha=L*.6,e.fillStyle=M,e.beginPath();const w=40*E,U=Math.sin(T*10)*3*P,k=p-75*P+U;e.moveTo(-w,p+30);const B=(Math.sin(T*I)*10+Math.cos(T*I*1.5)*5)*E;e.quadraticCurveTo(-w*1.2+Math.cos(T*2)*8,p,B,k),e.quadraticCurveTo(w*1.2+Math.sin(T*2.3)*8,p,w,p+30),e.shadowColor=M,e.shadowBlur=20,e.fill(),e.restore()};y(1.3,1.1,g.outer,1.5,.3),y(1,1,g.mid,2.5,.4),y(.6,.85,g.core,4,.5),e.save(),e.fillStyle=g.core,e.shadowColor="#fff",e.shadowBlur=10;for(let E=0;E<8;E++){const P=E*13,M=40+P%40,I=P%60-30,L=120,w=(T*M+P*100)%L,U=p+20-w,k=I+Math.sin(T*5+P)*5,B=1-w/L;if(B>0){e.globalAlpha=B;const q=1+P%2;e.fillRect(k,U,q,q)}}e.restore(),e.textAlign="center";let S="HIGH SCORE",_="#90a4ae",A=g.text;l.isDailyChallenge&&(S="DAILY BEST",_="#ffea00",A="#ffea00"),e.font='10px "PressStart2PLocal"',e.fillStyle=_,e.fillText(S,0,60),e.font='32px "PressStart2PLocal"',e.fillStyle=A,e.fillText(f,0,p+20),e.restore()}let ra=null,Qo=0,xo=0,en=null;function Gs(e,t,a,i=null){if(!ra||t!==Qo||a!==xo||i!==en){Qo=t,xo=a,en=i;const h=a/t>1.2,g=Math.min(t,a)*(h?.08:.1),m=Math.ceil(g*8+20);typeof OffscreenCanvas<"u"?ra=new OffscreenCanvas(m,m):(ra=document.createElement("canvas"),ra.width=m,ra.height=m);const p=ra.getContext("2d"),T=m/2,v=m/2,y=i||"#ffffe0",S=p.createRadialGradient(T,v,g,T,v,g*4);i?(S.addColorStop(0,"rgba(255, 0, 0, 0.4)"),S.addColorStop(.5,"rgba(100, 0, 0, 0.1)")):(S.addColorStop(0,"rgba(255, 255, 230, 0.4)"),S.addColorStop(.5,"rgba(200, 200, 255, 0.1)")),S.addColorStop(1,"rgba(0, 0, 0, 0)"),p.fillStyle=S,p.beginPath(),p.arc(T,v,g*4,0,Math.PI*2),p.fill(),p.fillStyle=y,p.shadowColor=y,p.shadowBlur=20,p.beginPath(),p.arc(T,v,g,0,Math.PI*2),p.fill(),p.shadowBlur=0,p.fillStyle=i?"rgba(50, 0, 0, 0.3)":"rgba(200, 200, 210, 0.5)";const _=(A,E,P)=>{p.beginPath(),p.arc(A,E,P,0,Math.PI*2),p.fill()};_(T-g*.3,v-g*.2,g*.2),_(T+g*.4,v+g*.3,g*.15)}const n=t*.85,s=a/t>1.2,r=s?45:a*.1,d=Math.min(t,a)*(s?.08:.1),f=Math.ceil(d*8+20),c=n-f/2,u=r-f/2;e.drawImage(ra,c,u)}function Fn(e,t,a,i=!1){const o=e.createLinearGradient(0,0,0,a);o.addColorStop(0,"#0a0520"),o.addColorStop(.5,"#1a0f35"),o.addColorStop(1,"#151020"),e.fillStyle=o,e.fillRect(0,0,t,a);const n=l.isGameOver?"#ff4444":null;Gs(e,t,a,n),(ut.length===0||t>Wi+50)&&Un(t,a,!0),e.save();for(let s=0;s<ut.length;s++){const r=ut[s];r.isDynamic||(e.globalAlpha=r.baseAlpha,e.fillStyle=r.color,e.fillRect(r.x,r.y,r.size,r.size))}e.restore()}let ca=null,da=null,tn=0,an=0,on=0,Da={flash1:!1,flash2:!1};function Bs(e,t,a){let i=0;const o=V.consecutivePerfectHits>=1&&l.perfectHitTimer>0;if(o){const m=l.perfectHitTimer;m>1300?(i=1,Da.flash1||(D.playThunder(.3),Da.flash1=!0)):m>850&&m<1e3&&(i=.8,Da.flash2||(D.playThunder(.15),Da.flash2=!0))}else Da.flash1=!1,Da.flash2=!1;e.save(),i>.5&&(e.globalCompositeOperation="screen",e.fillStyle=`rgba(180, 220, 255, ${.4*i})`,e.fillRect(0,0,t,a),e.globalCompositeOperation="source-over",e.strokeStyle=`rgba(255, 255, 255, ${i})`,e.lineWidth=3,e.lineCap="round",e.lineJoin="round",(i>.9?0:1)===0?(e.beginPath(),e.moveTo(t*.5,0),e.lineTo(t*.48,a*.15),e.lineTo(t*.52,a*.3),e.lineTo(t*.5,a*.5),e.stroke()):(e.beginPath(),e.moveTo(t*.7,0),e.lineTo(t*.68,a*.2),e.lineTo(t*.72,a*.35),e.lineTo(t*.7,a*.5),e.stroke()));const n=4096,s=2160,r=Math.floor(Math.min(t,n)),d=Math.floor(Math.min(a,s)),f=r!==tn||d!==an,c=Date.now(),u=f&&c-on<200;if(!ca||!da||f&&!u){t>n&&console.warn(`[HauntedRenderer] Clamping Storm Cache Width: ${t} -> ${n}`),console.log(`[HauntedRenderer] Storm Cache UPDATE: ${r}x${d}`),typeof OffscreenCanvas<"u"?(ca=new OffscreenCanvas(r,d),da=new OffscreenCanvas(r,d)):(ca=document.createElement("canvas"),ca.width=r,ca.height=d,da=document.createElement("canvas"),da.width=r,da.height=d);const m=ca.getContext("2d"),p=da.getContext("2d");ri(m,r,d,0,"FULL"),ri(p,r,d,1,"WINDOWS_ONLY"),tn=r,an=d,on=c}const g=Date.now()/1e3;e.save();for(let m=0;m<ut.length;m++){const p=ut[m];if(p.isDynamic){const v=.7+Math.sin(g*p.speed+p.phase)*.3;e.globalAlpha=p.baseAlpha*v,e.fillStyle=p.color,e.fillRect(p.x,p.y,p.size,p.size)}}if(e.restore(),e.drawImage(ca,0,0,t,a),o){const m=Date.now(),T=.5+(Math.sin(m*.008)+1)/4;e.globalAlpha=T,e.globalCompositeOperation="screen",e.drawImage(da,0,0,t,a),e.globalCompositeOperation="source-over",e.globalAlpha=1}e.restore()}function $e(e){const t=Math.sin(e)*1e4;return t-Math.floor(t)}const ut=[];let xt=null,Wi=0,Hn=0;function Un(e,t,a=!1){if(!a&&ut.length>0)return;a&&(ut.length=0,xt=null);const i=150/600,o=Math.ceil(e*i);for(let n=0;n<o;n++){const s=Math.random()>.9;ut.push({x:Math.random()*e,y:Math.random()*t*.7,size:s?2:1,baseAlpha:.3+Math.random()*.7,phase:Math.random()*Math.PI*2,speed:.5+Math.random()*1.5,color:Math.random()>.8?"#a0c0ff":Math.random()>.8?"#fffacd":"#ffffff",isDynamic:s})}Wi=e,Hn=t}function Fs(e,t,a,i){if((ut.length===0||t>Wi+50)&&Un(t,a,!0),!xt||t!==Wi||a!==Hn){typeof OffscreenCanvas<"u"?xt=new OffscreenCanvas(t,a):(xt=document.createElement("canvas"),xt.width=t,xt.height=a);const o=xt.getContext("2d");o.clearRect(0,0,t,a);for(let n=0;n<ut.length;n++){const s=ut[n];s.isDynamic||(o.globalAlpha=s.baseAlpha,o.fillStyle=s.color,o.fillRect(s.x,s.y,s.size,s.size))}}e.drawImage(xt,0,0),e.save();for(let o=0;o<ut.length;o++){const n=ut[o];if(n.isDynamic){const r=.7+Math.sin(i*n.speed+n.phase)*.3;e.globalAlpha=n.baseAlpha*r,e.fillStyle=n.color,e.fillRect(n.x,n.y,n.size,n.size)}}e.restore()}const Hs=(e,t,a,i,o,n,s)=>{const r=c=>{const u=Math.sin(c)*1e4;return u-Math.floor(u)};e.lineWidth=n,e.strokeStyle="#0a0f14",e.lineCap="square",e.lineJoin="bevel",e.beginPath(),e.moveTo(t,a);const d=(t+i)/2+(r(s)-.5)*10,f=(a+o)/2+(r(s+1)-.5)*10;e.lineTo(d,f),e.lineTo(i,o),e.stroke()};class nn{constructor(t){this.m=2147483648,this.a=1103515245,this.c=12345,this.state=t||Math.floor(Math.random()*(this.m-1))}nextInt(){return this.state=(this.a*this.state+this.c)%this.m,this.state}nextFloat(){return this.nextInt()/(this.m-1)}range(t,a){return t+this.nextFloat()*(a-t)}}const eo=new Map,Us=(e,t,a)=>`${e}-${t?"d":"l"}-${a.toFixed(1)}`,Vs=(e,t,a,i,o,n,s=!1,r=1)=>{const d=v=>{const y=Math.sin(v)*1e4;return y-Math.floor(y)},f=v=>d(v),c=i*.5;e.save(),e.globalAlpha=r;const u=(v,y,S,_)=>{e.save();const A=3+Math.floor(f(_)*3);for(let E=0;E<A;E++){const P=(f(_+E)-.5)*S*1.8,M=(f(_+E*2)-.5)*S*1.2,I=S*(.4+f(_+E*3)*.3);e.beginPath(),e.arc(v+P,y+M,I,0,Math.PI*2);const L=f(_+E*4);L>.8?e.fillStyle="#1b262c":L<.4?e.fillStyle="#05070a":e.fillStyle="#0f171a",e.fill()}e.restore()},h=(v,y,S,_,A,E,P)=>{if(_<2||E>6){if(!s&&E>2){const k=Math.max(1,15*c*Math.max(.5,6-E));u(v,y,k,P)}return}let M=v+Math.cos(S)*_,I=y+Math.sin(S)*_;Hs(e,v,y,M,I,A*.8,P),!s&&E>3&&f(P*99)>.7&&u(v,y,10*c,P+10);const L=P*13.1,w=P*17.5,U=1-E*.05;if(f(L)<U){if(h(M,I,S+(f(L)-.5)*.8,_*.7,A*.6,E+1,L+1),f(w)>.3){const k=f(w)>.5?1:-1;h(M,I,S+.6*k,_*.5,A*.5,E+1,w+2)}}else h(M,I,S+(f(L)-.5)*.4,_*.8,A*.7,E+1,L+1)},g=(s?15:25)*c,m=(s?220:180)*c;e.fillStyle="rgba(0,0,0,0.5)",e.beginPath(),e.ellipse(t,a+2,g*1.5,6,0,0,Math.PI*2),e.fill();const p=e.createLinearGradient(t-g,0,t+g,0);p.addColorStop(0,"#020305"),p.addColorStop(.4,"#1b262c"),p.addColorStop(1,"#000000"),e.fillStyle=p,e.beginPath(),e.moveTo(t-g,a+5),e.quadraticCurveTo(t-g*.2,a-m*.5,t-g*.4,a-m),e.lineTo(t+g*.4,a-m),e.quadraticCurveTo(t+g*.2,a-m*.5,t+g,a+5),e.closePath(),e.fill();const T=(s?140:120)*c;h(t,a-m,-Math.PI/2+o*.1,T,8*c,0,n),f(n)>.5&&h(t,a-m*.6,-Math.PI/2+o*.8,T*.7,6*c,0,n+50),e.restore()},Vn=(e,t,a,i)=>{const o=Us(e,t,i);if(eo.has(o))return eo.get(o);const n=100*i,s=300*i+n,r=400*i+n,d=document.createElement("canvas");d.width=Math.ceil(s),d.height=Math.ceil(r);const f=d.getContext("2d");return Vs(f,s/2,r-50*i,i,a,e,t,1),eo.set(o,d),d};function sn(e,t,a){e.shadowBlur=0;const{cx:i,baseY:o,scaleX:n,wingsPerSide:s}=Ya(t,a),r=(u,h,g,m,p,T)=>{const v=Vn(p,T,m,g),y=v.width/2,S=v.height-50*g;e.drawImage(v,u-y,h-S)},d=(60+s*90)*n,f=d+20*n,c=d+120*n;r(i-f,o+20,.7,.2,1e3,!1),r(i-c,o+10,.5,.1,1050,!0),r(i+f,o+20,.7,-.2,2e3,!1),r(i+(c+40*n),o+15,.6,-.1,2050,!0)}let to=null,ao={w:0,h:0};function zs(e,t){const a=[],{cx:i,baseY:o,scaleX:n,horizonY:s,wingsPerSide:r}=Ya(e,t),d=10,f=s+180,c=t,u=new nn(12345),h=t*.85,m=70/1.8,p=1.5*m,T=i-m,v=h-p,y=i+m,S=h-p,_=(E,P,M,I,L)=>{const w=L<0?1.5:-1.5,U=w,k=-1,B=I-w*M;return Math.abs(U*E+k*P+B)/Math.sqrt(U*U+k*k)};let A=0;for(;a.length<d&&A<600;){A++;let E=u.nextFloat()*e,P=f+u.nextFloat()*(c-f);const I=55+(P-s)/(c-s)*50,L=_(E,P,T,v,-1),w=_(E,P,y,S,1);if(L<I||w<I||Math.abs(E-i)<60)continue;const U=45,k=(60+r*90)*n,B=240*n,be=Math.min(k,B)+U;if(Math.abs(E-i)<be)continue;const oe=a.length,j=777+oe*1337,te=new nn(j).nextFloat()>.4,ce=.5+(P-s)/(t-s)*.5,Z=E<i?.4:-.4;a.push({x:E,y:P,scale:ce,lean:Z,isDead:te,id:oe})}return a.sort((E,P)=>E.y-P.y),a}let ln=0,rn=0,Ei=0;function Ws(e,t,a){const{horizonY:i}=Ya(t,a),o=Date.now();Ei===0&&(Ei=o);const n=(o-Ei)/1e3;Ei=o,l.isPaused||(rn+=n);const s=rn,d=t*.15+Math.sin(s*.25)*30;io(e,d,i+(a-i)*.3,1.2,s);const c=t*.85+Math.sin(s*.3+2)*25;io(e,c,i+(a-i)*.4,1.3,s+1);const h=t*.25+Math.cos(s*.2+1)*40;io(e,h,i+(a-i)*.6,1.8,s+2)}function zn(e,t,a,i){const o=Date.now(),n=ao.w!==t||ao.h!==a;(!to||n&&o-ln>200)&&(to=zs(t,a),ao={w:t,h:a},ln=o),to.forEach(r=>{const f=Vn(5e3+r.id,r.isDead,r.lean,r.scale);e.save(),e.globalAlpha=1;const c=f.width/2,u=f.height-50*r.scale;e.drawImage(f,r.x-c,r.y-u),e.restore()})}const cn=(e,t,a,i,o,n)=>{e.save();const s=Math.abs(i-t),r=Math.sign(i-t),f=Math.ceil(s/100),c=s/f,u=20,h=o+15,g="#2d3436",m="#636e72",p="#15181c",T="#050505",v=100;for(let A=0;A<f;A++){if(A>=v){console.warn("[HauntedRenderer] Max Fence Sections Reached. Stopping generation.");break}const E=t+A*c*r,P=t+(A+1)*c*r,M=E,I=Math.min(M,P)+u/2,w=Math.max(M,P)-u/2-I;if(w>0){e.fillStyle=T;const oe=a-o*.85,j=a-o*.15;e.fillRect(I,oe,w,6),e.fillRect(I,j,w,6);const $=16,te=Math.floor(w/$),ve=I+(w-te*$)/2;for(let ce=0;ce<=te;ce++){const Z=ve+ce*$,Ce=a-o;e.fillRect(Z-2,Ce,4,o);const Re=Ce;e.beginPath(),e.moveTo(Z,Re-15),e.lineTo(Z+5,Re),e.lineTo(Z-5,Re),e.fill(),e.beginPath(),e.arc(Z,Re+5,3,0,Math.PI*2),e.fill(),ce%2===0&&(e.beginPath(),e.arc(Z,a-o*.5,5,0,Math.PI*2),e.fill())}}e.fillStyle=p,e.fillRect(M-u/2,a-h,u,h),e.fillStyle=g,e.fillRect(M-u/2+2,a-h,u-2,h),e.fillStyle=p;const U=14;for(let oe=a-h+10;oe<a-5;oe+=U)e.fillRect(M-u/2+2,oe,u-2,1),e.fillStyle="rgba(255,255,255,0.1)",e.fillRect(M-u/2+2,oe+1,u-2,1),e.fillStyle=p;for(let oe=0;oe<8;oe++){const j=M-u/2+3+Math.abs(Math.sin(E+oe)*(u-6)),$=a-h+Math.abs(Math.cos(E*oe)*h);e.fillStyle=oe%2===0?"#111":"#555",e.fillRect(j,$,1,1)}const k=6,B=10,q=a-h;e.fillStyle=m,e.beginPath(),e.moveTo(M-u/2-k,q+B),e.lineTo(M+u/2+k,q+B),e.lineTo(M+u/2+k-2,q),e.lineTo(M-u/2-k+2,q),e.fill(),e.fillStyle="rgba(255,255,255,0.2)",e.fillRect(M-u/2-k+3,q,u+k*2-6,2);for(let oe=0;oe<5;oe++){const j=M*.13+oe*5.7,$=Math.abs(Math.sin(j)),te=Math.abs(Math.cos(j*2.1)),ve=Math.abs(Math.sin(j*3.3)),ce=M-u/2-k+$*(u+k*2),Z=q+te*B;e.fillStyle=ve>.5?"rgba(0,0,0,0.3)":"rgba(255,255,255,0.2)",e.fillRect(ce,Z,1,1)}e.fillStyle=p,e.fillRect(M-u/2-2,a-10,u+4,10),Math.abs(Math.sin(E*.1+n))>.7&&(e.fillStyle="#111",e.fillRect(M-2,a-h+30,3,15))}const y=i,S=a-h;e.fillStyle=p,e.fillRect(y-u/2,a-h,u,h),e.fillStyle=g,e.fillRect(y-u/2+2,a-h,u-2,h),e.fillStyle=p;const _=14;for(let A=a-h+10;A<a-5;A+=_)e.fillRect(y-u/2+2,A,u-2,1),e.fillStyle="rgba(255,255,255,0.1)",e.fillRect(y-u/2+2,A+1,u-2,1),e.fillStyle=p;e.fillStyle=m,e.beginPath(),e.moveTo(y-u/2-4,S+10),e.lineTo(y+u/2+4,S+10),e.lineTo(y+u/2+2,S),e.lineTo(y-u/2-2,S),e.fill(),e.fillStyle="rgba(255,255,255,0.2)",e.fillRect(y-u/2,S,u,2);for(let A=0;A<5;A++){const E=y*.13+A*5.7,P=Math.abs(Math.sin(E)),M=Math.abs(Math.cos(E*2.1)),I=Math.abs(Math.sin(E*3.3)),L=y-u/2-4+P*(u+8),w=S+M*10;e.fillStyle=I>.5?"rgba(0,0,0,0.3)":"rgba(255,255,255,0.2)",e.fillRect(L,w,1,1)}e.restore()},$s=(e,t,a,i,o)=>{e.save(),e.translate(t,a),e.scale(i,i),e.strokeStyle="#050505",e.lineWidth=1;const n=3+Math.floor(Math.abs(Math.sin(o)*3));for(let s=0;s<n;s++){const r=-Math.PI/2+Math.sin(o+s)*.5,d=5+Math.abs(Math.cos(o*s)*6);e.beginPath(),e.moveTo(0,0),e.quadraticCurveTo(Math.cos(r)*d*.5,Math.sin(r)*d*.5,Math.cos(r)*d,Math.sin(r)*d),e.stroke()}e.restore()};function ri(e,t,a,i=0,o="FULL",n=0,s=null,r=null){const d=o!=="WINDOWS_ONLY",f=o!=="STRUCTURE_ONLY",{cx:c,baseY:u,scaleX:h,scaleY:g,wingsPerSide:m}=s||Ya(t,a);e.save(),e.translate(c,u),e.scale(h,g);const p="#4a4e57",T="#1a1d23",v="#6c757d",y=6,S=4,_=i>.5,A=_?"#e0f7fa":"#feca57",E=(R,C,G,O)=>{const K=R,W=K-y,ee=C,x=C+O,fe=ee-S,he=x-S;e.beginPath(),e.moveTo(K,x),e.lineTo(K,ee),e.lineTo(W,fe),e.lineTo(W,he),e.closePath();const le=e.createLinearGradient(K,0,W,0);le.addColorStop(0,"#050508"),le.addColorStop(1,"#000000"),e.fillStyle=le,e.fill(),e.strokeStyle="#111",e.lineWidth=1,e.beginPath(),e.moveTo(K,ee),e.lineTo(K,x),e.stroke()},P=(R,C,G,O,K)=>{e.fillStyle=K,_&&K===A&&(e.shadowColor="#00e5ff",e.shadowBlur=40),e.fillRect(R,C,G,O),e.shadowBlur=0},M=(R,C,G,O)=>{for(let W=C;W>C-O;W-=6){const ee=25+$e(W)*5,x=`rgb(${ee}, ${ee}, ${ee+10})`;e.fillStyle=x,e.fillRect(R-G,W-6,G*2,6),e.fillStyle="rgba(0,0,0,0.4)",e.fillRect(R-G,W,G*2,1);const fe=8,he=Math.abs(W)/6%2*(fe/2);for(let le=R-G+he;le<R+G;le+=fe){const Me=$e(le*W);if(Me>.96){e.fillStyle="#050505",e.fillRect(le+1,W-6+1,fe-2,5);continue}Me>.75?(e.fillStyle="rgba(255,255,255,0.06)",e.fillRect(le,W-6,fe,5)):Me<.2&&(e.fillStyle="rgba(0,0,0,0.3)",e.fillRect(le,W-6,fe,5)),e.fillStyle="rgba(0,0,0,0.5)",e.fillRect(le+fe-1,W-6,1,6)}}},I=(R,C,G,O,K=!1)=>{e.save(),e.beginPath(),e.rect(R,C,G,O),e.clip(),K||(e.fillStyle="#2c2c2c",e.fillRect(R,C,G,O));const W=10,ee=14;for(let x=C;x<C+O;x+=W){const fe=Math.floor((x-C)/W)%2===1;let he=R-(fe?ee/2:0);for(;he<R+G;){const le=ee,Me=Math.sin(he*x)*1e4;let pe;const ye=Me-Math.floor(Me);ye>.8?pe="#5a5e68":ye>.4?pe="#4a4e57":pe="#3e4249",e.fillStyle="#636e72",e.fillRect(he,x,le-1,1),e.fillStyle=pe,e.fillRect(he,x+1,le-1,W-3),e.fillStyle="#2d3436",e.fillRect(he,x+W-2,le-1,1),he+=le}}e.restore()},L=90,w=60,U=L+(m-1)*w,k=({x:R,y:C,w:G,h:O,arched:K,lit:W,phase:ee=0,ignoreStorm:x=!1})=>{if(e.save(),d&&(e.fillStyle="#05070a",K?(e.beginPath(),e.moveTo(R,C+O),e.lineTo(R+G,C+O),e.lineTo(R+G,C+O*.3),e.quadraticCurveTo(R+G/2,C-O*.1,R,C+O*.3),e.fill()):e.fillRect(R,C,G,O),e.strokeStyle="rgba(0,0,0,0.6)",e.lineWidth=2,e.beginPath(),K?(e.moveTo(R+G,C+O*.3),e.moveTo(R,C+O),e.lineTo(R,C+O*.3),e.quadraticCurveTo(R+G/2,C-O*.1,R+G,C+O*.3),e.stroke()):(e.beginPath(),e.moveTo(R+G,C),e.lineTo(R,C),e.lineTo(R,C+O),e.stroke())),f){const he=R+2,le=C+2,Me=G-4,pe=O-4;let ye=0;if(_&&!x)if(W=!0,n>0){ye=(Math.sin(ee+n*.008)+1)/2;const Pe=Math.floor(40+215*ye),Ye=Math.floor(100+155*ye),Ze=255;e.fillStyle=`rgb(${Pe},${Ye},${Ze})`}else e.fillStyle="#e0f7fa";else if(W)if(r)e.fillStyle=r,e.shadowColor=r,e.shadowBlur=20;else{const Se=e.createRadialGradient(R+G/2,C+O/2,2,R+G/2,C+O/2,G);Se.addColorStop(0,"#ffca28"),Se.addColorStop(1,"#ff6f00"),e.fillStyle=Se}else e.fillStyle="#15181c";W&&_&&!x?(e.shadowColor="#00e5ff",e.shadowBlur=20+30*ye):e.shadowBlur=0,e.beginPath(),K?(e.moveTo(he,C+O-2),e.lineTo(he+Me,C+O-2),e.lineTo(he+Me,C+O*.3),e.quadraticCurveTo(R+G/2,C-O*.1+2,he,C+O*.3),e.fill()):e.fillRect(he,le,Me,pe),e.shadowBlur=0}if(d&&(e.strokeStyle="#636e72",e.lineWidth=1,e.beginPath(),K?(e.moveTo(R+G,C+O*.3),e.quadraticCurveTo(R+G/2,C-O*.1,R,C+O*.3),e.lineTo(R,C+O)):(e.moveTo(R+G,C),e.lineTo(R,C),e.lineTo(R,C+O)),e.stroke(),e.strokeStyle="#000",e.beginPath(),K?(e.moveTo(R+G,C+O*.3),e.lineTo(R+G,C+O),e.lineTo(R,C+O)):(e.moveTo(R+G,C),e.lineTo(R+G,C+O),e.lineTo(R,C+O)),e.stroke()),d||f){e.save(),e.beginPath();const fe=2,he=R+fe,le=G-fe*2;K?(e.moveTo(he,C+O-fe),e.lineTo(he+le,C+O-fe),e.lineTo(he+le,C+O*.3),e.quadraticCurveTo(R+G/2,C-O*.1+fe,he,C+O*.3)):e.rect(he,C+fe,le,O-fe*2),e.clip(),e.strokeStyle="#000",e.lineWidth=1,e.beginPath(),e.moveTo(R+G/2,C),e.lineTo(R+G/2,C+O),e.moveTo(R,C+O/2),e.lineTo(R+G,C+O/2),e.stroke(),e.restore()}e.restore()},B=(R,C,G,O)=>{const W=G*.6;e.fillStyle=T,e.beginPath(),e.moveTo(R-G/2-8,C),e.lineTo(R+G/2+8,C),e.lineTo(R+W/2,C-O),e.lineTo(R-W/2,C-O),e.fill(),e.save(),e.clip(),M(R,C,G+16,O),e.restore();const ee=5,x=G+16,fe=R-x/2;e.fillStyle="#1a1c21",e.fillRect(fe,C,x,ee),e.fillStyle="#3e4249",e.fillRect(fe,C,x,1),e.fillStyle="#08090a",e.fillRect(fe,C+ee-1,x,1),e.fillStyle="#1a1c21",e.fillRect(R-W/2-2,C-O-2,W+4,3),e.fillStyle="#3e4249",e.fillRect(R-W/2-2,C-O-2,W+4,1),e.fillStyle="#050508",e.beginPath();const he=R-W/2-2;e.moveTo(he,C-O-2),e.lineTo(he-y,C-O-2-S),e.lineTo(he-y,C-O+1-S),e.lineTo(he,C-O+1),e.fill(),e.strokeStyle="#0a0a0d",e.fillStyle="#0a0a0d",e.lineWidth=1.5,e.beginPath(),e.moveTo(R-W/2,C-O),e.lineTo(R+W/2,C-O),e.moveTo(R-W/2,C-O-5),e.lineTo(R+W/2,C-O-5),e.stroke();const le=6;for(let ye=0;ye<=W;ye+=le){const Se=R-W/2+ye;e.beginPath(),e.moveTo(Se,C-O),e.lineTo(Se,C-O-10),e.stroke(),e.beginPath(),e.arc(Se,C-O-11,1.5,0,Math.PI*2),e.fill()}e.fillStyle="#050508",e.beginPath();const Me=R-G/2-8,pe=R-W/2;e.moveTo(Me,C),e.lineTo(Me-y,C-S),e.lineTo(pe-y,C-O-S),e.lineTo(pe,C-O),e.closePath(),e.fill(),e.strokeStyle="#3e4249",e.lineWidth=1,e.beginPath(),e.moveTo(Me,C),e.lineTo(pe,C-O),e.stroke()},q=(R,C,G,O)=>{if(e.save(),d){e.fillStyle="rgba(0,0,0,0.5)",e.beginPath(),e.ellipse(R,C+2,G/2+4,3,0,0,Math.PI*2),e.fill(),P(R-G/2,C-O,G,O,p),I(R-G/2,C-O,G,O),e.fillStyle="#1a1d22",e.beginPath();const W=R-G/2;e.moveTo(W,C-O),e.lineTo(W-y,C-O-S),e.lineTo(W-y,C-S),e.lineTo(W,C),e.fill(),e.strokeStyle="#000",e.lineWidth=.5,e.stroke(),e.fillStyle=T,e.beginPath(),e.moveTo(R-G/2-4,C-O),e.lineTo(R+G/2+4,C-O),e.lineTo(R,C-O-12),e.fill(),e.fillStyle="rgba(0,0,0,0.4)",e.beginPath(),e.moveTo(R-G/2,C-O),e.lineTo(R+G/2,C-O),e.lineTo(R,C-O+4),e.fill(),e.save(),e.clip(),M(R,C-O,G+8,12),e.restore()}k({x:R-G/2+2,y:C-O+3,w:G-4,h:O-5,arched:!0,lit:!0}),e.restore()},be=(R,C,G,O)=>{const W=R*(C?1:-1),ee=60;e.save(),e.translate(W,0);const x=50,fe=6,le=ee-3*2,Me=40,pe=-x-fe,ye=-ee/2;d&&(G&&!C&&E(ye,-x,ee,x),P(ye,-x,ee,x,p),I(ye,-x,ee,x),e.fillStyle="rgba(0,0,0,0.35)",e.fillRect(ye+4,-x,ee-4,6),P(ye-2,-x,ee+4,5,v));const Se=ee+4,Pe=-Se/2,Ye=-le/2,Ze=pe-Me;if(d){if(G&&!C){E(Pe,pe+fe,Se,fe),e.fillStyle="#050508";const Ae=Pe;e.beginPath(),e.moveTo(Ae,pe),e.lineTo(Ae,pe+fe),e.lineTo(Ae-y,pe+fe-S),e.lineTo(Ae-y,pe-S),e.closePath(),e.fill();const Gt=Ye;e.beginPath(),e.moveTo(Gt,pe),e.lineTo(Ae,pe),e.lineTo(Ae-y,pe-S),e.lineTo(Gt-y,pe-S),e.closePath(),e.fill()}P(Pe,pe,Se,fe,v),e.fillStyle="rgba(255,255,255,0.4)",e.fillRect(Pe,pe,Se,1),e.fillStyle="rgba(0,0,0,0.6)",e.fillRect(Pe,pe+fe-1,Se,1),e.fillStyle="#6a6e75",e.fillRect(Pe,pe,Se,2),G&&!C&&E(Ye,Ze,le,Me),P(Ye,Ze,le,Me,p),I(Ye,Ze,le,Me);{const Ae=e.createLinearGradient(0,Ze,0,Ze+12);Ae.addColorStop(0,"rgba(0,0,0,0.8)"),Ae.addColorStop(1,"rgba(0,0,0,0.0)"),e.fillStyle=Ae,e.fillRect(Ye+4,Ze,le-4,12)}P(Ye-2,pe-3,le+4,4,v)}const Je=le+8,Aa=40,yt=-Je/2,Ot=Ze-Aa;if(d){{const Ae=C?yt:yt+Je,Gt=Je*.55,Bt=(Je-Gt)/2,Xa=C?yt+Bt:yt+Je-Bt,pi=y*.8,Yt=Ae-pi,Ea=Xa-pi;e.beginPath(),e.moveTo(Ae,Ze),e.lineTo(Xa,Ot),e.lineTo(Ea,Ot-S),e.lineTo(Yt,Ze-S),e.closePath();const Nt=e.createLinearGradient(Ae,0,Yt,0);Nt.addColorStop(0,"#050508"),Nt.addColorStop(1,"#000000"),e.fillStyle=Nt,e.fill(),e.save(),e.clip();const Ma=Ze-(Ot-S)+20;M(Math.min(Ae,Yt)-50,Ze,200,Ma),e.fillStyle="rgba(0,0,0,0.2)",e.fill(),e.restore(),e.strokeStyle="#3e4249",e.lineWidth=1,e.stroke()}B(0,Ze,Je,Aa)}const $t=$e(O*11+(C?100:0)),_e=$e(O*13+(C?200:0)),Qe=$e(O*17+(C?300:0)),dt=!G||$t>.5,St=_e>.3,qa=Math.abs(W)*.015;if(k({x:-10,y:-40,w:20,h:25,arched:!0,lit:dt,phase:qa}),k({x:-9,y:Ze+12,w:18,h:18,arched:!1,lit:St,phase:qa}),!G||Qe>.5){const Ae=Ze-25;q(0,Ae+12,16,12)}e.restore()},oe=54,j=60,$=-90,te=66,ve=8,ce=$-j-ve,Z=-2,Ce=54,Re=50,me=ce;if(d){const R=Z-oe/2;E(R,$,oe,j),e.fillStyle="#050508",e.beginPath(),e.moveTo(R,$),e.lineTo(R,$-j),e.lineTo(R-y,$-j-S),e.lineTo(R-y,$-S),e.fill();const C=Z-oe/2;P(C,$-j,oe,j,"#2d3138"),I(C,$-j,oe,j);const G=Z-te/2;e.fillStyle="#0a0c0e",e.beginPath(),e.moveTo(G,ce+ve),e.lineTo(G,ce),e.lineTo(G-6,ce-2),e.lineTo(G-6,ce+ve-2),e.fill(),P(Z-te/2,ce,te,ve,v),e.fillStyle="rgba(255,255,255,0.4)",e.fillRect(Z-te/2,ce,te,1),e.fillStyle="rgba(0,0,0,0.6)",e.fillRect(Z-te/2,ce+ve-1,te,1);const O=Z-Ce/2;e.fillStyle="#050508",e.beginPath(),e.moveTo(O,me),e.lineTo(O,me-Re),e.lineTo(O-y,me-Re-S),e.lineTo(O-y,me-S),e.fill(),P(Z-Ce/2,me-Re,Ce,Re,"#2d3138"),I(Z-Ce/2,me-Re,Ce,Re),B(Z,me-Re,60,50);const K=me-Re-54;e.strokeStyle="#000",e.lineWidth=2,e.beginPath(),e.moveTo(Z,K),e.lineTo(Z,K-30),e.stroke(),e.lineWidth=1,e.beginPath(),e.moveTo(Z-10,K-20),e.lineTo(Z+10,K-20),e.stroke(),e.fillStyle="#c0a060",e.beginPath(),e.arc(Z,K-30,3,0,Math.PI*2),e.fill();const W=K;e.strokeStyle="#0a0a0d",e.lineWidth=2,e.beginPath(),e.moveTo(Z-20,W-10),e.lineTo(Z+20,W-10);for(let ee=-18;ee<=18;ee+=6)e.moveTo(Z+ee,W),e.lineTo(Z+ee,W-12);e.stroke()}k({x:Z-10,y:me-Re+10,w:20,h:30,arched:!0,lit:!0,ignoreStorm:!0});const z=120,N=50,ne=8,ue=-N-ne,we=z-5*2,X=40,ie=ue,J=ie-X;if(d){e.fillStyle="#050508";const R=-z/2;e.beginPath(),e.moveTo(R,0),e.lineTo(R,-N),e.lineTo(R-y,-N-S),e.lineTo(R-y,0-S),e.closePath(),e.fill(),P(-z/2,-N,z,N,p),I(-z/2,-N,z,N);for(let O=-N;O<-4;O+=16)e.fillStyle=Math.abs(O)%32===0?p:"#3b3f46",e.fillRect(-z/2,O,6,8),e.fillRect(z/2-6,O,6,8);const C=-z/2-4;e.fillStyle="#050508",e.beginPath(),e.moveTo(C,ue+ne),e.lineTo(C,ue),e.lineTo(C-y,ue-S),e.lineTo(C-y,ue+ne-S),e.closePath(),e.fill(),P(-z/2-4,ue,z+8,ne,v),e.fillStyle="#5a5e68",e.fillRect(-z/2,ie,z,2);const G=-we/2;e.fillStyle="#050508",e.beginPath(),e.moveTo(G,ie),e.lineTo(G,J),e.lineTo(G-y,J-S),e.lineTo(G-y,ie-S),e.closePath(),e.fill(),P(-we/2,J,we,X,p),I(-we/2,J,we,X),P(-we/2-2,ie-4,we+4,4,v)}k({x:-40,y:J+10,w:14,h:20,arched:!0,lit:!0,ignoreStorm:!0}),k({x:-7,y:J+10,w:14,h:20,arched:!0,lit:!0,ignoreStorm:!0}),k({x:26,y:J+10,w:14,h:20,arched:!0,lit:!0,ignoreStorm:!0});const ge=40,Oe=35;if(d){P(-ge/2,-Oe,ge,Oe,"#2d3436"),e.beginPath(),e.moveTo(-ge/2-6,-Oe),e.lineTo(0,-Oe-12),e.lineTo(ge/2+6,-Oe),e.closePath(),e.fillStyle="#111",e.fill(),e.strokeStyle="#444",e.lineWidth=2,e.stroke(),e.fillStyle="rgba(0,0,0,0.6)",e.fillRect(-ge/2+2,-Oe,ge-4,6),e.fillStyle="#050505";const R=24,C=25;e.fillRect(-R/2,-C,R,C),e.fillStyle="#1a0f0f";const G=2;e.fillRect(-R/2+G,-C+G,R-G*2,C-G),e.fillStyle="#2b1b1b",e.fillRect(-R/2+4,-C+4,6,8),e.fillRect(R/2-10,-C+4,6,8),e.fillRect(-R/2+4,-C+14,6,8),e.fillRect(R/2-10,-C+14,6,8),e.fillStyle="#e1b12c",e.beginPath(),e.arc(R/2-6,-C/2+2,1.5,0,Math.PI*2),e.fill(),e.strokeStyle="#3a3a3a",e.lineWidth=1,e.strokeRect(-R/2,-C,R,C)}k({x:-45,y:-35,w:12,h:20,arched:!1,lit:!0,ignoreStorm:!0}),k({x:33,y:-35,w:12,h:20,arched:!1,lit:!0,ignoreStorm:!0}),d&&(P(-25,-25,6,25,v),P(19,-25,6,25,v),P(-30,-32,60,8,v),e.beginPath(),e.moveTo(-32,-32),e.lineTo(32,-32),e.lineTo(0,-50),e.fill());for(let R=1;R<=m;R++){const C=L+(R-1)*w;be(C,!1,R===m,R)}for(let R=m;R>=1;R--){const C=L+(R-1)*w;be(C,!0,R===m,R)}if(d){const R=U+60,C=-c/h,G=(t-c)/h,O=0,K=120,W=1200,ee=Math.max(C-50,-R-W),x=Math.min(G+50,R+W);cn(e,-R+5,O,ee,K,100),cn(e,R-5,O,x,K,200)}e.restore()}function Ya(e,t){const a=e/2,i=150+(qe||0),o=Math.max(i-40,t*.2);let n=(o-30)/290*1.5,s=0;e>t*1.2?(n*=1.5,s=1):t>e&&(n*=.75);const r=n,d=300*r,f=(e-d)/2;let c=0;f>0?c=Math.ceil(f/(90*r))+1:c=1;const u=1+Math.min(c,6)+s;return{cx:a,baseY:o,scaleX:r,scaleY:n,horizonY:o,wingsPerSide:u}}function Ys(e,t,a){const{cx:i,baseY:o,scaleX:n,scaleY:s}=Ya(t,a);e.save(),e.translate(i,o),e.scale(n,s);const r=(c,u,h,g,m)=>{e.fillStyle=m,e.fillRect(c,u,h,g)},d="#2a2e35",f="#1a1d23";r(-25,0,50,3,d),r(-25,3,50,2,f),r(-30,5,60,3,d),r(-30,8,60,2,f),r(-35,10,70,3,d),r(-35,13,70,2,f),e.restore()}const Ns=(e,t,a,i,o,n,s,r)=>{e.save(),e.beginPath(),e.moveTo(t-i/2,a),e.lineTo(t+i/2,a),e.lineTo(t+n/2,o),e.lineTo(t-n/2,o),e.closePath(),e.fillStyle="#1a1a1a",e.fill(),e.restore();const d=(u,h,g,m)=>{e.save(),e.translate(u,h),e.scale(-g,1),e.strokeStyle="rgba(255, 255, 255, 0.9)",e.lineWidth=1.3,e.lineCap="butt",e.beginPath();let p=m;const T=()=>$e(p+=17.1),v=30+T()*25,y=5,S=0,_=Math.PI*.55,A=[];for(let P=0;P<y;P++){const M=P/(y-1),I=S+M*(_-S),L=v*(.8+T()*.4),w=Math.cos(I)*L,U=Math.sin(I)*L;A.push({x:w,y:U}),e.moveTo(0,0),e.lineTo(w,U)}const E=3;for(let P=1;P<=E;P++){const M=P/(E+.2);for(let I=0;I<y-1;I++){const L=A[I],w=A[I+1],U=L.x*M,k=L.y*M,B=w.x*M,q=w.y*M;e.moveTo(U,k);const be=(U+B)*.5,oe=(k+q)*.5,j=.85;e.quadraticCurveTo(be*j,oe*j,B,q)}}e.stroke(),e.restore()},f=16,c=o-a;if(c>0){const u=Math.floor(c/f),h=[];let g=-999,m=$e(u)>.5;for(let p=0;p<u;p++){const T=a+p*f,v=p/u,y=i+(n-i)*v,S=t-y/2,_=p*1337;let A=y,E=S,P=0;for(;A>0;){let I=20+Math.floor($e(_+A)*30);I>A&&(I=A);let L=E,w=I-2;if(L<S&&(w-=S-L,L=S),L+w>S+y&&(w=S+y-L),w>1){const U=60+Math.floor($e(_+P)*30),k=`rgb(${U}, ${U}, ${U})`,B=`rgb(${U+40}, ${U+40}, ${U+40})`,q=`rgb(${U-30}, ${U-30}, ${U-30})`;e.fillStyle=k,e.fillRect(L,T,w,f-2),e.fillStyle=B,e.fillRect(L,T,w,1),e.fillRect(L,T,1,f-2),e.fillStyle=q,e.fillRect(L,T+f-3,w,1),e.fillRect(L+w-1,T,1,f-2)}A-=I,E+=I,P++}if(r&&T>r-80&&T<r+85||T>o-80||T<a+40||p-g<5)continue;const M=p*999;if($e(M)>.82){const I=m?-1:1,L=M+(m?0:100);h.push({x:m?S+2:S+y-2,y:T+5,side:I,seed:L}),m=!m,g=p}}h.forEach(p=>d(p.x,p.y,p.side,p.seed))}};function qs(e,t,a,i){e.save(),e.beginPath(),e.arc(t,a,i,0,Math.PI*2),e.fillStyle="#1a1a1a",e.fill();const o=18,n=Math.floor(i/o);for(let s=0;s<n;s++){const r=i-s*o,d=2*Math.PI*r,f=Math.floor(d/25),c=Math.PI*2/f,u=s*.5;for(let h=0;h<f;h++){const g=u+h*c,m=u+(h+1)*c-.1,p=r,T=r-o+2,v=70+h%3*20;e.fillStyle=`rgb(${v}, ${v}, ${v})`,e.beginPath(),e.arc(t,a,p,g,m),e.arc(t,a,T,m,g,!0),e.closePath(),e.fill()}}e.beginPath(),e.arc(t,a,i-n*o,0,Math.PI*2),e.fillStyle="#555",e.fill(),e.restore()}function dn(e,t,a,i,o){const n=i-t,s=o-a,r=Math.sqrt(n*n+s*s),d=Math.atan2(s,n),f=24,c=22,u=0,h=Math.ceil(r/(f+u));e.save(),e.translate(t,a),e.rotate(d);const m=c*2+2+4;e.fillStyle="#1a1a1a",e.fillRect(0,-m/2,r,m);for(let p=0;p<2;p++){const T=p===0?0:f/2;for(let v=0;v<h;v++){const y=v*(f+u)-T;if(y+f<0||y>r)continue;const S=f,_=c,A=p===0?-c:0,E=(v+p*1e3)*1.1,P=60+Math.floor($e(E)*30),M=`rgb(${P}, ${P}, ${P})`,I=`rgb(${P+40}, ${P+40}, ${P+40})`,L=`rgb(${P-30}, ${P-30}, ${P-30})`,w=1;e.fillStyle=M,e.fillRect(y,A+w,S-w,_-w),e.fillStyle=I,e.fillRect(y,A+w,S-w,1),e.fillRect(y,A+w,1,_-w),e.fillStyle=L,e.fillRect(y,A+_-1,S-w,1),e.fillRect(y+S-w-1,A+w,1,_-w)}}e.restore()}function Xs(e,t,a,i,o){e.save(),e.translate(t,a);const n=.9+o*.3,s=1.1-o*.2;e.scale(i*n,i*s);const r="#616161",d="#424242",f="#212121";e.lineWidth=2,e.strokeStyle=f,e.fillStyle=d,e.beginPath(),e.moveTo(10,-14),e.lineTo(14,-14),e.lineTo(14,0),e.lineTo(10,0),e.fill(),e.stroke(),e.fillStyle=r,e.beginPath(),e.arc(0,-18,10,Math.PI,0),e.lineTo(10,0),e.lineTo(-10,0),e.lineTo(-10,-18),e.fill(),e.stroke(),e.fillStyle="rgba(0,0,0,0.15)";for(let u=0;u<6;u++){const h=($e(o+u)-.5)*16,g=-4-$e(o*u)*20;e.fillRect(h,g,2,2)}e.fillStyle=d,o>.5?(e.beginPath(),e.moveTo(4,-24),e.lineTo(7,-18),e.stroke()):(e.fillStyle=d,e.fillRect(-10,-18,4,4)),e.fillStyle="#424242",e.fillRect(-4,-14,8,2),e.fillRect(-3,-10,6,2),e.fillStyle="rgba(0,0,0,0.5)",e.beginPath(),e.ellipse(0,2,12,4,0,0,Math.PI*2),e.fill(),e.strokeStyle="#0f1a13",e.lineWidth=1;const c=5+Math.floor(o*4);for(let u=0;u<c;u++){const h=-12+u/c*24+($e(u)-.5)*4,g=3+$e(u*2)*4;e.beginPath(),e.moveTo(h,2),e.quadraticCurveTo(h+1,2-g/2,h+(u%2==0?2:-2),2-g),e.stroke()}e.restore()}let Zt=null;function Zs(){if(Zt)return Zt;const e=128,t=2;typeof OffscreenCanvas<"u"?Zt=new OffscreenCanvas(e,e):(Zt=document.createElement("canvas"),Zt.width=e,Zt.height=e);const a=Zt.getContext("2d");a.translate(e/2,e/2),a.scale(t,t);const i=a.createRadialGradient(-4,-8,2,0,0,18);return i.addColorStop(0,"#ffffff"),i.addColorStop(.5,"#e1f5fe"),i.addColorStop(1,"#b3e5fc"),a.fillStyle=i,a.beginPath(),a.arc(0,-12,8,Math.PI,0),a.lineTo(8,10),a.lineTo(4,8),a.lineTo(0,12),a.lineTo(-4,8),a.lineTo(-8,10),a.lineTo(-8,-12),a.fill(),a.fillStyle="#e1f5fe",a.beginPath(),a.moveTo(-8,-4),a.lineTo(-12,-8),a.lineTo(-10,-2),a.lineTo(-8,0),a.fill(),a.beginPath(),a.moveTo(8,-4),a.lineTo(12,-2),a.lineTo(10,2),a.lineTo(8,-2),a.fill(),a.fillStyle="#1a237e",a.save(),a.translate(-3,-10),a.rotate(-.2),a.fillRect(-1.5,-2,3,5),a.restore(),a.save(),a.translate(3,-10),a.rotate(.2),a.fillRect(-1.5,-2,3,5),a.restore(),a.fillRect(-2,-4,4,6),Zt}function io(e,t,a,i,o=0){e.save(),e.save(),e.translate(t,a+20*i),e.scale(i,i*.3),e.fillStyle="rgba(0,0,0,0.4)",e.beginPath(),e.arc(0,0,10,0,Math.PI*2),e.fill(),e.restore();const n=Math.sin(o*.8)*(5*i),s=Zs(),r=32*i;e.save(),e.translate(t,a+n),e.globalAlpha=.7,e.drawImage(s,-r,-r,r*2,r*2),e.restore(),e.restore()}let Kt=null,fn=0,hn=0,un=!1,pn=0;function Ks(e,t,a,i=!0){const{cx:o,horizonY:n,scaleX:s,wingsPerSide:r}=Ya(t,a),d=l.bat&&l.bat.pivotY?l.bat.pivotY:a*.85;if(!(!Kt||Math.floor(t)!==Math.floor(fn)||Math.floor(a)!==Math.floor(hn)||i!==un||Math.abs(d-pn)>2)){e.drawImage(Kt,0,0);return}fn=t,hn=a,un=i,pn=d,typeof OffscreenCanvas<"u"?Kt=new OffscreenCanvas(t,a):(Kt=document.createElement("canvas"),Kt.width=t,Kt.height=a);const c=Kt.getContext("2d");c.clearRect(0,0,t,a),c.clearRect(0,0,t,n),c.save(),c.beginPath(),c.rect(0,n,t,a-n),c.clip();const u=(X,ie)=>{const Oe=document.createElement("canvas");Oe.width=1024,Oe.height=1024;const R=Oe.getContext("2d");R.imageSmoothingEnabled=!0;const C="#0b1214",G="#162a26",O="#2f4f48",K="#4a6b63";R.fillStyle=C,R.fillRect(0,0,1024,1024);const W=[],ee=25;for(let le=0;le<ee;le++)W.push({x:Math.random()*1024,y:Math.random()*1024,r:10+Math.random()*20});const x=(le,Me)=>{for(let pe of W){const ye=le-pe.x,Se=Me-pe.y;if(ye*ye+Se*Se<pe.r*pe.r)return!0}return!1},fe=150,he=1024/fe;for(let le=0;le<fe;le++){const Me=le/fe,pe=le*he,ye=.5+Math.pow(Me,2.2)*3,Se=200*(1.1-Me*.3);for(let Pe=0;Pe<Se;Pe++){const Ye=Math.random()*1024,Ze=(Math.random()-.5)*he*1.5,Je=pe+Ze;if(x(Ye,Je))continue;const Aa=Math.random(),yt=(15+Math.random()*20)*ye;R.lineWidth=1*ye,R.lineCap="round";let Ot=G;if(Math.random()>.6&&(Ot=O),Math.random()>.9&&(Ot=K),R.strokeStyle=Ot,R.beginPath(),Aa<.4){const $t=2+Math.floor(Math.random()*2),_e=(Math.random()-.5)*10*ye,Qe=4*ye;for(let dt=0;dt<$t;dt++){const St=Ye+dt*Qe;R.moveTo(St,Je),R.quadraticCurveTo(St+_e,Je-yt*.7,St+_e*1.2,Je-yt)}}else if(Aa<.8)for(let _e=0;_e<3;_e++){const Qe=Ye+(Math.random()-.5)*10*ye,dt=(Math.random()-.5)*30*ye,St=yt*(.8+Math.random()*.4);R.moveTo(Qe,Je),R.quadraticCurveTo(Qe+dt*.5,Je-St/2,Qe+dt,Je-St)}else{const $t=(Math.random()-.5)*15*ye,_e=yt*1.3;R.moveTo(Ye,Je),R.quadraticCurveTo(Ye+$t,Je-_e*.8,Ye+$t*2.5,Je-_e)}R.stroke()}}return Oe},h=a-n,g=1037;(!l.hauntedPatternCanvas||l.hauntedPatternCanvas._cacheId!==g)&&(l.hauntedPatternCanvas=u(),l.hauntedPatternCanvas._cacheId=g),c.save(),c.drawImage(l.hauntedPatternCanvas,0,n,t,h),c.restore(),c.save(),c.globalCompositeOperation="overlay";const m=c.createRadialGradient(o,n,50,o,n+200,600);m.addColorStop(0,"rgba(255, 200, 50, 0.4)"),m.addColorStop(.3,"rgba(100, 100, 50, 0.1)"),m.addColorStop(1,"rgba(0, 0, 0, 0)"),c.fillStyle=m,c.transform(1,0,0,.3,0,n*.7),c.fillRect(0,n,t,a),c.restore();const p=[],T=32,v=35;let y=0;for(;p.length<T&&y<200;){y++;const X=y*13,ie=Math.pow($e(X),.8),J=n+20+ie*(a-n-100),ge=90+ie*320,Oe=(t-ge)/2,R=$e(X+7)>.5?1:-1,C=$e(X+3)*(Oe-40),G=o+R*(ge/2+20+C);let O=!1;for(let K of p){const W=K.x-G,ee=K.y-J,x=Math.sqrt(W*W+ee*ee),fe=v*(.6+ie*.4);if(x<fe){O=!0;break}}O||p.push({x:G,y:J,z:ie,id:p.length})}p.sort((X,ie)=>X.y-ie.y),p.forEach(X=>{const ie=.6+X.z*1,J=$e(X.id+50);c.fillStyle="rgba(0, 0, 0, 0.5)",c.beginPath(),c.ellipse(X.x,X.y+5*ie,15*ie,6*ie,0,0,Math.PI*2),c.fill(),Xs(c,X.x,X.y,ie,J)});const S=70,A=d-30,E=70,P=150+(typeof qe<"u"?qe:0)+32;Ns(c,o,n,E,A,E,i,P);const M=S/1.8027,I=1.5*M,L=o-M,w=d-I,U=-t,k=w+1.5*(U-L);dn(c,L,w,U,k);const B=o+M,q=d-I,be=t*2,oe=q-1.5*(be-B);dn(c,B,q,be,oe),qs(c,o,d,S),c.save(),c.strokeStyle="#FFFFFF",c.lineWidth=4,c.lineWidth=3,c.strokeRect(o-70,d-30,30,60),c.strokeRect(o+40,d-30,30,60),c.fillStyle="#FFFFFF",c.beginPath(),c.moveTo(o,d+10),c.lineTo(o+10,d),c.lineTo(o+10,d-10),c.lineTo(o-10,d-10),c.lineTo(o-10,d),c.fill(),c.restore();const j=75,$=18;c.save(),c.translate(o,P);const te="#212121",ve=3,ce=$/ve;c.fillStyle=te,c.beginPath(),c.ellipse(0,$,j,j*.4,0,0,Math.PI*2),c.rect(-j,0,j*2,$),c.fill(),c.save();for(let X=0;X<ve;X++){const ie=X*ce,J=(X+1)*ce,ge=12,Oe=X%2*(Math.PI/ge);for(let R=0;R<ge/2+2;R++){const C=R*(Math.PI/(ge/2))+Oe,G=C+Math.PI/(ge/2)-.1;if(C>Math.PI-.1)continue;const O=(le,Me)=>({x:Math.cos(le)*j,y:Math.sin(le)*(j*.4)+Me}),K=O(C,ie),W=O(G,ie),ee=O(C,J),x=O(G,J);c.beginPath(),c.moveTo(K.x,K.y),c.lineTo(W.x,W.y),c.lineTo(x.x,x.y),c.lineTo(ee.x,ee.y),c.closePath();const fe=X*99+R*13,he=60+$e(fe)*20;c.fillStyle=`rgb(${he}, ${he}, ${he})`,c.fill(),c.strokeStyle="#151515",c.lineWidth=1,c.stroke(),c.strokeStyle="rgba(255,255,255,0.4)",c.lineWidth=1,c.beginPath(),c.moveTo(K.x,K.y),c.lineTo(W.x,W.y),c.moveTo(K.x,K.y),c.lineTo(ee.x,ee.y),c.stroke(),c.strokeStyle="rgba(0,0,0,0.5)",c.beginPath(),c.moveTo(ee.x,ee.y),c.lineTo(x.x,x.y),c.lineTo(W.x,W.y),c.stroke()}}c.restore(),c.strokeStyle="#000000",c.lineWidth=2,c.beginPath(),c.ellipse(0,$,j,j*.4,0,Math.PI,0),c.stroke(),c.save(),c.scale(1,.4);const Z=15,Ce=j,Re=j*.6,me=12,z=Math.PI*2/me;for(let X=0;X<me;X++){const ie=X*z,J=(X+1)*z,ge=90+$e(X)*20;c.fillStyle=`rgb(${ge}, ${ge}, ${ge})`,c.beginPath(),c.arc(0,0,Ce,ie,J),c.arc(0,0,Re,J,ie,!0),c.closePath(),c.fill(),c.stroke()}const N=Z,ne=8,ue=Math.PI*2/ne,de=ue/2;for(let X=0;X<ne;X++){const ie=de+X*ue,J=de+(X+1)*ue,ge=95+$e(X+50)*20;c.fillStyle=`rgb(${ge}, ${ge}, ${ge})`,c.beginPath(),c.arc(0,0,Re,ie,J),c.arc(0,0,N,J,ie,!0),c.closePath(),c.fill(),c.stroke()}c.fillStyle="#757575",c.beginPath(),c.arc(0,0,Z,0,Math.PI*2),c.fill(),c.stroke(),c.restore(),c.strokeStyle="#121212",c.lineWidth=2.5,c.beginPath(),c.ellipse(0,0,j,j*.4,0,0,Math.PI*2),c.stroke();const we=5;for(let X=0;X<we;X++){const ie=X/we*Math.PI*2+.5;if(Math.sin(ie)<-.2)continue;const J=Math.cos(ie)*j,ge=Math.sin(ie)*(j*.4);c.save(),c.translate(J,ge),c.scale(.6,.6),c.rotate(Math.PI/4+Math.random()*.3),c.beginPath(),c.strokeStyle="rgba(255,255,255,0.25)",c.lineWidth=1,c.moveTo(0,0),c.lineTo(10,25),c.moveTo(0,0),c.lineTo(-12,22),c.moveTo(-6,12),c.lineTo(6,14),c.stroke(),c.restore()}c.restore(),c.save(),c.strokeStyle="#FFFFFF",c.lineWidth=3,c.strokeRect(o-70,d-30,30,60),c.strokeRect(o+40,d-30,30,60),c.fillStyle="#FFFFFF",c.beginPath(),c.moveTo(o,d+10),c.lineTo(o+10,d),c.lineTo(o+10,d-10),c.lineTo(o-10,d-10),c.lineTo(o-10,d),c.fill(),c.restore(),Ys(c,t,a),typeof sn=="function"&&sn(c,t,a),c.restore(),e.drawImage(Kt,0,0)}let Mi=0,gn=0;function js(e,t,a){const i=Date.now();Mi===0&&(Mi=i),gn+=i-Mi,Mi=i;const o=gn,n=[{id:0,xBase:t*.3,yBase:a*.2,r:60,speed:.002},{id:1,xBase:t*.7,yBase:a*.25,r:50,speed:-.002},{id:2,xBase:t*.4,yBase:a*.18,r:70,speed:.0015},{id:3,xBase:t*.5,yBase:a*.15,r:80,speed:.001},{id:4,xBase:t*.2,yBase:a*.3,r:30,speed:.003}];e.save(),e.fillStyle="#000",n.forEach(s=>{const r=o*s.speed+s.id*100,d=s.xBase+Math.cos(r)*s.r,f=s.yBase+Math.sin(r*1.5)*(s.r*.5),c=Math.sin(o*.015+s.id),u=9;e.beginPath(),e.moveTo(d,f),e.lineTo(d-u*2,f-u*c),e.lineTo(d-u,f+u/2),e.lineTo(d,f+u),e.lineTo(d+u,f+u/2),e.lineTo(d+u*2,f-u*c),e.fill()}),e.restore()}let Vt=null,ga=null,ma=null,Oi=0,yo=0;function Wn(e,t,a){e.save(),e.globalAlpha=1,e.globalCompositeOperation="source-over",e.clearRect(0,0,t,a),e.restore();const i=l.isGameOver;Fn(e,t,a,!0);const o=Date.now()/1e3;Fs(e,t,a,o);const n=t<600?1.4:2.5,s=t/a,r=.5,f=Math.max(0,Math.min(1,(s-r)/(1.8-r))),c=a*(.7+f*.2),u=t*1.2,h=-t*.1,g=4096,m=2160,p=64,T=Math.min(t,g),v=Math.min(a,m),y=Math.ceil(T/p)*p,S=Math.ceil(v/p)*p;if(!Vt||Oi!==y||yo!==S){t>g&&console.warn(`[HauntedRenderer] Clamping Cache Width: ${t} -> ${g}`),(!Vt||Math.abs(y-Oi)>p)&&console.log(`[HauntedRenderer] Regenerating Start Screen Cache ${y}x${S} (Bucket Aligned)`),typeof OffscreenCanvas<"u"?(Vt=new OffscreenCanvas(y,S),ga=new OffscreenCanvas(y,S),ma=new OffscreenCanvas(y,S)):(Vt=document.createElement("canvas"),Vt.width=y,Vt.height=S,ga=document.createElement("canvas"),ga.width=y,ga.height=S,ma=document.createElement("canvas"),ma.width=y,ma.height=S);const $=Vt.getContext("2d"),te=ga.getContext("2d"),ve=ma.getContext("2d");$.save();const ce=$.createLinearGradient(0,c,0,a);ce.addColorStop(0,"#151515"),ce.addColorStop(1,"#000000"),$.fillStyle=ce,$.fillRect(h,c-2,u,a-c+2),$.strokeStyle="rgba(10, 10, 10, 0.5)",$.lineWidth=2,$.beginPath();const Z=20*n,Ce=40*n;for(let de=c;de<a;de+=Z){const we=Math.floor((de-c)/Z),X=we%2===0?0:Ce/2;for(let ie=h-Ce;ie<h+u;ie+=Ce){const J=Math.floor((ie-h)/Ce);de-c<(a-c)*.7&&($.strokeRect(ie+X,de,Ce,Z),Math.sin(we*12.9898+J*78.233)>.8&&($.fillStyle="rgba(0,0,0,0.3)",$.fillRect(ie+X,de,Ce,Z)))}}$.stroke();const Re=$.createLinearGradient(0,a*.75,0,a);Re.addColorStop(0,"rgba(0,0,0,0)"),Re.addColorStop(1,"rgba(0,0,0,0.8)"),$.fillStyle=Re,$.fillRect(0,a*.75,t,a*.25),$.fillStyle="#222",$.fillRect(h,c-5,u,10),$.restore();const me=300*n,z=(t-me)/2;let N=0;z>0&&(N=Math.ceil(z/(90*n)));const ne=Math.min(Math.max(3,1+N),7),ue={cx:y/2,baseY:c,scaleX:n,scaleY:n,wingsPerSide:ne};ri($,y,S,0,"STRUCTURE_ONLY",0,ue),ri(te,y,S,0,"WINDOWS_ONLY",0,ue),ri(ve,y,S,0,"WINDOWS_ONLY",0,ue,"#ff0000"),Oi=y,yo=S}e.drawImage(Vt,0,0,t,a),js(e,t,a),e.save();const _=Math.sin(Date.now()/1e3)*.1+.9;e.globalAlpha=_,e.globalCompositeOperation="screen";const A=i?ma:ga;A&&e.drawImage(A,0,0,t,a),e.restore();const E=a*.82,P=e.createLinearGradient(0,E,0,a);P.addColorStop(0,"#121010"),P.addColorStop(1,"#000000"),e.fillStyle=P,e.beginPath(),e.moveTo(0,a),e.lineTo(0,E+40);const M=t*.3,I=t*.7;e.quadraticCurveTo(t*.15,E+10,M,E),e.lineTo(I,E),e.quadraticCurveTo(t*.85,E+10,t,E+40),e.lineTo(t,a),e.fill(),e.save();const L=400,w=$=>{let te=$+=1831565813;return te=Math.imul(te^te>>>15,te|1),te^=te+Math.imul(te^te>>>7,te|61),((te^te>>>14)>>>0)/4294967296};for(let $=0;$<L;$++){const te=w($*123),ve=w($*456),ce=w($*789),Z=te*t,Ce=E+ve*(a-E),Re=ce*3+1;e.fillStyle=w($*999)>.5?"#1a1a1a":"#050505",e.fillRect(Z,Ce,Re,Re)}e.restore(),e.fillStyle="#050505";const U=Math.floor(t/30),k=$=>{const te=Math.sin($)*1e4;return te-Math.floor(te)};for(let $=0;$<U;$++){const te=$/U,ve=t*te;let ce=E;if(ve<M){const Z=ve/M;ce=(E+40)*(1-Z)+E*Z}else if(ve>I){const Z=(ve-I)/(t-I);ce=E*(1-Z)+(E+40)*Z}k($*99)>.4&&$s(e,ve,ce+5,.6+k($)*.4)}const B=t/2,q=E-50,be=!1,oe=l.isDailyChallenge?V.dailyHighScore:V.highScore;Bn(e,B,q,1.4,!0,oe,be),e.save();const j=e.createLinearGradient(0,a*.7,0,a);if(j.addColorStop(0,"rgba(0,0,0,0)"),i?(j.addColorStop(.5,"rgba(40, 10, 10, 0.4)"),j.addColorStop(1,"rgba(20, 0, 0, 0.9)")):(j.addColorStop(.5,"rgba(10, 20, 30, 0.3)"),j.addColorStop(1,"rgba(0, 0, 0, 0.8)")),e.fillStyle=j,e.fillRect(0,a*.7,t,a*.3),e.restore(),e.textAlign="center",e.shadowColor="transparent",e.shadowOffsetX=0,e.shadowOffsetY=0,e.shadowBlur=0,i){const $=l.consecutiveFouls>=4;let te="GAME OVER",ve="#6200ea";$&&(te="BAT BROKEN!"),e.save(),e.font='40px "PressStart2PLocal"',e.strokeStyle="#000000",e.lineWidth=4,e.strokeText(te,t/2,a*.45),e.fillStyle=ve,e.fillText(te,t/2,a*.45),e.restore(),e.font='20px "PressStart2PLocal"',e.fillStyle="#eceff1",e.fillText(`SCORE: ${V.score}`,t/2,a*.52),Math.floor(Date.now()/800)%2===0&&(e.font='16px "PressStart2PLocal"',e.fillStyle="#ffffff",e.fillText("TAP TO RETRY",t/2,a*.6))}else{e.save();const $=Math.sin(Date.now()/300);e.globalAlpha=.6+($+1)*.2,e.font='40px "PressStart2PLocal"',e.fillStyle="#80d8ff",e.strokeStyle="#000000",e.lineWidth=6,e.lineJoin="round",window.innerWidth<=600||window.innerHeight<=600?(e.strokeText("TAP TO",t/2,a*.48),e.fillText("TAP TO",t/2,a*.48),e.strokeText("START",t/2,a*.48+50),e.fillText("START",t/2,a*.48+50)):(e.strokeText("TAP TO START",t/2,a*.48),e.fillText("TAP TO START",t/2,a*.48)),e.restore()}}function $a(e,t){if(!(typeof document>"u"))try{console.log(`[HauntedRenderer] Warming up caches for ${e}x${t}...`);const a=document.createElement("canvas");a.width=1,a.height=1;const i=a.getContext("2d");Wn(i,e,t);const o=e<600?.6:.8;Bn(i,0,0,o),zn(i,e,t),console.log("[HauntedRenderer] Warmup Complete.")}catch(a){console.warn("[HauntedRenderer] Warmup Failed:",a)}}function Js(){console.log("[HauntedRenderer] Cleaning up Start Screen caches to free memory."),Vt=null,ga=null,ma=null,Oi=0,yo=0}const Fa={[F.FASTBALL]:{name:"Fastball",colorName:"WHITE",colors:["#ffffff"],baseSpeed:.6,rotationSpeed:.15,windupDuration:1e3,chargeSound:null,specialLogic:null},[F.CURVEBALL]:{name:"Curveball",colorName:"PINK",colors:["#ff69b4"],baseSpeed:.5,rotationSpeed:.3,windupDuration:1e3,chargeSound:"playCurveCharge",specialLogic:"curve"},[F.CHANGEUP]:{name:"Changeup",colorName:"GOLD",colors:["#ffd700"],baseSpeed:.45,rotationSpeed:.05,windupDuration:1e3,chargeSound:"playChangeCharge",specialLogic:null},super_fastball:{name:"Super Fastball",colorName:"RED",colors:["#ff0000"],baseSpeed:.85,rotationSpeed:.4,windupDuration:1e3,chargeSound:"playSuperCharge",specialLogic:null},[F.STOPBALL]:{name:"Stopball",colorName:"PURPLE",colors:["#800080"],baseSpeed:.65,rotationSpeed:.2,windupDuration:1e3,chargeSound:"playEvilLaugh",specialLogic:"stop"},[F.GHOSTBALL]:{name:"Ghostball",colorName:"CYAN",colors:["#00ffff"],baseSpeed:.55,rotationSpeed:.2,windupDuration:1e3,chargeSound:"playGhostCharge",specialLogic:"ghost"},[F.STOP_CURVE]:{name:"Stop-Curve",colorName:"PURPLE/PINK",colors:["#800080","#ff69b4"],baseSpeed:.55,rotationSpeed:.3,windupDuration:2500,chargeSound:"playEvilLaugh",specialLogic:"stop_curve"},[F.GHOST_CURVE]:{name:"Ghost-Curve",colorName:"CYAN/PINK",colors:["#00ffff","#ff69b4"],baseSpeed:.55,rotationSpeed:.3,windupDuration:2500,chargeSound:"playGhostCharge",specialLogic:"ghost_curve"},[F.SPLITTER]:{name:"Splitter",colorName:"BLUE",colors:["#00008b"],baseSpeed:.35,rotationSpeed:.1,windupDuration:1e3,chargeSound:"playSplitterCharge",specialLogic:"splitter"},[F.ZIGZAG]:{name:"ZigZag",colorName:"Lime Green",colors:["#32CD32"],baseSpeed:.55,rotationSpeed:.2,windupDuration:1e3,chargeSound:"playZigZagCharge",throwSound:null,specialLogic:"zigzag"},[F.SUPER_CURVE]:{name:"Super-Curve",colorName:"RED/PINK",colors:["#ff0000","#ff69b4"],baseSpeed:.85,rotationSpeed:.4,windupDuration:2500,chargeSound:"playSuperCharge",specialLogic:"super_curve"},[F.SUPER_ZIGZAG]:{name:"Super-ZigZag",colorName:"RED/GREEN",colors:["#ff0000","#32CD32"],baseSpeed:.85,rotationSpeed:.4,windupDuration:2500,chargeSound:"playSuperCharge",throwSound:null,specialLogic:"super_zigzag"},[F.SUPER_SPLITTER]:{name:"Super-Splitter",colorName:"RED/BLUE",colors:["#ff0000","#00008b"],baseSpeed:.38,rotationSpeed:.4,windupDuration:2500,chargeSound:"playSuperCharge",throwSound:"playSplitter",specialLogic:"super_splitter"},[F.STOP_SPLITTER]:{name:"Stop-Splitter",colorName:"PURPLE/BLUE",colors:["#800080","#00008b"],baseSpeed:.35,rotationSpeed:.3,windupDuration:2500,chargeSound:"playEvilLaugh",throwSound:"playSplitter",specialLogic:"stop_splitter"},[F.STOP_ZIGZAG]:{name:"Stop-ZigZag",colorName:"PURPLE/GREEN",colors:["#800080","#32CD32"],baseSpeed:.55,rotationSpeed:.3,windupDuration:2500,chargeSound:"playEvilLaugh",throwSound:null,specialLogic:"stop_zigzag"},[F.GHOST_SPLITTER]:{name:"Ghost-Splitter",colorName:"CYAN/BLUE",colors:["#00FFFF","#00008b"],baseSpeed:.35,rotationSpeed:.3,windupDuration:2500,chargeSound:"playGhostCharge",throwSound:"playSplitter",specialLogic:"ghost_splitter"},[F.GHOST_ZIGZAG]:{name:"Ghost-ZigZag",colorName:"CYAN/GREEN",colors:["#00FFFF","#32CD32"],baseSpeed:.55,rotationSpeed:.3,windupDuration:2500,chargeSound:"playGhostCharge",throwSound:null,specialLogic:"ghost_zigzag"},[F.GHOST_CHANGEUP]:{name:"Ghost-Changeup",colorName:"CYAN/GOLD",colors:["#00FFFF","#ffd700"],baseSpeed:.35,rotationSpeed:.3,windupDuration:2500,chargeSound:"playGhostCharge",throwSound:"playPitch",specialLogic:"ghost_changeup"},[F.CURVE_SPLITTER]:{name:"Curve-Splitter",colorName:"PINK/BLUE",colors:["#ff69b4","#00008b"],baseSpeed:.35,rotationSpeed:.3,windupDuration:2500,chargeSound:"playCurveCharge",throwSound:"playSplitter",specialLogic:"curve_splitter"},[F.ZIGZAG_SPLITTER]:{name:"ZigZag-Splitter",colorName:"GREEN/BLUE",colors:["#32CD32","#00008b"],baseSpeed:.35,rotationSpeed:.3,windupDuration:2500,chargeSound:"playZigZagCharge",throwSound:"playSplitter",specialLogic:"zigzag_splitter"},[F.CURVE_CHANGEUP]:{name:"Curve-Changeup",colorName:"PINK/GOLD",colors:["#ff69b4","#ffd700"],baseSpeed:.35,rotationSpeed:.3,windupDuration:2500,chargeSound:"playCurveCharge",throwSound:"playPitch",specialLogic:"curve_changeup"},[F.SPLITTER_CHANGEUP]:{name:"Splitter-Changeup",colorName:"BLUE/GOLD",colors:["#00008b","#ffd700"],baseSpeed:.22,rotationSpeed:.3,windupDuration:2500,chargeSound:"playSplitterCharge",throwSound:"playSplitter",specialLogic:"splitter_changeup"},[F.ZIGZAG_CHANGEUP]:{name:"ZigZag-Changeup",colorName:"GREEN/GOLD",colors:["#32CD32","#ffd700"],baseSpeed:.35,rotationSpeed:.3,windupDuration:2500,chargeSound:"playZigZagCharge",throwSound:null,specialLogic:"zigzag_changeup"},[F.GHOST_STOP]:{name:"Ghost-Stop",colorName:"CYAN/PURPLE",colors:["#00FFFF","#800080"],baseSpeed:.55,rotationSpeed:.2,windupDuration:2500,chargeSound:"playGhostCharge",throwSound:null,specialLogic:"ghost_stop"},[F.GHOST_SUPER]:{name:"Ghost-Super",colorName:"CYAN/RED",colors:["#00FFFF","#ff0000"],baseSpeed:.85,rotationSpeed:.4,windupDuration:2500,chargeSound:"playGhostCharge",throwSound:null,specialLogic:"ghost_super"},[F.STOP_SUPER]:{name:"Stop-Super",colorName:"PURPLE/RED",colors:["#800080","#ff0000"],baseSpeed:.85,rotationSpeed:.4,windupDuration:2500,chargeSound:"playEvilLaugh",throwSound:null,specialLogic:"stop_super"},[F.STOP_CHANGEUP]:{name:"Stop-Changeup",colorName:"PURPLE/GOLD",colors:["#800080","#ffd700"],baseSpeed:.35,rotationSpeed:.2,windupDuration:2500,chargeSound:"playEvilLaugh",throwSound:null,specialLogic:"stop_changeup"}};function Qs(){for(const e in si)delete si[e]}function So(e,t,a,i,o,n={}){const s=l.pitcher.gender||"MALE",r=n&&Object.keys(n).length>0?n:l.pitcher.props||{},d=`${r.sunglasses?"sg":""}${r.beard?"bd":""}${r.goldChain?"gc":""}${r.spaceHelmet?"sh":""}`;let f="";l.pitcher.id==="MONITOR"&&l.perfectHitTimer>0&&(f="_sad");const u=(l.pitcher.id==="ROOKIE"||!l.pitcher.id)&&(t==="#ff0000"||t==="#FF0000")?`_red_${Math.floor(Date.now()/100)}`:"",h=`${e}_${t}_${a||"none"}_${i!==void 0?i:"full"}_${o||"default"}_${s}_${d}${f}_${l.pitcher.id||"NONE"}${u}`;if(si[h])return si[h];Li.width=Ke,Li.height=Ke,st.clearRect(0,0,Ke,Ke);const g=s==="FEMALE",m=o==="#000000";if(mn(st,Va,li,e,"#ffffff",null,"UNIFORM",g,m,o,r),st.globalCompositeOperation="source-atop",i!==void 0){const v=Ke*i,y=Ke-v;st.fillStyle=t,st.fillRect(0,y,Ke,v)}else a?(st.fillStyle=t,st.fillRect(0,0,Ke/2,Ke),st.fillStyle=a,st.fillRect(Ke/2,0,Ke/2,Ke)):(st.fillStyle=t,st.fillRect(0,0,Ke,Ke));st.globalCompositeOperation="source-over",mn(st,Va,li,e,"#ffffff",null,"SKIN",g,m,o,r),To(st,Va,li,e,r);const p=document.createElement("canvas");return p.width=Ke,p.height=Ke,p.getContext("2d").drawImage(Li,0,0),si[h]=p,p}function To(e,t,a,i,o={}){const n=(u,h,g,m,p)=>{e.fillStyle=p,e.fillRect(u,h,g,m)};if(l.pitcher.id==="MONITOR"){re.currentTheme.id,re.currentTheme.id;let u=t,h=a-14,g=32,m=26;i==="THROW"&&(u=t+5,h=a-12),e.fillStyle="#111111",e.fillRect(u+3,h+3,g-6,m-6),e.fillStyle="#00ff00",l.perfectHitTimer>0?(e.fillStyle="#00ff00",e.fillRect(u+10,h+6,4,4),e.fillRect(u+18,h+6,4,4),e.strokeStyle="#00ff00",e.lineWidth=2,e.strokeRect(u+13,h+15,6,6)):(e.fillRect(u+10,h+6,4,4),e.fillRect(u+18,h+6,4,4),e.fillRect(u+10,h+13,2,2),e.fillRect(u+20,h+13,2,2),e.fillRect(u+12,h+15,8,2));return}let s=a-10,r=t+8;if(i==="THROW"&&(r=t+13,s=a-8),l.pitcher.id==="SCARY"){e.save(),e.translate(t+16,a+32);const u=e.createRadialGradient(0,0,5,0,0,25);u.addColorStop(0,"rgba(0, 0, 0, 0.8)"),u.addColorStop(1,"rgba(0, 0, 0, 0)"),e.fillStyle=u,e.beginPath(),e.arc(0,0,25,0,Math.PI*2),e.fill(),e.restore()}const d=l.pitcher.gender==="FEMALE",f=l.pitcher.skinColor||"#ffccaa";if(d){const u=f==="#000000"||f==="#1a1a1a"||f==="#808080",h=u?f:"#FFD54F";e.fillStyle=h,e.beginPath(),e.arc(r+8,s+6,8.2,0,Math.PI*2),e.fill(),e.fillStyle=f,e.beginPath(),e.ellipse?e.ellipse(r+8,s+9,7,8.5,0,0,Math.PI*2):e.arc(r+8,s+9,7,0,Math.PI*2),e.fill(),u||(e.fillStyle="#1E88E5",e.beginPath(),e.arc(r+5,s+9,1.5,0,Math.PI*2),e.fill(),e.beginPath(),e.arc(r+11,s+9,1.5,0,Math.PI*2),e.fill(),e.strokeStyle="#D81B60",e.lineWidth=1.5,e.beginPath(),e.arc(r+8,s+10,3,.2*Math.PI,.8*Math.PI),e.stroke()),e.fillStyle=h,e.beginPath(),e.moveTo(r+1,s+4),e.bezierCurveTo(r,s-2,r+6,s-4,r+15,s+5),e.lineTo(r+15,s+9),e.bezierCurveTo(r+8,s+2,r+4,s+2,r+1,s+7),e.fill()}else l.pitcher.id==="SCARY"&&(e.fillStyle="#ff0000",e.fillRect(r+4,s+6,2,2),e.fillRect(r+10,s+6,2,2));l.bossModeActive,d||l.pitcher.id==="SCARY"&&(e.fillStyle="#ff0000",e.shadowColor="#ff0000",e.shadowBlur=10,e.fillRect(r+4,s+5,2,2),e.fillRect(r+10,s+5,2,2),e.shadowBlur=0),o.spaceHelmet&&(e.fillStyle="rgba(173, 216, 230, 0.5)",e.strokeStyle="rgba(255, 255, 255, 0.8)",e.lineWidth=2,e.beginPath(),e.arc(r+8,s+8,12,0,Math.PI*2),e.fill(),e.stroke(),e.beginPath(),e.arc(r+12,s+4,3,0,Math.PI*2),e.fillStyle="rgba(255, 255, 255, 0.9)",e.fill());const c=d?"#FF69B4":"#000000";i==="SET"?(n(t+2,a+32,10,4,c),n(t+20,a+32,10,4,c),n(t+10,a+12,12,10,"#ffffff")):i==="KICK"?(n(t+20,a+32,10,4,c),n(t-8,a+22,10,4,c),n(t+20,a+12,8,8,"#ffffff")):i==="THROW"?(n(t+35,a+32,10,4,c),n(t+5,a+32,10,4,c),n(t-5,a+10,8,8,"#ffffff")):(n(t+2,a+32,10,4,c),n(t+20,a+32,10,4,c))}function mn(e,t,a,i,o,n,s="ALL",r=null,d=!1,f=null,c={}){const h=r!==null?r:l.pitcher.gender==="FEMALE",g=c.sunglasses||!1,m=c.beard||!1,p=c.goldChain||!1,T=c.hatColor||null,v=d,y=f||l.pitcher.skinColor||"#ffccaa",S=s==="ALL"||s==="UNIFORM",_=s==="ALL"||s==="SKIN",A=(k,B,q,be)=>{S&&(e.fillStyle=o,e.fillRect(k,B,q,be))},E=(k,B,q,be,oe)=>{_&&(e.fillStyle=oe,e.fillRect(k,B,q,be))},P=(k,B)=>{if(_){if(l.pitcher.id==="MONITOR"){e.fillStyle="#d0d0c0",e.fillRect(k-8,B-4,32,26);return}if(h)e.fillStyle=y,e.beginPath(),e.arc(k+8,B+8,8,0,Math.PI*2),e.fill();else{const q=T||(v?"#ffffff":"#e74c3c");if(v)e.fillStyle=q,e.fillRect(k-2,B-4,20,6),e.fillStyle=y,e.fillRect(k,B,16,16);else if(e.fillStyle=y,e.fillRect(k,B,16,16),l.pitcher.id==="ACE")e.fillStyle="#000000",e.fillRect(k+1,B-8,14,8),e.fillRect(k,B-5,16,5),e.fillRect(k-1,B-1,2,8),e.fillRect(k+15,B-1,2,8);else if(l.pitcher.id==="ROOKIE"||T){const be=T||"#e74c3c";e.fillStyle=be,e.fillRect(k-2,B-4,20,6),e.fillStyle=be,e.fillRect(k,B-6,16,4)}m&&(e.fillStyle="#000000",e.fillRect(k+2,B+12,12,1),e.fillRect(k-1,B+6,2,9),e.fillRect(k+15,B+6,2,9),e.fillRect(k,B+13,5,5),e.fillRect(k+11,B+13,5,5),e.fillRect(k+2,B+16,12,2),e.fillRect(k+7,B+14,2,2)),g&&(e.fillStyle="#000000",e.fillRect(k+1,B+4,6,5),e.fillRect(k+9,B+4,6,5),e.fillRect(k+7,B+4,2,1),e.fillRect(k+7,B+5,1,1),e.fillRect(k+8,B+5,1,1),e.fillStyle="#222222",e.fillRect(k+2,B+5,4,3),e.fillRect(k+10,B+5,4,3))}}},M=(k,B)=>{_&&p&&(e.strokeStyle="#B8860B",e.lineWidth=4,e.lineCap="round",e.beginPath(),e.moveTo(k+10,B+2),e.bezierCurveTo(k+10,B+14,k+22,B+14,k+22,B+2),e.stroke(),e.strokeStyle="#FFD700",e.lineWidth=3,e.setLineDash([2,1]),e.beginPath(),e.moveTo(k+10,B+2),e.bezierCurveTo(k+10,B+14,k+22,B+14,k+22,B+2),e.stroke(),e.setLineDash([]),e.shadowBlur=0)};let I=t+2,L=t+20,w=10;const U=c.shoeColor||l.pitcher.shoeColor||(h?"#FF69B4":"#000000");if(i==="SET")A(t,a,32,20),M(t,a),A(I,a+20,w,12),A(L,a+20,w,12),E(I,a+32,w,4,U),E(L,a+32,w,4,U),E(t+10,a+12,12,10,"#ffffff"),P(t+8,a-10);else if(i==="KICK")A(t,a,32,20),M(t,a),A(L,a+20,w,12),E(L,a+32,w,4,U),A(t-8,a+10,w,12),E(t-8,a+22,w,4,U),E(t+20,a+12,8,8,"#ffffff"),P(t+8,a-10);else if(i==="THROW"){A(t+5,a+2,32,20),M(t+5,a+2);let k=t+35,B=t+5;A(k,a+22,w,10),E(k,a+32,w,4,U),A(B,a+22,w,10),E(B,a+32,w,4,U),P(t+13,a-8),A(t+35,a+5,12,6),E(t-5,a+10,8,8,"#ffffff")}else A(t,a,32,20),M(t,a),A(I,a+20,w,12),A(L,a+20,w,12),E(I,a+32,w,4,U),E(L,a+32,w,4,U),P(t+8,a-10)}function xs(){let e=l.pitcher.baseColor,t=null,a;if(l.pitcher.state===Fe.WINDUP){let p=Fa[l.pitcher.nextPitch];if(!p&&typeof l.pitcher.nextPitch=="string"&&(p=Fa[l.pitcher.nextPitch.trim().toLowerCase()]),l.showTutorial)l.settings?.noFlash||Math.floor(l.pitcher.timer/200)%2===0?e="#FF69B4":e="#FFFFFF";else if(p&&p.windupStyle==="fill"){e=p.colors[0];const T=l.pitcher.timer/l.pitcher.windupDuration;a=Math.floor(T*10)/10,a=Math.max(.1,Math.min(1,a))}else if(p&&p.colors)if(l.settings?.noFlash)p.colors.length>1?(e=p.colors[0],t=p.colors[1]):e=p.colors[0];else{const T=Math.floor(l.pitcher.timer/200)%2===0;p.colors.length>1?T?(e=p.colors[0],t=p.colors[1]):t=null:T?e=p.colors[0]:e="#FFFFFF"}}Array.isArray(e)&&(e=e[0]),Array.isArray(t)&&(t=t[0]);let i="IDLE";if(l.pitcher.state===Fe.WINDUP){const p=l.pitcher.timer/l.pitcher.windupDuration;p<.3?i="SET":p<.7?i="KICK":i="THROW"}const n=!(l.pitcher.id==="SCARY")&&re.currentTheme?.pitcherAccessories?re.currentTheme.pitcherAccessories:{},r={...l.pitcher.props||{},...n};l.pitcher.id==="ACE"&&(r.sunglasses=!0,r.beard=!0,r.goldChain=!0);const d=So(i,e,t,a,l.pitcher.skinColor,r),f=l.pitcher.scale||1,c=Ke*f,u=Ke*f,h=(Ke/2-Va)*(f-1),g=l.pitcher.x-Va*f-h,m=l.pitcher.y-li*f;if(b.save(),l.pitcher.rotation){const p=g+c/2,T=m+u/2;b.translate(p,T),b.rotate(l.pitcher.rotation),b.translate(-p,-T)}l.pitcher.gender==="FEMALE"&&el(b,g,m,f,l.pitcher.skinColor,i),b.drawImage(d,g,m,c,u),b.restore()}function el(e,t,a,i,o,n="IDLE"){const r=o==="#000000"||o==="#1a1a1a"?o:"#FFD54F";let d=t+(Va+8)*i,f=a+(li-2)*i;n==="THROW"&&(d+=5*i,f+=2*i);const c=d+12*i,u=f-9*i,h=(l.pitcher.timer||0)/200;let g=0;(l.pitcher.state===Fe.WALK_ON||l.pitcher.state===Fe.WALK_OFF)&&(g=Math.sin(h)*(2*i)),e.fillStyle=r,e.beginPath(),e.moveTo(c,u),e.quadraticCurveTo(c+8*i,u-2*i+g,c+14*i,u+12*i+g),e.quadraticCurveTo(c+8*i,u+6*i+g,c+2*i,u+4*i),e.fill(),e.beginPath(),e.arc(c+1*i,u+2*i,4*i,0,Math.PI*2),e.fill()}const aa={STANDARD:{id:"STANDARD",name:"Pink Bat",color:"#ff69b4",type:"wood",draw(e,t,a){e.fillStyle=this.color,e.fillRect(0,-t/2,15,t),e.fillRect(15,-t/2-2,a,t+4)}},BLUE:{id:"BLUE",name:"Blue Bat",color:"#0000FF",type:"wood",pattern:"camo",draw(e,t,a){e.fillStyle=this.color,e.fillRect(0,-t/2,15,t),e.fillRect(15,-t/2-2,a,t+4)}},GOLD:{id:"GOLD",name:"Golden Glory",color:"#FFD700",type:"metal",draw(e,t,a){e.fillStyle="#B8860B",e.fillRect(0,-t/2,15,t);const i=e.createLinearGradient(15,-t/2,15,t/2);i.addColorStop(0,"#DAA520"),i.addColorStop(.3,"#FFD700"),i.addColorStop(.5,"#FFFFFF"),i.addColorStop(.7,"#FFD700"),i.addColorStop(1,"#DAA520"),e.fillStyle=i,e.fillRect(15,-t/2-2,a,t+4)}},LASER:{id:"LASER",name:"Neon Bat",color:"#00ffff",type:"energy"}},wt={currentBat:aa.STANDARD,setBat(e){aa[e]&&(this.currentBat=aa[e])}};class We{constructor(t){this.setSeed(t)}setSeed(t){if(typeof t=="string"){let a=2166136261;for(let i=0;i<t.length;i++)a=Math.imul(a^t.charCodeAt(i),16777619);this.seed=a>>>0}else this.seed=t>>>0}random(){let t=this.seed+=1831565813;return t=Math.imul(t^t>>>15,t|1),t^=t+Math.imul(t^t>>>7,t|61),((t^t>>>14)>>>0)/4294967296}range(t,a){return this.random()*(a-t)+t}rangeInt(t,a){return Math.floor(this.random()*(a-t+1))+t}shuffle(t){for(let a=t.length-1;a>0;a--){const i=Math.floor(this.random()*(a+1));[t[a],t[i]]=[t[i],t[a]]}return t}choice(t){return t[Math.floor(this.random()*t.length)]}static getDailySeed(t=new Date){const a=t,i=a.getUTCFullYear(),o=String(a.getUTCMonth()+1).padStart(2,"0"),n=String(a.getUTCDate()).padStart(2,"0");return`${i}-${o}-${n}`}}const Ca=new We(Date.now()),jt=256;class tl{constructor(){this.cache={},this.ctx=null,this.canvas=null,this.rng=new We(12345)}init(){this.canvas||(this.canvas=document.createElement("canvas"),this.canvas.width=jt,this.canvas.height=jt,this.ctx=this.canvas.getContext("2d",{willReadFrequently:!0}))}generate(t){this.init();const a=this.ctx,i=it.BAT_WIDTH,o=it.BAT_LENGTH,n=jt/2,s=jt/2;a.clearRect(0,0,jt,jt),a.save(),a.translate(n,s),t.id==="GOLD"?this.drawGoldBat(a,i,o):t.id==="LASER"?this.drawLaserBat(a,i,o):t.id==="MAGMA"?this.drawMagmaBat(a,i,o):t.id==="ZEUS"?this.drawZeusBat(a,i,o):t.id==="BLUE"?this.drawCamoBat(a,i,o):this.drawStandardBat(a,i,o,t.color),a.restore();const r=document.createElement("canvas");return r.width=jt,r.height=jt,r.getContext("2d").drawImage(this.canvas,0,0),r}generateIcon(t){const i=document.createElement("canvas");i.width=80,i.height=80;const o=i.getContext("2d"),n=it.BAT_WIDTH,s=it.BAT_LENGTH;return o.translate(80/2,80/2),o.rotate(-45*Math.PI/180),o.scale(1,1),o.translate(-32.5,0),t.id==="GOLD"?this.drawGoldBat(o,n,s):t.id==="LASER"?this.drawLaserBat(o,n,s):t.id==="MAGMA"?this.drawMagmaBat(o,n,s):t.id==="ZEUS"?this.drawZeusBat(o,n,s):t.id==="BLUE"?this.drawCamoBat(o,n,s):this.drawStandardBat(o,n,s,t.color),i}drawStandardBat(t,a,i,o){t.fillStyle=o,t.fillRect(0,-a/2,15,a),t.fillRect(15,-a/2-2,i,a+4)}drawCamoBat(t,a,i){this.rng.setSeed("BlueCamoBatPatternFlatV1"),t.beginPath(),t.rect(0,-a/2,15,a),t.rect(15,-a/2-2,i,a+4),t.clip(),t.fillStyle="#b0c4de",t.fillRect(0,-a/2-2,i+20,a+4),[{color:"#6495ed",count:8,sizeMin:10,sizeMax:20},{color:"#4169e1",count:8,sizeMin:8,sizeMax:18},{color:"#191970",count:6,sizeMin:6,sizeMax:15}].forEach(n=>{t.fillStyle=n.color;for(let s=0;s<n.count;s++){t.beginPath();const r=this.rng.random()*(i+20)-5,d=(this.rng.random()-.5)*a*4,f=this.rng.range(n.sizeMin,n.sizeMax),c=this.rng.range(n.sizeMin*.8,n.sizeMax),u=this.rng.random()*Math.PI*2;t.save(),t.translate(r,d),t.rotate(u),t.moveTo(0,-c/2),t.bezierCurveTo(f/2,-c/2,f,0,f/2,c/2),t.bezierCurveTo(0,c,-f/2,c/2,-f/2,0),t.bezierCurveTo(-f,-c/2,-f/2,-c/2,0,-c/2),t.fill(),t.restore()}}),t.fillStyle="rgba(0,0,0,0.4)";for(let n=0;n<15;n+=3)t.fillRect(n,-a/2,2,a)}drawGoldBat(t,a,i){t.fillStyle="#B8860B",t.fillRect(0,-a/2,15,a),t.fillStyle="rgba(0,0,0,0.2)",t.fillRect(2,-a/2,2,a),t.fillRect(6,-a/2,2,a),t.fillRect(10,-a/2,2,a);const o=t.createLinearGradient(15,-a/2,15,a/2);o.addColorStop(0,"#DAA520"),o.addColorStop(.3,"#FFD700"),o.addColorStop(.5,"#FFFFFF"),o.addColorStop(.7,"#FFD700"),o.addColorStop(1,"#DAA520"),t.fillStyle=o,t.fillRect(15,-a/2-2,i,a+4),t.fillStyle="#fff",t.globalAlpha=.8,t.beginPath(),t.arc(30,-5,1,0,Math.PI*2),t.fill(),t.beginPath(),t.arc(50,2,1.5,0,Math.PI*2),t.fill(),t.globalAlpha=1}drawLaserBat(t,a,i){t.shadowBlur=20,t.shadowColor="#00ffff",t.fillStyle="#00ffff",t.fillRect(0,-a/2,15,a),t.fillRect(15,-a/2-2,i,a+4),t.fillStyle="#e0ffff",t.shadowBlur=5,t.fillRect(15,-a/4,i,a/2),t.shadowBlur=0}drawMagmaBat(t,a,i){t.fillStyle="#2d2d2d",t.fillRect(0,-a/2,i+15,a),t.fillStyle="#ff4500";for(let o=0;o<15;o++){const n=Math.random()*i+10,s=(Math.random()-.5)*a,r=Math.random()*4+2,d=Math.random()*4+2;t.fillRect(n,s,r,d)}t.fillStyle="rgba(255, 69, 0, 0.3)",t.shadowBlur=10,t.shadowColor="#ff4500",t.fillRect(15,-a/2-2,i,a+4),t.shadowBlur=0}drawZeusBat(t,a,i){t.fillStyle="#dfe6e9",t.fillRect(0,-a/2,i+15,a),t.strokeStyle="#00d2d3",t.lineWidth=2,t.beginPath(),[10,20,30,40,50,60].forEach(n=>{t.moveTo(n,(Math.random()-.5)*a),t.lineTo(n+10,(Math.random()-.5)*a)}),t.stroke(),t.shadowBlur=8,t.shadowColor="#54a0ff",t.strokeStyle="#fff",t.lineWidth=1,t.stroke(),t.shadowBlur=0}}const $n=new tl,ci={},Ha=200;function al(){for(const e in ci)delete ci[e]}function il(e){const t=wt.currentBat.id+"_"+e;if(ci[t])return ci[t];const a=document.createElement("canvas");a.width=Ha,a.height=Ha;const i=a.getContext("2d"),o=Ha/2,n=Ha/2;i.translate(o,n);const s=$n.generate(wt.currentBat);if(i.drawImage(s,-s.width/2,-s.height/2),e==="damaged"||e==="broken"){let r="#500000";wt.currentBat.id==="GOLD"&&(r="#B8860B"),wt.currentBat.id==="BLUE"&&(r="#000000"),i.fillStyle=r,i.fillRect(20,-4,2,2),i.fillRect(22,-2,2,2),i.fillRect(24,0,2,2),i.fillRect(35,4,2,2),i.fillRect(37,2,2,2),i.fillRect(39,0,2,2),i.fillRect(41,-2,2,2),i.fillRect(55,-4,2,2),i.fillRect(57,-2,2,2),i.fillRect(59,0,2,2)}if(e==="broken"){let r="#500000";wt.currentBat.id==="GOLD"&&(r="#B8860B"),wt.currentBat.id==="BLUE"&&(r="#000000"),i.fillStyle=r;for(let d=25;d<65;d+=3){const f=d%4===0?2:-2;i.fillRect(d,f,2,2)}i.fillRect(30,-6,4,2),i.fillRect(45,6,4,2),i.fillRect(60,-5,2,4)}if(e==="severed"){i.clearRect(15,-it.BAT_WIDTH/2-2,it.BAT_LENGTH+20,it.BAT_WIDTH+4),i.fillStyle=wt.currentBat.color||"#ff0000",i.fillRect(15,-it.BAT_WIDTH/2-2,10,it.BAT_WIDTH+4);const d=45+15;i.fillRect(d,-it.BAT_WIDTH/2-2+-10,25,it.BAT_WIDTH+4)}return ci[t]=a,a}function ol(){let e="normal";l.consecutiveFouls>=4?e="severed":l.consecutiveFouls>=3?e="broken":l.consecutiveFouls>=2&&(e="damaged");const t=il(e);b.save(),b.translate(l.bat.pivotX,l.bat.pivotY),b.rotate(l.bat.angle),b.drawImage(t,-Ha/2,-Ha/2),b.restore()}function nl(){zi.width=Ba,zi.height=Ba;const e=Ba/2,t=Ba/2,a=Cs/2;ze.beginPath(),ze.arc(e,t,a,0,Math.PI*2),ze.fillStyle="#ffffff",ze.fill(),ze.save(),ze.beginPath(),ze.arc(e,t,a,0,Math.PI*2),ze.clip(),ze.strokeStyle="#ff0000",ze.lineWidth=2,ze.beginPath(),ze.arc(e-a*1.2,t,a,-1,1),ze.stroke(),ze.beginPath(),ze.arc(e+a*1.2,t,a,Math.PI-1,Math.PI+1),ze.stroke(),ze.restore(),ze.beginPath(),ze.arc(e,t,a,0,Math.PI*2),ze.strokeStyle="#000000",ze.lineWidth=1,ze.stroke()}nl();function sl(e,t=1){if(e.invisible)return;let a=e.x,i=e.y,o=e.rotationAngle;typeof e.prevX<"u"&&typeof e.prevY<"u"&&(a=e.prevX+(e.x-e.prevX)*t,i=e.prevY+(e.y-e.prevY)*t),typeof e.prevRotationAngle<"u"&&(o=e.prevRotationAngle+(e.rotationAngle-e.prevRotationAngle)*t);const n=a+e.size/2,s=i+e.size/2;e.invisible||(b.fillStyle="rgba(0, 0, 0, 0.5)",b.beginPath(),b.ellipse(n,s+e.size*1.2,e.size*.7,e.size*.25,0,0,Math.PI*2),b.fill()),b.save(),b.translate(n,s),b.rotate(o),b.drawImage(zi,-Ba/2,-Ba/2),b.restore()}function ll(){const e=Q/2+120,a=(l.bat?l.bat.pivotY:Ee*.85)+60,i=80,o=40;b.fillStyle="#d2b48c",b.beginPath(),b.roundRect(e,a,i,o,5),b.fill(),b.strokeStyle="#5a3a22",b.lineWidth=2,b.stroke();const n=8,s=24,r=e+16,d=a+o/2;for(let f=0;f<3;f++){const c=r+f*s;b.beginPath(),b.arc(c,d,n,0,Math.PI*2),f<V.strikes?(b.fillStyle="#ff0000",b.fill(),b.beginPath(),b.arc(c-2,d-2,2,0,Math.PI*2),b.fillStyle="#ffffff",b.fill()):(b.strokeStyle="#000000",b.lineWidth=2,b.stroke()),b.beginPath(),b.arc(c,d,n,0,Math.PI*2),b.strokeStyle="#000000",b.lineWidth=2,b.stroke()}}let fa=null;const xa=60,rl=30;function Yn(){if(!l.showTutorial){ct&&ct.style.display!=="none"&&(ct.style.display="none");return}ct&&ct.style.display!=="flex"&&(ct.style.display="flex");const e=Q,t=Ee,a=l.pitcher.x+l.pitcher.width/2,i=l.pitcher.y+l.pitcher.height/2+12;if(b.save(),b.fillStyle="rgba(0, 0, 0, 0.6)",b.beginPath(),b.rect(0,0,e,t),b.arc(a,i,xa,0,Math.PI*2,!0),b.fill(),!fa){const f=(xa+rl)*2;fa=document.createElement("canvas"),fa.width=f,fa.height=f;const c=fa.getContext("2d"),u=f/2,h=f/2;c.shadowColor="#FFD700",c.shadowBlur=20,c.strokeStyle="#FFD700",c.lineWidth=4,c.beginPath(),c.arc(u,h,xa,0,Math.PI*2),c.stroke()}const o=fa.width;b.drawImage(fa,a-o/2,i-o/2),b.shadowBlur=0;const n=i+xa+40,s=e/2;b.font='16px "PressStart2PLocal"',b.textAlign="center",b.textBaseline="top",b.strokeStyle="#000000",b.lineWidth=4,b.strokeText("WATCH PITCHER'S COLOR!",s,n),b.fillStyle="#FFFFFF",b.fillText("WATCH PITCHER'S COLOR!",s,n);const r=i+xa+10,d=a;b.fillStyle="#FFD700",b.beginPath(),b.moveTo(d,r),b.lineTo(d-10,r+15),b.lineTo(d+10,r+15),b.fill(),b.strokeStyle="#000000",b.lineWidth=2,b.beginPath(),b.moveTo(d,r),b.lineTo(d-10,r+15),b.lineTo(d+10,r+15),b.closePath(),b.stroke(),b.restore()}let ba=null,ni=null;const Ne=1024;let ha=null,La=null,wi=null,Jt={w:0,h:0,isNight:null,r:0};function yn(e,t,a,i){ba||cl();const o=Math.min(t,a)*.9,n=t/2,s=a+o*.6;if(Jt.w!==t||Jt.h!==a||Jt.isNight!==i||Jt.r!==o){if(ha=e.createRadialGradient(n,s-o*.6,o*.2,n,s,o),i?(ha.addColorStop(0,"#102030"),ha.addColorStop(1,"#050a10")):(ha.addColorStop(0,"#1565c0"),ha.addColorStop(.6,"#0d47a1"),ha.addColorStop(1,"#002171")),i)La=null;else{const m=n-o*.3,p=s-o*.6;La=e.createRadialGradient(m,p,0,m,p,o*.6),La.addColorStop(0,"rgba(255, 255, 255, 0.2)"),La.addColorStop(1,"rgba(255, 255, 255, 0)")}wi=e.createLinearGradient(0,a+50,0,a-o*1.2),wi.addColorStop(0,"rgba(0,0,0,0.9)"),wi.addColorStop(1,"rgba(0,0,0,0)"),Jt={w:t,h:a,isNight:i,cx:n,cy:s,r:o}}const d=o*2.5,f=Date.now()*.015%d,c=Date.now()*.02%d;if(!Jt.persistentGlowCache){const p=document.createElement("canvas");p.width=2e3,p.height=2e3;const T=p.getContext("2d"),v=2e3/2,y=2e3/2,S=T.createRadialGradient(v,v,y*.4,v,v,y);i?(S.addColorStop(0,"rgba(255, 30, 0, 0.6)"),S.addColorStop(1,"rgba(100, 0, 0, 0)")):(S.addColorStop(0,"rgba(100, 149, 237, 0.4)"),S.addColorStop(1,"rgba(0, 50, 255, 0)")),T.fillStyle=S,T.beginPath(),T.arc(v,v,y,0,Math.PI*2),T.fill(),Jt.persistentGlowCache=p}const u=Math.sin(Date.now()/2500)*.05+.95;e.save(),e.translate(n,s);const h=o*2.2*u;e.drawImage(Jt.persistentGlowCache,-h/2,-h/2,h,h),e.restore(),e.save(),e.beginPath(),e.arc(n,s,o,0,Math.PI*2),e.clip(),e.fillStyle=ha,e.fill();const g=(m,p,T,v=1)=>{if(!m)return;e.globalAlpha=v,e.save(),e.translate(n,s);const y=-T/2-p;y<o&&y+T>-o&&e.drawImage(m,y,-T/2,T,T);const S=-T/2-p+T;S<o&&S+T>-o&&e.drawImage(m,S,-T/2,T,T),e.restore(),e.globalAlpha=1};if(i?(e.globalCompositeOperation="source-over",g(ba,f,d,.3)):(e.globalCompositeOperation="source-over",g(ba,f,d,1)),!i&&La){const m=n-o*.3,p=s-o*.6;e.fillStyle=La,e.beginPath(),e.arc(m,p,o*.7,0,Math.PI*2),e.fill()}g(ni,c,d,i?.1:.6),e.fillStyle=wi,e.fillRect(0,0,t,a),e.restore()}function cl(){ba=document.createElement("canvas"),ba.width=Ne,ba.height=Ne;const e=ba.getContext("2d");e.clearRect(0,0,Ne,Ne);const t=7;for(let o=0;o<t;o++){let n=Math.random()*Ne,s=Math.random()*(Ne*.6)+Ne*.2;const d=Math.random()>.3?"#2e7d32":"#8d6e63";e.fillStyle=d;let f=3e3,c=n,u=s;for(let h=0;h<f;h++){let g=2+Math.random()*4;e.beginPath(),e.arc(c,u,g,0,Math.PI*2),e.fill(),c<50&&(e.beginPath(),e.arc(c+Ne,u,g,0,Math.PI*2),e.fill()),c>Ne-50&&(e.beginPath(),e.arc(c-Ne,u,g,0,Math.PI*2),e.fill()),c+=(Math.random()-.5)*8,u+=(Math.random()-.5)*8,Math.random()>.99&&(c+=(Math.random()-.5)*50,u+=(Math.random()-.5)*50),Math.hypot(c-n,u-s)>150&&(c=n+(Math.random()-.5)*50,u=s+(Math.random()-.5)*50),u=Math.max(50,Math.min(Ne-50,u))}}ni=document.createElement("canvas"),ni.width=Ne,ni.height=Ne;const a=ni.getContext("2d");a.clearRect(0,0,Ne,Ne),a.fillStyle="#ffffff";const i=20;for(let o=0;o<i;o++){let n=Math.random()*Ne,s=Math.random()*Ne,r=Math.random()*50+50;for(let d=0;d<r;d++){let f=5+Math.random()*15;a.globalAlpha=.1+Math.random()*.2,a.beginPath(),a.arc(n,s,f,0,Math.PI*2),a.fill(),n<50&&(a.beginPath(),a.arc(n+Ne,s,f,0,Math.PI*2),a.fill()),n>Ne-50&&(a.beginPath(),a.arc(n-Ne,s,f,0,Math.PI*2),a.fill()),n+=(Math.random()-.5)*60,s+=(Math.random()-.5)*20,s=Math.max(0,Math.min(Ne,s))}}}const $i=[],ei=[],bo=10,dl=8,oo=[];for(let e=0;e<bo;e++)$i.push({active:!1,type:"FIGHTER",x:0,y:0,vx:0,size:0,color:"#fff",blinkOffset:0});for(let e=0;e<4;e++)Nn(e);function Nn(e){if(oo[e])return oo[e];const t=60,a=document.createElement("canvas");a.width=t,a.height=t;const i=a.getContext("2d"),o=[],n=8;for(let s=0;s<n;s++){const r=s/n*Math.PI*2,d=t*.4+(Math.random()-.5)*(t*.2);o.push({x:t/2+Math.cos(r)*d,y:t/2+Math.sin(r)*d})}return i.fillStyle="#4a4a4a",i.strokeStyle="#2a2a2a",i.lineWidth=2,i.beginPath(),o.forEach((s,r)=>{r===0?i.moveTo(s.x,s.y):i.lineTo(s.x,s.y)}),i.closePath(),i.fill(),i.stroke(),i.fillStyle="#3a3a3a",i.beginPath(),i.arc(t*.4,t*.4,t*.1,0,Math.PI*2),i.fill(),oo[e]=a,a}function Sn(e,t,a){ei.length<dl&&Math.random()>.95&&ei.push({x:Math.random()>.5?-100:t+100,y:Math.random()*a,vx:(Math.random()-.5)*.5,vy:(Math.random()-.5)*.5,size:30+Math.random()*30,rotation:Math.random()*Math.PI,rotSpeed:(Math.random()-.5)*.02,variant:Math.floor(Math.random()*4)}),e.save();for(let i=ei.length-1;i>=0;i--){let o=ei[i];if(o.x+=o.vx,o.y+=o.vy,o.rotation+=o.rotSpeed,o.x<-200||o.x>t+200||o.y<-200||o.y>a+200){ei.splice(i,1);continue}const n=Nn(o.variant);e.save(),e.translate(o.x,o.y),e.rotate(o.rotation),e.drawImage(n,-o.size/2,-o.size/2,o.size,o.size),e.restore()}e.restore()}function fl(e,t,a){const i=$i.find(r=>!r.active);if(!i)return;const o=Math.random()>.6,n=Math.random()>.5?1:-1;let s=o?t*.1+Math.random()*t*.4:t*.6+Math.random()*t*.3;i.active=!0,i.type=o?"FIGHTER":"CARGO",i.x=n===1?-150:e+150,i.y=s,i.vx=n*(o?3+Math.random()*2:.5+Math.random()),i.size=o?10+Math.random()*5:40+Math.random()*30,i.color=a?"#ff4d4d":Math.random()>.5?"#00e5ff":"#ffffff",i.blinkOffset=Math.random()*1e3}function no(e,t,a,i){const o=Date.now();$i.filter(s=>s.active).length<bo&&Math.random()>.92&&fl(t,a,i);for(let s=0;s<bo;s++){const r=$i[s];if(!r.active)continue;r.x+=r.vx;const d=Math.max(t+200,3e3);if(r.x<-d||r.x>d){r.active=!1;continue}e.save(),e.translate(r.x,r.y),r.vx<0&&e.scale(-1,1),r.type==="CARGO"?(e.fillStyle=i?"#0a0505":"#080810",e.fillRect(-r.size/2,-r.size/4,r.size,r.size/2),e.fillStyle=i?"#050202":"#05050a",e.fillRect(-r.size*1.5,-r.size/3,r.size,r.size*.6),Math.floor((o+r.blinkOffset)/1e3)%2===0&&(e.fillStyle="#aa0000",e.fillRect(r.size*.4,-r.size*.2,2,2))):(e.fillStyle=r.color,e.beginPath(),e.moveTo(r.size,0),e.lineTo(-r.size/2,-r.size/2),e.lineTo(-r.size/2,r.size/2),e.closePath(),e.fill(),e.strokeStyle=r.color,e.globalAlpha=.6,e.lineWidth=2,e.beginPath(),e.moveTo(-r.size/2,0),e.lineTo(-r.size*3,0),e.stroke(),e.globalAlpha=1,e.fillStyle="#fff",e.beginPath(),e.arc(0,0,2,0,Math.PI*2),e.fill()),e.restore()}}const Ue={x:-300,y:100,active:!1,hoverTimer:0};let Et=null,Tn=null,bn=null;function hl(e){const t=e?"night":"day";if(Et&&bn===t)return Et;Et||(Et=document.createElement("canvas"),Et.width=600,Et.height=400,Tn=Et.getContext("2d"));const a=Tn,i=Et.width,o=Et.height;a.clearRect(0,0,i,o),a.save(),a.translate(i/2,o/2),bn=t;const n=f=>{a.save(),a.scale(f,1),a.strokeStyle=e?"#444":"#666",a.lineWidth=4,a.beginPath(),a.moveTo(35,0),a.lineTo(80,0),a.stroke(),a.strokeStyle="#444",a.lineWidth=1,a.beginPath(),a.moveTo(40,-5),a.lineTo(75,5),a.moveTo(40,5),a.lineTo(75,-5),a.stroke();const c=e?"#001a4d":"#1a4d80",u=e?"#003366":"#2980b9",h="rgba(255, 255, 255, 0.2)";a.translate(80,0);for(let g=0;g<3;g++){const m=g*42,p=-35,T=40,v=70;a.fillStyle=c,a.fillRect(m,p,T,v),a.fillStyle=u;for(let y=0;y<4;y++)for(let S=0;S<2;S++)a.fillRect(m+2+S*19,p+2+y*17,17,15);a.fillStyle=h,a.beginPath(),a.moveTo(m,p),a.lineTo(m+T,p),a.lineTo(m,p+v/2),a.fill(),a.strokeStyle="#555",a.lineWidth=2,a.strokeRect(m,p,T,v)}a.restore()};n(1),n(-1);const s=60,r=70,d=a.createLinearGradient(0,-r/2,0,r/2);return e?(d.addColorStop(0,"#555"),d.addColorStop(.2,"#333"),d.addColorStop(.5,"#222"),d.addColorStop(.8,"#333"),d.addColorStop(1,"#555")):(d.addColorStop(0,"#bdc3c7"),d.addColorStop(.2,"#95a5a6"),d.addColorStop(.5,"#7f8c8d"),d.addColorStop(.8,"#95a5a6"),d.addColorStop(1,"#bdc3c7")),a.fillStyle=d,a.fillRect(-s/2,-r/2,s,r),a.fillStyle="rgba(0,0,0,0.3)",a.fillRect(-s/2,-r/2+20,s,2),a.fillRect(-s/2,-r/2+50,s,2),a.fillRect(-s/4,-r/2,2,20),a.fillRect(s/4,50-r/2,2,20),a.strokeStyle="#2c3e50",a.lineWidth=2,a.strokeRect(-s/2,-r/2,s,r),a.fillStyle="#444",a.fillRect(-15,-15,30,30),a.strokeStyle="#888",a.strokeRect(-15,-15,30,30),a.fillStyle="#222",a.beginPath(),a.arc(0,0,4,0,Math.PI*2),a.fill(),a.save(),a.translate(0,35),a.fillStyle="#333",a.fillRect(-15,0,30,10),a.restore(),a.restore(),Et}function vn(e,t,a,i,o=!1){if(o){Ue.active||(Ue.active=!0,Ue.x=t*.5,Ue.y=a*.45);const y=t*.5,S=a*.45;Ue.hoverTimer+=.02;const _=Math.sin(Ue.hoverTimer)*10,A=Math.cos(Ue.hoverTimer*.7)*5;Ue.x+=(y+A-Ue.x)*.1,Ue.y+=(S+_-Ue.y)*.1}else{Ue.active||(Ue.active=!0,Ue.x=-200,Ue.y=a*.5);const y=t*.5,S=a*.5;Ue.x+=(y-Ue.x)*.04,Ue.y+=(S-Ue.y)*.04,Math.abs(Ue.x-y)<10&&(Ue.hoverTimer+=.02,Ue.y+=Math.sin(Ue.hoverTimer)*.5)}const n=Ue.x,s=Ue.y,r=1.2,d=Date.now();e.save(),e.translate(n,s),e.scale(r,r),e.save(),e.translate(0,-35);const f=Math.sin(d/2e3)*.5;e.rotate(f),e.fillStyle=i?"#333":"#444",e.fillRect(-3,0,6,15),e.beginPath(),e.arc(0,-10,18,0,Math.PI,!0),e.fillStyle=i?"#888":"#ccc",e.fill(),e.strokeStyle=i?"#666":"#999",e.lineWidth=2,e.stroke(),e.beginPath(),e.moveTo(0,-10),e.lineTo(0,-35),e.strokeStyle="#fff",e.stroke(),e.fillStyle="red",e.beginPath(),e.arc(0,-35,2,0,Math.PI*2),e.fill(),e.restore();const c=hl(i);e.drawImage(c,-c.width/2,-c.height/2);const u=206;Math.floor(d/500)%2===0&&(e.fillStyle="rgba(0, 255, 0, 0.4)",e.beginPath(),e.arc(u,0,8,0,Math.PI*2),e.fill(),e.fillStyle="#00ff00",e.beginPath(),e.arc(u,0,4,0,Math.PI*2),e.fill(),e.fillStyle="rgba(255, 0, 0, 0.4)",e.beginPath(),e.arc(-u,0,8,0,Math.PI*2),e.fill(),e.fillStyle="#ff0000",e.beginPath(),e.arc(-u,0,4,0,Math.PI*2),e.fill()),e.translate(0,35);const h=90,g=220,m=e.createLinearGradient(0,10,0,10+h);i?(m.addColorStop(0,"rgba(255, 0, 0, 0.6)"),m.addColorStop(.2,"rgba(255, 0, 0, 0.1)"),m.addColorStop(1,"rgba(255, 0, 0, 0)")):(m.addColorStop(0,"rgba(0, 229, 255, 0.6)"),m.addColorStop(.2,"rgba(0, 229, 255, 0.1)"),m.addColorStop(1,"rgba(0, 229, 255, 0)")),e.fillStyle=m,e.beginPath(),e.moveTo(-15,10),e.lineTo(15,10),e.lineTo(g/2,10+h),e.lineTo(-g/2,10+h),e.closePath(),e.fill(),e.strokeStyle=i?"rgba(255, 0, 0, 0.1)":"rgba(0, 229, 255, 0.1)",e.lineWidth=1;for(let y=0;y<5;y++){const S=20+y*15;e.beginPath(),e.moveTo(-g/4,S),e.lineTo(g/4,S),e.stroke()}const p=10+h-30;e.fillStyle="#ffffff",e.font='14px "PressStart2PLocal"',e.textAlign="center";const T=l.isDailyChallenge?"DAILY":"HIGH SCORE";e.fillText(T,0,p-20);let v=l.highScore||0;if(l.isDailyChallenge){const y=new Date,S=y.getUTCFullYear(),_=String(y.getUTCMonth()+1).padStart(2,"0"),A=String(y.getUTCDate()).padStart(2,"0"),E=`${S}-${_}-${A}`;v=parseInt(Y.getItem(`baseball_daily_score_${E}`,"0"))||0}e.font='24px "PressStart2PLocal"',e.fillStyle=l.isDailyChallenge?"#f1c40f":"#ffffff",e.fillText(v.toString(),0,p+15),e.restore()}let Mt=null;const at={w:0,h:0,vignette:null,glass:null,upperBeam:null,lowerBeam:null,core:null};function qn(e,t,a,i=!1){const o=e.createLinearGradient(0,0,0,a);i?(o.addColorStop(0,"#1a0000"),o.addColorStop(.5,"#000000"),o.addColorStop(1,"#220000")):(o.addColorStop(0,"#050520"),o.addColorStop(.5,"#1a0b2e"),o.addColorStop(1,"#000005")),e.fillStyle=o,e.fillRect(0,0,t,a),e.save();const n=(s,r,d,f)=>{const c=e.createRadialGradient(s,r,0,s,r,d);c.addColorStop(0,f),c.addColorStop(1,"rgba(0,0,0,0)"),e.fillStyle=c,e.beginPath(),e.arc(s,r,d,0,Math.PI*2),e.fill()};n(t*.2,a*.15,t*.25,"rgba(128, 0, 128, 0.2)"),n(t*.7,a*.2,t*.3,"rgba(255, 105, 180, 0.15)"),e.restore()}const qi=(e,t)=>{const a=t||e*.28,i=140,o=a-i/2,n=a+i/2,s=64,r=o,d=r-s,f=d+2,c=n,u=25,h=c+u;return{floorTop:o,floorBottom:n,floorH:i,consoleTop:d,consoleBottom:r,consoleH:s,winBottom:f,cautionTop:c,cautionBottom:h,cautionH:u}},Ua=(e,t,a,i,o)=>{e.save(),e.globalCompositeOperation="screen";let n=o;const s=()=>(n=(n*9301+49297)%233280,n/233280);((f,c,u,h)=>{const g=e.createRadialGradient(f,c,0,f,c,u);g.addColorStop(0,h),g.addColorStop(1,"rgba(0,0,0,0)"),e.fillStyle=g,e.beginPath(),e.arc(f,c,u,0,Math.PI*2),e.fill()})(t,a,i,"rgba(40, 0, 80, 0.4)");const d=150;for(let f=0;f<d;f++){const c=s()*Math.PI*2,u=s()*i*.8,h=t+Math.cos(c)*u,g=a+Math.sin(c)*u,m=i*.1+s()*i*.15;let p;const T=s();T<.4?p=`rgba(255, 64, 129, ${.1+s()*.1})`:T<.8?p=`rgba(48, 79, 254, ${.1+s()*.1})`:p=`rgba(0, 229, 255, ${.05+s()*.05})`;const v=e.createRadialGradient(h,g,0,h,g,m);v.addColorStop(0,p),v.addColorStop(1,"rgba(0,0,0,0)"),e.fillStyle=v,e.beginPath(),e.arc(h,g,m,0,Math.PI*2),e.fill()}e.restore()};function ul(e,t,a,i){e.save();const n=qi(a,i).winBottom,s=n;e.beginPath(),e.rect(0,0,t,n),e.clip();const r=0,d=t*.32,f=t*.68,c=t-f;Ua(e,t*.2,s*.5,t*.3,101),Ua(e,t*.8,s*.4,t*.3,202);const u=(g,m,p,T,v)=>{e.save();const y=p*1.15,S=e.createRadialGradient(g,m,p,g,m,y);if(S.addColorStop(0,"rgba(255,255,255,0.3)"),S.addColorStop(1,"rgba(255,255,255,0)"),e.fillStyle=S,e.beginPath(),e.arc(g,m,y,0,Math.PI*2),e.fill(),e.beginPath(),e.arc(g,m,p,0,Math.PI*2),e.fillStyle=T,e.fill(),e.save(),e.clip(),v==="moon"){e.fillStyle="rgba(0,0,0,0.15)";const A=(E,P,M)=>{e.beginPath(),e.ellipse(E,P,M,M*.7,Math.random(),0,Math.PI*2),e.fill()};A(g-p*.3,m-p*.2,p*.25),A(g+p*.4,m+p*.3,p*.2),A(g+p*.1,m+p*.5,p*.15),A(g-p*.2,m+p*.6,p*.1)}else v==="earth"?(e.fillStyle="#27ae60",e.beginPath(),e.moveTo(g-p*.7,m-p*.3),e.lineTo(g-p*.4,m-p*.5),e.lineTo(g-p*.2,m-p*.1),e.lineTo(g-p*.5,m+p*.4),e.lineTo(g-p*.8,m+p*.1),e.fill(),e.beginPath(),e.moveTo(g+p*.3,m-p*.6),e.lineTo(g+p*.6,m-p*.4),e.lineTo(g+p*.5,m+p*.2),e.lineTo(g+p*.2,m+p*.5),e.lineTo(g+p*.1,m-p*.1),e.fill(),e.beginPath(),e.arc(g,m+p*.6,p*.15,0,Math.PI*2),e.fill(),e.fillStyle="#ffffff",e.beginPath(),e.arc(g,m-p*.95,p*.2,0,Math.PI*2),e.fill(),e.fillStyle="rgba(255, 255, 255, 0.3)",e.fillRect(g-p*.8,m,p*1.6,p*.05),e.fillRect(g-p*.6,m-p*.4,p*1.2,p*.04),e.fillStyle="rgba(255, 255, 255, 0.2)",e.beginPath(),e.arc(g+p*.3,m-p*.3,p*.1,0,Math.PI*2),e.fill()):v==="orange"&&(e.fillStyle="rgba(255, 255, 255, 0.15)",e.beginPath(),e.rect(g-p,m-p*.3,p*2,p*.15),e.fill(),e.beginPath(),e.rect(g-p,m+p*.1,p*2,p*.1),e.fill(),e.beginPath(),e.rect(g-p,m+p*.5,p*2,p*.05),e.fill());e.restore();const _=e.createRadialGradient(g-p*.3,m-p*.3,p*.5,g,m,p);_.addColorStop(0,"rgba(0,0,0,0)"),_.addColorStop(1,"rgba(0,0,0,0.7)"),e.fillStyle=_,e.beginPath(),e.arc(g,m,p,0,Math.PI*2),e.fill(),e.fillStyle="rgba(10, 20, 40, 0.4)",e.fill(),e.restore()},h=Math.min(d,s)*.35;u(r+d*.3,s*.4,h,"#bdc3c7","moon"),u(r+d*.7,s*.7,h*1.2,"#8d6e63","mars"),u(f+c*.3,s*.6,h*1.3,"#3498db","earth"),u(f+c*.8,s*.3,h*1.1,"#d35400","orange"),e.restore()}function Xn(e,t,a,i){e.save();const s=qi(a,i).winBottom,r=0,d=t*.32,f=t*.32,c=t*.68-f,u=t*.68,h=t-u,g=(v,y,S,_)=>{const A=e.createLinearGradient(v,y,v,y+_);A.addColorStop(0,"rgba(135, 206, 235, 0.2)"),A.addColorStop(1,"rgba(135, 206, 235, 0.05)"),e.fillStyle=A,e.fillRect(v,y,S,_)};g(r,0,d,s),g(f,0,c,s),g(u,0,h,s);const m=(v,y,S,_,A=!1)=>{const E=e.createLinearGradient(v,y,A?v+S:v,A?y:y+_);E.addColorStop(0,"#2c3e50"),E.addColorStop(.3,"#78909c"),E.addColorStop(.7,"#455a64"),E.addColorStop(1,"#2c3e50"),e.fillStyle=E,e.fillRect(v,y,S,_),e.fillStyle="rgba(0,0,0,0.5)",A?e.fillRect(v+S*.3,y,S*.4,_):e.fillRect(v,y+_*.3,S,_*.4),e.fillStyle="#111";const P=1.5;if(A)for(let M=10;M<_;M+=20)e.beginPath(),e.arc(v+S/2,y+M,P,0,Math.PI*2),e.fill();else for(let M=10;M<S;M+=40)e.beginPath(),e.arc(v+M,y+_/2,P,0,Math.PI*2),e.fill();e.fillStyle="rgba(255,255,255,0.15)",A?e.fillRect(v,y,1,_):e.fillRect(v,y,S,1)},p=16;m(f-p/2,0,p,s,!0),m(u-p/2,0,p,s,!0);const T=12;m(0,s-T,t,T,!1),m(0,0,t,12,!1),e.restore()}function Cn(e,t,a){const i=(n,s,r,d,f)=>{e.save();const c=r*1.15,u=e.createRadialGradient(n,s,r,n,s,c);if(u.addColorStop(0,"rgba(255,255,255,0.3)"),u.addColorStop(1,"rgba(255,255,255,0)"),e.fillStyle=u,e.beginPath(),e.arc(n,s,c,0,Math.PI*2),e.fill(),e.beginPath(),e.arc(n,s,r,0,Math.PI*2),e.fillStyle=d,e.fill(),e.save(),e.clip(),f==="moon"||f==="rocky"){e.fillStyle="rgba(0,0,0,0.15)";const g=(m,p,T)=>{e.beginPath(),e.ellipse(m,p,T,T*.7,Math.random(),0,Math.PI*2),e.fill()};g(n-r*.3,s-r*.2,r*.25),g(n+r*.4,s+r*.3,r*.2),g(n+r*.1,s+r*.5,r*.15),g(n-r*.2,s+r*.6,r*.1)}else f==="earth"?(e.fillStyle="#27ae60",e.beginPath(),e.moveTo(n-r*.7,s-r*.3),e.lineTo(n-r*.4,s-r*.5),e.lineTo(n-r*.2,s-r*.1),e.lineTo(n-r*.5,s+r*.4),e.lineTo(n-r*.8,s+r*.1),e.fill(),e.beginPath(),e.moveTo(n+r*.3,s-r*.6),e.lineTo(n+r*.6,s-r*.4),e.lineTo(n+r*.5,s+r*.2),e.lineTo(n+r*.2,s+r*.5),e.lineTo(n+r*.1,s-r*.1),e.fill(),e.fillStyle="rgba(255, 255, 255, 0.2)",e.beginPath(),e.arc(n+r*.3,s-r*.3,r*.1,0,Math.PI*2),e.fill()):f==="gas"&&(e.fillStyle="rgba(255, 255, 255, 0.15)",e.beginPath(),e.rect(n-r,s-r*.3,r*2,r*.15),e.fill(),e.beginPath(),e.rect(n-r,s+r*.1,r*2,r*.1),e.fill(),e.beginPath(),e.rect(n-r,s+r*.5,r*2,r*.05),e.fill());e.restore();const h=e.createRadialGradient(n-r*.3,s-r*.3,r*.1,n,s,r);h.addColorStop(0,"rgba(0,0,0,0)"),h.addColorStop(.5,"rgba(0,0,0,0.1)"),h.addColorStop(1,"rgba(0,0,0,0.8)"),e.fillStyle=h,e.beginPath(),e.arc(n,s,r,0,Math.PI*2),e.fill(),e.fillStyle="rgba(10, 20, 40, 0.4)",e.beginPath(),e.arc(n,s,r,0,Math.PI*2),e.fill(),e.restore()},o=Math.min(t,a);i(t*.15,a*.5,o*.11,"#c0392b","rocky"),i(t*.28,a*.38,o*.05,"#4fc3f7","rocky"),i(t*.85,a*.45,o*.12,"#8e44ad","rocky"),i(t*.72,a*.65,o*.07,"#f39c12","gas")}let _t=[],Gi=null;function Zn(){if(_t.length===0)return;const e=_t.shift();if(e)try{e()}catch(t){console.error("[SpaceRenderer] Warmup Task Failed:",t)}_t.length>0&&(Gi=setTimeout(Zn,16))}function Kn(e,t){if(Mt&&Mt.width===e&&Mt.height===t)return;console.log(`[SpaceRenderer] Starting Async Warmup: ${e}x${t}`),Gi&&clearTimeout(Gi),_t=[],Mt||(Mt=document.createElement("canvas")),Mt.width=e,Mt.height=t;const a=Mt.getContext("2d"),i=a.createLinearGradient(0,0,0,t);i.addColorStop(0,"#050520"),i.addColorStop(.5,"#1a0b2e"),i.addColorStop(1,"#000005"),a.fillStyle=i,a.fillRect(0,0,e,t);const o=Math.min(e,t)*.6;Cn(a,e,t),_t.push(()=>Ua(a,e*.1,t*.5,o,111)),_t.push(()=>Ua(a,e*.9,t*.55,o,444)),_t.push(()=>Ua(a,e*.2,t*.4,o*.8,222)),_t.push(()=>Ua(a,e*.8,t*.45,o*.8,333)),_t.push(()=>Cn(a,e,t)),_t.push(()=>{const n=s=>Jn(s,5,10);n("#ff0000"),n("#ffff00"),n("#00ff00"),n("#ffa500"),n("#ff8c00"),console.log("[SpaceRenderer] Surge Sprites Warmed Up")}),Gi=setTimeout(Zn,0)}function jn(e,t,a,i,o,n,s=!1,r=!0){e.save();const d=qi(a,n);Kn(t,a),Mt&&e.drawImage(Mt,0,0),s&&l.isGameOver&&(e.fillStyle="rgba(20, 0, 0, 0.6)",e.fillRect(0,0,t,a));const f=20,c="#2c3e50",u=i||t/2,h=o||a*.85,g=(H,se,ke,Le)=>{e.save();const xe=Math.atan2(Le-se,ke-H),tt=Math.hypot(ke-H,Le-se);e.translate(H,se),e.rotate(xe);const gt=e.createLinearGradient(0,-f/2,0,f/2);gt.addColorStop(0,"#2c3e50"),gt.addColorStop(.5,"#546e7a"),gt.addColorStop(1,"#2c3e50"),e.fillStyle=gt,e.fillRect(0,-f/2,tt,f),e.strokeStyle=c,e.lineWidth=2,e.strokeRect(0,-f/2,tt,f),e.fillStyle="#2c3e50";for(let At=30;At<tt;At+=50)e.beginPath(),e.arc(At,0,4,0,Math.PI*2),e.fill(),e.fillStyle="rgba(255,255,255,0.3)",e.beginPath(),e.arc(At-1,-1,2,0,Math.PI*2),e.fill(),e.fillStyle="#2c3e50";e.restore()};g(u,h,0,h-u*1.5),g(u,h,t,h-(t-u)*1.5),g(u,h,t*.2,a),g(u,h,t*.8,a);const m=d.floorH,p=d.floorTop,T=d.floorBottom,v=d.consoleH,y=d.consoleBottom,S=d.consoleTop,_=e.createLinearGradient(0,S,0,y);_.addColorStop(0,"#2c3e50"),_.addColorStop(.5,"#546e7a"),_.addColorStop(1,"#2c3e50"),e.fillStyle=_,e.fillRect(0,S,t,v),e.strokeStyle="#1c2833",e.lineWidth=2,e.strokeRect(0,S,t,v);const A=(H,se,ke)=>{e.beginPath(),e.arc(H,se,7,0,Math.PI*2),e.fillStyle="#111",e.fill(),e.strokeStyle="#333",e.lineWidth=1,e.stroke(),e.beginPath(),e.arc(H,se,5,0,Math.PI*2);const Le=e.createRadialGradient(H-2,se-2,1,H,se,6);Le.addColorStop(0,"#444"),Le.addColorStop(.5,"#222"),Le.addColorStop(1,"#000"),e.fillStyle=Le,e.fill(),e.strokeStyle=ke,e.globalAlpha=.5,e.lineWidth=1,e.stroke(),e.globalAlpha=1,e.fillStyle="rgba(255, 255, 255, 0.3)",e.beginPath(),e.arc(H-2,se-2,1.5,0,Math.PI*2),e.fill()};A(t*.15,S+v*.3,"#500"),A(t*.18,S+v*.3,"#550"),A(t*.21,S+v*.3,"#050"),A(t*.85,S+v*.5,"#500"),A(t*.82,S+v*.5,"#530");const E=t*.35,P=S+5,M=t*.3,I=v-10;e.fillStyle="#111",e.fillRect(E-4,P-4,M+8,I+8),e.save();const L=e.createLinearGradient(0,p,0,T);L.addColorStop(0,"rgba(200, 200, 200, 0.05)"),L.addColorStop(.5,"rgba(255, 255, 255, 0.02)"),L.addColorStop(1,"rgba(200, 200, 200, 0.05)"),e.fillStyle=L,e.fillRect(0,p,t,m),e.strokeStyle="rgba(0, 255, 255, 0.15)",e.lineWidth=1,e.beginPath();for(let H=0;H<=t;H+=40)e.moveTo(H,p),e.lineTo(H,T);for(let H=p;H<=T;H+=10)e.moveTo(0,H),e.lineTo(t,H);e.stroke();const w=i||t*.5,U=n||p+m*.5,k=m*.35,B=(window.spaceRendererTime||Date.now())/500,q=.5+Math.sin(B)*.2,be=e.createRadialGradient(w,U,0,w,U,k*.6);be.addColorStop(0,`rgba(255, 165, 0, ${q*.3})`),be.addColorStop(1,"rgba(0, 0, 0, 0)"),e.fillStyle=be,e.beginPath(),e.arc(w,U,k*.6,0,Math.PI*2),e.fill(),e.fillStyle="rgba(0, 0, 0, 0.3)",e.beginPath(),e.arc(w,U,k*.6,0,Math.PI*2),e.fill(),e.strokeStyle="#1c2833",e.lineWidth=2,e.beginPath();for(let H=-k*.6;H<k*.6;H+=8){const se=Math.sqrt(Math.pow(k*.6,2)-Math.pow(H,2));e.moveTo(w-se,U+H),e.lineTo(w+se,U+H)}e.stroke(),e.strokeStyle="#7f8c8d",e.lineWidth=4,e.beginPath(),e.arc(w,U,k,0,Math.PI*2),e.stroke(),e.strokeStyle="#000",e.lineWidth=1,e.beginPath(),e.arc(w,U,k-2,0,Math.PI*2),e.stroke(),e.restore();const oe=T,j=a-oe-a*.05;e.save(),e.fillStyle="rgba(10, 10, 15, 0.3)",e.fillRect(0,oe,t,j),e.save(),e.beginPath(),e.rect(0,oe,t,j),e.clip(),e.strokeStyle="rgba(0, 255, 255, 0.05)",e.lineWidth=1;const $=20,te=$*1.5,ve=$*Math.sqrt(3);for(let H=oe;H<oe+j+ve;H+=ve)for(let se=0;se<t+te;se+=te*2){const ke=(Le,xe)=>{e.beginPath();for(let tt=0;tt<6;tt++)e.lineTo(Le+$*Math.cos(tt*Math.PI/3),xe+$*Math.sin(tt*Math.PI/3));e.closePath(),e.stroke()};ke(se,H),ke(se+te,H+ve/2)}e.restore(),e.strokeStyle="rgba(0, 255, 255, 0.3)",e.lineWidth=2,e.beginPath(),e.moveTo(0,oe),e.lineTo(t,oe),e.stroke(),e.restore();const ce=T,Z=25,Ce=ce+Z,Re=e.createLinearGradient(0,ce,0,Ce);Re.addColorStop(0,"#2c3e50"),Re.addColorStop(.5,"#546e7a"),Re.addColorStop(1,"#2c3e50"),e.fillStyle=Re,e.fillRect(0,ce,t,Z);const me=60,z=ce+Z/2,N=t*.05;for(let H=20;H<t;H+=me)H<N||H>t-N||(e.beginPath(),e.arc(H,z,6,0,Math.PI*2),e.fillStyle="#111",e.fill(),e.fillStyle="#442200",e.beginPath(),e.arc(H,z,4,0,Math.PI*2),e.fill(),e.fillStyle="rgba(255, 255, 255, 0.4)",e.beginPath(),e.arc(H-1.5,z-1.5,1.5,0,Math.PI*2),e.fill());e.fillStyle="#1c2833",e.fillRect(0,ce,t,2),e.fillRect(0,Ce,t,4);const we=(h-Ce)/1.5,X=u-we,ie=u+we,J=40,ge=12,Oe=(H,se)=>{e.fillStyle="#34495e",e.fillRect(H-J/2,se-ge/2,J,ge),e.strokeStyle="#1c2833",e.lineWidth=2,e.strokeRect(H-J/2,se-ge/2,J,ge),e.fillStyle="#bdc3c7",e.beginPath(),e.arc(H-12,se,3,0,Math.PI*2),e.fill(),e.beginPath(),e.arc(H+12,se,3,0,Math.PI*2),e.fill()};Oe(X,Ce),Oe(ie,Ce);const R=t*.2,C=(t-R)/2,G=Ce+4,O=a*.25,K=6;e.fillStyle="#2c3e50",e.fillRect(C,G,R,K),e.fillRect(C,G+O-K,R,K),e.fillRect(C,G,K,O),e.fillRect(C+R-K,G,K,O),e.fillStyle="rgba(0, 0, 0, 0.4)",e.fillRect(C+K,G+K,R-K*2,O-K*2);const W=.2,ee=e.createLinearGradient(C,G,C+R,G);ee.addColorStop(0,"rgba(0, 255, 255, 0)"),ee.addColorStop(.2,`rgba(0, 255, 255, ${W*.2})`),ee.addColorStop(.5,`rgba(0, 255, 255, ${W})`),ee.addColorStop(.8,`rgba(0, 255, 255, ${W*.2})`),ee.addColorStop(1,"rgba(0, 255, 255, 0)"),e.fillStyle=ee,e.fillRect(C,G,R,O),e.fillStyle=`rgba(0, 255, 255, ${W*.5})`;for(let H=G;H<G+O;H+=4)Math.floor(H/20)%2===0&&e.fillRect(C+R*.4,H,R*.2,1);e.restore();const x=10,fe=R-x*2,he=(O-x*3)/2,le=(H,se,ke,Le)=>{e.strokeStyle="#34495e",e.lineWidth=1,e.strokeRect(H,se,ke,Le),e.fillStyle="#2c3e50";const xe=3,tt=ke/(xe+1);for(let Tt=1;Tt<=xe;Tt++)e.fillRect(H+Tt*tt-1,se,2,Le);const gt=3,At=10;for(let Tt=se+At;Tt<se+Le-At;Tt+=gt+At)e.fillStyle="#546e7a",e.fillRect(H+2,Tt,ke-4,gt),e.fillStyle="rgba(255,255,255,0.1)",e.fillRect(H+2,Tt,ke-4,1),e.fillStyle="rgba(0,0,0,0.3)",e.fillRect(H+2,Tt+gt-1,ke-4,1)};le(C+x,G+x,fe,he),le(C+x,G+x+he+x,fe,he);const Me=(H,se,ke,Le,xe,tt)=>{e.beginPath(),e.moveTo(H,se),e.quadraticCurveTo(H,se+tt,ke,Le),e.strokeStyle=xe,e.lineWidth=3,e.stroke()};Me(C-40,Ce,C,G+50,"#e74c3c",20),Me(C-30,Ce,C,G+60,"#2c3e50",20),Me(C+R+40,Ce,C+R,G+50,"#2ecc71",20),Me(C+R+30,Ce,C+R,G+60,"#2c3e50",20);const pe=i||t/2,ye=o||a*.85,Se=t*.25,Pe=(t-Se)/2,Ye=ye+20,yt=T+25+4,Ot=a*.25,_e=yt+Ot,Qe=Ye-_e;e.save();const dt=12,St=t*.2,Zi=(t-St)/2,qa=(H,se,ke)=>{const Le=e.createLinearGradient(H,se,H+dt,se);Le.addColorStop(0,"#2c3e50"),Le.addColorStop(.5,"#78909c"),Le.addColorStop(1,"#2c3e50"),e.fillStyle=Le,e.fillRect(H,se-50,dt,50),e.fillStyle="#34495e",e.fillRect(H-2,se-10,dt+4,8)};qa(Zi-4,_e),qa(Zi+St-dt+4,_e);const Ae=6;e.fillStyle="#2c3e50",e.fillRect(Pe,_e,Se,Ae),e.fillRect(Pe,_e+Qe-Ae,Se,Ae),e.fillRect(Pe,_e,Ae,Qe),e.fillRect(Pe+Se-Ae,_e,Ae,Qe),e.fillStyle="rgba(0, 0, 0, 0.4)",e.fillRect(Pe+Ae,_e+Ae,Se-Ae*2,Qe-Ae*2);const Gt=.2;e.save(),e.beginPath(),e.rect(Pe+Ae,_e+Ae,Se-Ae*2,Qe-Ae*2),e.clip();const Bt=e.createLinearGradient(Pe,_e,Pe+Se,_e);Bt.addColorStop(0,"rgba(0, 255, 255, 0)"),Bt.addColorStop(.2,`rgba(0, 255, 255, ${Gt*.2})`),Bt.addColorStop(.5,`rgba(0, 255, 255, ${Gt})`),Bt.addColorStop(.8,`rgba(0, 255, 255, ${Gt*.2})`),Bt.addColorStop(1,"rgba(0, 255, 255, 0)"),e.fillStyle=Bt,e.fillRect(Pe,_e,Se,Qe),e.fillStyle=`rgba(0, 255, 255, ${Gt*.5})`;for(let H=_e;H<_e+Qe;H+=4)Math.floor(H/20)%2===0&&e.fillRect(Pe+Se*.4,H,Se*.2,1);e.restore(),e.strokeStyle="#1c2833",e.lineWidth=4,e.strokeRect(Pe,_e,Se,Qe),e.fillStyle="#2c3e50";const Xa=2,pi=Se/(Xa+1);for(let H=1;H<=Xa;H++)e.fillRect(Pe+H*pi-2,_e,4,Qe);const Yt=60,Ea=15,Nt=pe-Yt/2,Ma=ye-10;e.fillStyle="#34495e",e.fillRect(Nt,Ma,Yt,Ea),e.strokeStyle="#1c2833",e.strokeRect(Nt,Ma,Yt,Ea),e.fillStyle="#bdc3c7",e.beginPath(),e.arc(Nt+8,Ma+Ea/2,3,0,Math.PI*2),e.fill(),e.beginPath(),e.arc(Nt+Yt-8,Ma+Ea/2,3,0,Math.PI*2),e.fill(),e.fillStyle="#111",e.beginPath(),e.arc(Pe+10,_e+10,4,0,Math.PI*2),e.fill(),e.beginPath(),e.arc(Pe+Se-10,_e+10,4,0,Math.PI*2),e.fill(),e.beginPath(),e.arc(Pe+10,Ye-10,4,0,Math.PI*2),e.fill(),e.beginPath(),e.arc(Pe+Se-10,Ye-10,4,0,Math.PI*2),e.fill(),e.strokeStyle="#546e7a",e.lineWidth=2;for(let H=_e+30;H<Ye;H+=30){e.beginPath(),e.moveTo(Pe+10,H),e.lineTo(Pe+Se-10,H),e.stroke(),e.fillStyle="#2c3e50";for(let se=Pe+20;se<Pe+Se-20;se+=20)e.beginPath(),e.arc(se,H,2,0,Math.PI*2),e.fill()}e.restore();const ft=Ye,gi=a*.08,Rt=a-gi,Za=Rt,qt=Za-ft,wo=Se,_o=Pe;if(qt>0){const ke=t;e.fillStyle="#1b2631",e.fillRect(0,ft,ke,qt),e.save(),e.beginPath(),e.rect(0,ft,ke,qt),e.clip();const Le=e.createLinearGradient(0,ft,0,Za);Le.addColorStop(0,"#1c2833"),Le.addColorStop(1,"#2c3e50"),e.fillStyle=Le,e.fill(),e.strokeStyle="rgba(255, 255, 255, 0.05)",e.lineWidth=1,e.beginPath();for(let nt=0;nt<0+ke;nt+=t*.1)e.moveTo(nt,ft),e.lineTo(nt,Za);e.stroke(),e.restore();const xe=_o-20,tt=wo+40;e.fillStyle="#34495e",e.fillRect(xe,ft,tt,qt),e.fillStyle="#546e7a",e.fillRect(xe,ft,4,qt),e.fillRect(xe+tt-4,ft,4,qt);const gt=6,At=xe+4,Tt=xe+tt-10,Do=nt=>{e.fillStyle="#37474f",e.fillRect(nt-2,Za-6,gt+4,6);const mi=e.createLinearGradient(nt,ft,nt+gt,ft);mi.addColorStop(0,"rgba(0, 229, 255, 0.2)"),mi.addColorStop(.5,"rgba(224, 255, 255, 0.9)"),mi.addColorStop(1,"rgba(0, 229, 255, 0.2)"),e.fillStyle=mi,e.shadowBlur=15,e.shadowColor="#00e5ff",e.fillRect(nt,ft,gt,qt-6),e.shadowBlur=0};Do(At),Do(Tt),e.restore();const Ki=_o+10,Lo=wo-20;e.fillStyle="#000",e.fillRect(Ki,ft+10,Lo,qt-20),e.strokeStyle="rgba(0, 229, 255, 0.15)",e.lineWidth=2,e.beginPath();for(let nt=Ki+10;nt<Ki+Lo;nt+=15)e.moveTo(nt,ft+10),e.lineTo(nt,Za-10);e.stroke()}r&&(e.save(),e.strokeStyle="#ffffff",e.lineWidth=3,e.strokeRect(pe-70,ye-30,30,60),e.strokeRect(pe+40,ye-30,30,60),e.fillStyle="#ffffff",e.beginPath(),e.moveTo(pe,ye+10),e.lineTo(pe+10,ye),e.lineTo(pe+10,ye-10),e.lineTo(pe-10,ye-10),e.lineTo(pe-10,ye),e.closePath(),e.fill(),e.restore());const Ka=e.createLinearGradient(0,Rt,0,a);Ka.addColorStop(0,"#546e7a"),Ka.addColorStop(.1,"#37474f"),Ka.addColorStop(.5,"#263238"),Ka.addColorStop(1,"#101015"),e.fillStyle=Ka,e.fillRect(0,Rt,t,gi),e.fillStyle="#78909c",e.fillRect(0,Rt,t,4),e.fillStyle="#1c2326",e.fillRect(0,Rt+4,t,2);const Io=t*.2;for(let H=Io;H<t;H+=Io){e.fillStyle="#000",e.fillRect(H,Rt+10,2,gi-20),e.fillStyle="rgba(255,255,255,0.1)",e.fillRect(H+2,Rt+10,1,gi-20);const se=H-60;if(se>0){e.fillStyle="#111";for(let ke=Rt+15;ke<a-10;ke+=6)e.fillRect(se,ke,40,3)}}e.fillStyle="#111";for(let H=20;H<t;H+=40)e.beginPath(),e.arc(H,a-8,3,0,Math.PI*2),e.fill(),e.fillStyle="rgba(255,255,255,0.2)",e.beginPath(),e.arc(H-1,a-9,1,0,Math.PI*2),e.fill(),e.fillStyle="#111";const ko=(H,se,ke,Le)=>{e.fillStyle="#222",e.fillRect(H,se,ke,Le),e.fillStyle="#051e3e",e.fillRect(H+4,se+4,ke-24,Le-8);const xe=H+ke-16;e.fillStyle="#e74c3c",e.beginPath(),e.arc(xe,se+8,3,0,Math.PI*2),e.fill(),e.fillStyle="#f1c40f",e.beginPath(),e.arc(xe,se+18,3,0,Math.PI*2),e.fill(),e.fillStyle="#004400",e.fillRect(H+6,se+6,4,4)};ko(20,Rt+15,120,30),ko(t-140,Rt+15,120,30),e.restore(),ul(e,t,a,n),Xn(e,t,a,n),e.restore()}const so={};function Jn(e,t=6,a=10){const i=`${e}-${t}-${a}`;if(so[i])return so[i];const o=a*2,n=document.createElement("canvas"),s=(t+o)*2;n.width=s,n.height=s;const r=n.getContext("2d"),d=s/2,f=s/2;r.beginPath(),r.arc(d,f,t,0,Math.PI*2);const c=r.createRadialGradient(d-t*.4,f-t*.4,t*.2,d,f,t+1);return c.addColorStop(0,"#fff"),c.addColorStop(.3,e),c.addColorStop(1,e),r.fillStyle=c,r.shadowColor=e,r.shadowBlur=a,r.fill(),r.shadowBlur=0,r.fillStyle="rgba(255, 255, 255, 0.9)",r.beginPath(),r.arc(d-t*.4,f-t*.4,t*.3,0,Math.PI*2),r.fill(),so[i]=n,n}function pl(e,t,a,i){if(l.settings?.useLowPerformance)return;const o=qi(a,i),n=o.consoleTop,s=o.consoleH,r=t*.35,d=s-10,f=t*.3,c=a-a*.08,h=o.cautionBottom+4,g=a*.25,m=t*.2,p=(t-m)/2,T=h+g,v=c,y=v-T,S=t*.3,_=(t-S)/2,A=r,E=n+5,P=f,M=d;l.isPaused||(window.spaceRendererTime||(window.spaceRendererTime=Date.now()),window.spaceRendererTime+=16.6);const I=window.spaceRendererTime||Date.now(),L=l.perfectHitTimer>0&&!l.settings.noFlash,w=l.isGameOver,U=L&&V.consecutivePerfectHits>=3;e.fillStyle=w?"#420d0d":"#051015",e.fillRect(A,E,P,M),e.save(),e.beginPath(),e.rect(A,E,P,M),e.clip();const k=w||U?"#ff0000":L?"#00e5ff":"#00ff00";e.strokeStyle=k,e.lineWidth=2,e.shadowBlur=5,e.shadowColor=e.strokeStyle,e.beginPath();const B=I*.002;for(let me=0;me<P;me+=3){let z=L?Math.sin(me*12.9898+I*.5)*Math.sin(me*78.233+I*.1)*(M*.4):Math.sin(me*.05+B)*(M*.35);e.lineTo(A+me,E+M/2+z)}if(e.stroke(),e.shadowBlur=0,e.restore(),at.w!==t||at.h!==a){at.w=t,at.h=a;const me=Math.max(t,a),z=e.createRadialGradient(t/2,a/2,me*.35,t/2,a/2,me*.85);z.addColorStop(0,"rgba(0,0,0,0)"),z.addColorStop(1,"rgba(20, 10, 30, 0.7)"),at.vignette=z;const N=e.createLinearGradient(A,E,A+P,E+M);N.addColorStop(0,"rgba(255,255,255,0.1)"),N.addColorStop(.5,"rgba(255,255,255,0)"),N.addColorStop(1,"rgba(255,255,255,0.05)"),at.glass=N;const ne=e.createLinearGradient(p,h,p+m,h);if(ne.addColorStop(0,"rgba(0, 255, 255, 0)"),ne.addColorStop(.2,"rgba(0, 255, 255, 0.2)"),ne.addColorStop(.5,"rgba(0, 255, 255, 1.0)"),ne.addColorStop(.8,"rgba(0, 255, 255, 0.2)"),ne.addColorStop(1,"rgba(0, 255, 255, 0)"),at.upperBeam=ne,y>0){const de=e.createLinearGradient(_,T,_+S,T);de.addColorStop(0,"rgba(0, 255, 255, 0)"),de.addColorStop(.2,"rgba(0, 255, 255, 0.2)"),de.addColorStop(.5,"rgba(0, 255, 255, 1.0)"),de.addColorStop(.8,"rgba(0, 255, 255, 0.2)"),de.addColorStop(1,"rgba(0, 255, 255, 0)"),at.lowerBeam=de}const ue=e.createLinearGradient(0,v-40,0,v);ue.addColorStop(0,"rgba(0, 229, 255, 0)"),ue.addColorStop(1,"rgba(0, 229, 255, 1.0)"),at.core=ue}if(e.fillStyle=at.glass,e.fillRect(A,E,P,M),L&&Math.sin(I/50)>0&&(e.shadowBlur=10,e.shadowColor="#ff0000",e.strokeStyle="#ff0000",e.lineWidth=4,e.strokeRect(r,n+5,f,d),e.shadowBlur=0),L){const me=(X,ie,J,ge)=>{if(Math.sin(I/50+ge)>0){const Oe=Jn(J,5,10),G=(5+20)*2;e.drawImage(Oe,X-G/2,ie-G/2)}},z=s;me(t*.15,n+z*.3,"#ff0000",0),me(t*.18,n+z*.3,"#ffff00",10),me(t*.21,n+z*.3,"#00ff00",20),me(t*.85,n+z*.5,"#ff0000",5),me(t*.82,n+z*.5,"#ffa500",15);const N=o.cautionTop,ne=o.cautionH,ue=N+ne/2,de=60,we=t*.05;for(let X=20;X<t;X+=de)X<we||X>t-we||me(X,ue,"#ff8c00",X)}const q=6,be=I*.001,oe=(Math.sin(be)+1)/2,j=.02,te=j+oe*(.25-j);if(e.save(),e.globalAlpha=te,e.fillStyle=at.upperBeam,e.fillRect(p+q,h+q,m-q*2,g-q*2),y>0&&at.lowerBeam){e.fillStyle=at.lowerBeam,e.fillRect(_+q,T+q,S-q*2,y-q*2),e.fillStyle=at.core;const me=S,z=_,N=me-20,ne=z+10;e.fillRect(ne,v-30,N,20)}e.globalAlpha=1,e.restore();const ve=20,ce=c+15,Z=t-140,Ce=c+15;I%2e3<1e3&&(e.fillStyle="rgba(0, 255, 0, 0.4)",e.fillRect(ve+2,ce+2,12,12),e.fillRect(Z+2,Ce+2,12,12),e.fillStyle="#00ff00",e.fillRect(ve+6,ce+6,4,4),e.fillRect(Z+6,Ce+6,4,4)),e.shadowBlur=0,e.fillStyle=at.vignette,e.fillRect(0,0,t,a),Qn(e,t,a,o,I)}const lo=new Uint8Array(500);function Qn(e,t,a,i,o){if(!window.spaceStarCache||window.spaceStarCache.length!==500){window.spaceStarCache=[];for(let y=0;y<500;y++)window.spaceStarCache.push({x:Math.random(),y:Math.random(),size:.5+Math.random()*2,offset:Math.random()*1e4,speed:.002+Math.random()*.004})}let s,r,d,f,c,u,h,g,m,p=!1;i&&(p=!0,s=t*.05,r=i.consoleTop,d=i.consoleBottom,f=i.cautionTop,c=i.cautionBottom,m=t*.25,g=(t-m)/2,u=i.cautionBottom,h=a*.85);const T=o||Date.now(),v=window.spaceStarCache;for(let y=0;y<500;y++){const S=v[y],_=S.x*t,A=S.y*a;let E=!0;if(p&&(_<s||_>t-s||A>r&&A<d||A>f&&A<c||A>u&&A<h&&_>g&&_<g+m)&&(E=!1),!E){lo[y]=255;continue}const P=Math.sin(T*S.speed+S.offset),M=Math.max(0,(P+1)/2);lo[y]=Math.min(9,Math.floor(M*10))}e.save(),e.fillStyle="#ffffff";for(let y=0;y<10;y++){const S=(y+1)/10;e.globalAlpha=S;for(let _=0;_<500;_++)if(lo[_]===y){const A=v[_];e.fillRect(A.x*t,A.y*a,A.size,A.size)}}e.globalAlpha=1,e.restore()}function gl(e,t,a){const i=l.isGameOver,o=i;if(qn(e,t,a,o),no(e,t,a,o),e.canvas.style.cursor="pointer",Qn(e,t,a,null,Date.now()),i){Sn(e,t,a),no(e,t,a,!0),yn(e,t,a,!0),vn(e,t,a,!0,!1),e.save(),e.textAlign="center",e.fillStyle="#ff0000",e.shadowColor="#ff0000",e.shadowBlur=20;const n=Math.min(t,a)*.08;e.font=`${n}px "PressStart2PLocal"`;let s="GAME OVER";l.consecutiveFouls>=4&&(s="BAT BROKEN!"),e.fillText(s,t/2,a*.2),e.fillStyle=l.isDailyChallenge?"#FFD700":"#ffffff",e.shadowBlur=10,e.font=`${n*.5}px "PressStart2PLocal"`,e.fillText(`SCORE: ${V.score}`,t/2,a*.35),(l.settings?.noFlash||Math.floor(Date.now()/500)%2===0)&&(e.fillStyle="#ffffff",e.shadowBlur=0,e.font=`${n*.5}px "PressStart2PLocal"`,e.fillText("TAP TO RETRY",t/2,a*.8)),e.restore()}else{Sn(e,t,a),no(e,t,a,!1),yn(e,t,a,!1),vn(e,t,a,!1,!0),e.save(),e.textAlign="center",e.font='40px "PressStart2PLocal"';const n=Math.sin(Date.now()/300);e.globalAlpha=.6+n*.4,e.fillStyle="#e0f7fa",e.shadowColor="#00e5ff",e.shadowBlur=15,window.innerWidth<=600||window.innerHeight<=600?(e.fillText("TAP TO",t/2,a*.72),e.fillText("START",t/2,a*.72+50)):e.fillText("TAP TO START",t/2,a*.75),e.restore()}}function xn(e,t,a,i,o=null){const n=o!==null?o:a*.1,s=e.createLinearGradient(0,0,0,n);i?(s.addColorStop(0,"#0a0a2a"),s.addColorStop(1,"#2c3e50")):(s.addColorStop(0,"#4facfe"),s.addColorStop(1,"#00f2fe")),e.fillStyle=s,e.fillRect(0,0,t,n);const r=t*.8,d=n*.35,f=i?Math.min(25,n*.5):Math.min(45,n*.7);i?(e.fillStyle="#fdfdea",e.shadowColor="#fdfdea",e.shadowBlur=15,e.beginPath(),e.arc(t*.2,d,f,0,Math.PI*2),e.fill(),e.shadowBlur=0):(e.fillStyle="#ffecb3",e.shadowColor="#ffc107",e.shadowBlur=30,e.beginPath(),e.arc(r,d,f,0,Math.PI*2),e.fill(),e.shadowBlur=0);const c=e.createLinearGradient(0,n,0,a);if(i?(c.addColorStop(0,"#000033"),c.addColorStop(1,"#001144")):(c.addColorStop(0,"#0277bd"),c.addColorStop(.3,"#00acc1"),c.addColorStop(1,"#26c6da")),e.fillStyle=c,e.fillRect(0,n+20,t,a-(n+20)),yl(e,t*.55,n+1,.4,i),!i){const u=e.createLinearGradient(0,n-20,0,n+40);u.addColorStop(0,"rgba(255, 255, 255, 0)"),u.addColorStop(.4,"rgba(200, 240, 255, 0.5)"),u.addColorStop(1,"rgba(255, 255, 255, 0)"),e.fillStyle=u,e.fillRect(0,n-20,t,60)}ml(e,t,n,i)}function ml(e,t,a,i){const o=i?"#263238":"#546e7a",n=i?"#000000":"#37474f",s=(r,d,f)=>{e.save(),e.translate(r,d),e.scale(f,f),e.fillStyle=o,e.beginPath(),e.moveTo(0,0),e.lineTo(10,-15),e.lineTo(25,-5),e.lineTo(35,-20),e.lineTo(50,0),e.fill(),e.fillStyle=n,e.fillRect(0,-2,50,2),e.restore()};s(t*.25,a+40,.6),s(t*.22,a+45,.5),s(t*.8,a+80,.8),s(t*.85,a+75,.6)}function yl(e,t,a,i,o){e.save(),e.translate(t,a),e.scale(i,i);const n=o?"#212121":"#455a64",s=o?"#1b5e20":"#2e7d32";e.fillStyle=n,e.beginPath(),e.moveTo(-40,0),e.lineTo(40,0),e.lineTo(35,4),e.lineTo(-38,4),e.closePath(),e.fill(),e.fillRect(20,-10,8,10),e.fillRect(22,-12,4,3),e.fillStyle=s,e.fillRect(-30,-5,12,5),e.fillRect(-15,-5,12,5),e.fillStyle=o?"#b71c1c":"#c62828",e.fillRect(-28,-9,10,4),e.fillRect(-12,-9,10,4),e.restore()}function Pn(e,t,a,i,o,n=!1,s=0){const r=s?Math.sin(s*.8)*1.5:0,d=s?Math.sin(s*.5)*.05:0;e.save(),e.translate(t,a+r),n&&e.scale(-1,1),e.rotate(d),e.scale(i,i);const f=o?"#263238":"#37474f",c=o?"#b0bec5":"#ECEFF1";e.fillStyle=f,e.beginPath(),e.moveTo(-15,0),e.lineTo(15,0),e.lineTo(10,6),e.lineTo(-10,6),e.closePath(),e.fill(),e.strokeStyle=f,e.lineWidth=2,e.beginPath(),e.moveTo(0,0),e.lineTo(0,-25),e.stroke(),e.fillStyle=c,e.beginPath(),e.moveTo(2,-22),e.quadraticCurveTo(15,-12,2,-2),e.fill(),e.restore()}function Rn(e,t,a,i,o,n){const s=Math.sin(n*1.2)*2,r=Math.sin(n*.8)*.1;e.save(),e.translate(t,a+s),e.rotate(r),e.scale(i,i);const d=o?"#880e4f":"#d81b60",f=o?"#263238":"#546e7a";e.fillStyle=d,e.beginPath(),e.arc(0,0,6,0,Math.PI,!0),e.fill(),e.fillRect(-6,0,12,3),e.fillStyle=f,e.fillRect(-2,-10,4,10),e.fillRect(-4,-12,8,2),o&&(e.shadowBlur=10,e.shadowColor="red",e.fillStyle="#ff1744",e.beginPath(),e.arc(0,-13,1.5,0,Math.PI*2),e.fill()),e.restore()}function Sl(e,t,a,i,o,n=!1,s=0,r=!1){e.save(),e.translate(t,a),e.scale(i,i);const d=o?"#795548":"#ffe0b2",f=o?"#4e342e":"#ffcc80";if(e.fillStyle=f,e.beginPath(),e.ellipse(0,0,40,10,0,0,Math.PI*2),e.fill(),e.fillStyle=d,e.beginPath(),e.ellipse(0,-2,35,8,0,0,Math.PI*2),e.fill(),n){if(r){e.save(),e.translate(0,-35);const p=s*2;for(let T=0;T<2;T++){e.save(),e.rotate(p+T*Math.PI);const v=e.createLinearGradient(0,0,0,-120);v.addColorStop(0,"rgba(255, 215, 0, 0.6)"),v.addColorStop(1,"rgba(255, 215, 0, 0)"),e.fillStyle=v,e.beginPath(),e.moveTo(0,0),e.lineTo(-15,-120),e.lineTo(15,-120),e.closePath(),e.fill(),e.restore()}e.restore()}e.save(),e.beginPath(),e.moveTo(-8/2,0),e.lineTo(-8/3,-35),e.lineTo(8/3,-35),e.lineTo(8/2,0),e.clip();const g=4,m=35/g;for(let p=0;p<g;p++){const T=r?"#fff176":"#ffffff";e.fillStyle=p%2===0?o?"#37474f":T:"#d32f2f",e.fillRect(-8,-35+p*m,16,m)}e.restore(),e.fillStyle="#212121",e.fillRect(-4,-39,8,4),e.fillStyle=r?"#ffff00":"#ffeb3b",(o||r)&&(e.shadowBlur=r?20:10,e.shadowColor="#ffff00"),e.beginPath(),e.arc(0,-41,3,0,Math.PI*2),e.fill(),e.shadowBlur=0,e.fillStyle="#b71c1c",e.beginPath(),e.moveTo(-6,-43),e.lineTo(0,-47),e.lineTo(6,-43),e.fill()}e.restore()}function Po(e,t,a,i=null,o=null){const n=Date.now()/1e3,s=i!==null?i:a*.1,r=re.currentTheme,d=o!==null?o:r.getShorelineY?r.getShorelineY(a):a*.18,f=d-s;e.save();const c=l.isGameOver||l.isNight;e.beginPath(),e.moveTo(0,d),e.lineTo(0,s);for(let g=0;g<=t;g+=25){const m=s+Math.sin(g*.04+n*.4)*3+Math.sin(g*.12-n*.7)*1;e.lineTo(g,m)}e.lineTo(t,d),e.closePath(),e.fillStyle=c?"#000033":"#0277bd",e.fill();const u=l.perfectHitTimer>0&&V.consecutivePerfectHits>=1;Sl(e,t*.16,s+5,1.1,c,!0,n,u),e.strokeStyle="rgba(255, 255, 255, 0.25)",e.lineWidth=1,e.beginPath();for(let g=0;g<=t;g+=100){const m=Math.sin(g*.2+n*1.5)*1,p=s+Math.sin(g*.04+n*.4)*3+m;g===0?e.moveTo(g,p):e.lineTo(g,p)}e.stroke(),r._waveGradients||(r._waveGradients=[]);const h=2;for(let g=0;g<h;g++){const m=(g+1)/(h+1),p=s+f*.1+f*.8*m,T=.2+g*.1,v=3+g*3;e.beginPath(),e.moveTo(0,d);for(let _=0;_<=t;_+=60){const A=Math.sin(_*.01+n*T)*v;e.lineTo(_,p+A)}e.lineTo(t,d),e.closePath();const y=e.createLinearGradient(0,p-v,0,p+v*8),S=.08+g*.12;y.addColorStop(0,`rgba(255, 255, 255, ${S*.5})`),y.addColorStop(.3,`rgba(0, 188, 212, ${S})`),y.addColorStop(1,"rgba(0, 77, 64, 0)"),e.fillStyle=y,e.fill(),g===0?(Pn(e,t*.35,p,1,c,!1,n),Pn(e,t*.62,p+2,.85,c,!0,n+1)):(Rn(e,t*.2,p+1,1.1,c,n+.5),Rn(e,t*.85,p-1,1,c,n+2.1))}if(V.consecutivePerfectHits>=1&&!l.settings?.noFlash&&!l.isGameOver){const g=l.perfectHitTimer>0,m=t*.8,p=s*.35,T=Math.min(45,s*.7);if(g){const S=(Math.sin(n*15)+1)*.5,_=T*(1.5+S*.5),A=e.createRadialGradient(m,p,T*.5,m,p,_);A.addColorStop(0,"rgba(255, 255, 210, 0.8)"),A.addColorStop(.4,"rgba(255, 215, 0, 0.6)"),A.addColorStop(1,"rgba(255, 165, 0, 0)"),e.fillStyle=A,e.beginPath(),e.arc(m,p,_,0,Math.PI*2),e.fill(),e.save(),e.translate(m,p),e.rotate(n*.5),e.fillStyle="rgba(255, 255, 255, 0.15)";for(let E=0;E<8;E++)e.rotate(Math.PI/4),e.beginPath(),e.moveTo(0,0),e.lineTo(20,-_*2),e.lineTo(-20,-_*2),e.closePath(),e.fill();e.restore()}const v=g?.3:.15;e.fillStyle=`rgba(255, 100, 0, ${v})`,e.globalCompositeOperation="overlay",e.fillRect(0,0,t,a),e.globalCompositeOperation="source-over";const y=Math.floor(n*5);for(let S=0;S<10;S++){let A=(y*9301+49297+S)%233280/233280;if(A>.5){const E=A*t%t,P=s+A*1e3%f;e.fillStyle="#fff",e.beginPath(),e.arc(E,P,2,0,Math.PI*2),e.fill()}}}e.restore()}function Tl(e,t,a){if(re.currentTheme.id!=="BEACH")return;const i=Date.now()/1e3,o=re.currentTheme,n=o.getShorelineY?o.getShorelineY(a):a*.18,s=40/(t/a),r=Math.sin(i*.45),d=Math.sin(i*.9)*.15,f=(r+1)/2+d,c=f*Math.min(55,Math.max(15,s)),u=n+c;e.save();const g=l.isNight||l.isGameOver?"77, 208, 225":"178, 235, 242";for(let m=0;m<3;m++){const p=(.4+m*.15)*Math.max(0,f),T=c*(.5+m*.5),v=n+T,y=e.createLinearGradient(0,n,0,v+12);y.addColorStop(0,`rgba(${g}, ${.1*m})`),y.addColorStop(.3,`rgba(${g}, ${p})`),y.addColorStop(.7,`rgba(255, 255, 255, ${p*.9})`),y.addColorStop(1,"rgba(255, 255, 255, 0)"),e.fillStyle=y,e.beginPath(),e.moveTo(0,n);for(let S=0;S<=t;S+=40){const _=Math.sin(S*.015+i*.6+m)*8,A=Math.sin(S*.05-i*.9)*3;e.lineTo(S,v+_+A)}e.lineTo(t,n),e.fill()}for(let m=0;m<50;m++){const p=t*(m/50+Math.sin(m*123)%.02),T=u+Math.sin(p*.01+i*.5)*6;T>n&&(e.fillStyle=m%2===0?`rgba(${g}, ${.8*f})`:`rgba(255, 255, 255, ${.9*f})`,e.beginPath(),e.arc(p,T,Math.max(.1,.7+Math.sin(i+m)*1.2),0,Math.PI*2),e.fill())}e.restore()}function bl(e,t,a,i,o){e.save();const n="#8d6e63",s="#4e342e",r=(d,f,c,u)=>{e.save(),e.strokeStyle=s,e.lineWidth=6,e.beginPath(),e.moveTo(d,f),e.lineTo(c,u),e.stroke(),e.strokeStyle=n,e.lineWidth=4,e.setLineDash([8,4]),e.beginPath(),e.moveTo(d,f),e.lineTo(c,u),e.stroke(),e.restore()};r(i,o,t,o-(t-i)*1.5),r(i,o,0,o-i*1.5),e.restore()}function An(e,t,a){if(re.currentTheme.id!=="BEACH")return;const i=re.currentTheme,n=(i.getShorelineY?i.getShorelineY(a):a*.18)+20,s=a,r=s-n;ro(e,t*.28,n+r*.15,1.2),ro(e,t*.1,s-100,1.5),ro(e,t*.88,n+r*.35,1.3),co(e,t*.1,n+r*.6,1.5,"#ff7043"),co(e,t*.72,n+r*.08,1.2,"#ff8a65"),co(e,t*.92,n+r*.75,1.6,"#ef5350"),fo(e,t*.2,n+r*.1,1.4,"#f8bbd0"),fo(e,t*.03,n+r*.5,1.6,"#ffffff"),fo(e,t*.95,n+r*.45,1.3,"#e1bee7")}function ro(e,t,a,i){e.save(),e.translate(t,a),e.scale(i,i),e.rotate(.3),e.fillStyle="rgba(0,0,0,0.15)",e.beginPath(),e.ellipse(0,4,18,5,0,0,Math.PI*2),e.fill(),e.fillStyle="#6d4c41",e.beginPath(),e.moveTo(-18,-3),e.quadraticCurveTo(-10,-5,5,-4),e.lineTo(18,-2),e.lineTo(20,3),e.quadraticCurveTo(5,6,-10,5),e.lineTo(-20,2),e.closePath(),e.fill(),e.strokeStyle="rgba(0,0,0,0.2)",e.lineWidth=1,e.beginPath(),e.moveTo(-12,1),e.lineTo(12,-1),e.stroke(),e.beginPath(),e.moveTo(-8,3),e.lineTo(8,2),e.stroke(),e.beginPath(),e.arc(5,0,1.5,0,Math.PI*2),e.stroke(),e.restore()}function co(e,t,a,i,o){e.save(),e.translate(t,a),e.scale(i,i),e.rotate(.5),e.fillStyle="rgba(0,0,0,0.1)",e.beginPath(),e.arc(0,2,7,0,Math.PI*2),e.fill(),e.fillStyle=o,e.beginPath();for(let n=0;n<5;n++){const s=n/5*Math.PI*2;e.lineTo(Math.cos(s)*10,Math.sin(s)*10),e.lineTo(Math.cos(s+Math.PI/5)*4,Math.sin(s+Math.PI/5)*4)}e.closePath(),e.fill(),e.fillStyle="rgba(255,255,255,0.3)";for(let n=0;n<5;n++){const s=n/5*Math.PI*2;e.beginPath(),e.arc(Math.cos(s)*5,Math.sin(s)*5,1,0,Math.PI*2),e.fill()}e.restore()}function fo(e,t,a,i,o){e.save(),e.translate(t,a),e.scale(i,i),e.fillStyle="rgba(0,0,0,0.1)",e.beginPath(),e.ellipse(0,2,8,4,0,0,Math.PI*2),e.fill(),e.fillStyle=o,e.beginPath(),e.moveTo(-6,4),e.bezierCurveTo(-12,-10,12,-10,6,4),e.closePath(),e.fill(),e.strokeStyle="rgba(0,0,0,0.15)",e.lineWidth=.5;for(let n=-3;n<=3;n+=2)e.beginPath(),e.moveTo(n,-6),e.lineTo(n,2),e.stroke();e.restore()}function vl(e,t,a,i,o,n,s=0){e.save(),e.translate(t,a),e.scale(i,i);const r=Math.abs(Math.sin(s*8))*.5,d=Math.sin(s*4)*.08;e.translate(0,-r),e.rotate(d);const f=o?"#b71c1c":"#ff5252",c=o?"#7f0000":"#d32f2f",u=o?"#ffcc80":"#ffe0b2",h=f,g="#ffffff",m="#000000";e.save(),e.translate(0,r),e.rotate(-d),e.fillStyle="rgba(0,0,0,0.2)",e.beginPath(),e.ellipse(0,5,25,8,0,0,Math.PI*2),e.fill(),e.restore(),e.strokeStyle=c,e.lineWidth=3,e.lineCap="round";const p=(_,A,E,P)=>{const M=_==="left"?-1:1,I=A/(E*1.5)*Math.PI,w=(P*3+I)%(Math.PI*2),U=Math.sin(w),k=Math.max(0,U)*6,B=Math.cos(w)*.5;e.beginPath(),e.moveTo(M*15,0);const q=M*(25+B),be=5-k;e.lineTo(q,be);const oe=M*(28+B*1.5),j=12-Math.max(0,k*1.2);e.lineTo(oe,j),e.stroke()};for(let _=0;_<3;_++)p("left",_,3,s),p("right",_,3,s);e.fillStyle=f,e.beginPath(),e.ellipse(0,0,20,14,0,0,Math.PI*2),e.fill(),e.fillStyle="rgba(255,255,255,0.15)",e.beginPath(),e.arc(-12,-5,2,0,Math.PI*2),e.fill(),e.beginPath(),e.arc(12,-3,3,0,Math.PI*2),e.fill(),e.beginPath(),e.arc(-8,6,1.5,0,Math.PI*2),e.fill(),e.fillStyle=u,e.beginPath(),e.ellipse(0,5,12,6,0,0,Math.PI*2),e.fill(),e.strokeStyle="#3e2723",e.lineWidth=1.5,e.beginPath(),e.arc(0,-4,6,.2,Math.PI-.2),e.stroke(),e.fillStyle="rgba(255, 100, 100, 0.3)",e.beginPath(),e.arc(-7,-4,2.5,0,Math.PI*2),e.fill(),e.beginPath(),e.arc(7,-4,2.5,0,Math.PI*2),e.fill();const T=(_,A,E)=>{e.save(),e.translate(_,A),E&&e.scale(-1,1),e.rotate(-.2+Math.sin(s*2)*.05),e.strokeStyle=f,e.lineWidth=5,e.beginPath(),e.moveTo(0,0),e.lineTo(-8,-6),e.stroke(),e.translate(-10,-9),e.rotate(-.4),e.fillStyle=h,e.beginPath(),e.moveTo(0,0),e.bezierCurveTo(5,5,15,0,10,-10),e.bezierCurveTo(5,-5,0,0,0,0),e.fill(),e.beginPath(),e.moveTo(2,-2),e.bezierCurveTo(8,-8,12,-15,4,-18),e.bezierCurveTo(2,-10,-2,-6,2,-2),e.fill(),e.restore()};T(-18,-2,!1),T(18,-2,!0);const v=(_,A)=>{const E=Math.sin(s*3)*1;e.strokeStyle=f,e.lineWidth=3,e.beginPath(),e.moveTo(_,A+5+E),e.lineTo(_,A+E),e.stroke(),e.fillStyle=g,e.beginPath(),e.arc(_,A+E,5,0,Math.PI*2),e.fill(),e.strokeStyle=c,e.lineWidth=1,e.stroke(),e.fillStyle=m,e.beginPath(),e.arc(_,A+E,2.5,0,Math.PI*2),e.fill(),e.fillStyle="#fff",e.beginPath(),e.arc(_+1.5,A-1.5+E,1,0,Math.PI*2),e.fill()};v(-6,-16),v(6,-16),e.save(),e.translate(28,-28),e.rotate(.1+Math.sin(s*2)*.05),e.fillStyle="#5d4037",e.fillRect(-2,0,4,45),e.fillStyle="#5d4037",e.fillRect(-25,-20,50,25),e.lineWidth=2,e.strokeStyle="#3e2723",e.strokeRect(-25,-20,50,25),e.fillStyle="#ffffff",e.font='6px "PressStart2PLocal"',e.textAlign="center";let y="HIGH",S=n;if(l.isDailyChallenge){y="DAILY";const _=new Date,A=_.getUTCFullYear(),E=String(_.getUTCMonth()+1).padStart(2,"0"),P=String(_.getUTCDate()).padStart(2,"0"),M=`${A}-${E}-${P}`;S=parseInt(Y.getItem(`baseball_daily_score_${M}`,"0"))||0}e.fillText(y,0,-12),e.fillStyle=l.isDailyChallenge?"#f1c40f":"#b71c1c",e.fillText(`${S}`,0,-3),e.restore(),e.restore()}function Cl(e,t,a){const i=l.isGameOver,o=i,n=Date.now()/1e3,s=a*.38,r=a*.65;xn(e,t,a,o,s),Po(e,t,a,s,r),e.save();const d=r,f=a-d,c=o?"#3e2723":"#d7ccc8",u=o?"#21130d":"#8d6e63",h=e.createLinearGradient(0,d,0,a);h.addColorStop(0,c),h.addColorStop(1,o?"#1b100c":"#a1887f"),e.fillStyle=h,e.fillRect(0,d,t,f),e.strokeStyle=u,e.lineWidth=2,e.beginPath();const g=t/2;for(let P=-8;P<=8;P++){const M=g+P*(t/12),I=g+P*(t/3);e.moveTo(M,d),e.lineTo(I,a)}for(let P=d;P<a;P+=25)if(P%50===0){e.fillStyle=o?"#111":"#5d4037";for(let M=0;M<t;M+=40){const I=P%100/2;e.fillRect(M+I,P,4,4)}}e.stroke();const m=30,p=20,T=d-45;e.fillStyle="rgba(0,0,0,0.3)",e.fillRect(0,d,t,15),e.fillStyle=u,e.fillRect(0,T,t,m),e.fillStyle=o?"#5d4037":"#bcaaa4",e.fillRect(0,T,t,5),e.fillStyle=u;for(let P=0;P<=t;P+=t/6)e.fillRect(P-p/2,T,p,d-T),e.fillStyle=o?"#5d4037":"#bcaaa4",e.fillRect(P-p/2+2,T+m,3,d-T-m),e.fillStyle=u;const v=typeof V<"u"?V.highScore:0,y=t*.15,_=Math.sin(n*.5)*y,A=t*.5+_;vl(e,A,a*.7,3.5,o,v,n),e.restore(),e.restore();const E=Math.min(t,a)*.08;if(e.textAlign="center",i){e.save(),e.fillStyle="#ff0000",e.shadowColor="#000",e.shadowBlur=4,e.font=`${E}px "PressStart2PLocal"`;let P="GAME OVER";l.consecutiveFouls>=4&&(P="BAT BROKEN!"),e.fillText(P,t/2,a*.3),e.fillStyle=l.isDailyChallenge?"#FFD700":"#ffffff",e.font=`${E*.6}px "PressStart2PLocal"`;const M=typeof V<"u"?V.score:l.score;e.fillText(`SCORE: ${M}`,t/2,a*.5),(l.settings?.noFlash||Math.floor(Date.now()/500)%2===0)&&(e.fillStyle="#ffff00",e.shadowColor="#000",e.shadowBlur=2,t<=600||a<=600?(e.font=`${E*.6}px "PressStart2PLocal"`,e.fillText("TAP TO",t/2,a*.82),e.fillText("RETRY",t/2,a*.82+E*.7)):(e.font=`${E*.6}px "PressStart2PLocal"`,e.fillText("TAP TO RETRY",t/2,a*.87))),e.restore()}else{e.save();const P=Math.sin(Date.now()/300);e.globalAlpha=.8+P*.2,e.fillStyle="#ffffff",e.shadowColor="#00e5ff",e.shadowBlur=10,e.shadowOffsetX=0,e.shadowOffsetY=0;const M=t<=600||a<=600;e.textAlign="center",M?(e.font=`${E*.6}px "PressStart2PLocal"`,e.fillText("TAP TO",t/2,a*.82),e.fillText("START",t/2,a*.82+E*.7)):(e.font=`${E*.6}px "PressStart2PLocal"`,e.fillText("TAP TO START",t/2,a*.87)),e.restore()}e.canvas.style.cursor="pointer"}function Pl(e,t){const a=document.createElement("canvas");a.width=100,a.height=100;const i=a.getContext("2d"),o=i.createLinearGradient(0,0,0,-120);o.addColorStop(0,"rgba(255, 215, 0, 0.6)"),o.addColorStop(1,"rgba(255, 215, 0, 0)"),i.fillStyle=o,i.fillRect(0,0,10,10);const n=i.createRadialGradient(50,50,10,50,50,100);n.addColorStop(0,"rgba(255, 255, 210, 0.8)"),n.addColorStop(.4,"rgba(255, 215, 0, 0.6)"),n.addColorStop(1,"rgba(255, 165, 0, 0)"),i.fillStyle=n,i.fillRect(0,0,100,100),console.log("[Beach] Effects Warmed Up")}function Rl(e,t,a,i){const o=i?"#3d1f0b":"#8B4513",n=i?"#000000":"#555555",s=i?"#002200":"#32CD32",r=i?"#001100":"#006400",d=i?"#001100":"#228B22",f=i?"#002200":"#006400";e.fillStyle=n;const c=a*.5;e.fillRect(t*.05,c,t*.9,150),e.fillStyle=i?"#111":"#444",e.beginPath(),e.moveTo(t*.05,c),e.bezierCurveTo(t*.05,c-60,t*.95,c-60,t*.95,c),e.fill();const u=t*.35,h=c-100,g=t*.3,m=50;e.fillStyle="#222",e.fillRect(u-10,h-10,g+20,m+20),e.fillStyle="#333",e.fillRect(u-40,h,30,m),e.fillRect(u+g+10,h,30,m),i||(e.fillStyle="#c0392b",e.fillRect(u-35,h+5,20,15),e.fillStyle="#2980b9",e.fillRect(u-35,h+25,20,15),e.fillStyle="#f1c40f",e.fillRect(u+g+15,h+5,20,15),e.fillStyle="#27ae60",e.fillRect(u+g+15,h+25,20,15)),e.fillStyle="#000",e.fillRect(u,h,g,m),e.fillStyle="#111",e.fillRect(u,h-30,g,20);for(let z=0;z<5;z++){const N=u+g/4*z;e.fillStyle=i?"#ffffcc":"#555",i&&(e.shadowColor="#ffffcc",e.shadowBlur=10),e.beginPath(),e.arc(N,h-35,4,0,Math.PI*2),e.fill(),e.shadowBlur=0}const p=20,T=5,v=4,y=g-v*2,S=m-v*2,_=Math.floor(y/p),A=Math.floor(S/T),E=Math.min(_,A)-1,P=E+1,M=p*P,I=T*P,L=(g-M)/2,w=(m-I)/2;e.fillStyle="#222";for(let z=0;z<T;z++)for(let N=0;N<p;N++)e.fillRect(u+L+N*P,h+w+z*P,E,E);const U={0:[[1,1,1],[1,0,1],[1,0,1],[1,0,1],[1,1,1]],1:[[0,1,0],[1,1,0],[0,1,0],[0,1,0],[1,1,1]],2:[[1,1,1],[0,0,1],[1,1,1],[1,0,0],[1,1,1]],3:[[1,1,1],[0,0,1],[1,1,1],[0,0,1],[1,1,1]],4:[[1,0,1],[1,0,1],[1,1,1],[0,0,1],[0,0,1]],5:[[1,1,1],[1,0,0],[1,1,1],[0,0,1],[1,1,1]],6:[[1,1,1],[1,0,0],[1,1,1],[1,0,1],[1,1,1]],7:[[1,1,1],[0,0,1],[0,0,1],[0,0,1],[0,0,1]],8:[[1,1,1],[1,0,1],[1,1,1],[1,0,1],[1,1,1]],9:[[1,1,1],[1,0,1],[1,1,1],[0,0,1],[1,1,1]]};e.fillStyle=l.isDailyChallenge?"#f1c40f":"#e74c3c",i&&(e.shadowColor=l.isDailyChallenge?"#f1c40f":"#e74c3c",e.shadowBlur=15);let k=l.highScore||0;if(l.isDailyChallenge){const z=new Date,N=z.getUTCFullYear(),ne=String(z.getUTCMonth()+1).padStart(2,"0"),ue=String(z.getUTCDate()).padStart(2,"0"),de=`${N}-${ne}-${ue}`;k=parseInt(Y.getItem(`baseball_daily_score_${de}`,"0"))||0}const B=k.toString(),q=3,be=1,oe=B.length*q+(B.length-1)*be;let j=Math.floor((p-oe)/2);for(let z=0;z<B.length;z++){const N=parseInt(B[z]);if(isNaN(N))continue;const ne=U[N];for(let ue=0;ue<5;ue++)for(let de=0;de<3;de++)if(ne[ue][de]){const we=j+z*(q+be)+de,X=ue;e.fillRect(u+L+we*P,h+w+X*P,E,E)}}e.shadowBlur=0,e.fillStyle="#f1c40f",e.font='16px "PressStart2PLocal"',e.textAlign="center",e.textBaseline="middle";const $=l.isDailyChallenge?"DAILY":"HIGH SCORE";e.fillText($,u+g/2,h-20);const te=(z,N)=>{e.fillStyle="#333",e.fillRect(z,N,20,60),e.fillStyle="#222",e.fillRect(z-10,N-20,40,20),e.fillStyle=i?"#ffffe0":"#ddd",i&&(e.shadowColor="#ffffe0",e.shadowBlur=20);for(let ne=0;ne<3;ne++)for(let ue=0;ue<4;ue++)e.fillRect(z-8+ue*10,N-18+ne*6,6,4);e.shadowBlur=0};te(t*.15,c-60),te(t*.8,c-60),e.fillStyle=f,e.beginPath(),e.moveTo(0,a*.6),e.bezierCurveTo(t*.2,a*.5,t*.4,a*.65,t*.6,a*.6),e.bezierCurveTo(t*.8,a*.55,t,a*.65,t,a*.65),e.lineTo(t,a),e.lineTo(0,a),e.fill(),e.fillStyle=d,e.beginPath(),e.moveTo(0,a*.65),e.bezierCurveTo(t*.25,a*.7,t*.5,a*.6,t*.75,a*.65),e.bezierCurveTo(t*.9,a*.68,t,a*.62,t,a*.62),e.lineTo(t,a),e.lineTo(0,a),e.fill();const ve=e.createLinearGradient(0,a*.6,0,a);ve.addColorStop(0,s),ve.addColorStop(1,r),e.fillStyle=ve,e.fillRect(0,a*.65,t,a*.35);const ce=new We("classic_static_world_noise");e.fillStyle="rgba(0,0,0,0.05)";for(let z=0;z<3e3;z++){const N=ce.random()*t,ne=a*.6+ce.random()*a*.4;e.fillRect(N,ne,1,2)}if(!i){e.fillStyle="#228B22";for(let z=0;z<50;z++){const N=ce.random()*t,ne=a*.65+ce.random()*a*.35;(N<t*.35||N>t*.65)&&(e.fillRect(N,ne,2,4),e.fillRect(N-2,ne+2,2,2),e.fillRect(N+2,ne+2,2,2))}}e.fillStyle=o,e.beginPath(),e.moveTo(t*.45,a*.6),e.lineTo(t*.55,a*.6),e.lineTo(t*.85,a),e.lineTo(t*.15,a),e.fill(),e.fillStyle=i?"rgba(0,0,0,0.3)":"rgba(60,40,20,0.15)";for(let z=0;z<800;z++){const N=t*.15+ce.random()*t*.7,ne=a*.6+ce.random()*a*.4,ue=(ne-a*.6)/(a*.4),de=t*.05+ue*(t*.35),we=t*.5;N>=we-de&&N<=we+de&&e.fillRect(N,ne,2,2)}const Z=(z,N,ne,ue,de)=>{const we=i?"#2a1a10":"#5C4033",X=i?"#3d2b1f":"#8B4513";e.strokeStyle=X,e.lineWidth=3*de,e.beginPath(),e.moveTo(z,N-8*de),e.lineTo(ne,ue-8*de),e.moveTo(z,N+2*de),e.lineTo(ne,ue+2*de),e.stroke(),e.fillStyle=we;const ie=Math.sqrt(Math.pow(ne-z,2)+Math.pow(ue-N,2)),J=Math.floor(ie/(25*de));for(let ge=0;ge<=J;ge++){const Oe=ge/J,R=z+(ne-z)*Oe,C=N+(ue-N)*Oe;e.fillRect(R-2*de,C-15*de,4*de,20*de)}};if(Z(t*.45,a*.6,t*.15,a,1.5),Z(t*.55,a*.6,t*.85,a,1.5),!window._classicTreeCache||window._classicTreeCacheIsNight!==i){const z=[],de=i?["#003300","#004400","#002200","#002600","#001a00"]:["#228B22","#006400","#2E8B57","#32CD32","#008000","#6B8E23"],we=i?"#2d1a08":"#8B4513";de.forEach(X=>{const ie=document.createElement("canvas");ie.width=160,ie.height=320;const J=ie.getContext("2d");J.scale(4,4);const ge=6,Oe=12,R=(40-ge)/2,C=80-Oe;J.fillStyle=we,J.fillRect(R,C,ge,Oe),J.fillStyle=X;const G=(O,K)=>{const ee=C+O,x=14*K,fe=ee-18,he=ee;J.beginPath(),J.moveTo(20,fe),J.lineTo(20+x,he),J.lineTo(20-x,he),J.closePath(),J.fill(),J.fillStyle="rgba(0,0,0,0.1)",J.beginPath(),J.moveTo(20,fe),J.lineTo(20+x,he),J.lineTo(20,he),J.fill(),J.fillStyle=X};G(0,1.2),G(-10,1),G(-20,.8),z.push(ie)}),window._classicTreeCache=z,window._classicTreeCacheIsNight=i}const Ce=window._classicTreeCache,Re=(z,N,ne,ue)=>{const de=Ce[ue%Ce.length],we=40*ne,X=80*ne,ie=17*ne,J=68*ne;e.drawImage(de,z-ie,N-J,we,X)},me=[{x:t*.1,y:a*.7,scale:4},{x:t*.05,y:a*.75,scale:5},{x:t*.25,y:a*.65,scale:2.5},{x:t*.15,y:a*.62,scale:2},{x:t*.02,y:a*.68,scale:3},{x:t*.85,y:a*.75,scale:4.5},{x:t*.95,y:a*.7,scale:5},{x:t*.75,y:a*.63,scale:2},{x:t*.8,y:a*.61,scale:1.8},{x:t*.9,y:a*.66,scale:3.5}];me.sort((z,N)=>z.y-N.y),me.forEach((z,N)=>Re(z.x,z.y,z.scale,N)),e.fillStyle=i?"#1a1a1a":"#555555",e.beginPath(),e.arc(t*.3,a*.8,5,0,Math.PI*2),e.fill(),e.beginPath(),e.arc(t*.75,a*.85,7,0,Math.PI*2),e.fill(),e.beginPath(),e.arc(t*.2,a*.9,4,0,Math.PI*2),e.fill()}function Al(){const a=document.createElement("canvas");a.width=400,a.height=400;const i=a.getContext("2d"),o=10,n=10,s=On,r=Gn;for(let u=0;u<400;u+=n){const h=u/n%2===0?0:o/2;for(let g=0;g<400;g+=o){const m=g+h+(Math.random()*2-1),p=u+(Math.random()*2-1);if(Math.random()>.9)continue;const T=s[Math.floor(Math.random()*s.length)],v=r[Math.floor(Math.random()*r.length)];i.fillStyle=v,i.fillRect(m+1,p+4,o-2,6),i.fillStyle=T,i.fillRect(m+2,p,o-4,4)}}sa.width=4e3,sa.height=100,ti||(ti=document.createElement("canvas")),ti.width=4e3,ti.height=100;const d=Ts;ti.getContext("2d");const f=d.createPattern(a,"repeat");d.fillStyle=f,d.fillRect(0,0,sa.width,100);const c=document.createElement("canvas");c.width=400,c.height=400,c.getContext("2d")}let ti=null;const ua=document.createElement("canvas");let Bi=!1;const Fi={currentBannerMessage:null};function El(){Fi.currentBannerMessage=null,Bi=!1}const En=["Perfect Hit streaks earn bonus Coins!","4 Fouls in a row breaks your bat!","Daily Challenges reset at Midnight UTC.","Wait for the ball to reach the plate.","Unlock new bats in the Shop!","The Ace mixes up every pitch type.","High Scores unlock new Stadiums.","Foul balls save you from strikes.","Timing is everything!","Practice makes perfect!","Gold Bats sparkle on Perfect Hits!","I can see my house from here!","This plane runs on AA batteries.","Where is the pilot?","Do a barrel roll!","404: Cloud Not Found","If you read this, look down.","Physics are just suggestions.","Beware of low-flying birds.","Don't look down!","Why is the ball getting larger?","Have you tried turning it off and on?","Nice throw!","I saw a UFO earlier!","Bring back the hot dogs!","Swinging is mandatory.","Keep your eye on the... bird?","My other plane is a convertible.","Don't feed the clouds."];function Ml(){return En[Math.floor(Math.random()*En.length)]}let Ut=null,_i=null,Mn=null;function es(e){let t=e?"night":"day";l.bossModeActive&&!l.isGameOver&&(t="boss");const a=l.settings&&l.settings.theme?l.settings.theme:"classic";if((a==="space"||a==="moon")&&(t="space"),Ut||(Ut=document.createElement("canvas"),_i=Ut.getContext("2d")),Ut.width===Q&&Ut.height===Ee&&Mn===t)return Ut;Ut.width=Q,Ut.height=Ee,Mn=t;const n=_i.createLinearGradient(0,0,0,Ee);return t==="boss"?(n.addColorStop(0,"#1a0a2e"),n.addColorStop(.4,"#000000"),n.addColorStop(1,"#2c0000")):t==="space"?(n.addColorStop(0,"#000000"),n.addColorStop(1,"#0a0a1a")):t==="night"?(n.addColorStop(0,"#000033"),n.addColorStop(1,"#191970")):(n.addColorStop(0,"#4facfe"),n.addColorStop(1,"#00f2fe")),_i.fillStyle=n,_i.fillRect(0,0,Q,Ee),Ut}function Lt(e){Pa.width=Q,Pa.height=Ee,l.lastStaticRenderMode=e;const t=ys,a=Q,i=Ee;if(t.clearRect(0,0,a,i),re.currentTheme.id==="SPACE"){qn(t,a,i,e),Ct.width=a,Ct.height=i;const o=150+qe+32;jn(mo,a,i,a/2,l.bat.pivotY,o,e),Xn(mo,a,i,o);return}if(re.currentTheme.id==="BEACH"){xn(t,a,i,e);return}if(re.currentTheme.id==="HAUNTED"){Fn(t,a,i,e);return}Rl(t,a,i,e)}function wl(e){const t=document.getElementById("start-screen");if(re.currentTheme.id==="BEACH"){l.isGameOver?t&&t.style.display!=="none"&&(t.style.display="none"):t&&t.style.display==="none"&&!l.gameActive&&(t.style.display=""),Cl(b,Q,Ee);return}if(re.currentTheme.id==="HAUNTED"){l.isGameOver?t&&t.style.display!=="none"&&(t.style.display="none"):t&&t.style.display==="none"&&!l.gameActive&&(t.style.display=""),Wn(b,Q,Ee);return}if(re.currentTheme.id==="SPACE"){l.isGameOver?t&&t.style.display!=="none"&&(t.style.display="none"):t&&t.style.display==="none"&&!l.gameActive&&(t.style.display=""),gl(b,Q,Ee);return}else!l.gameActive&&t&&t.style.display==="none"&&(t.style.display="");const a=es(l.isGameOver);b.drawImage(a,0,0);const i=Date.now()/1e3;if(l.isGameOver){b.fillStyle="#FFFFFF";for(let U=0;U<50;U++){const k=(Math.sin(U*123.45)*.5+.5)*Q,B=(Math.cos(U*67.89)*.5+.5)*Ee*.6;Math.random()>.95&&(b.globalAlpha=.5+Math.sin(i*5+U)*.5),b.fillRect(k,B,2,2),b.globalAlpha=1}const P=Q-80,M=60,I=4,L=(U,k,B,q)=>{b.fillStyle="#DDDDDD",b.fillRect(P+U*I,M+k*I,B*I,q*I)},w=(U,k,B="#AAAAAA")=>{b.fillStyle=B,b.fillRect(P+U*I,M+k*I,I,I)};L(4,0,6,1),L(2,1,10,1),L(1,2,12,2),L(0,4,14,6),L(1,10,12,2),L(2,12,10,1),L(4,13,6,1),w(3,4),w(4,4),w(3,5),w(4,5),w(9,8),w(10,8),w(9,9),w(10,9),w(7,2),w(8,2)}else{b.fillStyle="#FFD700",b.fillRect(Q-60,20,30,30),b.fillStyle="#FFA500",b.fillRect(Q-65,25,5,20),b.fillRect(Q-25,25,5,20),b.fillRect(Q-55,15,20,5),b.fillRect(Q-55,50,20,5),b.strokeStyle="#000",b.lineWidth=2;const P=50+Math.sin(i)*10,I=i/20%1*(Q+50)-20;b.beginPath(),b.moveTo(I,P),b.lineTo(I+5,P+3),b.lineTo(I+10,P),b.stroke(),b.beginPath(),b.moveTo(I-15,P+5),b.lineTo(I-10,P+8),b.lineTo(I-5,P+5),b.stroke()}const o=l.isGameOver?"rgba(50, 50, 100, 0.5)":"rgba(255, 255, 255, 0.8)";b.fillStyle=o;const s=i/50%1*(Q+100)-50;b.fillRect(s,40,60,20),b.fillRect(s+10,30,40,10);const d=(i/65+.3)%1*(Q+100)-50;b.fillRect(d,80,50,15),b.fillRect(d+10,70,30,10);const f=180,c=i/35%1,u=Q+500,h=Q+100-c*u,g=(P,M)=>{let L=l.isGameOver?"#CCCCCC":"#FFFFFF",w=l.isGameOver?"#1a3d6a":"#2a4d7a",U=l.isGameOver?"#AAAAAA":"#F0F0F0",k=w;const B=(q,be,oe,j,$)=>{b.fillStyle=$,b.fillRect(P+q*4,M+be*4,oe*4,j*4)};B(18,0,2,1,L),B(19,1,2,4,k),B(18,1,1,4,L),B(17,4,1,1,L),B(4,4,16,2,L),B(3,5,1,1,L),B(1,6,2,1,L),B(1,6,19,3,w),B(3,9,10,1,w),B(2,4,2,1,"#87CEEB"),B(8,7,5,1,U),B(9,8,4,1,U),B(10,9,3,1,U),B(11,10,2,1,U),B(5,10,1,1,"#000"),B(5,9,1,1,"#555"),B(11,11,1,1,"#000")},m=4,p=h+21*m,T=f+3*m,v=20;if(Fi.currentBannerMessage||(Fi.currentBannerMessage=Ml(),Bi=!1),!Bi){const P=` ${Fi.currentBannerMessage} `,M=ua.getContext("2d");M.font='10px "PressStart2PLocal"';const L=M.measureText(P).width+24,w=24;ua.width!==L&&(ua.width=L,ua.height=w),M.clearRect(0,0,L,w),M.fillStyle="#FFF",M.fillRect(0,0,L,w),M.fillStyle="#008000",M.fillRect(0,0,4,w),M.fillStyle="#2a4d7a",M.fillRect(4,0,L-4,4),M.fillRect(4,w-4,L-4,4),M.fillStyle="#2a4d7a",M.textBaseline="middle",M.font='10px "PressStart2PLocal"',M.fillText(P,14,w/2+2),Bi=!0}const y=ua.width,S=ua.height,_=p+v,A=f-2,E=Math.sin(i*2)*3;b.strokeStyle="#1a3d6a",b.lineWidth=2,b.beginPath(),b.moveTo(p,T),b.lineTo(_,A+E),b.stroke(),b.beginPath(),b.moveTo(p,T),b.lineTo(_,A+S+E),b.stroke();for(let P=0;P<y;P+=2){const M=Math.sin(i*2+P*.15)*3,I=Math.min(2,y-P);b.drawImage(ua,P,0,I,S,_+P,A+M,I,S)}g(h,f),e&&l.showFireworks&&e.draw(),Pa.width>0&&b.drawImage(Pa,0,0)}function Na(e=null,t=null,a=null,i=null){const o=t||Q,n=a||Ee,r=(i?di[i]:re.currentTheme)||re.currentTheme,d=o/2,c=l.bat&&l.bat.pivotY?l.bat.pivotY:n*.85;let u;r.id==="SPACE"?u=150+qe+32:u=l.pitcher&&typeof l.pitcher.y<"u"?l.pitcher.y+(l.pitcher.height||32)/2:n*.25;const h=e||(r.id==="SPACE"?mo:Ss);if(e||(r.id==="SPACE"?(Ct.width!==o||Ct.height!==n)&&(Ct.width=o,Ct.height=n):(Sa.width!==o||Sa.height!==n)&&(Sa.width=o,Sa.height=n)),h.save(),r.id==="SPACE"){h.clearRect(0,0,o,n),jn(h,o,n,d,c,u),h.restore(),h.restore();return}if(r.id==="HAUNTED"){h.clearRect(0,0,o,n),Ks(h,o,n);return}r.id!=="BEACH"&&r.id!=="HAUNTED"&&h.clearRect(0,0,o,n);const g=c,m=o*1.4,p=Math.max(16,c-40);if(r.id==="BEACH"||(h.beginPath(),h.ellipse(d,g,Math.max(1,m),Math.max(1,p),0,0,Math.PI*2),h.rect(0,c,o,n-c),h.fillStyle=r.warningTrackColor,h.fill(),h.beginPath(),h.ellipse(d,g,Math.max(1,m-15),Math.max(1,p-15),0,0,Math.PI*2),h.fillStyle=r.grassColor,h.fill(),h.clip()),r.drawGrassPattern(h,o,n),h.restore(),h.save(),r.id==="BEACH"&&r.getShorelineY){const y=r.getShorelineY(n);h.beginPath(),h.rect(0,y,o,n-y),h.clip()}r.id!=="BEACH"&&(h.beginPath(),h.ellipse(d,g,Math.max(1,m-15),Math.max(1,p-15),0,0,Math.PI*2),h.clip()),h.fillStyle=r.dirtColor;const T=25;h.beginPath(),h.moveTo(d,c),h.lineTo(o,c-(o-d)*1.5),h.lineTo(o,c-(o-d)*1.5+T),h.lineTo(d+T,c+T),h.fill(),h.beginPath(),h.moveTo(d,c),h.lineTo(0,c-d*1.5),h.lineTo(0,c-d*1.5+T),h.lineTo(d-T,c+T),h.fill(),h.strokeStyle=r.lineColor,h.lineWidth=4,r.id==="BEACH"?bl(h,o,n,d,c):(h.beginPath(),h.moveTo(d,c),h.lineTo(o,c-(o-d)*1.5),h.moveTo(d,c),h.lineTo(0,c-d*1.5),h.stroke()),h.fillStyle=r.dirtColor,h.beginPath(),h.arc(d,c,70,0,Math.PI*2),h.fill();const v=l.pitcher&&typeof l.pitcher.y<"u"?l.pitcher.y+(l.pitcher.height||64)/2+10:n*.25+42;if(h.beginPath(),h.arc(d,v,45,0,Math.PI*2),h.fillStyle=r.moundColor,h.fill(),h.beginPath(),h.arc(d,v,35,0,Math.PI*2),h.fillStyle=r.dirtColor,h.fill(),r.id==="BEACH"&&(h.fillStyle="rgba(0,0,0,0.08)",h.beginPath(),h.arc(d,c,78,0,Math.PI*2),h.fill(),h.beginPath(),h.arc(d,v,52,0,Math.PI*2),h.fill()),r.id==="BEACH"&&An(h,o,n),h.strokeStyle="#ffffff",h.lineWidth=3,h.strokeRect(d-70,c-30,30,60),h.strokeRect(d+40,c-30,30,60),h.fillStyle="#ffffff",h.beginPath(),h.moveTo(d,c+10),h.lineTo(d+10,c),h.lineTo(d+10,c-10),h.lineTo(d-10,c-10),h.lineTo(d-10,c),h.fill(),h.restore(),r.id!=="BEACH"){const y=_l(h);h.save(),h.globalCompositeOperation="overlay",h.globalAlpha=.15,h.fillStyle=y,h.fillRect(0,0,o,n),h.restore()}r.id==="BEACH"&&An(h,o,n)}let Ii=null;function _l(e){if(Ii)return Ii;const t=256,a=document.createElement("canvas");a.width=t,a.height=t;const i=a.getContext("2d"),o=i.createImageData(t,t),n=o.data;for(let s=0;s<n.length;s+=4){const r=Math.random()*255;n[s]=r,n[s+1]=r,n[s+2]=r,n[s+3]=255}return i.putImageData(o,0,0),Ii=e.createPattern(a,"repeat"),Ii}const ho={};function Il(e){if(ho[e])return ho[e];const t=400,a=document.createElement("canvas");a.width=t,a.height=t;const i=a.getContext("2d"),o=t/Ee;i.scale(o,o);const n=(Ee-Q)/2;return i.translate(n,0),Na(i,Q,Ee,e),ho[e]=a,a}let uo=null;function kl(){if(uo)return uo;const e=200,t=800,a=document.createElement("canvas");a.width=e,a.height=t;const i=a.getContext("2d"),o=i.createLinearGradient(0,0,0,t);o.addColorStop(0,"rgba(255, 255, 255, 0.8)"),o.addColorStop(1,"rgba(255, 255, 255, 0)"),i.save(),i.fillStyle=o,i.beginPath(),i.moveTo(e*.45,0),i.lineTo(e*.55,0),i.lineTo(e,t),i.lineTo(0,t),i.closePath(),i.fill();const n=i.createLinearGradient(0,0,0,t);return n.addColorStop(0,"rgba(200, 230, 255, 0.1)"),n.addColorStop(1,"rgba(200, 230, 255, 0)"),i.fillStyle=n,i.fillRect(0,0,e,t),i.restore(),uo=a,a}kl();let wn;function ts(){const e=Q;if(window.innerWidth===0||window.innerHeight===0)return;const t=window.innerWidth/window.innerHeight,a=600/800;let i,o;t>a?(o=800,i=o*t):(i=600,o=i/t),vs(i,o),Dt.width=i,Dt.height=o,b.imageSmoothingEnabled=!1,Dt.style.width=`${window.innerWidth}px`,Dt.style.height=`${window.innerHeight}px`;const n=qe;Ee>No?qo((Ee-No)/2):qo(0);const s=qe-n,r=e/2,f=Q/2-r;l.pitcher&&(l.pitcher.x=Q/2-l.pitcher.width/2,l.pitcher.y=150+qe),l.bat&&(l.bat.pivotX=Q/2-40,l.bat.pivotY=bs+qe),l.balls&&l.balls.forEach(m=>{m.x+=f,m.startY+=s,m.y+=s,m.startX+=f,m.prevX+=f,m.prevY+=s}),Lt(l.lastStaticRenderMode||!1),Na(null,i,o);const g=110*(window.innerHeight/o)+20;Ve&&Ve.style.setProperty("--title-bottom-offset",`${g}px`),clearTimeout(wn),wn=setTimeout(()=>{$a(Q,Ee)},200)}function Dl(){if(re.currentTheme.id!=="SPACE"&&re.currentTheme.id!=="HAUNTED"){const e=es(l.isGameOver);b.drawImage(e,0,0)}if(Pa.width>0&&b.drawImage(Pa,0,0),re.currentTheme.id==="CLASSIC"&&(b.fillStyle="#1a1a1a",b.fillRect(0,0,Q,100),sa.width>0)){const e=(sa.width-Q)/2,t=Math.max(0,e),a=e<0?-e:0,i=Math.min(Q,sa.width),o=100;b.drawImage(sa,Math.floor(t),0,Math.floor(i),o,Math.floor(a),0,Math.floor(i),o);const n=f=>{const c=Math.sin(f)*1e4;return c-Math.floor(c)},s=200,r=On,d=Gn;b.save();for(let f=0;f<s;f++){const c=f*1337,u=n(c),h=n(c+1),g=a+Math.floor(u*i),m=Math.floor(h*100),p=r[Math.floor(n(c+2)*r.length)],T=d[Math.floor(n(c+3)*d.length)];let v=0,y=!1;if(V.consecutivePerfectHits>=1&&l.perfectHitTimer>0){const S=Math.floor(n(c+4)*2e3),_=800+Math.floor(n(c+5)*700);(Date.now()+S)%_<300&&(v=-4,y=!0)}b.fillStyle=T,b.fillRect(g,m+4+v,8,6),b.fillStyle=p,b.fillRect(g+1,m+v,6,4),y&&(b.fillStyle=p,b.fillRect(g-1,m+2+v,2,4),b.fillRect(g+7,m+2+v,2,4))}b.restore()}if(re.currentTheme.id==="HAUNTED"&&Bs(b,Q,Ee),re.currentTheme.id==="BEACH"&&Po(b,Q,Ee),re.currentTheme.id==="SPACE"&&Ct.width>0){const e=150+qe+32;b.drawImage(Ct,0,0),pl(b,Ct.width,Ct.height,e)}if(Sa.width>0&&re.currentTheme.id!=="SPACE"){if(b.save(),re.currentTheme.id,re.currentTheme.id==="BEACH"&&re.currentTheme.getShorelineY){const e=b.canvas.height,t=re.currentTheme.getShorelineY(e);b.beginPath(),b.rect(0,t,b.canvas.width,e-t),b.clip()}b.drawImage(Sa,0,0),b.restore(),re.currentTheme.id==="BEACH"&&Tl(b,Q,Ee)}if(re.currentTheme.id==="HAUNTED"&&Ws(b,Q,Ee),l.bossModeActive){const e=l.pitcher.state;(e===Fe.WALK_ON||e===Fe.WALK_OFF)&&(b.fillStyle="rgba(0, 0, 0, 0.6)",b.fillRect(0,0,Q,Ee))}if(l.aceFlashStartTime){const e=performance.now()-l.aceFlashStartTime;if(e<1e3){const t=e/1e3,a=1-Math.pow(1-t,3),i=Q/2,o=l.pitcher.y+(l.pitcher.height||64)/2,s=Q*1.5*a,r=b.createRadialGradient(i,o,0,i,o,s);r.addColorStop(0,`rgba(255, 255, 255, ${.9*(1-t)})`),r.addColorStop(.2,`rgba(255, 215, 0, ${.8*(1-t)})`),r.addColorStop(1,"rgba(255, 215, 0, 0)"),b.fillStyle=r,b.fillRect(0,0,Q,Ee),b.strokeStyle=`rgba(255, 255, 255, ${.8*(1-t)})`,b.lineWidth=15*(1-t),b.beginPath(),b.arc(i,o,s*.8,0,Math.PI*2),b.stroke(),b.lineWidth=5*(1-t),b.stroke()}}if(l.showTutorial&&Yn(),l.monitorEntranceStartTime){const e=performance.now()-l.monitorEntranceStartTime;e<1500?Ll(b,e/1500):l.monitorEntranceStartTime=0}}function Ll(e,t){const a=Q,i=Ee,o=Math.floor(a/20),n=1-t;e.save(),e.font="bold 20px monospace",e.textAlign="center";for(let s=0;s<o;s++){const r=s*20+10,d=s*731,f=Math.floor(i/20),c=t*i*2;for(let u=0;u<f;u++){const h=(u*20+c)%i,g=Math.sin(u+d+t*10)>0?"1":"0";e.fillStyle=`rgba(0, 255, 0, ${n*(.3+.7*Math.random())})`,Math.random()>.95&&(e.fillStyle=`rgba(200, 255, 200, ${n})`),e.fillText(g,r,h)}}e.restore()}function Ol(){re.currentTheme.id==="HAUNTED"&&(l.bat&&(l.bat.pivotX,l.bat.pivotY),zn(b,Q,Ee))}const di={CLASSIC:{id:"CLASSIC",name:"Classic Field",grassColor:"#00a800",dirtColor:"#654321",lineColor:"#ffffff",warningTrackColor:"#a0522d",moundColor:"#503010",stripeColor:"rgba(0, 0, 0, 0.1)",drawGrassPattern(e,t,a){const o=Math.ceil(t/40);for(let n=0;n<o;n++)n%2!==0&&(e.fillStyle=this.stripeColor,e.fillRect(n*40,0,40,a))}},SPACE:{id:"SPACE",name:"Space Station",grassColor:"#1e272e",dirtColor:"#bdc3c7",lineColor:"#f39c12",warningTrackColor:"#2c3e50",moundColor:"#95a5a6",stripeColor:"rgba(255, 255, 255, 0.05)",pitcherAccessories:{spaceHelmet:!0},pitcherAccessories:{spaceHelmet:!0},walkOffType:"FLY_AWAY",warmup(e,t){Kn(e,t)},drawGrassPattern(e,t,a){const o=30*Math.sqrt(3),s=60*.75;e.lineWidth=1,e.strokeStyle="#2f3640";const r=Math.ceil(a/o)+1,d=Math.ceil(t/s)+1;for(let c=0;c<r;c++)for(let u=0;u<d;u++){const h=u*s,g=c*o+(u%2===0?0:o/2);e.beginPath();for(let m=0;m<6;m++){const p=2*Math.PI/6*m,T=h+30*Math.cos(p),v=g+30*Math.sin(p);m===0?e.moveTo(T,v):e.lineTo(T,v)}e.closePath(),Math.random()>.95?(e.fillStyle="rgba(52, 152, 219, 0.1)",e.fill()):Math.random()>.98&&(e.fillStyle="rgba(231, 76, 60, 0.1)",e.fill()),e.stroke(),e.fillStyle="#353b48",e.fillRect(h-1,g-1,2,2)}const f=e.createRadialGradient(t/2,a/2,a/4,t/2,a/2,a);f.addColorStop(0,"rgba(0,0,0,0)"),f.addColorStop(1,"rgba(0,0,0,0.4)"),e.fillStyle=f,e.fillRect(0,0,t,a)}},BEACH:{id:"BEACH",name:"Sunny Beach",grassColor:"#f4e4bc",dirtColor:"#e0cda7",lineColor:"#ffffff",warningTrackColor:"#90d4e9",moundColor:"#d6c096",stripeColor:"rgba(0, 0, 0, 0.05)",pitcherAccessories:{sunglasses:!0},walkOffType:"SWIM",warmup(e,t){if(Pl(),!this.sandPattern&&typeof document<"u"){const a=document.createElement("canvas"),i=128;a.width=i,a.height=i;const o=a.getContext("2d");o.fillStyle="#f4e4bc",o.fillRect(0,0,i,i);const n=o.getImageData(0,0,i,i),s=n.data;for(let r=0;r<s.length;r+=4){const d=(Math.random()-.5)*20;s[r]=Math.max(0,Math.min(255,s[r]+d)),s[r+1]=Math.max(0,Math.min(255,s[r+1]+d)),s[r+2]=Math.max(0,Math.min(255,s[r+2]+d))}o.putImageData(n,0,0),o.fillStyle="rgba(255, 255, 255, 0.4)";for(let r=0;r<40;r++){const d=Math.random()*i,f=Math.random()*i;o.fillRect(d,f,1,1)}}},getShorelineY(e){const t=l.pitcher&&typeof l.pitcher.y<"u"?l.pitcher.y+32:e*.25;return Math.max(e*.1+20,t-120)},drawGrassPattern(e,t,a){if(!this.sandPattern){const s=document.createElement("canvas"),r=128;s.width=r,s.height=r;const d=s.getContext("2d");d.fillStyle="#f4e4bc",d.fillRect(0,0,r,r);const f=d.getImageData(0,0,r,r),c=f.data;for(let u=0;u<c.length;u+=4){const h=(Math.random()-.5)*20;c[u]=Math.max(0,Math.min(255,c[u]+h)),c[u+1]=Math.max(0,Math.min(255,c[u+1]+h)),c[u+2]=Math.max(0,Math.min(255,c[u+2]+h))}d.putImageData(f,0,0),d.fillStyle="rgba(255, 255, 255, 0.4)";for(let u=0;u<40;u++){const h=Math.random()*r,g=Math.random()*r;d.fillRect(h,g,1,1)}this.sandPattern=e.createPattern(s,"repeat")}const i=this.getShorelineY(a);e.fillStyle=this.sandPattern,e.fillRect(0,i,t,a-i);const o=240;for(let s=i;s<a;s+=o){const r=e.createLinearGradient(0,s,0,s+o);r.addColorStop(0,"rgba(100, 80, 50, 0.15)"),r.addColorStop(.4,"rgba(100, 80, 50, 0)"),r.addColorStop(1,"rgba(255, 255, 255, 0.2)"),e.fillStyle=r,e.beginPath(),e.moveTo(0,s);for(let d=0;d<=t;d+=50){const f=s+Math.sin(d*.003+s)*20;e.lineTo(d,f)}e.lineTo(t,s+o),e.lineTo(0,s+o),e.fill()}const n=e.createRadialGradient(t/2,a*.7,50,t/2,a*.7,t*.6);n.addColorStop(0,"rgba(160, 140, 110, 0.4)"),n.addColorStop(1,"rgba(160, 140, 110, 0)"),e.fillStyle=n,e.fillRect(0,i,t,a-i)}},HAUNTED:{id:"HAUNTED",name:"Haunted Mansion",grassColor:"#1a261a",dirtColor:"#2d3436",lineColor:"#dfe6e9",warningTrackColor:"#000000",moundColor:"#4b4b4b",stripeColor:"rgba(0,0,0,0.3)",pitcherAccessories:{halloweenMask:!0},walkOffType:"GHOST",warmup(e,t){$a(e,t)},drawGrassPattern(e,t,a){}}},re={currentTheme:di.CLASSIC,setTheme(e){di[e]&&(this.currentTheme=di[e],typeof document<"u"&&document.body&&document.body.setAttribute("data-theme",e),Qs())},init(){typeof document<"u"&&document.body&&this.currentTheme&&document.body.setAttribute("data-theme",this.currentTheme.id)}};re.init();const Gl=Object.freeze(Object.defineProperty({__proto__:null,THEMES:di,themeManager:re},Symbol.toStringTag,{value:"Module"})),ai={Heavy:"HEAVY",Medium:"MEDIUM",Light:"LIGHT"};class Bl{constructor(){this.Haptics=null,this.initialized=!1,this.patterns={light:ai.Light,medium:ai.Medium,heavy:ai.Heavy,perfect:ai.Heavy,good:15,foul:15,failure:[60,50,60,50,100],unlock:[50,50,100,50,150],purchase:[60,40,60,40,100],locked:[30,50,30],equipped:[20,20,20],footstep:25,bossStep:ai.Heavy,bossEntrance:[100,50,100,50,200,50,400]},this.init()}async init(){if(typeof window.Capacitor<"u")try{const{Haptics:t}=await Be(async()=>{const{Haptics:a}=await import("./index-Qs8-2f79.js");return{Haptics:a}},__vite__mapDeps([0,1]),import.meta.url);this.Haptics=t,this.initialized=!0}catch{console.log("Haptics native plugin not found.")}}async vibrate(t){if(!l.settings?.vibration)return;const a=this.patterns[t];try{if(this.initialized&&this.Haptics)typeof a=="string"?await this.Haptics.impact({style:a}):typeof a=="number"?await this.Haptics.vibrate({duration:a}):Array.isArray(a)&&this.vibrateSequence(a);else throw new Error("Native Haptics unavailable")}catch{if(navigator.vibrate){if(Array.isArray(a)||typeof a=="number")navigator.vibrate(a);else if(typeof a=="string"){const n={LIGHT:10,MEDIUM:25,HEAVY:50}[a]||25;navigator.vibrate(n)}}}}async vibrateSequence(t){for(let a=0;a<t.length;a++){const i=t[a];a%2===0&&i>0&&this.Haptics&&await this.Haptics.vibrate({duration:i}),await new Promise(o=>setTimeout(o,i))}}vibrateCustom(t){l.settings?.vibration&&(this.initialized&&this.Haptics?typeof t=="number"?this.Haptics.vibrate({duration:t}).catch(()=>{}):Array.isArray(t)&&this.vibrateSequence(t):navigator.vibrate&&navigator.vibrate(t))}}const Ie=new Bl;class Fl{constructor(){this.isOpen=!1,this.init()}closeAndExit(){this.isOpen=!1,Qt&&(Qt.style.display="none"),D.playSettingsClose(),is()}init(){this.loadSettings(),Xe.addEventListener("click",()=>this.openSettings()),ps.addEventListener("click",()=>this.closeSettings()),bt.addEventListener("click",()=>{if(l.isDailyChallenge){Ie.vibrate("medium"),D.playError();return}Ie.vibrate("medium"),this.restartGame()}),Qt&&(Qt.onclick=t=>{t.stopPropagation(),t.target===Qt&&this.closeSettings()}),ht&&ht.addEventListener("click",()=>{if(l.isDailyChallenge&&!l.isGameOver){Ie.vibrate("medium"),D.playError();return}if(l.isGameOver){this.closeAndExit();return}const t=document.getElementById("confirmation-modal"),a=document.getElementById("confirm-ok-btn"),i=document.getElementById("confirm-cancel-btn");if(t&&a&&i){const o=()=>{Ie.vibrate("light"),t.style.display="none",D.playSettingsClose()};a.onclick=()=>{Ie.vibrate("medium"),t.style.display="none",this.closeAndExit()},i.onclick=o,t.onclick=n=>{n.stopPropagation(),n.target===t&&o()},t.style.display="flex",D.playSettingsOpen()}else this.closeAndExit()}),Ho.addEventListener("change",t=>this.updateSetting("swingOnRelease",t.target.checked)),Uo.addEventListener("change",t=>this.updateSetting("vibration",t.target.checked)),Vo.addEventListener("change",t=>this.updateSetting("muteMusic",t.target.checked)),zo.addEventListener("change",t=>this.updateSetting("muteSound",t.target.checked)),Wo.addEventListener("change",t=>this.updateSetting("colorBlindMode",t.target.checked)),$o.addEventListener("change",t=>this.updateSetting("noFlash",t.target.checked)),document.addEventListener("keydown",t=>{(t.key==="r"||t.key==="R")&&(this.isOpen&&l.gameActive&&!l.isDailyChallenge?(Ie.vibrate("medium"),this.restartGame()):this.isOpen&&l.gameActive&&l.isDailyChallenge&&(Ie.vibrate("medium"),D.playError()))})}loadSettings(){const t=localStorage.getItem("baseball_settings");if(t)try{const a=JSON.parse(t);l.settings={...l.settings,...a}}catch(a){console.error("Failed to parse settings",a)}this.syncUI(),this.applySideEffects()}syncUI(){l.settings&&(Ho.checked=!!l.settings.swingOnRelease,Uo.checked=!!l.settings.vibration,Vo.checked=!!l.settings.muteMusic,zo.checked=!!l.settings.muteSound,Wo.checked=!!l.settings.colorBlindMode,$o.checked=!!l.settings.noFlash)}updateSetting(t,a){l.settings||(l.settings={}),l.settings[t]=a,this.saveSettings(),this.applySideEffects(t),D.playSettingsToggle()}saveSettings(){localStorage.setItem("baseball_settings",JSON.stringify(l.settings))}applySideEffects(t){if(t==="muteMusic"||!t)l.settings.muteMusic?D.stopTheme():!l.gameActive&&l.isGameOver&&(re.currentTheme&&re.currentTheme.id==="HAUNTED"?D.playHauntedTheme():D.playTheme());else if(t==="noFlash"&&l.isGameOver){const a=document.getElementById("restart-msg");a&&(a.style.animation=l.settings.noFlash?"none":"blink 1s infinite")}}openSettings(){this.isOpen=!0,Qt.style.display="flex",D.init().then(()=>{D.playSettingsOpen()}),l.gameActive?(bt.style.display="block",l.isDailyChallenge?(bt.classList.add("btn-blocked"),bt.style.opacity="",bt.style.filter="",bt.style.textDecoration=""):(bt.classList.remove("btn-blocked"),bt.style.opacity="1",bt.style.filter="none",bt.style.textDecoration="none")):bt.style.display="none",ht&&(!l.gameActive&&!l.isGameOver?ht.style.display="none":(ht.style.display="block",l.isDailyChallenge&&!l.isGameOver?(ht.classList.add("btn-blocked"),ht.style.opacity="",ht.style.filter="",ht.style.textDecoration=""):(ht.classList.remove("btn-blocked"),ht.style.opacity="1",ht.style.filter="none",ht.style.textDecoration="none")))}closeSettings(){this.isOpen=!1,Qt.style.display="none",Ra(!0),D.playSettingsClose()}restartGame(){this.closeSettings(),la(l.isDailyChallenge,!1,"menu")}}const ea=new Fl;class Hl{constructor(){this.boundHandleKeyDown=this.handleKeyDown.bind(this),this.boundHandleTouchStart=this.handleTouchStart.bind(this),this.boundHandleTouchEnd=this.handleTouchEnd.bind(this),this.boundHandleMouseDown=this.handleMouseDown.bind(this),this.boundHandleMouseUp=this.handleMouseUp.bind(this),this.boundHandleClick=this.handleClick.bind(this),this.lastPhysicalInputTime=0,this.touchStartX=0,this.touchStartY=0}markInput(){this.lastPhysicalInputTime=performance.now()}init(){window.addEventListener("keydown",t=>{this.markInput(),this.boundHandleKeyDown(t)}),window.addEventListener("keyup",t=>{this.markInput(),this.handleKeyUp(t)}),window.addEventListener("touchstart",t=>{this.markInput(),this.boundHandleTouchStart(t)},{passive:!1}),window.addEventListener("touchend",t=>{this.markInput(),this.boundHandleTouchEnd(t)},{passive:!1}),window.addEventListener("mousedown",t=>{this.markInput(),this.boundHandleMouseDown(t)}),window.addEventListener("mouseup",t=>{this.markInput(),this.boundHandleMouseUp(t)}),De&&De.addEventListener("click",t=>{t.stopPropagation(),Wa()}),window.addEventListener("contextmenu",t=>t.preventDefault()),window.addEventListener("pointerdown",t=>{t.target.closest('button, .clickable, #settings-btn, #pause-btn, #unlockables-btn, #leaderboard-btn, .close-btn, input[type="checkbox"], #daily-prev-btn, #daily-next-btn, #message-overlay, .nav-arrow')&&Ie.vibrate("light")})}handleKeyDown(t){if(!l.transitioning&&t.isTrusted&&!t.target.matches("input, textarea")){if(t.code==="Space"){if(l.isLoading||l.showTutorial)return;l.gameActive?!l.settings?.swingOnRelease&&!l.isPaused&&ya():Ve.style.display!=="none"&&D.init().then(()=>la(l.isDailyChallenge,!1,"game_over"))}if(t.code==="Escape"){if(ea.isOpen){ea.closeSettings();return}De.style.pointerEvents!=="none"&&Wa()}if(t.code==="KeyP"){if(ea.isOpen)return;De.style.pointerEvents!=="none"&&Wa()}t.code==="KeyS"&&(ea.isOpen?ea.closeSettings():(l.isPaused||!l.gameActive)&&ea.openSettings()),t.code==="KeyD"&&Si&&(Si.style.display==="none"?Si.style.display="block":Si.style.display="none")}}isUIClick(t){return t.closest("#pause-btn")||t.closest("#settings-btn")||t.closest("#settings-modal")||t.closest("#unlockables-btn")||t.closest("#unlockables-modal")||t.closest("#leaderboard-btn")||t.closest("#leaderboard-modal")||t.closest("#daily-retry-modal")||t.closest("#security-modal")||t.closest("#confirmation-modal")||t.closest("#feedback-btn")||t.closest("#coin-container")}handleTouchStart(t){if(l.transitioning||!t.isTrusted||this.isUIClick(t.target)||l.isLoading||(t.preventDefault(),t.touches&&t.touches.length>0&&(this.touchStartX=t.touches[0].clientX,this.touchStartY=t.touches[0].clientY),!l.gameActive)||l.showTutorial)return;!l.settings?.swingOnRelease&&!l.isPaused&&ya()}handleTouchEnd(t){if(!l.transitioning&&t.isTrusted&&!this.isUIClick(t.target)){if(t.preventDefault(),!l.gameActive){const a=t.changedTouches[0].clientX,i=t.changedTouches[0].clientY;Math.hypot(a-this.touchStartX,i-this.touchStartY)<30&&D.init().then(()=>la(l.isDailyChallenge,!1,"game_over"));return}l.gameActive&&!l.showTutorial&&!l.isPaused&&l.settings?.swingOnRelease&&ya()}}handleMouseDown(t){if(l.transitioning||!t.isTrusted||this.isUIClick(t.target)||l.isLoading)return;if(!l.gameActive){D.init().then(()=>la(l.isDailyChallenge,!1,"game_over"));return}if(l.showTutorial)return;!l.settings?.swingOnRelease&&!l.isPaused&&ya()}handleMouseUp(t){l.transitioning||t.isTrusted&&(this.isUIClick(t.target)||l.gameActive&&!l.showTutorial&&!l.isPaused&&l.settings?.swingOnRelease&&ya())}handleKeyUp(t){l.transitioning||t.code==="Space"&&l.gameActive&&!l.showTutorial&&!l.isPaused&&l.settings?.swingOnRelease&&ya()}handleClick(t){}}const Hi=new Hl;class Ul{#e=Math.floor(Math.random()*16777215);#s=0;#a=0;#c=0;#d=0;#i=0;#o=0;#y=0;#f=null;#u=null;#n=!1;#t=0;#l=0;#g=!1;#p=null;#m=null;_lastSyncTimestamp=0;constructor(){Y.migrate("baseball_coins"),Y.migrate("baseball_local_delta"),Y.migrate("baseball_local_perfects_delta");const t=We.getDailySeed();Y.migrate(`baseball_daily_score_${t}`),this.#s=0^this.#e,this.#i=0^this.#e,this.#o=0^this.#e;const a=parseInt(Y.getItem("baseball_high_score_s1","0"))||0;this.#c=a^this.#e;const i=parseInt(Y.getItem(`baseball_daily_score_${t}`,"0"))||0;this.#d=i^this.#e;const o=parseInt(Y.getItem("baseball_coins","0"))||0;this.#a=o^this.#e;const n=parseInt(Y.getItem("baseball_local_delta")||"0");this.#t=n;const s=parseInt(Y.getItem("baseball_local_perfects_delta")||"0");this.#l=s;const r=Y.getItem("baseball_last_synced_balance");if(r!==null&&n===0){const d=parseInt(r)||0;this.#t=Math.max(0,o-d),this.#h(),Y.removeItem("baseball_last_synced_balance"),console.log(`[ScoreManager] Migrated from lastSynced (${d}) to localDelta (${this.#t})`)}this.startCoins=this.coins,this.initialHighScore=this.highScore,this.initialDailyHigh=this.dailyHighScore,this.fetchServerBalance()}async startSession(){return this.#m=null,this.#p=(async()=>{try{console.log("[ScoreManager] Session Tracking Disabled (Optimization)")}catch{console.warn("[ScoreManager] Failed to start server session (Offline?)")}return null})(),this.#p}get score(){return this.#s^this.#e}get coins(){return this.#a^this.#e}get strikes(){return this.#i^this.#e}get consecutivePerfectHits(){return this.#o^this.#e}get highScore(){return this.#c^this.#e}set highScore(t){this.#c=t^this.#e}get dailyHighScore(){return this.#d^this.#e}set dailyHighScore(t){this.#d=t^this.#e}reset(){this.#s=0^this.#e,this.#i=0^this.#e,this.#o=0^this.#e,this.startCoins=this.coins,this.#n=!1,this.sessionPerfects=0,this.initialHighScore=this.highScore;const t=We.getDailySeed();Y.migrate(`baseball_daily_score_${t}`);const a=parseInt(Y.getItem(`baseball_daily_score_${t}`,"0"))||0;this.dailyHighScore=a,this.initialDailyHigh=a,this.updateScoreDisplay(),this.updateCoinDisplay(),Ft&&(Ft.style.display="none"),pa&&(pa.style.display="none")}get isTainted(){return this.#n}get localDelta(){return this.#t}#h(){Y.setItem("baseball_local_delta",this.#t.toString()),Y.setItem("baseball_local_perfects_delta",this.#l.toString())}#T(){this.#t=0,this.#l=0,this.#h()}#r(){const t=this.#s^this.#e,a=this.#a^this.#e,i=this.#c^this.#e,o=this.#d^this.#e,n=this.#i^this.#e,s=this.#o^this.#e;this.#e=Math.floor(Math.random()*16777215),this.#s=t^this.#e,this.#a=a^this.#e,this.#c=i^this.#e,this.#d=o^this.#e,this.#i=n^this.#e,this.#o=s^this.#e}registerHit(t){if(!l.gameActive&&!l.isGameOver)return;if(!l.gameActive){console.warn("Iron Umpire: Hit rejected (Game Not Active)");return}if(Hi&&Hi.lastPhysicalInputTime){const o=performance.now()-Hi.lastPhysicalInputTime;if(o>2e3){console.warn(`Iron Umpire: Hit rejected (No recent input). Delta: ${o.toFixed(2)}ms`),o>5e3&&(this.isTainted=!0);return}}const a=performance.now();if(a-this.#y<100)return;this.#y=a;let i=0;if(t==="PERFECT"){let o=this.#o^this.#e;o++,this.#o=o^this.#e,i=1,o===2&&(i=2),o>=3&&(i=3),this.showPointsPopup(i,!0,l.settings?.noFlash),this.sessionPerfects||(this.sessionPerfects=0),this.sessionPerfects++,this.#l++,this.#h()}else t==="GOOD"&&(i=1,this.#o=0^this.#e,this.showPointsPopup(1,!1,l.settings?.noFlash));if(i>0){let o=this.#s^this.#e;o+=i,this.#s=o^this.#e,this.addCoins(i)}else this.#r();this.updateScoreDisplay(),this.updateCoinDisplay(),this.checkHighScore()}registerStrike(){let t=this.#i^this.#e;t++,this.#i=t^this.#e,this.#r()}resetStrikes(){this.#i=0^this.#e,this.#r()}setStrikes(t){this.#i=t^this.#e,this.#r()}setMultiplier(t){this.#o=t^this.#e,this.#r()}registerFoul(){this.#o=0^this.#e,this.#r()}async deductCoins(t,a="generic_spend"){if(this.coins<t)return console.warn(`[ScoreManager] Deduct Failed: Insufficient funds (Local=${this.coins} < ${t})`),!1;const{supabaseService:i}=await Be(async()=>{const{supabaseService:r}=await Promise.resolve().then(()=>va);return{supabaseService:r}},void 0,import.meta.url),{showSecurityModal:o}=await Be(async()=>{const{showSecurityModal:r}=await Promise.resolve().then(()=>Zl);return{showSecurityModal:r}},void 0,import.meta.url),n=i.getClient();if(!n)return this.deductCoinsLocal(t);const{data:{user:s}}=await n.auth.getUser();if(!s)return this.deductCoinsLocal(t);try{const{data:r,error:d}=await n.rpc("deduct_coins",{p_amount:t,p_reason:a});return d?(console.warn("[ScoreManager] Deduct Coins Failed:",d.message),console.warn("[ScoreManager] Falling back to local deduction..."),this.deductCoinsLocal(t)):r&&r.success?(console.log(`[ScoreManager] Deducted ${t} coins. New Bal: ${r.new_balance}`),this.setAuthoritativeBalance(r.new_balance),!0):r?.error==="Insufficient funds"?(console.warn("[ScoreManager] Server says insufficient funds. Checking local..."),this.deductCoinsLocal(t)):!1}catch(r){return console.error("[ScoreManager] Deduct RPC Error",r),console.warn("[ScoreManager] Falling back to local deduction due to error..."),this.deductCoinsLocal(t)}}addCoins(t){if(!t||t<=0)return;let a=this.#a^this.#e;a+=t,this.#a=a^this.#e,this.#t+=t,this.#h(),console.log(`[ScoreManager] addCoins(+${t}) -> Balance: ${a}, Delta: ${this.#t}`),this.updateCoinDisplay(),this.#r(),this.saveCoins(!0)}deductCoinsLocal(t){let a=this.#a^this.#e;return a>=t?(a-=t,this.#a=a^this.#e,this.updateCoinDisplay(),this.#r(),this.saveCoins(!0),console.log(`[ScoreManager] Local Deduction: -${t}. Balance: ${a}`),!0):(console.warn(`[ScoreManager] Local Deduction Failed: Insufficient Funds (${a} < ${t})`),!1)}updateScoreDisplay(){He&&(He.innerText=`Score: ${this.score}`)}updateCoinDisplay(){ot&&(ot.innerText=`${this.coins}`)}saveCoins(t=!1){if(l.coins=this.coins,this.#f&&clearTimeout(this.#f),t){Y.setItem("baseball_coins",this.coins),this.#f=null;return}this.#f=setTimeout(()=>{Y.setItem("baseball_coins",this.coins),this.#f=null},2e3)}checkHighScore(){if(l.isDailyChallenge){if(this.score>this.dailyHighScore){if(this.dailyHighScore=this.score,!this.#n){const a=`baseball_daily_score_${We.getDailySeed()}`;Y.setItem(a,this.dailyHighScore)}return!0}return!1}return this.score>this.highScore?(this.score>this.initialHighScore&&this.score>1,this.highScore=this.score,l.highScore=this.highScore,this.#n||(this.#u&&clearTimeout(this.#u),this.#u=setTimeout(()=>{Y.setItem("baseball_high_score_s1",this.highScore),this.#u=null},2e3)),re.currentTheme&&re.currentTheme.id!=="SPACE"&&Lt(!1),!0):!1}showPointsPopup(t,a=!1,i=!1){requestAnimationFrame(()=>{t>1&&Ft&&(Ft.innerText=`+${t}`,Ft.style.display="block",i?Ft.classList.remove("perfect-hit"):Ft.classList.add("perfect-hit"),setTimeout(()=>{Ft.style.display="none",Ft.classList.remove("perfect-hit")},1e3))})}animateCoinGain(t){const a=this.coins-(this.startCoins||0);if(a>0&&pa&&ot){pa.innerText=`+${a}`,pa.style.display="block";const i=this.startCoins||0;let o=i;const n=this.coins,s=1500,r=performance.now(),d=f=>{const c=f-r,u=Math.min(c/s,1),h=1-Math.pow(1-u,3);o=Math.floor(i+a*h),ot.innerText=`${o}`,u<1?requestAnimationFrame(d):(ot.innerText=`${n}`,setTimeout(()=>{pa.style.display="none",t&&t()},1e3))};requestAnimationFrame(d)}else t&&t()}hasNewRecord(){return this.highScore>this.initialHighScore&&this.score===this.highScore}async updateDailyStreak(){if(!l.isDailyChallenge||this.#n)return;const{TimeAnchorManager:t}=await Be(async()=>{const{TimeAnchorManager:h}=await Promise.resolve().then(()=>_n);return{TimeAnchorManager:h}},void 0,import.meta.url),i=await t.getTrustedTime()||new Date,o=We.getDailySeed(i),n=Y.getItem("baseball_daily_streak_updated_date");if(n===o){console.log(`Daily Challenge: Streak already updated for ${o}. Current: ${l.dailyStreak}`);return}const s=Date.UTC(i.getUTCFullYear(),i.getUTCMonth(),i.getUTCDate()-1),r=new Date(s),d=r.getUTCFullYear(),f=String(r.getUTCMonth()+1).padStart(2,"0"),c=String(r.getUTCDate()).padStart(2,"0"),u=`${d}-${f}-${c}`;n===u?l.dailyStreak++:l.dailyStreak=1,l.lastDailyDate=o,Y.setItem("baseball_daily_streak",l.dailyStreak),Y.setItem("baseball_last_daily_date",l.lastDailyDate),Y.setItem("baseball_daily_streak_updated_date",o),console.log(`Daily Challenge: Streak updated to ${l.dailyStreak}`)}async validateStartupStreak(){const t=Y.getItem("baseball_daily_streak_updated_date");if(!l.dailyStreak||l.dailyStreak===0)return;if(!t&&!l.lastDailyDate){l.dailyStreak=0;return}const{TimeAnchorManager:a}=await Be(async()=>{const{TimeAnchorManager:g}=await Promise.resolve().then(()=>_n);return{TimeAnchorManager:g}},void 0,import.meta.url),o=await a.getTrustedTime()||new Date,n=We.getDailySeed(o);if(t===n)return;const s=Date.UTC(o.getUTCFullYear(),o.getUTCMonth(),o.getUTCDate()-1),r=new Date(s),d=r.getUTCFullYear(),f=String(r.getUTCMonth()+1).padStart(2,"0"),c=String(r.getUTCDate()).padStart(2,"0"),u=`${d}-${f}-${c}`,h=t||l.lastDailyDate;h!==u&&h!==n&&(console.log(`Daily Challenge: Streak broken (Last: ${h}, Yest: ${u}). Visual Reset to 0.`),l.dailyStreak=0,Y.setItem("baseball_daily_streak",0))}#b(t){this.#n=!0,console.error(`ðŸš¨ Iron Umpire: Cheating attempt detected - ${t}`),typeof window<"u"&&Be(()=>Promise.resolve().then(()=>Xi),void 0,import.meta.url).then(a=>{const i=a.leaderboardManager;i&&i.flagSession&&i.flagSession(t)}).catch(()=>{console.warn("[Iron Umpire] Could not report to server")})}enableDevMode(t){return t==="iron_umpire_2026"?(this.#n=!0,console.log("%c[DEV MODE ENABLED] SCORES ARE NOW TAINTED.","color: red; font-weight: bold; font-size: 14px;"),Te.innerText="DEV MODE ACTIVE",Te.style.color="red",Be(()=>Promise.resolve().then(()=>xi),void 0,import.meta.url).then(a=>{window.gameState=a.gameState,console.log("%c[DEV] gameState exposed to window","color: orange")}),window.testWalkOff=async(a="TECHNICIAN")=>{const o=(await Be(()=>Promise.resolve().then(()=>xi),void 0,import.meta.url)).gameState;if(!o.gameActive){console.warn("[DEV] âŒ Start a game first!"),console.log("[DEV] Hint: Click 'PLAY BALL!' or run: document.querySelector('.start-btn').click()");return}o.isPaused&&(console.log("[DEV] Unpausing game..."),(await Be(()=>Promise.resolve().then(()=>ir),void 0,import.meta.url)).togglePause(),await new Promise(s=>setTimeout(s,100))),o.pitcher.nextPitcherId=a,o.pitcher.state="walk_off",o.pitcher.timer=0,o.balls=[],console.log(`[DEV] âœ… Triggering walk-off to ${a}`),console.log(`[DEV] Theme: ${window.themeManager?.currentTheme?.id||"UNKNOWN"}`),console.log(`[DEV] Walk-off type: ${window.themeManager?.currentTheme?.walkOffType||"CLASSIC"}`),console.log("[DEV] Watch the pitcher swim away!")},window.debugStatus=()=>{Be(()=>Promise.resolve().then(()=>xi),void 0,import.meta.url).then(a=>{const i=a.gameState;console.log("=== ðŸŽ® GAME STATUS ==="),console.log(`Active: ${i.gameActive?"âœ…":"âŒ"}`),console.log(`Paused: ${i.isPaused?"â¸ï¸":"â–¶ï¸"}`),console.log(`Over: ${i.isGameOver?"ðŸ’€":"ðŸ”¥"}`),console.log(`Pitcher State: ${i.pitcher.state}`),console.log(`Pitcher ID: ${i.pitcher.id}`),console.log(`Theme: ${window.themeManager?.currentTheme?.id}`),console.log(`Walk-off Type: ${window.themeManager?.currentTheme?.walkOffType||"CLASSIC"}`),console.log("=====================")})},Be(()=>Promise.resolve().then(()=>Gl),void 0,import.meta.url).then(a=>{window.themeManager=a.themeManager,window.THEMES=a.THEMES,console.log("%c[DEV] themeManager exposed to window","color: orange")}),!0):(console.warn("Access Denied"),!1)}setScore(t){if(!this.#n){console.warn("Iron Umpire: Score manipulation blocked. Dev mode not active.");return}this.#s=t^this.#e,this.updateScoreDisplay(),console.log(`[DEV] Score set to ${t}`)}get isTainted(){return this.#n}set isTainted(t){t===!0&&(this.#n=!0)}saveGame(){if(!l.gameActive||l.isGameOver){Y.removeItem("baseball_saved_game");return}const t={score:this.score,strikes:this.strikes,isDailyChallenge:l.isDailyChallenge,dailySeed:l.isDailyChallenge?We.dailySeed:null,pitcher:{id:l.pitcher.id,skinColor:l.pitcher.skinColor,hatColor:l.pitcher.hatColor,gender:l.pitcher.gender,props:l.pitcher.props,scale:l.pitcher.scale},timestamp:Date.now()};Y.setItem("baseball_saved_game",JSON.stringify(t)),console.log("Game Saved Securely (Encrypted)")}loadGame(){const t=Y.getItem("baseball_saved_game");if(!t)return!1;try{const a=JSON.parse(t);if(Date.now()-a.timestamp>1440*60*1e3)return Y.removeItem("baseball_saved_game"),!1;if(a.isDailyChallenge){const i=We.getDailySeed();if(a.dailySeed!==i)return Y.removeItem("baseball_saved_game"),!1;We.setSeed(i),l.isDailyChallenge=!0,He.style.color="#FFD700"}else l.isDailyChallenge=!1,He.style.color="#fff";return this.#s=a.score^this.#e,this.#i=a.strikes^this.#e,l.gameActive=!0,l.isPaused=!0,l.isGameOver=!1,l.pitcher.id=a.pitcher.id,l.pitcher.skinColor=a.pitcher.skinColor,l.pitcher.hatColor=a.pitcher.hatColor,l.pitcher.gender=a.pitcher.gender,l.pitcher.props=a.pitcher.props,l.pitcher.scale=a.pitcher.scale||1,l.pitcher.state="IDLE",l.pitcher.timer=0,a}catch(a){return console.error("Failed to load secure save:",a),Y.removeItem("baseball_saved_game"),!1}}async fetchServerBalance(){if(this.#g){console.log("[ScoreManager] Sync already in progress - skipping");return}this.#g=!0;try{const{supabaseService:t}=await Be(async()=>{const{supabaseService:m}=await Promise.resolve().then(()=>va);return{supabaseService:m}},void 0,import.meta.url),a=t.getClient();if(!a){console.log("[ScoreManager] Offline - skipping server sync");return}const{data:{session:i}}=await a.auth.getSession();if(!i){console.log("[ScoreManager] No session - skipping sync");return}const o=i.user,{data:n,error:s}=await a.from("user_stats").select("total_coins").eq("user_id",o.id).limit(1);if(s||!n||n.length===0){console.log("[ScoreManager] No user_stats found (New User?)");return}const r=n[0].total_coins||0,d=this.coins,f=this.#t,c=Y.getItem("baseball_pending_purchases");let u=0;if(c)try{const m=JSON.parse(c);Array.isArray(m)&&m.length>0&&(u=m.reduce((p,T)=>p+(T.cost||0),0),console.log(`[ScoreManager] Found ${m.length} pending purchases (${u} coins). Triggering sync...`),Be(()=>Promise.resolve().then(()=>sr),void 0,import.meta.url).then(p=>p.unlockablesManager.syncPendingPurchases()))}catch(m){console.warn("[ScoreManager] Failed to parse pending purchases",m)}const h=Math.max(0,r-u);console.log(`[ScoreManager] Sync: Server=${r}, Effective=${h}, Local=${d}, Delta=${f}, Pending=${u}`);const g=Math.max(0,h+f);if(f===0){if(d===h){console.log("[ScoreManager] Sync: Already in sync (accounting for pending purchases)");return}if(d>h){const m=d-h;console.log(`[ScoreManager] Sync: Local (${d}) > Effective Server (${h}). Pushing ${m}...`),await this.#S(m)&&console.log("[ScoreManager] Push successful - balances synced")}else u===0?(console.log(`[ScoreManager] Sync: Server (${r}) > Local (${d}). Updating local.`),this.#a=r^this.#e,this.saveCoins(),this.updateCoinDisplay(),l.gameActive||(this.startCoins=r)):console.log("[ScoreManager] Sync: Local < Server but pending purchases exist - keeping local (no refund)");return}(f>0||this.#l>0)&&(console.log(`[ScoreManager] Pushing unsynchronized earnings (Coins: ${f}, Perfects: ${this.#l})...`),await this.#S()?(this.#T(),console.log("[ScoreManager] Push successful - deltas cleared")):console.warn("[ScoreManager] Push failed - deltas preserved for retry")),l.gameActive||(this.startCoins=this.coins),this._lastSyncTimestamp=Date.now()}catch(t){console.warn("[ScoreManager] Fetch Balance Warning:",t)}finally{this.#g=!1}}async#S(){const t=this.#t,a=this.#l;if(t<=0&&a<=0)return!1;const{supabaseService:i}=await Be(async()=>{const{supabaseService:n}=await Promise.resolve().then(()=>va);return{supabaseService:n}},void 0,import.meta.url),o=i.getClient();if(!o)return!1;console.log(`[ScoreManager] Pushing offline delta (Coins: +${t}, Perfects: +${a}) to server...`);try{const{data:n,error:s}=await o.rpc("update_user_coins",{p_delta:t,p_perfects:a});if(s)throw s;return console.log("[ScoreManager] Delta Sync Success."),!0}catch(n){return console.error(`[ScoreManager] Delta Push Failed: ${n.message}`),!1}}setAuthoritativeBalance(t){console.log(`[ScoreManager] Setting balance to: ${t}`),this.#a=t^this.#e,this._lastSyncTimestamp=Date.now(),l.gameActive||(this.startCoins=t),this.#r(),this.updateCoinDisplay(),this.saveCoins()}async syncSession(){const t=this.coins-(this.startCoins||0),a=this.#t,i=Math.max(t,a);if(i<=0){console.log("[ScoreManager] No earnings to sync");return}console.log(`[ScoreManager] Syncing Session: SessionEarnings=${t}, Delta=${a}, Pushing=${i}`),this.#p&&(console.log("Waiting for Session Handshake..."),await this.#p),this.#m;const{supabaseService:o}=await Be(async()=>{const{supabaseService:s}=await Promise.resolve().then(()=>va);return{supabaseService:s}},void 0,import.meta.url),n=o.getClient();if(!n){console.warn("[ScoreManager] Sync Skipped: No RPC Client (Offline?)");return}try{const s=Y.hash("gameplay_trace",`${this.score}-${this.#e}-${Date.now()}`),r=Math.floor((l.activeSessionTime||0)/1e3),d=this.sessionPerfects||0,{data:f,error:c}=await n.rpc("update_user_coins",{p_delta:i,p_perfects:d});if(c)throw c;const u=typeof f=="number"?f:f?.new_balance;u!=null?(console.log("[ScoreManager] Session Sync Success. Server Balance:",u),this.#t=Math.max(0,this.#t-i),this.#l=Math.max(0,this.#l-d),this.#h(),this.startCoins=this.coins,this.sessionPerfects=0,this.#m=null):console.warn("[ScoreManager] Sync Rejected: Invalid Data",f)}catch(s){console.error("[ScoreManager] Sync RPC Failed",s),console.error("Error Details:",{message:s.message,code:s.code,hint:s.hint,details:s.details})}}}window.enableDevTools=e=>V.enableDevMode(e);window.setGameScore=e=>V.setScore(e);const V=new Ul;window.__addCoins=e=>{console.warn("ðŸš¨ Iron Umpire: Honeypot triggered"),V.isTainted=!0,console.error("ðŸš¨ Iron Umpire: Cheating attempt detected - honeypot_coins"),Be(()=>Promise.resolve().then(()=>Xi),void 0,import.meta.url).then(t=>{t.leaderboardManager.flagSession&&t.leaderboardManager.flagSession("honeypot_coins")})};window.__setScore=e=>{console.warn("ðŸš¨ Iron Umpire: Honeypot triggered"),V.isTainted=!0,console.error("ðŸš¨ Iron Umpire: Cheating attempt detected - honeypot_score"),Be(()=>Promise.resolve().then(()=>Xi),void 0,import.meta.url).then(t=>{t.leaderboardManager.flagSession&&t.leaderboardManager.flagSession("honeypot_score")})};window.__unlockAll=()=>{console.warn("ðŸš¨ Iron Umpire: Honeypot triggered"),V.isTainted=!0,console.error("ðŸš¨ Iron Umpire: Cheating attempt detected - honeypot_unlock"),Be(()=>Promise.resolve().then(()=>Xi),void 0,import.meta.url).then(e=>{e.leaderboardManager.flagSession&&e.leaderboardManager.flagSession("honeypot_unlock")})};const Vl=Object.freeze(Object.defineProperty({__proto__:null,scoreManager:V},Symbol.toStringTag,{value:"Module"})),Yi=new Co(()=>({x:0,y:0,startX:0,startY:0,size:10,speedY:0,speedX:0,baseSpeedY:0,type:"FASTBALL",timeAlive:0,active:!1,hasPaused:!1,pauseTimer:0,invisible:!1,rotationAngle:0,rotationSpeed:0,prevRotationAngle:0,strikeCounted:!1,curveDirection:1,hit:!1,spin:0,trail:[]}),(e,t,a,i,o,n,s,r)=>{e.x=t,e.y=a,e.prevX=t,e.prevY=a,e.startX=t,e.startY=a,e.size=10,e.speedY=o,e.speedX=n,e.baseSpeedY=o,e.type=i,e.timeAlive=0,e.active=!0,e.hasPaused=!1,e.pauseTimer=0,e.invisible=!1,e.rotationAngle=0,e.prevRotationAngle=0,e.rotationSpeed=s,e.strikeCounted=!1,e.curveDirection=r,e.hit=!1,e.spin=0,e.trail.length=0},20);function zl(){l.balls.forEach(e=>Yi.release(e)),l.balls.length=0}const Wl={update:(e,t,a)=>{const i=e/16.667;for(let o=l.balls.length-1;o>=0;o--){const n=l.balls[o];if(n.hit)n.prevX=n.x,n.prevY=n.y,n.prevRotationAngle=n.rotationAngle,n.x+=n.speedX,n.y+=n.speedY,n.invisible=!1,n.spin&&(n.speedX+=n.spin*i),n.rotationAngle+=n.rotationSpeed*3*i;else{if(n.timeAlive+=e,n.prevX=n.x,n.prevY=n.y,n.prevRotationAngle=n.rotationAngle,jo[n.type]&&jo[n.type](n,e))continue;n.rotationAngle+=n.rotationSpeed*i,n.y+=n.speedY,!n.hit&&!n.strikeCounted&&n.y>l.bat.pivotY+60&&(n.strikeCounted=!0,l.lastPitchResult="STRIKE",V.registerStrike(),V.registerFoul(),Te.innerText="STRIKE!",Te.className="foul-text",D.playStrike(),a&&a(!0),l.consecutiveFouls=0,V.strikes>=3?t&&t("STRIKE_OUT"):setTimeout(()=>{Te.innerText.includes("STRIKE")&&(Te.innerText="",Te.className="")},1e3))}if(n.timeAlive>1e4){Yi.release(n),l.balls.splice(o,1);continue}(n.y>Ee||n.y<-50||n.x<-50||n.x>Q+50)&&(Yi.release(n),l.balls.splice(o,1),l.balls.length===0&&a&&a(!0))}}},ki=new Co(()=>({x:0,y:0,vx:0,vy:0,color:"#fff",alpha:1,decay:.01,gravity:.05,active:!1}),(e,t,a,i)=>{e.x=t,e.y=a,e.color=i;const o=Math.random()*Math.PI*2,n=Math.random()*3+1;e.vx=Math.cos(o)*n,e.vy=Math.sin(o)*n,e.alpha=1,e.decay=Math.random()*.015+.005,e.gravity=.05,e.active=!0},500),po=new Co(()=>({x:0,y:0,targetY:0,speed:6,color:"#fff",exploded:!1,active:!1,trail:[]}),(e,t,a)=>{e.x=t,e.y=Dt.height,e.targetY=a,e.speed=6;const i=["#ff0000","#00ff00","#0000ff","#ffff00","#ff00ff","#00ffff","#ffffff"];e.color=i[Math.floor(Math.random()*i.length)],e.exploded=!1,e.active=!0,e.trail.length=0},10),Pt={fireworks:[],particles:[],timer:0,interval:500,reset(){this.fireworks.forEach(e=>po.release(e)),this.particles.forEach(e=>ki.release(e)),this.fireworks.length=0,this.particles.length=0,this.timer=this.interval},update(e,t=!0){const a=re.currentTheme&&re.currentTheme.id==="SPACE";if(this.timer+=e,t&&!a&&this.timer>this.interval){this.timer=0;const i=Math.random()*Dt.width,o=Math.random()*(Dt.height/2),n=po.get(i,o);this.fireworks.push(n)}for(let i=this.fireworks.length-1;i>=0;i--){const o=this.fireworks[i];if(!o.exploded){o.y-=o.speed,o.trail.push({x:o.x,y:o.y,alpha:1}),o.trail.length>8&&o.trail.shift();for(let n of o.trail)n.alpha-=.15;o.y<=o.targetY&&(o.exploded=!0,this.spawnParticles(o.x,o.y,o.color),D.playFirework(),po.release(o),this.fireworks.splice(i,1))}}for(let i=this.particles.length-1;i>=0;i--){const o=this.particles[i];if(o.x+=o.vx,o.y+=o.vy,o.vy+=o.gravity,o.alpha-=o.decay,o.alpha<=0){ki.release(o);const n=this.particles[this.particles.length-1];this.particles[i]=n,this.particles.pop()}}},spawnParticles(e,t,a){if(!(this.particles.length>300))for(let i=0;i<50;i++){const o=ki.get(e,t,a);this.particles.push(o)}},spawnImpactParticles(e,t,a="#ffffff"){for(let i=0;i<15;i++){const o=ki.get(e,t,a);o.vx*=1.5,o.vy*=1.5,o.decay=.05,this.particles.push(o)}},draw(){for(const e of this.fireworks)if(!e.exploded){for(const t of e.trail)b.globalAlpha=Math.max(0,t.alpha),b.fillStyle=e.color,b.fillRect(t.x-1,t.y-1,3,3);b.globalAlpha=1,b.fillStyle=e.color,b.fillRect(e.x-2,e.y-2,5,5)}if(this.particles.length>0){let e="",t=-1;b.beginPath();for(const a of this.particles){if(a.alpha<=.01)continue;a.color!==e&&(e=a.color,b.fillStyle=e);const i=Math.round(a.alpha*20)/20;i!==t&&(t=i,b.globalAlpha=t),b.fillRect(a.x|0,a.y|0,3,3)}b.globalAlpha=1}}},vo={url:"https://yfxamjivfbrzmdfipcyc.supabase.co",key:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InlmeGFtaml2ZmJyem1kZmlwY3ljIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjUyMjcyNDgsImV4cCI6MjA4MDgwMzI0OH0.SyFt2GpS82vFsSbsboG6e3t01CoXlDLPAnXn_THBGWs"},$l=Object.freeze(Object.defineProperty({__proto__:null,SUPABASE_CONFIG:vo},Symbol.toStringTag,{value:"Module"}));class Yl{constructor(){this.client=null,this.initialized=!1,this.authPromise=null}init(){if(this.initialized)return this.client;if(window.supabase)try{this.client=window.supabase.createClient(vo.url,vo.key),this.initialized=!0,console.log("Supabase Service: Initialized"),this.authPromise=this.ensureAuth()}catch(t){console.error("Supabase Service: Failed to initialize",t)}else console.error("Supabase Service: SDK not loaded");return this.client}async ensureAuth(){if(!this.client)return;const{data:{session:t}}=await this.client.auth.getSession();if(!t){console.log("Supabase: Attempting Anonymous Sign-in...");const{data:a,error:i}=await this.client.auth.signInAnonymously();i?(console.warn("Supabase Anon Auth Failed:",i.message),i.message.includes("Anonymous sign-ins are disabled")&&console.error("Developer Action Required: Enable 'Anonymous Sign-ins' in Supabase Dashboard (Authentication -> Providers).")):console.log("Supabase: Signed in anonymously",a.user.id)}}async waitForAuth(){return this.initialized||this.init(),this.authPromise&&await this.authPromise,this.client}getClient(){return this.initialized?this.client:this.init()}}const ui=new Yl,va=Object.freeze(Object.defineProperty({__proto__:null,supabaseService:ui},Symbol.toStringTag,{value:"Module"})),fi={getUserId(){const e=ui.getClient();if(e&&e.auth){const a=e.auth.session;if(a&&typeof a=="object"&&a.user){const i=a.user.id,o=localStorage.getItem("baseball_user_id");return o!==i&&(console.log(`[UserManager] Adopting Cloud ID: ${i} (Replacing ${o})`),localStorage.setItem("baseball_user_id",i)),i}}let t=localStorage.getItem("baseball_user_id");return t||(typeof crypto<"u"&&crypto.randomUUID?t=crypto.randomUUID():t="user_"+Math.random().toString(36).substr(2,9)+Date.now().toString(36),localStorage.setItem("baseball_user_id",t)),t}},Nl="https://timeapi.io/api/Time/current/zone?timeZone=UTC",ql="https://cdnjs.cloudflare.com/ajax/libs/json3/3.3.2/json3.min.js",Di="baseball_time_anchor";class zt{static async fetchServerTime(){try{console.log("[TimeAnchor] Attempting Primary (TimeAPI.io)...");let t=await this.tryFetch(Nl,"dateTime",!0);return this.isValidDate(t)?(this.updateAnchor(t),t):(console.log("[TimeAnchor] Primary API failed. Attempting Secondary (CDN Head Check)..."),t=await this.fetchHeadDate(ql),this.isValidDate(t)?(this.updateAnchor(t),t):(console.log("[TimeAnchor] Secondary failed. Using Supabase Connection..."),t=await this.fetchViaSupabase(),this.isValidDate(t)?(this.updateAnchor(t),t):(console.warn("[TimeAnchor] All Time Sources failed. Using Local Fallback."),null)))}catch(t){return console.warn("[TimeAnchor] Network Error",t.message),null}}static isValidDate(t){return!t||isNaN(t.getTime())?!1:t.getUTCFullYear()>=2025}static async fetchViaSupabase(){try{const{SUPABASE_CONFIG:t}=await Be(async()=>{const{SUPABASE_CONFIG:d}=await Promise.resolve().then(()=>$l);return{SUPABASE_CONFIG:d}},void 0,import.meta.url),a=`${t.url}/rest/v1/`,i=t.key;console.log("[TimeAnchor] Fetching time headers from Supabase...");const o=new AbortController,n=setTimeout(()=>o.abort(),5e3),s=await fetch(a,{method:"HEAD",headers:{apikey:i,Authorization:`Bearer ${i}`},cache:"no-store",signal:o.signal});if(clearTimeout(n),!s.ok)return null;const r=s.headers.get("Date");if(r){const d=new Date(r);if(this.isValidDate(d))return d;console.warn(`[TimeAnchor] Supabase returned invalid date string: ${r}`)}return null}catch(t){return console.warn("[TimeAnchor] Supabase Header Check Failed",t),null}}static async fetchHeadDate(t){try{const a=new AbortController,i=setTimeout(()=>a.abort(),3e3),o=await fetch(t+"?_cb="+Date.now(),{method:"HEAD",cache:"no-store",signal:a.signal});if(clearTimeout(i),!o.ok)return null;const n=o.headers.get("Date");if(n){const s=new Date(n);if(this.isValidDate(s))return s}return null}catch(a){return console.warn("[TimeAnchor] CDN Head Check Failed",a.message),null}}static async tryFetch(t,a,i=!0){try{const o=new AbortController,n=setTimeout(()=>o.abort(),5e3);let s=t;if(i){const u=t.includes("?")?"&":"?";s=`${t}${u}_cb=${Date.now()}`}const r=await fetch(s,{signal:o.signal,cache:"no-store"});if(clearTimeout(n),!r.ok)throw new Error(`API Error ${r.status}`);const d=await r.json();let f=d[a];if(f||(d.datetime?f=d.datetime:d.dateTime?f=d.dateTime:d.milliSeconds&&(f=d.milliSeconds)),!f)throw new Error("Invalid JSON format");typeof f=="string"&&f.includes("T")&&!f.endsWith("Z")&&!f.includes("+")&&(f+="Z");const c=new Date(f);if(!this.isValidDate(c))throw new Error(`Invalid Date Parsed: ${c.toISOString()}`);return c}catch(o){return console.warn(`[TimeAnchor] Fetch failed for ${t}:`,o.message),null}}static updateAnchor(t){if(!this.isValidDate(t))return;const a={serverTime:t.getTime(),deviceTime:Date.now(),verifiedAt:Date.now()};Y.setItem(Di,JSON.stringify(a)),console.log(`[TimeAnchor] Security Lease Renewed: ${t.toISOString()}`)}static async getTrustedTime(){const t=Y.getItem(Di);if(t){const a=JSON.parse(t),i=Date.now()-a.verifiedAt,o=2880*60*1e3;if(i<o&&i>-864e5){const n=Date.now()-a.deviceTime;return new Date(a.serverTime+n)}}return await this.fetchServerTime()}static async verifyOrFetch(t){let a=this.isDateAllowed(t);if(!a.allowed&&(a.reasonCode==="MISSING_ANCHOR"||a.reasonCode==="EXPIRED_ANCHOR"||a.reasonCode==="FUTURE_BLOCK")){console.log(`[TimeAnchor] Auto-repairing security check for ${t} (${a.reasonCode})...`);const i=await this.fetchServerTime();i?console.log(`[TimeAnchor] Repair successful. New Server Time: ${i.toISOString()}`):console.warn("[TimeAnchor] Repair FAILED. Could not fetch server time."),a=this.isDateAllowed(t)}return a}static isDateAllowed(t){Y.migrate(Di);const a=Y.getItem(Di);if(!a)return console.warn("TimeAnchor: No security lease found. Online verification required."),{allowed:!1,reason:"Please connect to internet to verify date.",reasonCode:"MISSING_ANCHOR"};const i=JSON.parse(a),o=Date.now()-i.verifiedAt,n=1440*60*1e3,s=2*n;if(o>s||o<-n)return console.warn("TimeAnchor: Security lease expired or invalid (future timestamp)."),{allowed:!1,reason:"Time synchronization error. Connect to verify.",reasonCode:"EXPIRED_ANCHOR"};const r=new Date(i.serverTime),d=r.getUTCFullYear(),f=String(r.getUTCMonth()+1).padStart(2,"0"),c=String(r.getUTCDate()).padStart(2,"0"),u=`${d}-${f}-${c}`,[h,g,m]=t.split("-").map(Number),p=Date.UTC(h,g-1,m),T=Date.UTC(d,Number(f)-1,Number(c)),v=(p-T)/n;return console.log(`[TimeAnchor] Target: ${t} (${p}) | Valid: ${u} (${T}) | Diff: ${v.toFixed(2)} days`),v>2.5?(console.warn(`[TimeAnchor] BLOCK: Future Date detected. Diff: ${v.toFixed(2)} > 2.5`),{allowed:!1,reason:"Future Date Blocked",reasonCode:"FUTURE_BLOCK"}):{allowed:!0}}}const _n=Object.freeze(Object.defineProperty({__proto__:null,TimeAnchorManager:zt},Symbol.toStringTag,{value:"Module"}));class Xl{constructor(){this.client=null,this.initialized=!1,this.queueKey="baseball_leaderboard_queue"}init(){if(!this.initialized)try{ui.init(),this.client=ui.getClient(),this.initialized=!0,console.log("LeaderboardManager: Supabase initialized (via Service)"),zt.fetchServerTime(),this.syncScores(),this.processRetryQueue()}catch(t){console.error("LeaderboardManager: Failed to initialize",t)}}async syncScores(){if(!this.initialized)return;console.log("LeaderboardManager: Syncing scores...");const t=localStorage.getItem("baseball_username");if(!t)return;let a=parseInt(Y.getItem("baseball_high_score_s1","0"))||0;if(a===0){const n=await this.getUserEntry("leaderboard");n&&n.score>0&&(console.log(`LeaderboardManager: Restored High Score ${n.score} from cloud.`),a=n.score,Y.setItem("baseball_high_score_s1",a),V.highScore=a,l.highScore=a)}a>0&&await this.submitScore(t,a,"leaderboard");const i=We.getDailySeed(),o=parseInt(Y.getItem(`baseball_daily_score_${i}`,"0"))||0;o>0&&await this.submitScore(t,o,"daily_leaderboard")}async submitScore(t,a,i="leaderboard",o=null){if(!this.initialized||!this.client)return{error:"Not initialized"};if(V.isTainted)return console.warn("LeaderboardManager: Submission REJECTED. Score is tainted (Dev Mode)."),{success:!0,ignored:!0,reason:"Tainted"};if(i==="daily_leaderboard"){const n=await zt.fetchServerTime(),s=We.getDailySeed();if(n){const r=n.getUTCFullYear(),d=String(n.getUTCMonth()+1).padStart(2,"0"),f=String(n.getUTCDate()).padStart(2,"0"),c=`${r}-${d}-${f}`;if(s>c)return console.error("Security Block: Attempted future score submission"),{error:"Future Date Blocked"}}else return console.warn("Security: Offline submission deferred."),{error:"Offline - Score Saved Locally",queued:!0}}try{const{data:{session:n}}=await this.client.auth.getSession();if(o||(i==="daily_leaderboard"?o=`daily_${We.getDailySeed()}`:o="classic"),!n)return console.log("LeaderboardManager: Security: No Session (Offline). Deferring."),this.addToQueue(t,a,i,o),{error:"Offline (Deferred)",queued:!0};const s=fi.getUserId(),r=await zt.getTrustedTime(),d=r?r.getTime():Date.now(),f=Y.signPayload(s,a,d,o);console.log("LeaderboardManager: Submitting via Secure RPC...",{score:a,details:o});const c={p_user_id:s,p_username:t,p_score:a,p_timestamp:d,p_details:o,p_signature:f},{data:u,error:h}=await this.client.rpc("submit_score_secure",c);if(h)throw console.error("LeaderboardManager: RPC Error",h),h;return u&&!u.success?(console.warn("LeaderboardManager: Server rejected score:",u.error),{error:u.error}):{success:!0}}catch(n){return console.error("LeaderboardManager: Failed to submit score",n),this.addToQueue(t,a,i,o),{error:n.message,queued:!0}}}addToQueue(t,a,i,o){console.log("LeaderboardManager: Queuing score for later retry...");const n=JSON.parse(Y.getItem(this.queueKey)||"[]");n.some(r=>r.score===a&&r.table===i&&r.details===o)||(n.push({username:t,score:a,table:i,details:o,timestamp:Date.now()}),Y.setItem(this.queueKey,JSON.stringify(n)))}async processRetryQueue(){if(!this.initialized)return;const t=Y.getItem(this.queueKey);if(!t)return;let a=JSON.parse(t);if(a.length===0)return;console.log(`LeaderboardManager: Processing ${a.length} pending items...`);const i=[];for(const o of a)try{(await this.submitScoreInternal(o)).success?console.log(`LeaderboardManager: Recovered score ${o.score} on ${o.table}`):i.push(o)}catch{i.push(o)}i.length<a.length?Y.setItem(this.queueKey,JSON.stringify(i)):i.length===0&&Y.removeItem(this.queueKey)}async submitScoreInternal(t){try{return(await this.submitScore(t.username,t.score,t.table)).error?{success:!1}:{success:!0}}catch{return{success:!1}}}async getUserEntry(t="leaderboard",a=null){if(!this.initialized||!this.client)return null;const i=fi.getUserId();try{let o=this.client.from(t).select("score, username, rank").select("score, username").eq("user_id",i).maybeSingle();t==="daily_leaderboard"&&a&&(o=o.eq("score_date",a));const{data:n,error:s}=await o;if(s)throw s;return n}catch(o){return console.error("LeaderboardManager: User entry fetch error",o),null}}async getLeaderboard(t=100,a="leaderboard",i=null){if(!this.initialized||!this.client)return{error:"Service Not Initialized"};try{let o=this.client.from(a).select("username, score, created_at, user_id").order("score",{ascending:!1}).limit(t);if(a==="daily_leaderboard"){let r=i;if(!r){const d=new Date,f=d.getUTCFullYear(),c=String(d.getUTCMonth()+1).padStart(2,"0"),u=String(d.getUTCDate()).padStart(2,"0");r=`${f}-${c}-${u}`}o=o.eq("score_date",r)}const{data:n,error:s}=await o;if(s)throw s;return n}catch(o){return console.error("LeaderboardManager: Fetch error",o),{error:o.message||"Unknown Error"}}}async getUserRank(t,a="leaderboard",i=null){if(!this.initialized||!this.client)return null;try{let o=this.client.from(a).select("*",{count:"exact",head:!0}).gt("score",t);if(a==="daily_leaderboard"){let h=i;if(!h){const g=new Date,m=g.getUTCFullYear(),p=String(g.getUTCMonth()+1).padStart(2,"0"),T=String(g.getUTCDate()).padStart(2,"0");h=`${m}-${p}-${T}`}o=o.eq("score_date",h)}const{count:n,error:s}=await o;if(s)throw s;let r=this.client.from(a).select("*",{count:"exact",head:!0});if(a==="daily_leaderboard"){let h=i;if(!h){const g=new Date,m=g.getUTCFullYear(),p=String(g.getUTCMonth()+1).padStart(2,"0"),T=String(g.getUTCDate()).padStart(2,"0");h=`${m}-${p}-${T}`}r=r.eq("score_date",h)}const{count:d,error:f}=await r;if(f)throw f;const c=n+1,u=d>0?(c/d*100).toFixed(1):0;return{rank:c,total:d,percentile:u}}catch(o){return console.error("LeaderboardManager: Rank fetch error",o),null}}flagSession(t){console.warn(`ðŸš¨ Leaderboard Manager: Cheating attempt logged - ${t}`);const a=JSON.parse(localStorage.getItem("baseball_cheat_flags")||"[]");a.push({reason:t,timestamp:Date.now(),userId:fi.getUserId()}),localStorage.setItem("baseball_cheat_flags",JSON.stringify(a.slice(-10)))}}const ta=new Xl,Xi=Object.freeze(Object.defineProperty({__proto__:null,leaderboardManager:ta},Symbol.toStringTag,{value:"Module"}));function Ro(e,t="SECURITY ALERT"){console.log("[SecurityUI] Modal Requested:",e),Zo&&(Zo.innerText=t),Ko&&(Ko.textContent=e),Xt&&(Xt.style.display="flex",Xt.style.pointerEvents="auto");try{D&&D.playError(),Ie&&Ie.vibrate("medium")}catch(o){console.warn("[SecurityUI] Sound error:",o)}const a=o=>{o&&(o.preventDefault(),o.stopPropagation()),Xt&&(Xt.style.display="none");try{D&&D.playSettingsClose()}catch{}},i=document.getElementById("security-close-btn")||Ps;i&&(i.onclick=a),Xt&&(Xt.onclick=o=>{o.target===Xt&&a(o)})}const Zl=Object.freeze(Object.defineProperty({__proto__:null,showSecurityModal:Ro},Symbol.toStringTag,{value:"Module"}));class Kl{constructor(){this.isOpen=!1,this.username=localStorage.getItem("baseball_username")||null,this.pendingScore=null,this.pendingTable=null,this.isSyncing=!1,this.currentTab="all-time",this.init(),setTimeout(()=>this.syncLocalScore(),2e3),this.currentViewDate=new Date}init(){pt.addEventListener("click",()=>this.open()),gs.addEventListener("click",()=>this.close()),ms.addEventListener("click",()=>this.submitName()),Ht&&Ht.addEventListener("keydown",t=>{t.key==="Enter"&&(t.preventDefault(),this.submitName())}),Oa.addEventListener("click",t=>{t.target===Oa&&this.close()}),_a&&_a.addEventListener("click",()=>this.switchTab("all-time")),Ia&&Ia.addEventListener("click",()=>this.switchTab("daily")),Xo&&Xo.addEventListener("click",()=>this.changeDate(-1)),Pi&&Pi.addEventListener("click",()=>this.changeDate(1))}async changeDate(t){this.currentViewDate||(this.currentViewDate=new Date);const a=new Date(this.currentViewDate);a.setUTCDate(this.currentViewDate.getUTCDate()+t);const i=a.getUTCFullYear(),o=String(a.getUTCMonth()+1).padStart(2,"0"),n=String(a.getUTCDate()).padStart(2,"0"),s=`${i}-${o}-${n}`;if(t>0){const r=await zt.verifyOrFetch(s);if(!r.allowed){Ro(r.reason),console.log("Leaderboard Nav Blocked: Future Date");return}}this.currentViewDate.setUTCDate(this.currentViewDate.getUTCDate()+t),D&&D.playSettingsToggle(),this.updateDailyUI(),this.loadLeaderboard("daily"),this.updatePersonalBest()}open(t="all-time"){this.isOpen=!0,Oa.style.display="flex",l.isPaused=!0,oi.style.display="none",Qt.style.display="none",Wt.style.display="none",this.switchTab(t),this.syncLocalScore(),t==="daily"&&this.updateDailyUI(),D&&D.init().then(()=>{D.playUnlockablesOpen()})}close(){this.isOpen&&(this.isOpen=!1,Oa.style.display="none",!l.isGameOver&&l.gameActive&&(l.isPaused=!1),D&&D.playUnlockablesClose())}async updatePersonalBest(){let t=0,a="leaderboard",i=null;if(this.currentTab==="daily"){a="daily_leaderboard";const o=this.currentViewDate||new Date,n=o.getUTCFullYear(),s=String(o.getUTCMonth()+1).padStart(2,"0"),r=String(o.getUTCDate()).padStart(2,"0");i=`${n}-${s}-${r}`;const d=new Date;if(o.getUTCFullYear()===d.getUTCFullYear()&&o.getUTCMonth()===d.getUTCMonth()&&o.getUTCDate()===d.getUTCDate()){const c=We.getDailySeed();t=parseInt(Y.getItem(`baseball_daily_score_${c}`,"0"))||0}else{const c=await ta.getUserEntry(a,i);t=c?c.score:0}}else Be(()=>Promise.resolve().then(()=>Vl),void 0,import.meta.url).then(o=>{}),t=parseInt(Y.getItem("baseball_high_score_s1","0"))||0;if(ja.textContent=t>0?t:"-",t>0){ja.textContent=`${t} (Loading...)`;const o=await ta.getUserRank(t,a,i);o?o.rank<=100?ja.textContent=`${t} (#${o.rank})`:ja.textContent=`${t} (Top ${o.percentile}%)`:ja.textContent=t}}async loadLeaderboard(t="all-time"){if(this.currentTab===t&&(vi.style.display="none",ji&&(ji.style.display="none"),Ja.style.display="none",wa.style.display="block"),!this.username){this.currentTab===t&&(wa.style.display="none",t==="all-time"&&(Ja.style.display="flex",Ht&&Ht.focus()));return}let a="leaderboard",i=null;if(t==="daily"){a="daily_leaderboard";const n=this.currentViewDate||new Date,s=n.getUTCFullYear(),r=String(n.getUTCMonth()+1).padStart(2,"0"),d=String(n.getUTCDate()).padStart(2,"0");i=`${s}-${r}-${d}`}let o=await ta.getLeaderboard(100,a,i);if(o&&!o.error){let n=0;const s=We.getDailySeed();if(t==="daily"?(!this.currentViewDate||this.currentViewDate.toDateString()===new Date().toDateString())&&(n=parseInt(Y.getItem(`baseball_daily_score_${s}`,"0"))||0):n=parseInt(Y.getItem("baseball_high_score_s1","0"))||0,n>0){const r=fi.getUserId();let d=!1;for(let f of o)if(f.user_id===r&&f.username===this.username){n>f.score&&(f.score=n,f.isOptimistic=!0),d=!0;break}if(!d){const f=o.length>0?o[o.length-1].score:-1;(o.length<100||n>f)&&o.push({rank:0,score:n,username:this.username,user_id:r,isOptimistic:!0})}o.sort((f,c)=>c.score-f.score),o.forEach((f,c)=>{f.rank=c+1}),o.length>100&&(o=o.slice(0,100))}}this.renderList(o,t)}renderList(t,a){let i=vi;if(a==="daily"&&(i=ji),!i)return;if(this.currentTab===a?(wa.style.display="none",i.style.display="flex",i.style.flexDirection="column"):i.style.display="none",i.innerHTML="",t&&t.error){i.innerHTML=`
                <div style="text-align:center; padding: 20px; color: #ff5555;">
                    SERVICE UNAVAILABLE<br>
                    <span style="font-size: 0.6em; color: #aaa;">${t.error.toUpperCase()}</span>
                </div>`;return}if(t===null){i.innerHTML=`
                <div style="text-align:center; padding: 20px; color: #ff5555;">
                    CONNECTION FAILED<br>
                    <span style="font-size: 0.8em; color: #aaa;">OFFLINE MODE</span>
                </div>`;return}if(!t||t.length===0){i.innerHTML='<div style="text-align:center; padding: 20px; color: #666;">NO SCORES YET</div>';return}const o=fi.getUserId();t.forEach((n,s)=>{const r=s+1;let d="";r===1?d="gold":r===2?d="silver":r===3&&(d="bronze");const f=document.createElement("div");f.className=`leaderboard-row ${d}`;const c=n.user_id===o;let u=n.username;c&&(f.classList.add("current-user-row"),u+=" (YOU)",setTimeout(()=>{const p=f;p.isConnected&&p.scrollIntoView({behavior:"smooth",block:"nearest"})},100));const h=document.createElement("div");h.className="leaderboard-rank",h.textContent=`#${r}`;const g=document.createElement("div");g.className="leaderboard-name",g.textContent=u;const m=document.createElement("div");m.className="leaderboard-score",m.textContent=n.score.toLocaleString(),f.appendChild(h),f.appendChild(g),f.appendChild(m),i.appendChild(f)})}async submitName(){const t=Ht.value.trim().toUpperCase(),a=/^[A-Z]+$/,i=["NIG","FUK","CNT","KKK","ASS","CUM","FAG","WOP","JAP","POO","TIT","DIK","SEX","GAY","JEW","AZN","FCK","FUC","COC","COK","PEE","VAG","SHT","WTF","HIV","STD","LSD","GOD","DYK","FGT","NGR","PCP","XXX"];if(t.length<1||!a.test(t)||i.includes(t)){Ht.classList.add("input-error"),Ht.classList.add("shake-animation"),setTimeout(()=>{Ht.classList.remove("input-error"),Ht.classList.remove("shake-animation")},500);return}this.username=t,localStorage.setItem("baseball_username",this.username),Ie.vibrate("medium"),Ja.style.display="none",wa.style.display="block";try{await this.processPendingScore(),await this.syncLocalScore()}catch(o){console.error("Error during score submission flow:",o)}this.loadLeaderboard(this.currentTab)}async checkAndSubmitScore(t,a="leaderboard"){t<=0||(this.username?(console.log(`Submitting score: ${t} for ${this.username} on table: ${a}`),await ta.submitScore(this.username,t,a)):(this.pendingScore=t,this.pendingTable=a,this.open()))}async processPendingScore(){if(this.pendingScore&&this.username){const t=this.pendingTable||"leaderboard";console.log(`Submitting PENDING score: ${this.pendingScore} for ${this.username} on table: ${t}`),await ta.submitScore(this.username,this.pendingScore,t),this.pendingScore=null,this.pendingTable=null}}async syncLocalScore(){if(!this.username||this.isSyncing)return;const t=l.highScore;if(t>0){this.isSyncing=!0,console.log(`Attempting to sync local best (${t}) to server...`);try{await ta.submitScore(this.username,t)}finally{this.isSyncing=!1}}}updateDailyUI(){if(!oa)return;const t=We.getDailySeed(),a=l.lastDailyDate,i=this.currentViewDate||new Date;i.getUTCFullYear(),String(i.getUTCMonth()+1).padStart(2,"0");const o=String(i.getUTCDate()).padStart(2,"0"),n=new Date,s=i.getUTCFullYear()===n.getUTCFullYear()&&i.getUTCMonth()===n.getUTCMonth()&&i.getUTCDate()===n.getUTCDate();if(Yo){const r=i.toLocaleString("en-US",{month:"short",timeZone:"UTC"}).toUpperCase();Yo.innerText=`${r} ${o}`}Pi&&(Pi.style.visibility=s?"hidden":"visible"),oa&&(oa.style.display=s?"block":"none"),Ga&&(Ga.parentElement.style.visibility=s?"visible":"hidden"),s&&(Vi&&(Vi.innerText=l.dailyStreak),a!==t?(Ui.innerText="FREE",Ga.className="stat-value free",na&&(na.style.display="none")):(Ui.innerText="20",Ga.className="stat-value cost",na&&(na.style.display="block")))}switchTab(t){this.currentTab!==t&&D&&D.playSettingsToggle(),this.currentTab=t,vi&&(vi.style.display="none"),Ci&&(Ci.style.display="none"),Ja&&(Ja.style.display="none"),wa&&(wa.style.display="none"),_a&&(_a.className="tab-btn"),Ia&&(Ia.className="tab-btn"),t==="all-time"?(_a&&_a.classList.add("active"),this.loadLeaderboard("all-time")):t==="daily"&&(Ia&&Ia.classList.add("active"),Ci&&(Ci.style.display="flex"),this.currentViewDate=new Date,this.updateDailyUI(),this.loadLeaderboard("daily")),this.updatePersonalBest()}}const za=new Kl,Ao=[{id:"ROOKIE",name:"The Rookie",leagueId:0,minScoreInSeason:0,maxScoreInSeason:49,visuals:{gender:"MALE",skinColor:"#ffccaa",hatColor:"#e74c3c",walkSpeed:.18},pools:[{max:9,probs:{fastball:.5,curveball:.5}},{max:19,probs:{super_fastball:.4,fastball:.3,curveball:.3}},{max:29,probs:{super_fastball:.5,changeup:.5}},{max:39,probs:{zigzag:.4,super_fastball:.15,changeup:.15,fastball:.15,curveball:.15}},{max:49,probs:{fastball:.2,curveball:.2,super_fastball:.2,changeup:.2,zigzag:.2}}],seasonTwoTrick:F.GHOSTBALL},{id:"TECHNICIAN",name:"The Technician",leagueId:1,minScoreInSeason:50,maxScoreInSeason:99,visuals:{gender:"FEMALE",skinColor:"#ffdbac",hatColor:null,shoeColor:"#FF69B4",scale:1,walkSpeed:.18},pools:[{max:59,probs:{[F.STOPBALL]:.4,[F.FASTBALL]:.12,[F.CURVEBALL]:.12,[F.SUPER_FASTBALL]:.12,[F.CHANGEUP]:.12,[F.ZIGZAG]:.12}},{max:69,probs:{[F.SPLITTER]:.4,[F.FASTBALL]:.1,[F.CURVEBALL]:.1,[F.SUPER_FASTBALL]:.1,[F.CHANGEUP]:.1,[F.ZIGZAG]:.1,[F.STOPBALL]:.1}},{max:79,probs:{[F.GHOSTBALL]:.4,[F.FASTBALL]:.0857,[F.CURVEBALL]:.0857,[F.SUPER_FASTBALL]:.0857,[F.CHANGEUP]:.0857,[F.ZIGZAG]:.0857,[F.STOPBALL]:.0857,[F.SPLITTER]:.0857}},{max:99,probs:{[F.FASTBALL]:.125,[F.CURVEBALL]:.125,[F.SUPER_FASTBALL]:.125,[F.CHANGEUP]:.125,[F.ZIGZAG]:.125,[F.STOPBALL]:.125,[F.SPLITTER]:.125,[F.GHOSTBALL]:.125}}],seasonTwoTrick:F.STOP_CURVE},{id:"ACE",name:"The Ace",leagueId:2,minScoreInSeason:100,maxScoreInSeason:149,visuals:{gender:"MALE",skinColor:"#8d5524",hatColor:"#000000",shoeColor:"#FFD700",sunglasses:!0,beard:!0,goldChain:!0,scale:1,walkSpeed:.18},pools:[{max:109,probs:{SUPER_CURVE:.4,fastball:.075,curveball:.075,changeup:.075,splitter:.075,zigzag:.075,stopball:.075,ghostball:.075,super_fastball:.075}},{max:119,probs:{zigzag_splitter:.4,fastball:.0667,curveball:.0667,changeup:.0667,splitter:.0667,zigzag:.0667,stopball:.0667,ghostball:.0667,super_fastball:.0667,SUPER_CURVE:.0667}},{max:129,probs:{curve_changeup:.4,fastball:.06,curveball:.06,changeup:.06,splitter:.06,zigzag:.06,stopball:.06,ghostball:.06,super_fastball:.06,SUPER_CURVE:.06,zigzag_splitter:.06}},{max:139,probs:{super_zigzag:.4,fastball:.0545,curveball:.0545,changeup:.0545,splitter:.0545,zigzag:.0545,stopball:.0545,ghostball:.0545,super_fastball:.0545,SUPER_CURVE:.0545,zigzag_splitter:.0545,curve_changeup:.0545}},{max:149,probs:{curve_splitter:.4,fastball:.05,curveball:.05,changeup:.05,splitter:.05,zigzag:.05,stopball:.05,ghostball:.05,super_fastball:.05,SUPER_CURVE:.05,zigzag_splitter:.05,curve_changeup:.05,super_zigzag:.05}}],seasonTwoTrick:F.SUPER_ZIGZAG},{id:"SCARY",name:"The Legend",leagueId:4,minScoreInSeason:300,maxScoreInSeason:1/0,bossMode:!0,visuals:{gender:"MALE",skinColor:"#000000",hatColor:"#ffffff",shoeColor:"#ff0000",scale:1.1,walkSpeed:.08},pools:[{max:309,probs:{ghost_stop:.4,fastball:.02307,curveball:.02307,changeup:.02307,super_fastball:.02307,zigzag:.02307,stopball:.02307,splitter:.02307,ghostball:.02307,SUPER_CURVE:.02307,zigzag_splitter:.02307,curve_changeup:.02307,super_zigzag:.02307,curve_splitter:.02307,super_splitter:.02307,GHOST_CURVE:.02307,stop_super:.02307,ghost_zigzag:.02307,stop_zigzag:.02307,stop_splitter:.02307,ghost_changeup:.02307,zigzag_changeup:.02307,STOP_CURVE:.02307,splitter_changeup:.02307,ghost_splitter:.02307,stop_changeup:.02307,ghost_super:.02307}},{max:1/0,probs:{fastball:.037,curveball:.037,changeup:.037,super_fastball:.037,zigzag:.037,stopball:.037,splitter:.037,ghostball:.037,SUPER_CURVE:.037,zigzag_splitter:.037,curve_changeup:.037,super_zigzag:.037,curve_splitter:.037,ghost_stop:.037,super_splitter:.037,GHOST_CURVE:.037,stop_super:.037,ghost_zigzag:.037,stop_zigzag:.037,stop_splitter:.037,ghost_changeup:.037,zigzag_changeup:.037,STOP_CURVE:.037,splitter_changeup:.037,ghost_splitter:.037,stop_changeup:.037,ghost_super:.037}}],seasonTwoTrick:F.STOP_SUPER},{id:"MONITOR",name:"The Monitor",leagueId:3,minScoreInSeason:150,maxScoreInSeason:199,visuals:{gender:"MALE",style:"TV_HEAD",skinColor:"#888888",hatColor:null,shoeColor:"#00ff00",scale:1,walkSpeed:.18},pools:[{max:159,probs:{stop_zigzag:.4,fastball:.0462,curveball:.0462,changeup:.0462,super_fastball:.0462,zigzag:.0462,stopball:.0462,splitter:.0462,ghostball:.0462,SUPER_CURVE:.0462,zigzag_splitter:.0462,curve_changeup:.0462,super_zigzag:.0462,curve_splitter:.0462}},{max:169,probs:{super_splitter:.4,stop_zigzag:.0429,fastball:.0429,curveball:.0429,changeup:.0429,super_fastball:.0429,zigzag:.0429,stopball:.0429,splitter:.0429,ghostball:.0429,SUPER_CURVE:.0429,zigzag_splitter:.0429,curve_changeup:.0429,super_zigzag:.0429,curve_splitter:.0429}},{max:179,probs:{GHOST_CURVE:.4,super_splitter:.04,stop_zigzag:.04,fastball:.04,curveball:.04,changeup:.04,super_fastball:.04,zigzag:.04,stopball:.04,splitter:.04,ghostball:.04,SUPER_CURVE:.04,zigzag_splitter:.04,curve_changeup:.04,super_zigzag:.04,curve_splitter:.04}},{max:189,probs:{stop_super:.4,GHOST_CURVE:.0375,super_splitter:.0375,stop_zigzag:.0375,fastball:.0375,curveball:.0375,changeup:.0375,super_fastball:.0375,zigzag:.0375,stopball:.0375,splitter:.0375,ghostball:.0375,SUPER_CURVE:.0375,zigzag_splitter:.0375,curve_changeup:.0375,super_zigzag:.0375,curve_splitter:.0375}},{max:199,probs:{ghost_zigzag:.4,stop_super:.0353,GHOST_CURVE:.0353,super_splitter:.0353,stop_zigzag:.0353,fastball:.0353,curveball:.0353,changeup:.0353,super_fastball:.0353,zigzag:.0353,stopball:.0353,splitter:.0353,ghostball:.0353,SUPER_CURVE:.0353,zigzag_splitter:.0353,curve_changeup:.0353,super_zigzag:.0353,curve_splitter:.0353}}],seasonTwoTrick:F.GHOST_SUPER},{id:"ROOKIE",name:"The Rookie (Elite)",leagueId:0,minScoreInSeason:200,maxScoreInSeason:249,visuals:{gender:"MALE",skinColor:"#ffccaa",hatColor:"#e74c3c",walkSpeed:.18},pools:[{max:209,probs:{stop_splitter:.4,ghost_zigzag:.0333,stop_super:.0333,GHOST_CURVE:.0333,super_splitter:.0333,stop_zigzag:.0333,fastball:.0333,curveball:.0333,changeup:.0333,super_fastball:.0333,zigzag:.0333,stopball:.0333,splitter:.0333,ghostball:.0333,SUPER_CURVE:.0333,zigzag_splitter:.0333,curve_changeup:.0333,super_zigzag:.0333,curve_splitter:.0333}},{max:219,probs:{ghost_changeup:.4,stop_splitter:.0316,ghost_zigzag:.0316,stop_super:.0316,GHOST_CURVE:.0316,super_splitter:.0316,stop_zigzag:.0316,fastball:.0316,curveball:.0316,changeup:.0316,super_fastball:.0316,zigzag:.0316,stopball:.0316,splitter:.0316,ghostball:.0316,SUPER_CURVE:.0316,zigzag_splitter:.0316,curve_changeup:.0316,super_zigzag:.0316,curve_splitter:.0316}},{max:229,probs:{zigzag_changeup:.4,ghost_changeup:.03,stop_splitter:.03,ghost_zigzag:.03,stop_super:.03,GHOST_CURVE:.03,super_splitter:.03,stop_zigzag:.03,fastball:.03,curveball:.03,changeup:.03,super_fastball:.03,zigzag:.03,stopball:.03,splitter:.03,ghostball:.03,SUPER_CURVE:.03,zigzag_splitter:.03,curve_changeup:.03,super_zigzag:.03,curve_splitter:.03}},{max:239,probs:{STOP_CURVE:.4,zigzag_changeup:.0286,ghost_changeup:.0286,stop_splitter:.0286,ghost_zigzag:.0286,stop_super:.0286,GHOST_CURVE:.0286,super_splitter:.0286,stop_zigzag:.0286,fastball:.0286,curveball:.0286,changeup:.0286,super_fastball:.0286,zigzag:.0286,stopball:.0286,splitter:.0286,ghostball:.0286,SUPER_CURVE:.0286,zigzag_splitter:.0286,curve_changeup:.0286,super_zigzag:.0286,curve_splitter:.0286}},{max:249,probs:{splitter_changeup:.4,STOP_CURVE:.0273,zigzag_changeup:.0273,ghost_changeup:.0273,stop_splitter:.0273,ghost_zigzag:.0273,stop_super:.0273,GHOST_CURVE:.0273,super_splitter:.0273,stop_zigzag:.0273,fastball:.0273,curveball:.0273,changeup:.0273,super_fastball:.0273,zigzag:.0273,stopball:.0273,splitter:.0273,ghostball:.0273,SUPER_CURVE:.0273,zigzag_splitter:.0273,curve_changeup:.0273,super_zigzag:.0273,curve_splitter:.0273}}]},{id:"TECHNICIAN",name:"The Technician (Elite)",leagueId:1,minScoreInSeason:250,maxScoreInSeason:299,visuals:{gender:"FEMALE",skinColor:"#ffdbac",hatColor:null,shoeColor:"#FF69B4",scale:1,walkSpeed:.18},pools:[{max:259,probs:{ghost_splitter:.4,splitter_changeup:.0261,STOP_CURVE:.0261,zigzag_changeup:.0261,ghost_changeup:.0261,stop_splitter:.0261,ghost_zigzag:.0261,stop_super:.0261,GHOST_CURVE:.0261,super_splitter:.0261,stop_zigzag:.0261,fastball:.0261,curveball:.0261,changeup:.0261,super_fastball:.0261,zigzag:.0261,stopball:.0261,splitter:.0261,ghostball:.0261,SUPER_CURVE:.0261,zigzag_splitter:.0261,curve_changeup:.0261,super_zigzag:.0261,curve_splitter:.0261}},{max:269,probs:{stop_changeup:.4,ghost_splitter:.025,splitter_changeup:.025,STOP_CURVE:.025,zigzag_changeup:.025,ghost_changeup:.025,stop_splitter:.025,ghost_zigzag:.025,stop_super:.025,GHOST_CURVE:.025,super_splitter:.025,stop_zigzag:.025,fastball:.025,curveball:.025,changeup:.025,super_fastball:.025,zigzag:.025,stopball:.025,splitter:.025,ghostball:.025,SUPER_CURVE:.025,zigzag_splitter:.025,curve_changeup:.025,super_zigzag:.025,curve_splitter:.025}},{max:279,probs:{ghost_super:.4,stop_changeup:.024,ghost_splitter:.024,splitter_changeup:.024,STOP_CURVE:.024,zigzag_changeup:.024,ghost_changeup:.024,stop_splitter:.024,ghost_zigzag:.024,stop_super:.024,GHOST_CURVE:.024,super_splitter:.024,stop_zigzag:.024,fastball:.024,curveball:.024,changeup:.024,super_fastball:.024,zigzag:.024,stopball:.024,splitter:.024,ghostball:.024,SUPER_CURVE:.024,zigzag_splitter:.024,curve_changeup:.024,super_zigzag:.024,curve_splitter:.024}},{max:299,probs:{fastball:.0385,curveball:.0385,changeup:.0385,super_fastball:.0385,zigzag:.0385,stopball:.0385,splitter:.0385,ghostball:.0385,SUPER_CURVE:.0385,zigzag_splitter:.0385,curve_changeup:.0385,super_zigzag:.0385,curve_splitter:.0385,super_splitter:.0385,GHOST_CURVE:.0385,stop_super:.0385,ghost_zigzag:.0385,stop_splitter:.0385,ghost_changeup:.0385,zigzag_changeup:.0385,STOP_CURVE:.0385,splitter_changeup:.0385,ghost_splitter:.0385,stop_changeup:.0385,ghost_super:.0385,stop_zigzag:.0385}}]}];function as(e){if(e>=300)return{seasonIndex:0,scoreInSeason:e};const t=400,a=Math.floor(e/t),i=e%t;return{seasonIndex:a,scoreInSeason:i}}function In(e){const{scoreInSeason:t}=as(e);return Ao.find(a=>t>=a.minScoreInSeason&&t<=a.maxScoreInSeason)}function kn(e,t,a=!1){const{seasonIndex:i,scoreInSeason:o}=as(t);if(!e||!e.pools)return F.FASTBALL;const n=i>=1,s=a?Ca.random():Math.random();if(n&&s<.1&&e.seasonTwoTrick)return e.seasonTwoTrick;const d=e.pools.find(u=>o<=u.max)||e.pools[e.pools.length-1],f=a?Ca.random():Math.random();let c=0;for(const[u,h]of Object.entries(d.probs))if(c+=h,f<c)return u;return F.FASTBALL}class jl{checkCollisions(t,a,i){if(l.bat.swinging)for(let o=l.balls.length-1;o>=0;o--){const n=l.balls[o];if(!n.active)continue;const s=n.x-l.bat.pivotX,r=n.y-l.bat.pivotY,d=s*s+r*r,f=Math.atan2(r,s);let c=l.bat.angle%(Math.PI*2);c>Math.PI&&(c-=Math.PI*2);let u=Math.abs(c-f);u>Math.PI&&(u=Math.PI*2-u);const h=u<1.2,g=it.BAT_LENGTH+20,m=it.BAT_LENGTH-5,p=it.BAT_LENGTH+8,T=it.BAT_LENGTH-25,v=d>0&&d<g*g,y=!0,S=n.x>l.bat.pivotX-10,_=n.y<l.bat.pivotY+30;if(h&&v&&y&&S&&_){n.active=!1,i(!0),n.strikeCounted&&(V.setStrikes(V.strikes-1),n.strikeCounted=!1,l.gameActive||(l.gameActive=!0,Ve.style.display="none",He.style.display="block",D.stopTheme()));const A=l.bat.angle,E=d>=T*T&&d<m*m,P=d>=m*m&&d<p*p,M=d>=p*p&&d<g*g,I=A<.5&&A>-3,L=E&&I||P||M,w=12*(t/16.667),U=.08;if(L){let k;const B=(Math.random()-.5)*.4;if(M){const q=(Math.random()-.5)*.4;k=Ai+.15+q,Te.innerText="GOOD HIT!",Te.className=""}else if(P){const q=(Math.random()-.5)*.3;k=Qi+q,Te.innerText="PERFECT HIT!",Te.className="perfect-hit"}else{let be=(Math.max(-2,Math.min(.5,A))- -1)/(.5- -1);be=Math.max(0,Math.min(1,be)),k=Qi+be*(Ri-Qi),k+=B,Te.innerText="GOOD HIT!",Te.className=""}k=Math.max(Ai+U,Math.min(Ri-U,k)),n.speedX=Math.cos(k)*w,n.speedY=Math.sin(k)*w,P?(l.lastPitchResult="HIT",V.registerHit("PERFECT"),requestAnimationFrame(()=>{Ie.vibrate("perfect"),wt.currentBat.id==="GOLD"&&Pt.spawnImpactParticles(n.x+n.size/2,n.y+n.size/2,"#ffd700"),Te.innerText="PERFECT HIT!",l.settings?.noFlash?Te.className="":Te.className="perfect-hit",D.playPerfectHit(),l.perfectHitTimer=1500}),V.consecutivePerfectHits>=3):(l.lastPitchResult="HIT",V.registerHit("GOOD"),Te.innerText="GOOD HIT!",Te.className="",Te.className="",D.playHit(),Ie.vibrate("good")),l.consecutiveFouls=0,V.updateScoreDisplay(),V.checkHighScore(),setTimeout(()=>{Te.innerText.includes("HIT")&&(Te.innerText="",Te.className="")},1e3)}else{if(l.lastPitchResult="FOUL",V.registerFoul(),l.consecutiveFouls++,l.consecutiveFouls>=4){D.playBatBreak(),D.playBatBreak(),Ie.vibrate("failure"),document.body.style.animation="shake 0.5s cubic-bezier(.36,.07,.19,.97) both",setTimeout(()=>{document.body.style.animation=""},500),Te.innerText="BAT BROKEN!",Te.className="foul-text",setTimeout(()=>{a&&a("BAT_BROKEN")},500),n.speedX=0,n.speedY=5,n.hit=!0;return}let k;const B=Math.random();if(B<.3){const q=.08+Math.random()*.05;Math.random()>.5?(k=Ri+q,n.spin=.03+Math.random()*.03):(k=Ai-q,n.spin=-(.03+Math.random()*.03))}else if(B<.7){const q=.25+Math.random()*.5;Math.random()>.5?(k=Ri+q,n.spin=.05+Math.random()*.05):(k=Ai-q,n.spin=-(.05+Math.random()*.05))}else Math.random()>.5?(k=.2+Math.random()*1,n.spin=.02):(k=Math.PI-(.2+Math.random()*1),n.spin=-.02);n.speedX=Math.cos(k)*w,n.speedY=Math.sin(k)*w,D.playHit(),Ie.vibrate("foul"),setTimeout(()=>{D.playFoul();let q="FOUL";A>-1.3?q="FOUL<br>(LATE SWING)":A<-1.8&&(q="FOUL<br>(EARLY SWING)"),Te.innerHTML=q,Te.className="foul-text",V.strikes<2&&V.registerStrike()},600),setTimeout(()=>{Te.innerText.includes("FOUL")&&(Te.innerText="",Te.className="")},2e3)}n.hit=!0;break}}}}const Jl=new jl;class Ql{update(t){if(!l.isDailyChallenge){const a=In(V.score);a&&a.id!==l.pitcher.id&&l.pitcher.state===Fe.IDLE&&l.balls.length===0&&(l.pitcher.nextPitcherId=a.id,l.pitcher.state=Fe.WALK_OFF,l.pitcher.timer=0,V.score<300&&(V.setStrikes(0),l.consecutiveFouls=0,l.balls.length>0&&(l.balls=[]),Te.innerHTML="<div style='width:100%; text-align:center'>STRIKES</div><div style='width:100%; text-align:center'>CLEARED!</div>",Te.className="strikes-cleared",Te.style.color="#FFD700",Lt(!1),D.playStrikesCleared&&D.playStrikesCleared(),setTimeout(()=>{Te.innerText.includes("STRIKES")&&(Te.innerText="",Te.className="",Te.style.color="")},4e3)))}l.startMessage&&l.startMessage.active&&l.pitcher.state!==Fe.WALK_ON&&l.pitcher.state!==Fe.WALK_OFF||(l.pitcher.state===Fe.IDLE?this.handleIdle(t):l.pitcher.state===Fe.WALK_OFF?this.handleWalkOff(t):l.pitcher.state===Fe.WALK_ON?this.handleWalkOn(t):l.pitcher.state===Fe.WINDUP?this.handleWindup(t):l.pitcher.state===Fe.BACKFLIP&&this.handleBackflip(t))}handleIdle(t){let a=0;if(l.totalPitches===0?a=1500:(l.lastPitchResult==="STRIKE"||l.lastPitchResult==="FOUL")&&(a=1e3),l.pitcher.timer>a){if(l.pitcher.state=Fe.WINDUP,Ra(!1),l.pitcher.timer=0,l.totalPitches++,l.totalPitches>1&&(l.showTutorial=!1,l.tutorialSeen=!0),(l.totalPitches===1||V.score===0)&&!l.tutorialSeen&&!l.isDailyChallenge)l.pitcher.nextPitch=F.CURVEBALL,l.pitcher.windupDuration=4e3;else{const o=In(V.score);if(o&&l.pitcher.freshArm)o.id==="TECHNICIAN"?(l.pitcher.nextPitch=F.STOPBALL,l.pitcher.freshArm=!1):o.id==="ACE"?(l.pitcher.nextPitch=F.SUPER_CURVE,l.pitcher.freshArm=!1):o.id==="SCARY"?(l.pitcher.nextPitch=F.GHOST_STOP,l.pitcher.freshArm=!1):l.pitcher.nextPitch=kn(o,V.score,l.isDailyChallenge);else if(l.isDailyChallenge){const n=Object.keys(Fa);l.pitcher.nextPitch=Ca.choice(n)}else l.pitcher.nextPitch=kn(o,V.score)}const i=Fa[l.pitcher.nextPitch];l.showTutorial||(l.pitcher.windupDuration=i.windupDuration||1e3),i.chargeSound&&D[i.chargeSound]&&D[i.chargeSound]()}}handleWalkOff(t){l.pitcher.timer+=t;const a=re.currentTheme.walkOffType;if(a==="FLY_AWAY"){l.pitcher.x-=.2*t;const i=Math.PI*2/1200;l.pitcher.rotation=(l.pitcher.rotation||0)-i*t,l.pitcher.y=150+qe+Math.sin(l.pitcher.timer/100)*10,l.pitcher.flyAwayTriggered||(D.playWoosh&&D.playWoosh(),l.pitcher.flyAwayTriggered=!0)}else if(a==="SWIM"){const i=-Math.PI/2,o=l.pitcher.rotation||0;Math.abs(o-i)>.1?l.pitcher.rotation=o+(i-o)*.1:l.pitcher.rotation=i,l.pitcher.x-=.15*t,l.pitcher.y=150+qe+Math.sin(l.pitcher.timer/300)*15,l.pitcher.rotation+=Math.sin(l.pitcher.timer/150)*.1}else l.pitcher.x-=.18*t,l.pitcher.rotation=0,Math.floor(l.pitcher.timer/160)%2===0?(l.pitcher.y=150+qe-2,l.pitcher.stepTriggeredOff||(l.pitcher.gender==="FEMALE"&&D.playLightStep?D.playLightStep():l.pitcher.id==="XXX"&&D.playThud?D.playThud():D.playNormalStep&&D.playNormalStep(),l.pitcher.stepTriggeredOff=!0)):(l.pitcher.y=150+qe+2,l.pitcher.stepTriggeredOff=!1);l.pitcher.x<-100&&this.transitionToNextPitcher()}transitionToNextPitcher(){l.pitcher.state=Fe.WALK_ON,l.pitcher.x=Q+50,l.pitcher.timer=0;const t=Ao.find(a=>a.id===l.pitcher.nextPitcherId);t?(l.pitcher.id=t.id,l.pitcher.freshArm=!0,l.pitcher.skinColor=t.visuals.skinColor,l.pitcher.gender=t.visuals.gender,l.pitcher.scale=t.visuals.scale||1,l.pitcher.hatColor=t.visuals.hatColor,l.pitcher.shoeColor=t.visuals.shoeColor,l.pitcher.walkSpeed=t.visuals.walkSpeed||.18,l.pitcher.props={sunglasses:t.visuals.sunglasses,beard:t.visuals.beard,goldChain:t.visuals.goldChain,hatColor:t.visuals.hatColor,shoeColor:t.visuals.shoeColor},l.pitcher.flyAwayTriggered=!1,l.pitcher.rotation=0,l.bossModeActive=t.id!=="ROOKIE"):(l.pitcher.id="ROOKIE",l.pitcher.skinColor="#ffccaa",l.pitcher.gender="MALE",l.pitcher.scale=1,l.bossModeActive=!1)}handleWalkOn(t){l.pitcher.timer+=t;let a=l.pitcher.walkSpeed||.18,i=160;l.pitcher.id==="SCARY"&&(i=300),l.pitcher.x-=a*t,Math.floor(l.pitcher.timer/i)%2===0?(l.pitcher.y=150+qe-2,l.pitcher.stepTriggeredOn||(l.pitcher.id==="SCARY"?this.playWalkSound():l.pitcher.gender==="FEMALE"&&D.playLightStep?D.playLightStep():l.pitcher.id==="XXX"&&D.playThud?D.playThud():D.playNormalStep&&D.playNormalStep(),l.pitcher.stepTriggeredOn=!0)):(l.pitcher.y=150+qe+2,l.pitcher.stepTriggeredOn=!1),l.pitcher.x<=Q/2-l.pitcher.width/2&&(l.pitcher.x=Q/2-l.pitcher.width/2,l.pitcher.state=Fe.IDLE,l.pitcher.timer=-1e3,(l.pitcher.id==="TECHNICIAN"||l.pitcher.id==="ACE")&&(l.bossModeActive=!0),this.playEntranceEffects())}playWalkSound(){if(l.pitcher.id==="SCARY"){const t=document.getElementById("game-container");t&&(t.classList.remove("shake-screen"),t.offsetWidth,t.classList.add("shake-screen")),D.playThud&&D.playThud(),Ie.vibrate("bossStep")}else l.pitcher.id==="ACE"?D.playAceStep&&D.playAceStep():l.pitcher.gender==="FEMALE"?D.playLightStep&&D.playLightStep():D.playNormalStep&&D.playNormalStep()}playEntranceEffects(){l.pitcher.id==="ACE"?(D.playAceEntrance&&D.playAceEntrance(),l.aceFlashStartTime=performance.now()):l.pitcher.gender==="FEMALE"?(document.body.classList.add("sparkle-effect"),D.playCheer&&D.playCheer(),setTimeout(()=>{document.body.classList.remove("sparkle-effect")},1500)):l.pitcher.id==="SCARY"?(l.pitcher.skinColor="#000000",document.body.classList.add("fracture-effect"),D.playRoar&&D.playRoar(),D.playThunder&&D.playThunder(),Ie.vibrate("bossEntrance"),setTimeout(()=>{document.body.classList.remove("fracture-effect")},600)):l.pitcher.id==="MONITOR"&&(l.monitorEntranceStartTime=performance.now(),D.playDigitalEntrance&&D.playDigitalEntrance(),Ie.vibrate("bossEntrance"))}handleWindup(t){l.pitcher.timer+=t,this.updateColorBlindIndicator(),l.pitcher.timer>1250&&!l.pitcher.chargeSoundPlayed&&this.playChargeSound(),l.pitcher.timer>l.pitcher.windupDuration&&this.throwBall(t)}updateColorBlindIndicator(){const t=Fa[l.pitcher.nextPitch];if(l.settings?.colorBlindMode){if(vt.style.display!=="block"&&(vt.style.display="block",vt.style.textShadow="2px 2px 0 #000"),window.innerWidth/window.innerHeight>=.7)vt.style.top="20vh";else{const o=l.pitcher.y/Ee*100;vt.style.top=`${o}%`}let i="";if(t.colors.length>1&&t.colorName.includes("/")){const o=t.colorName.split("/");o.forEach((n,s)=>{const r=t.colors[s]||"#ffffff";i+=`<span style="color: ${r}">${n}</span>`,s<o.length-1&&(i+='<span style="color: #ffffff">/</span>')})}else i=`<span style="color: ${t.colors[0]}">${t.colorName}</span>`;vt.innerHTML!==i&&(vt.innerHTML=i)}else vt.style.display!=="none"&&(vt.style.display="none")}handleBackflip(t){l.pitcher.timer+=t;const a=600;if(l.pitcher.timer<a){const i=l.pitcher.timer/a;l.pitcher.rotation=-i*Math.PI*2,l.pitcher.y=150+qe-Math.sin(i*Math.PI)*50}else l.pitcher.rotation=0,l.pitcher.y=150+qe,l.pitcher.state=Fe.IDLE,l.pitcher.timer=0}playChargeSound(){const t=l.pitcher.nextPitch;t===F.SUPER_ZIGZAG||t===F.STOP_ZIGZAG||t===F.GHOST_ZIGZAG?D.playZigZagCharge():t===F.SUPER_CURVE||t===F.STOP_CURVE||t===F.GHOST_CURVE?D.playCurveCharge():t===F.GHOST_CHANGEUP||t===F.CURVE_CHANGEUP||t===F.SPLITTER_CHANGEUP||t===F.STOP_CHANGEUP||t===F.ZIGZAG_CHANGEUP?D.playChangeCharge():t===F.CURVE_SPLITTER||t===F.ZIGZAG_SPLITTER||t===F.SUPER_SPLITTER||t===F.GHOST_SPLITTER||t===F.STOP_SPLITTER?D.playSplitterCharge():(t===F.GHOST_STOP||t===F.GHOST_SUPER||t===F.STOP_SUPER)&&(t===F.GHOST_STOP?D.playEvilLaugh():D.playSuperCharge()),l.pitcher.chargeSoundPlayed=!0}throwBall(t){l.pitcher.state=Fe.IDLE,l.pitcher.timer=0,l.pitcher.chargeSoundPlayed=!1,vt.style.display="none",l.showTutorial&&(l.showTutorial=!1);let a=1,i=0;const o=Fa[l.pitcher.nextPitch];let n=o.rotationSpeed||.2;if(l.isDailyChallenge){const f=V.score+lt.DAILY_SCORE_OFFSET;a=lt.BASE_MULTIPLIER+Math.log10(f/10+1)*lt.LOG_FACTOR,i=(o.baseSpeed||.4)*a*Ca.range(.95,1.05)}else{const f=V.score,c=lt.TRANSITION_SCORE;if(f<c)a=lt.BASE_MULTIPLIER+Math.pow(f,lt.POWER_EXPONENT)*lt.POWER_FACTOR;else{const u=lt.BASE_MULTIPLIER+Math.pow(c,lt.POWER_EXPONENT)*lt.POWER_FACTOR,h=lt.BASE_MULTIPLIER+Math.log10(c/10+1)*lt.LOG_FACTOR,g=u-h;a=lt.BASE_MULTIPLIER+Math.log10(f/10+1)*lt.LOG_FACTOR+g}i=(o.baseSpeed||.4)*a}let s=0,r=1;l.isDailyChallenge?r=Ca.random()>.5?1:-1:r=Math.random()>.5?1:-1;const d=Yi.get(l.pitcher.x+l.pitcher.width/2-5,l.pitcher.y+l.pitcher.height,l.pitcher.nextPitch,i*t,s,n,r);l.balls.push(d),o.throwSound&&D[o.throwSound]?D[o.throwSound]():D.playPitch()}}const xl=new Ql;class It{static init(t,a){this.startGame=t,this.returnToTitleScreen=a,this.bindRetryEvents()}static setupRetryModal(){kt&&(kt.innerText=20,kt.style.color="#fff"),Ge&&(Ge.onclick=async a=>{a.stopPropagation(),Ge.style.opacity="0.5",Ge.style.pointerEvents="none",await V.deductCoins(20,"daily_retry")?(D.playPurchase(),Ie.vibrate("purchase"),rt&&(rt.style.display="none"),this.startGame&&this.startGame(!0,!0)):(D.playError(),Ie.vibrate("medium"),Ge.style.opacity="1",Ge.style.pointerEvents="auto",Ge.innerText="NEED COINS")}),Ji&&(Ji.innerText="HOME",Ji.onclick=a=>{a.stopPropagation(),D.playSettingsClose(),rt&&(rt.style.display="none"),this.returnToTitleScreen&&this.returnToTitleScreen()}),V.coins>=20?Ge&&(Ge.disabled=!1,Ge.style.opacity="1",Ge.innerText="RETRY",Ge.style.cursor="pointer",Ge.style.pointerEvents="auto"):(kt&&(kt.style.color="#e74c3c"),Ge&&(Ge.disabled=!1,Ge.innerText="NEED COINS",Ge.classList.add("btn-disabled-visual")))}static bindRetryEvents(){rt&&(rt.onclick=t=>{t.target===rt&&(D.playSettingsClose(),rt.style.display="none")})}static async attemptEntry(t,a="generic"){const i=We.getDailySeed(),o=l.lastDailyDate,n=await zt.verifyOrFetch(i);return n.allowed?(zt.fetchServerTime(),t?!0:o!==i?(console.log("Daily Challenge: Free Entry Used"),l.lastDailyDate=i,Y.setItem("baseball_last_daily_date",i),!0):!1):(Ro(n.reason),!1)}static setupGame(t){if(!t){l.isDailyChallenge=!1,He.style.color="#fff",V.setStrikes(0),l.startMessage.active=!1,mt&&(mt.style.display="none");return}l.isDailyChallenge=!0,l.showTutorial=!1,Ca.setSeed(We.getDailySeed()),He.style.color="#FFD700";const a=Ao.reduce((h,g)=>(h.find(m=>m.id===g.id)||h.push(g),h),[]),i=We.getDailySeed();Ca.setSeed(i);const n=parseInt(i.replace(/-/g,""))%a.length,s=a[n];this._applyPitcherToGameState(s),V.setStrikes(2),Ti&&(Ti.innerText="ONE STRIKE"),Go&&(Go.innerText="1 STRIKE = GAME OVER"),Ti&&(Ti.style.color="#FF0000"),mt&&(mt.style.display="flex"),l.startMessage.active=!0;const r=Q+60,d=Q/2-16,f=r-d;l.pitcher.width=32;const c=l.pitcher.walkSpeed||.18,u=f/c;l.startMessage.timer=Math.max(1e3,u-750),D.playError()}static _applyPitcherToGameState(t){l.pitcher.id=t.id,l.pitcher.skinColor=t.visuals.skinColor,l.pitcher.hatColor=t.visuals.hatColor,l.pitcher.gender=t.visuals.gender,l.pitcher.shoeColor=t.visuals.shoeColor||null,l.pitcher.scale=t.visuals.scale||1,l.pitcher.walkSpeed=t.visuals.walkSpeed||.18,l.pitcher.props={sunglasses:t.visuals.sunglasses||!1,beard:t.visuals.beard||!1,goldChain:t.visuals.goldChain||!1},l.pitcher.x=Q+60,l.pitcher.state=Fe.WALK_ON}static updateButtonState(){if(!oa)return;const t=We.getDailySeed(),a=l.lastDailyDate;Vi&&(Vi.innerText=l.dailyStreak),a!==t?(Ui.innerText="FREE",Ga.className="daily-badge free",na&&(na.style.display="none")):(Ui.innerText="20",Ga.className="daily-badge cost",na&&(na.style.display="block"))}}let hi=!0;function Wa(){l.gameActive&&(l.isPaused=!l.isPaused,Wt.style.display=l.isPaused?"flex":"none",l.isPaused?(De.innerHTML="&#9658;",De.style.fontSize="8vmin",De.style.paddingLeft=""):(De.innerHTML='<div class="pause-bar"></div><div class="pause-bar"></div>',De.style.fontSize="",De.style.paddingLeft=""),De.style.display=l.isPaused||l.gameActive?"flex":"none",l.isPaused?(Xe.style.display="block",l.startMessage&&l.startMessage.active&&mt&&(mt.style.display="none"),D.audioContext&&D.playPause(!0),l.balls.forEach(e=>{e.prevX=e.x,e.prevY=e.y,e.prevRotationAngle=e.rotationAngle})):(Wt.style.display="none",Xe.style.display="none",l.startMessage&&l.startMessage.active&&mt&&(mt.style.display="flex"),D.audioContext&&D.playPause(!1),l.lastTime=performance.now()))}function is(){if(console.log("Returning to Title Screen..."),l.gameActive=!1,l.isPaused=!1,l.isGameOver=!1,l.isDailyChallenge=!1,l.bossModeActive=!1,l.showFireworks=!1,D.stopTheme(),Wt&&(Wt.style.display="none"),Xe&&(Xe.style.display="block"),Xe&&(Xe.style.display="block"),et&&(et.style.display="flex",et.classList.remove("wiggle-active")),ct&&(ct.style.visibility="hidden"),l.showTutorial=!1,He&&(He.style.visibility="hidden"),ot&&(ot.style.visibility="visible"),ii&&(ii.style.display="flex",ii.parentElement&&(ii.parentElement.style.display="flex")),yi&&(yi.style.display="block",yi.style.visibility="visible",yi.style.opacity="1"),V&&V.updateCoinDisplay(),De&&(De.style.display="none",De.innerHTML='<div class="pause-bar"></div><div class="pause-bar"></div>',De.style.paddingLeft="",De.style.fontSize=""),Ve){Ve.style.display="block";const e='<div class="game-title"><div class="title-line" data-text="PERFECT">PERFECT</div><div class="title-line" data-text="DERBY">DERBY</div></div><div class="subtitle pulse">TAP TO <span class="mobile-block">START</span></div>',t=document.getElementById("start-content");t?t.innerHTML=e:Ve.innerHTML=`<div id="start-content">${e}</div>`}je&&(je.style.display="flex"),pt&&(pt.style.display="flex"),Lt(!1),Na()}async function la(e=!1,t=!1,a="generic"){if(!hi)return;if(e){const n=We.getDailySeed();if(!zt.isDateAllowed(n).allowed){await It.attemptEntry(t,a);return}if(l.lastDailyDate===n&&!t){if(a==="game_over"){D.playUnlockablesOpen(),rt&&(rt.style.display="flex"),It.setupRetryModal();return}const d=20;if(V.coins<d){D.playError(),rt&&(rt.style.display="flex"),It.setupRetryModal();return}if(await V.deductCoins(d,"daily_retry"))D.playPurchase(),It.setupGame(!0);else{D.playError();return}}else{if(!await It.attemptEntry(t,a))return;It.setupGame(!0)}}else It.setupGame(!1);De.style.display="flex",Xe.style.display="none",De.style.display="flex",Xe.style.display="none",et&&(et.style.display="none",et.classList.remove("wiggle-active")),je&&(je.style.display="none"),pt&&(pt.style.display="none"),Ve.style.display="none",Oa&&(Oa.style.display="none"),ct&&(ct.style.display="none"),l.needsUnlockablesGlow=!1,je&&je.classList.remove("unlockables-glow"),!l.tutorialSeen&&!e?l.pendingUnlockablesGlow=!0:l.pendingUnlockablesGlow=!1,D.stopTheme(),Js(),l.gameActive=!0,l.isPaused=!1,l.isGameOver=!1,Lt(!1),Na(),Wt.style.display="none",e||(l.pitcher.id="ROOKIE",l.pitcher.skinColor="#ffccaa",l.pitcher.hatColor="#e74c3c",l.pitcher.props={hatColor:"#e74c3c"},l.pitcher.gender="MALE",l.pitcher.shoeColor=null,l.pitcher.baseColor="#ffffff",l.pitcher.bossType=null,l.pitcher.freshArm=!1,l.pitcher.scale=1),e||(l.showTutorial=!l.tutorialSeen),V.reset(),V.startSession(),e&&V.setStrikes(2),He.innerText=`Score: ${V.score}`,l.totalPitches=0,V.setMultiplier(0),l.consecutiveFouls=0,He.innerText=`Score: ${V.score}`,Pt.reset(),l.showFireworks=!1,V.updateCoinDisplay(),pa.style.display="none",He.style.visibility="visible",V.updateCoinDisplay(),He.style.visibility="visible",He.parentElement.style.display="flex";const i=document.getElementById("coin-container");i?(i.style.display="none",i.style.visibility="hidden"):ot&&ot.parentElement&&(ot.parentElement.style.display="none"),Te.innerText="",vt.style.display="none",Ve.style.display="none",zl(),l.lastTime=performance.now(),l.accumulator=0,l.pitcher.state=Fe.IDLE,l.sessionStartTime=Date.now(),l.activeSessionTime=0,l.lastActiveTick=Date.now(),l.pitcher.timer=0,l.showFireworks=!1,l.timeScale=1,l.bossModeActive=!1,l.bossLevel=0,l.nextBossType=null;const o=document.querySelector("canvas");o&&(o.style.cursor="default"),l.isDailyChallenge?l.pitcher.state=Fe.WALK_ON:(l.pitcher.x=Q/2-l.pitcher.width/2,l.pitcher.state=Fe.IDLE),l.pitcher.y=150+qe,l.perfectHitTimer=0,l.score===0&&!l.tutorialSeen&&!l.isDailyChallenge?l.showTutorial=!0:l.showTutorial=!1,Ra(!0),localStorage.removeItem("baseball_saved_game"),l.isGameOver=!1}async function er(e,t="generic"){return await It.attemptEntry(e,t)}function tr(){kt&&(kt.innerText=20,kt.style.color="#fff"),V.coins>=20?Ge&&(Ge.disabled=!1,Ge.style.opacity="1",Ge.innerText="RETRY",Ge.style.cursor="pointer"):(kt&&(kt.style.color="#e74c3c"),Ge&&(Ge.disabled=!1,Ge.innerText="NEED COINS",Ge.classList.add("btn-disabled-visual")))}function os(){l.isDailyChallenge=!1,localStorage.removeItem("baseball_saved_game"),l.isGameOver=!1,l.gameActive=!1,D.stopTheme(),V.reset(),l.showFireworks=!1,Pt.reset(),l.bossModeActive=!1,Ve.style.display="block",ia?ia.innerHTML=`
            <div class="game-title">
                <div class="title-line" data-text="PERFECT">PERFECT</div>
                <div class="title-line" data-text="DERBY">DERBY</div>
            </div>
            <div class="subtitle pulse">TAP TO <span class="mobile-block">START</span></div>
        `:Ve.innerHTML=`
            <div class="game-title">
                <div class="title-line" data-text="PERFECT">PERFECT</div>
                <div class="title-line" data-text="DERBY">DERBY</div>
            </div>
            <div class="subtitle pulse">TAP TO <span class="mobile-block">START</span></div>
        `,Xe&&(Xe.style.display="block"),Xe&&(Xe.style.display="block"),et&&(et.style.display="flex",et.classList.remove("wiggle-active")),je&&(je.style.display="flex"),pt&&(pt.style.display="block"),ct&&(ct.style.display="none"),Lt(!1),He.style.color="#fff",rt&&(rt.style.display="none"),za&&za.close(),Wt&&(Wt.style.display="none"),He&&He.parentElement&&(He.parentElement.style.display="flex");const e=document.getElementById("coin-container");e?(e.style.display="flex",e.style.visibility="visible"):ot&&ot.parentElement&&(ot.parentElement.style.display="flex"),mt&&(mt.style.display="none"),ia?ia.innerHTML=`
            <div class="game-title">
                <div class="title-line" data-text="PERFECT">PERFECT</div>
                <div class="title-line" data-text="DERBY">DERBY</div>
            </div>
            <div class="subtitle pulse">TAP TO <span class="mobile-block">START</span></div>
            ${l.isMobile?'<span class="mobile-block"><br>(TAP ZONES)</span>':""}
        `:Ve.innerHTML=`
            <div class="game-title">
                <div class="title-line" data-text="PERFECT">PERFECT</div>
                <div class="title-line" data-text="DERBY">DERBY</div>
            </div>
            <div class="subtitle pulse">TAP TO <span class="mobile-block">START</span></div>
            ${l.isMobile?'<span class="mobile-block"><br>(TAP ZONES)</span>':""}
        `,Xe&&(Xe.style.display="block"),je&&(je.style.display="flex"),pt&&(pt.style.display="block"),Ve.style.display="block"}function Ni(e=null){if(l.transitioning)return;if(e&&!l.isGameOver&&!l.transitioning){if(l.transitioning=!0,l.gameActive=!1,Ra(!1),hi=!1,Ve&&(Ve.style.display="none"),Xe&&(Xe.style.display="none"),l.balls.forEach(s=>{s.prevX=s.x,s.prevY=s.y,s.prevRotationAngle=s.rotationAngle}),bi){bi.style.display="flex";let s="GAME OVER",r="BETTER LUCK NEXT TIME",d=null;e==="STRIKE_OUT"?(s="STRIKE OUT!",r="THREE STRIKES, YOU'RE OUT",d=()=>D.playStrike()):e==="BAT_BROKEN"&&(s="BAT BROKEN!",r="TOO MANY FOULS",d=()=>D.playBatBreak()),Bo&&(Bo.innerText=s),Fo&&(Fo.innerText=r),d&&d()}setTimeout(()=>{l.transitioning=!1,bi&&(bi.style.display="none"),Ni()},2e3);return}l.gameActive=!1,l.isGameOver=!0,hi=!1,V.checkHighScore();const t=re.currentTheme&&re.currentTheme.id==="CLASSIC";V.score>50&&V.hasNewRecord()&&t&&(l.showFireworks=!0,Pt.reset()),El(),localStorage.removeItem("baseball_saved_game"),Xe.style.display="block",Xe.style.display="block",et&&(et.style.display="flex",et.classList.add("wiggle-active")),je&&(je.style.display="flex"),pt&&(pt.style.display="block"),ct&&(ct.style.display="none"),l.pendingUnlockablesGlow&&!l.isDailyChallenge&&(l.needsUnlockablesGlow=!0,l.pendingUnlockablesGlow=!1,je&&je.classList.add("unlockables-glow")),Lt(!0),l.isDailyChallenge?`${V.dailyHighScore}`:`${V.highScore}`;const i=l.isDailyChallenge?"#FFD700":"#ffffff";console.log(`[Game Over] isDaily: ${l.isDailyChallenge}, color: ${i}`),ia?ia.innerHTML=`
            <span style="color: #ff0000; font-size: 1.2em;">GAME OVER</span><br>
            <span style="font-size: 1.0em; display: block; margin-top: 10px; animation: none; color: ${i} !important;">SCORE: ${V.score}</span>
            <span id="restart-msg" style="font-size: 0.8em; display: block; margin-top: 20px; animation: blink 1s infinite linear; color: #fff;">TAP TO RETRY</span>
        `:Ve.innerHTML=`
            <span style="color: #ff0000; font-size: 1.2em;">GAME OVER</span><br>
            <span style="font-size: 1.0em; display: block; margin-top: 10px; animation: none; color: ${i} !important;">SCORE: ${V.score}</span>
            <span id="restart-msg" style="font-size: 0.8em; display: block; margin-top: 20px; animation: blink 1s infinite linear; color: #fff;">TAP TO RETRY</span>
        `,Ve.style.display="block",Ve.style.display="block",l.isDailyChallenge&&V.updateDailyStreak().catch(s=>console.warn("[Daily] Streak update failed",s)),He.parentElement.style.display="flex",He.parentElement.style.display="flex",He.style.visibility="hidden";const o=document.getElementById("coin-container");o?(o.style.display="flex",o.style.visibility="visible"):ot.parentElement.style.display="flex",Te.innerText="",re.currentTheme&&re.currentTheme.id==="HAUNTED"?D.playHauntedTheme():D.playTheme();const n=l.isDailyChallenge?"daily_leaderboard":"leaderboard";za.checkAndSubmitScore(V.score,n),setTimeout(()=>{hi=!0},1e3),De.style.display="none",Ra(!0),V.saveCoins(!0),V.animateCoinGain(),V.syncSession().catch(s=>console.error("Sync Failed",s))}function ya(){if(l.isPaused)return;if(!l.gameActive){if(!hi)return;D.init().then(()=>{la()});return}const e=Date.now();e-l.lastSwingTime<Rs||l.bat.swinging||(l.lastSwingTime=e,l.bat.swinging=!0,l.bat.angle=Math.PI,D.playSwing())}function ns(e){l.gameActive&&Ve.style.display!=="none"&&(Ve.style.display="none",ia&&(ia.style.display="none")),document.visibilityState==="visible"&&(l.activeSessionTime+=e),l.balls.length===0&&(l.pitcher.timer+=e),l.perfectHitTimer>0&&(l.perfectHitTimer-=e),l.startMessage&&l.startMessage.active&&(l.startMessage.timer-=e,l.startMessage.timer<=0&&(l.startMessage.active=!1,mt&&(mt.style.display="none"))),l.isDailyChallenge&&He.style.color!=="rgb(255, 215, 0)"&&He.style.color!=="#FFD700"&&(He.style.color="#FFD700"),xl.update(e),Wl.update(e,Ni,Ra),l.bat.swinging&&(l.bat.angle+=l.bat.swingSpeed*(e/16),l.bat.angle<=-Math.PI&&(l.bat.angle=Math.PI,l.bat.swinging=!1)),Jl.checkCollisions(e,t=>{t==="BAT_BROKEN"&&Ni("BAT_BROKEN")},Ra)}function ss(){It.updateButtonState()}function Eo(){V.saveGame()}function ar(){return V.loadGame()?(l.pitcher.state=Fe.IDLE,l.pitcher.timer=0,l.pitcher.x=Q/2-l.pitcher.width/2,l.pitcher.y=150+qe,l.balls=[],Ve.style.display="none",Wt.style.display="block",Xe.style.display="block",He.style.visibility="visible",He.parentElement.style.display="flex",V.updateScoreDisplay(),ot.parentElement.style.display="none",je&&(je.style.display="none"),pt&&(pt.style.display="none"),Lt(!1),Na(),console.log("Game Restored from Secure Disk"),!0):!1}It.init(la,os);const ir=Object.freeze(Object.defineProperty({__proto__:null,attemptDailyEntry:er,gameOver:Ni,loadSavedGame:ar,returnToTitle:is,returnToTitleScreen:os,saveGame:Eo,setupDailyRetryModal:tr,startGame:la,swing:ya,togglePause:Wa,update:ns,updateDailyButtonState:ss},Symbol.toStringTag,{value:"Module"})),or=`data:image/svg+xml;charset=utf-8,${encodeURIComponent('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 10 10" shape-rendering="crispEdges"><rect x="3" y="0" width="4" height="1" fill="#DAA520" /><rect x="2" y="1" width="1" height="1" fill="#DAA520" /><rect x="3" y="1" width="4" height="1" fill="#FFD700" /><rect x="7" y="1" width="1" height="1" fill="#DAA520" /><rect x="1" y="2" width="1" height="1" fill="#DAA520" /><rect x="2" y="2" width="1" height="1" fill="#FFD700" /><rect x="3" y="2" width="2" height="1" fill="#FFFFFF" /><rect x="5" y="2" width="3" height="1" fill="#FFD700" /><rect x="8" y="2" width="1" height="1" fill="#DAA520" /><rect x="1" y="3" width="1" height="1" fill="#DAA520" /><rect x="2" y="3" width="1" height="1" fill="#FFD700" /><rect x="3" y="3" width="1" height="1" fill="#FFFFFF" /><rect x="4" y="3" width="3" height="1" fill="#000000" /><rect x="7" y="3" width="1" height="1" fill="#FFD700" /><rect x="8" y="3" width="1" height="1" fill="#DAA520" /><rect x="1" y="4" width="1" height="1" fill="#DAA520" /><rect x="2" y="4" width="2" height="1" fill="#FFD700" /><rect x="4" y="4" width="1" height="1" fill="#000000" /><rect x="5" y="4" width="3" height="1" fill="#FFD700" /><rect x="8" y="4" width="1" height="1" fill="#DAA520" /><rect x="1" y="5" width="1" height="1" fill="#DAA520" /><rect x="2" y="5" width="2" height="1" fill="#FFD700" /><rect x="4" y="5" width="1" height="1" fill="#000000" /><rect x="5" y="5" width="3" height="1" fill="#FFD700" /><rect x="8" y="5" width="1" height="1" fill="#DAA520" /><rect x="1" y="6" width="1" height="1" fill="#DAA520" /><rect x="2" y="6" width="2" height="1" fill="#FFD700" /><rect x="4" y="6" width="3" height="1" fill="#000000" /><rect x="7" y="6" width="1" height="1" fill="#FFD700" /><rect x="8" y="6" width="1" height="1" fill="#DAA520" /><rect x="1" y="7" width="1" height="1" fill="#DAA520" /><rect x="2" y="7" width="6" height="1" fill="#FFD700" /><rect x="8" y="7" width="1" height="1" fill="#DAA520" /><rect x="2" y="8" width="1" height="1" fill="#DAA520" /><rect x="3" y="8" width="4" height="1" fill="#FFD700" /><rect x="7" y="8" width="1" height="1" fill="#DAA520" /><rect x="3" y="9" width="4" height="1" fill="#DAA520" /></svg>')}`;class nr{constructor(){this.stadiums=[{id:"stadium_default",name:"Classic Field",cost:0,type:"stadium",unlocked:!0,equipped:!0,theme:"CLASSIC"},{id:"stadium_night",name:"Night Game",cost:1e6,type:"stadium",unlocked:!1,equipped:!1,theme:"NIGHT"},{id:"stadium_retro",name:"Retro Park",cost:25e5,type:"stadium",unlocked:!1,equipped:!1,theme:"RETRO"},{id:"stadium_space",name:"Space Station",cost:30,type:"stadium",unlocked:!1,equipped:!1,theme:"SPACE"},{id:"stadium_beach",name:"Sunny Beach",cost:20,type:"stadium",unlocked:!1,equipped:!1,theme:"BEACH"},{id:"stadium_haunted",name:"Haunted Mansion",cost:10,type:"stadium",unlocked:!1,equipped:!1,theme:"HAUNTED"}],this.bats=[{id:"bat_default",name:"Pink Bat",cost:0,type:"bat",unlocked:!0,equipped:!0,color:"#ff69b4"},{id:"bat_blue",name:"Blue Bat",cost:1,type:"bat",unlocked:!1,equipped:!1,color:"#0000FF"},{id:"bat_gold",name:"Gold Bat",cost:10,type:"bat",unlocked:!1,equipped:!1,color:"#FFD700"},{id:"bat_laser",name:"Neon Bat",cost:1,type:"bat",unlocked:!1,equipped:!1,color:"#00ffff"}],this.init()}init(){this.loadProgress(),this.renderItems(),this.setupEventListeners(),setTimeout(()=>this.syncPendingPurchases(),2e3)}async syncPendingPurchases(){const t=JSON.parse(Y.getItem("baseball_pending_purchases")||"[]");if(t.length===0)return;console.log(`[Unlockables] Found ${t.length} pending offline purchases to sync...`);const{supabaseService:a}=await Be(async()=>{const{supabaseService:s}=await Promise.resolve().then(()=>va);return{supabaseService:s}},void 0,import.meta.url),i=a.getClient();if(!i)return;const{data:{session:o}}=await i.auth.getSession();if(!o)return;try{await i.rpc("ensure_user_exists",{p_user_id:o.user.id})}catch(s){console.warn("[Unlockables] Failed to ensure user exists:",s)}const n=[];for(const s of t)try{console.log(`[Unlockables] Syncing purchase: ${s.id}`);const{data:r,error:d}=await i.rpc("purchase_item",{p_item_id:s.id,p_cost:s.cost,p_item_type:s.type});d?(console.warn(`[Unlockables] Sync failed for ${s.id}: ${d.message}`),n.push(s)):typeof r.new_balance=="number"?console.log(`[Unlockables] Synced ${s.id}. Server Balance: ${r.new_balance}`):console.warn(`[Unlockables] Synced ${s.id} but received invalid balance: ${r.new_balance}.`)}catch(r){console.error(`[Unlockables] Sync Error for ${s.id}`,r),n.push(s)}Y.setItem("baseball_pending_purchases",JSON.stringify(n)),await this.syncPendingEquips(i)}async syncPendingEquips(t){const a=["bat","stadium"];for(const i of a){const o=`pending_equip_${i}`,n=Y.getItem(o);if(n)try{const s=JSON.parse(n);console.log(`[Unlockables] Syncing pending equip: ${s.id}`);const{error:r}=await t.rpc("set_equipped_item",{p_item_id:s.id,p_item_type:s.type});r?console.warn(`[Unlockables] Failed to sync pending equip ${s.id}: ${r.message}`):(Y.removeItem(o),console.log(`[Unlockables] Pending equip synced: ${s.id}`))}catch(s){console.error("Error syncing pending equip",s)}}}setupEventListeners(){je.addEventListener("click",()=>this.open()),ds.addEventListener("click",()=>this.close()),ii.addEventListener("click",t=>{t.stopPropagation(),(!l.gameActive||l.isGameOver)&&(Ie.vibrate("light"),this.open())}),oi.addEventListener("click",t=>{t.target===oi&&this.close()})}open(){oi.style.display="flex",this.updateCoinDisplay(),l.isPaused=!0,l.needsUnlockablesGlow=!1,je&&je.classList.remove("unlockables-glow"),D.init().then(()=>{D.playUnlockablesOpen()})}close(){oi.style.display="none",l.isPaused=!1,D.playUnlockablesClose()}updateCoinDisplay(){us.textContent=V.coins}renderItems(){this.stadiums.sort((t,a)=>t.cost-a.cost),this.bats.sort((t,a)=>t.cost-a.cost),this.renderGrid(fs,this.stadiums),this.renderGrid(hs,this.bats)}renderGrid(t,a){t.innerHTML="",a.forEach(i=>{const o=document.createElement("div");o.className=`unlockable-item clickable ${i.unlocked?"unlocked":"locked"} ${i.equipped?"equipped":""}`,o.onclick=()=>this.handleItemClick(i);let n="";if(i.equipped)n='<div class="item-status equipped">EQUIPPED</div>';else if(i.unlocked)n='<div class="item-status owned">OWNED</div>';else{const c=i.id==="stadium_night"||i.id==="stadium_retro"?"?":i.cost.toLocaleString();n=`
                    <div class="item-cost">
                        <img src="${or}" style="width: 1.2em; height: 1.2em;">
                        <span style="color: #ffffff; margin-left: 4px;">${c}</span>
                    </div>`}const r=i.unlocked?"":`<div class="lock-overlay">
            <svg viewBox="0 0 12 14" xmlns="http://www.w3.org/2000/svg" style="shape-rendering: crispEdges; width: 100%; height: 100%;">
                <!-- Shackle (Silver) -->
                <rect x="3" y="0" width="6" height="1" fill="#C0C0C0"/>
                <rect x="2" y="1" width="1" height="4" fill="#C0C0C0"/>
                <rect x="9" y="1" width="1" height="4" fill="#C0C0C0"/>
                <!-- Body (Gold) -->
                <rect x="1" y="5" width="10" height="9" fill="#FFD700"/>
                <!-- Highlight -->
                <rect x="2" y="6" width="1" height="1" fill="#FFFFFF" opacity="0.5"/>
                <rect x="3" y="6" width="7" height="1" fill="#FFFFFF" opacity="0.5"/>
                <!-- Keyhole (Black) -->
                <rect x="5" y="8" width="2" height="3" fill="#000"/>
            </svg></div>`;let d="";i.type==="stadium"?d=this.getStadiumIcon(i):i.type==="bat"&&(d=this.getBatIcon(i)),o.innerHTML=`
                <div class="item-name">${i.name}</div>
                <div class="item-icon-container">
                    <div class="item-icon">${d}</div>
                    ${r}
                </div>
                <div class="item-footer">
                    ${n}
                </div>
            `,t.appendChild(o)})}handleItemClick(t){if(console.log(`[Unlockables] Clicked item: ${t.name}, Equipped: ${t.equipped}`),t.equipped){D.playItemAlreadyEquipped(),Ie.vibrate("equipped");return}t.unlocked?this.equipItem(t):V.coins>=t.cost?this.purchaseItem(t):this.purchaseItem(t)}async purchaseItem(t){if(console.log(`[Unlockables] Attempting purchase: ${t.name} (${t.id})`),!V.deductCoinsLocal(t.cost)){D.playError(),Ie.vibrate("locked"),console.log("[Unlockables] Purchase Failed: Insufficient Local Funds");return}t.unlocked=!0,this.saveProgress(),this.updateCoinDisplay(),this.renderItems(),D.playPurchase(),Ie.vibrate("purchase"),console.log(`[Unlockables] Local Purchase Successful: ${t.name}`),this.syncPurchaseToServer(t)}async syncPurchaseToServer(t){const{supabaseService:a}=await Be(async()=>{const{supabaseService:o}=await Promise.resolve().then(()=>va);return{supabaseService:o}},void 0,import.meta.url),i=a.getClient();if(!i){console.warn("[Unlockables] Offline. Queuing purchase for server sync."),this.queuePendingPurchase(t);return}try{const{data:o,error:n}=await i.rpc("purchase_item",{p_item_id:t.id,p_cost:t.cost,p_item_type:t.type});if(n){if(n.message?.includes("already owned")){console.log(`[Unlockables] Item ${t.id} already owned on server - OK`);return}console.warn("[Unlockables] Server Sync Failed:",n.message),this.queuePendingPurchase(t)}else console.log(`[Unlockables] Server Sync Success for ${t.id}. Server Bal: ${o.new_balance}`)}catch(o){console.error("[Unlockables] Sync RPC Exception",o),this.queuePendingPurchase(t)}}purchaseItemLocal(t){V.deductCoinsLocal(t.cost)?(t.unlocked=!0,this.saveProgress(),this.queuePendingPurchase(t),this.updateCoinDisplay(),this.renderItems(),D.playPurchase(),Ie.vibrate("purchase"),console.log(`[Unlockables] Offline Purchase Successful: ${t.name}`)):(D.playError(),Ie.vibrate("locked"),console.log("[Unlockables] Offline Purchase Failed: Insufficient Funds"))}queuePendingPurchase(t){const a=JSON.parse(Y.getItem("baseball_pending_purchases")||"[]");a.find(i=>i.id===t.id)||(a.push({id:t.id,cost:t.cost,type:t.type,timestamp:Date.now()}),Y.setItem("baseball_pending_purchases",JSON.stringify(a)),console.log(`[Unlockables] Queued purchase sync for ${t.name}`))}equipItem(t){D.playEquip(),Ie.vibrate("light"),(t.type==="stadium"?this.stadiums:this.bats).forEach(o=>o.equipped=!1),t.equipped=!0,this.saveProgress(),this.renderItems(),console.log(`Equipped ${t.name}`),t.type==="stadium"&&(t.theme==="SPACE"||t.theme==="HAUNTED")?(this.showLoadingOverlay(t.theme),setTimeout(()=>{if(this.applyEquippedItem(t),t.type==="stadium"&&this.close(),t.theme==="HAUNTED"&&$a){const o=Q||window.innerWidth,n=Ee||window.innerHeight;$a(o,n)}setTimeout(()=>this.hideLoadingOverlay(),50)},50)):(this.applyEquippedItem(t),t.type==="stadium"&&this.close()),this.syncEquippedItem(t)}async syncEquippedItem(t){const{supabaseService:a}=await Be(async()=>{const{supabaseService:o}=await Promise.resolve().then(()=>va);return{supabaseService:o}},void 0,import.meta.url),i=a.getClient();if(!i){console.warn("[Unlockables] Offline. Queuing equip for server sync."),this.savePendingEquip(t);return}try{const{data:{session:o}}=await i.auth.getSession();if(o){const{error:r}=await i.rpc("ensure_user_exists",{p_user_id:o.user.id});r&&console.error("[Unlockables] ensure_user_exists FAILED:",r)}console.log(`[Unlockables] Syncing equip: ${t.id}`);const{data:n,error:s}=await i.rpc("set_equipped_item",{p_item_id:t.id,p_item_type:t.type});if(s)console.warn(`[Unlockables] Equip Sync Network Error: ${s.message}`),this.savePendingEquip(t);else{console.log(`[Unlockables] Equip Sync Result: ${n}`);const r=String(n).match(/Equipped=(\d+)/);if((r?parseInt(r[1]):null)===0){console.warn("[Unlockables] Server missed equip (Item likely missing). Attempting Backfill..."),await this.syncPurchaseToServer(t),console.log(`[Unlockables] Retrying equip for ${t.id}...`);const{data:f}=await i.rpc("set_equipped_item",{p_item_id:t.id,p_item_type:t.type});console.log(`[Unlockables] Retry Result: ${f}`)}else n&&String(n).startsWith("Error")&&this.savePendingEquip(t)}}catch(o){console.error("[Unlockables] Equip Sync Exception",o),this.savePendingEquip(t)}}savePendingEquip(t){const a=`pending_equip_${t.type}`;Y.setItem(a,JSON.stringify({id:t.id,type:t.type,timestamp:Date.now()}))}applyEquippedItem(t){if(t.type==="bat"){const a={bat_default:"STANDARD",bat_blue:"BLUE",bat_gold:"GOLD",bat_laser:"LASER"};wt.setBat(a[t.id]||"STANDARD"),al()}else if(t.type==="stadium"&&t.theme){if(re.setTheme(t.theme),l.gameActive=!1,l.isGameOver=!1,l.bossModeActive=!1,l.showFireworks=!1,l.showFireworks=!1,D.stopTheme(),et&&et.classList.remove("wiggle-active"),Ve){Ve.style.display="block";const a='<div class="game-title"><div class="title-line" data-text="PERFECT">PERFECT</div><div class="title-line" data-text="DERBY">DERBY</div></div><div class="subtitle pulse">TAP TO <span class="mobile-block">START</span></div>',i=document.getElementById("start-content");i?i.innerHTML=a:Ve.innerHTML=`<div id="start-content">${a}</div>`}Lt(!1),Na()}}showLoadingOverlay(t){let a=document.getElementById("global-loading-overlay");const i=t==="HAUNTED"?"SUMMONING SPIRITS":"INITIALIZING SPACE SYSTEMS";a||(a=document.createElement("div"),a.id="global-loading-overlay",a.style.position="fixed",a.style.top="0",a.style.left="0",a.style.width="100%",a.style.height="100%",a.style.background="rgba(0,0,0,0.85)",a.style.color="#fff",a.style.zIndex="10000",a.style.display="flex",a.style.flexDirection="column",a.style.alignItems="center",a.style.justifyContent="center",a.style.fontFamily="var(--font-display, monospace)",a.style.fontSize="4vmin",document.body.appendChild(a)),a.innerHTML=`<div class="pulse">LOADING...</div><div class="subtitle" style="font-size: 0.5em; margin-top: 20px; color: #888;">${i}</div>`,a.style.display="flex",l.isLoading=!0}hideLoadingOverlay(){const t=document.getElementById("global-loading-overlay");t&&(t.style.display="none"),l.isLoading=!1}saveProgress(){const t={stadiums:this.stadiums.map(a=>({id:a.id,unlocked:a.unlocked,equipped:a.equipped})),bats:this.bats.map(a=>({id:a.id,unlocked:a.unlocked,equipped:a.equipped})),coins:l.coins};Y.setItem("baseball_unlockables",JSON.stringify(t))}loadProgress(){Y.migrate("baseball_unlockables");const t=Y.getItem("baseball_unlockables");if(t)try{const a=JSON.parse(t);a.stadiums&&a.stadiums.forEach(i=>{const o=this.stadiums.find(n=>n.id===i.id);o&&(o.unlocked=i.unlocked,o.equipped=i.equipped,o.equipped&&o.theme&&re.setTheme(o.theme))}),a.bats&&a.bats.forEach(i=>{const o=this.bats.find(n=>n.id===i.id);if(o&&(o.unlocked=i.unlocked,o.equipped=i.equipped,o.equipped&&o.type==="bat")){const n={bat_default:"STANDARD",bat_blue:"BLUE",bat_gold:"GOLD",bat_laser:"LASER"};wt.setBat(n[o.id]||"STANDARD")}})}catch(a){console.warn("Failed to parse unlockables. Resetting.",a),Y.removeItem("baseball_unlockables")}}getStadiumIcon(t){return`<img src="${Il(t.theme).toDataURL()}" draggable="false" style="width: 100%; height: 100%; border-radius: 1vmin; display: block; user-select: none; -webkit-user-drag: none; pointer-events: none;">`}getBatIcon(t){const i={bat_default:aa.STANDARD,bat_blue:aa.BLUE,bat_gold:aa.GOLD,bat_laser:aa.LASER}[t.id]||aa.STANDARD;return`<img src="${$n.generateIcon(i).toDataURL()}" draggable="false" style="width: 100%; height: 100%; display: block; user-select: none; -webkit-user-drag: none; pointer-events: none;">`}}const Mo=new nr,sr=Object.freeze(Object.defineProperty({__proto__:null,unlockablesManager:Mo},Symbol.toStringTag,{value:"Module"})),Dn=512,go=[{name:"Audio System Warmup",action:async()=>{D&&(await D.init(),D.warmup&&D.warmup())}},{name:"Beach Sun Flare & Island Glow (Perfect Hit)",draw:e=>{const t=l.perfectHitTimer,a=V.consecutivePerfectHits,i=l.settings;l.perfectHitTimer=1,V.setMultiplier(3),l.settings={...i,noFlash:!1};for(let o=0;o<3;o++)Po(e,Dn,Dn);l.perfectHitTimer=t,V.setMultiplier(a),l.settings=i}},{name:"Space Warp (Perfect Hit)",draw:e=>{}},{name:"Monitor Shocked Face",draw:e=>{const t=l.perfectHitTimer;l.perfectHitTimer=1;const a=l.pitcher;l.pitcher={id:"MONITOR"},To(e,64,64,1),l.perfectHitTimer=t,l.pitcher=a}},{name:"Fireworks Particles",draw:e=>{Pt.spawnParticles(64,64,"#ff0000"),Pt.draw(),Pt.reset()}},{name:"Pitcher Sprites (Current Daily)",draw:e=>{try{const t=l.pitcher||{skinColor:"#ffccaa",gender:"MALE",props:{hatColor:"#e74c3c"}},a=t.skinColor||"#ffccaa",i=t.props||{},o=["IDLE","SET","KICK","THROW"],n=["#ffffff","#ff0000"];o.forEach(s=>{n.forEach(r=>{typeof So=="function"&&So(s,r,null,"full",a,i)})}),To(e,64,64,1)}catch(t){console.warn("[Preloader] Pitcher warmup failed (Non-fatal):",t)}}},{name:"Haunted Mansion Storm",draw:e=>{if($a){const t=Q||window.innerWidth,a=Ee||window.innerHeight;$a(t,a)}}}];async function lr(e,t){console.log("[Preloader] Starting effect warmup...");const a=document.createElement("canvas");a.width=512,a.height=512;const i=a.getContext("2d",{willReadFrequently:!0});for(let o=0;o<go.length;o++){if(t&&t.aborted){console.log("[Preloader] Warmup aborted.");break}const n=go[o];try{if(i.clearRect(0,0,512,512),n.action&&await n.action(),n.draw){n.draw(i);const s=i.getImageData(0,0,1,1).data}console.log(`[Preloader] Warmed up: ${n.name}`)}catch(s){console.warn(`[Preloader] Failed to warmup ${n.name}:`,s)}if(e){const s=Math.round((o+1)/go.length*100);e(s,`Loading: ${n.name}`),await new Promise(r=>setTimeout(r,20))}}a.width=1,a.height=1,console.log("[Preloader] Warmup complete.")}function ls(e){try{l.lastTime===0&&(l.lastTime=e);let t=(e-l.lastTime)*Es.TIME_SCALE;for(l.lastTime=e,t>100&&(t=100),l.accumulator+=t;l.accumulator>=ka;)l.gameActive&&!l.isPaused?(ns(ka),Pt.update(ka,!1)):!l.gameActive&&l.showFireworks&&Pt.update(ka),l.accumulator-=ka;b.clearRect(0,0,Dt.width,Dt.height);const a=l.accumulator/ka;l.gameActive||l.transitioning?(Dl(),xs(),ol(),l.balls.forEach(i=>sl(i,a)),Ol(),Pt.draw(),ll(),Yn()):wl(Pt),requestAnimationFrame(ls)}catch(t){console.error("CRITICAL GAMELOOP ERROR:",t),l.gameActive=!1}}async function rr(){try{if(typeof window.Capacitor<"u"){const{App:e}=await Be(async()=>{const{App:o}=await import("./index-DlaQ9LD2.js");return{App:o}},__vite__mapDeps([2,1]),import.meta.url),{StatusBar:t}=await Be(async()=>{const{StatusBar:o}=await import("./index-DbeBRm09.js");return{StatusBar:o}},__vite__mapDeps([3,1]),import.meta.url),{SplashScreen:a}=await Be(async()=>{const{SplashScreen:o}=await import("./index-fe9Xyqf8.js");return{SplashScreen:o}},__vite__mapDeps([4,1]),import.meta.url),i=async()=>{await t.hide().catch(()=>{}),await a.hide().catch(()=>{})};await i(),e.addListener("appStateChange",({isActive:o})=>{o?(i(),D._checkAndResume()):D.suspendAudio()}),window.addEventListener("touchend",i),window.addEventListener("click",i),e.addListener("backButton",({canGoBack:o})=>{l.gameActive&&!l.isPaused&&!l.isGameOver?De&&De.style.display!=="none"&&De.style.pointerEvents!=="none"&&Wa():l.isPaused?Wa():za&&za.modal.style.display==="flex"?za.close():ea.isOpen?ea.closeSettings():l.isDailyChallenge&&l.gameActive})}}catch{console.log("Native mode disabled (Web/Browser).")}}const Ln=async()=>{console.log("Game Loading...");let e=document.getElementById("global-loading-overlay");e||(e=document.createElement("div"),e.id="global-loading-overlay",e.style.position="fixed",e.style.top="0",e.style.left="0",e.style.width="100%",e.style.height="100%",e.style.background="rgba(0,0,0,1)",e.style.zIndex="90",e.style.display="block",document.body.appendChild(e)),requestAnimationFrame(()=>{document.body.offsetWidth,document.body.classList.add("play-intro"),console.log("[DEBUG] Intro Animation Triggered (Immediate)"),typeof window.Capacitor<"u"&&window.Capacitor.isNativePlatform()&&(setTimeout(()=>D.playIntroReveal(),450),setTimeout(()=>D.playIntroImpact(),1050))}),rr(),console.log("[DEBUG] initGame: Starting..."),ta.init(),console.log("[DEBUG] initGame: Leaderboard Init Called");try{const o=ui.waitForAuth(),n=new Promise((s,r)=>{setTimeout(()=>r(new Error("Auth Timeout")),2e3)});await Promise.race([o,n]),V.fetchServerBalance(),V.validateStartupStreak(),console.log("[DEBUG] initGame: Auth & Sync Complete")}catch(o){console.warn(`[DEBUG] initGame: Auth/Sync skipped (${o.message}). Starting game offline.`)}V.updateCoinDisplay(),Al(),console.log("[DEBUG] initGame: Crowd Generated"),ts(),console.log("[DEBUG] initGame: Resized"),setTimeout(()=>{if(l.isLoading&&document.getElementById("global-loading-overlay")){console.warn("Loading taking too long. Showing Failsafe Reset.");const o=document.getElementById("global-loading-overlay");if(document.getElementById("failsafe-reset-btn"))return;const n=document.createElement("button");n.id="failsafe-reset-btn",n.textContent="STUCK? RESET DATA",n.style.marginTop="20px",n.style.padding="10px 20px",n.style.background="#ff4444",n.style.color="white",n.style.border="none",n.style.borderRadius="5px",n.style.cursor="pointer",n.style.fontFamily="inherit",n.style.fontSize="16px",n.style.pointerEvents="auto",n.style.zIndex="10001",n.onclick=()=>{confirm("This will clear your save data and high scores to fix the loading error. Continue?")&&(localStorage.clear(),window.location.reload())},o.appendChild(n)}},5e3);const t=new AbortController,a=t.signal;try{console.log("[DEBUG] Starting Preloader...");const o=lr(r=>{},a),n=new Promise(r=>setTimeout(()=>{r("timeout")},3e3));await Promise.race([o,n])==="timeout"?(console.warn("Preloader timed out - Aborting background tasks."),t.abort()):console.log("[DEBUG] Preloader Finished Successfully.")}catch(o){console.error("Preload failed or timed out:",o)}const i=re.currentTheme;if(i&&i.warmup){console.log(`[DEBUG] Startup: Warming up ${i.id} Cache...`);const o=e.querySelector("div");if(o){const n={HAUNTED:"SUMMONING SPIRITS...",SPACE:"ENTERING ORBIT...",BEACH:"WAXING BOARDS...",CLASSIC:"MOWING GRASS..."};o.innerText=n[i.id]||"LOADING..."}try{const n=window.innerWidth||GAME_WIDTH,s=window.innerHeight||GAME_HEIGHT;i.warmup(n,s)}catch(n){console.warn("Theme warmup failed:",n)}}e.style.transition="opacity 0.5s",requestAnimationFrame(()=>{e.style.opacity="0"}),setTimeout(()=>{e.parentNode&&e.parentNode.removeChild(e),l.isLoading=!1,document.body.classList.add("loading-complete"),typeof window.Capacitor<"u"&&window.Capacitor.isNativePlatform()},800),Lt(!1),oa&&(oa.style.display="flex",V.validateStartupStreak(),ss(),oa.addEventListener("click",o=>{o.stopPropagation(),Ie.vibrate("medium"),console.log("Daily Challenge Button Clicked"),la(!0)}),oa.addEventListener("touchstart",o=>{o.stopPropagation()},{passive:!1})),typeof et<"u"&&et&&et.addEventListener("click",o=>{o.stopPropagation(),Ie.vibrate("medium"),console.log("Feedback Button Clicked: Generating Smart Link...");const n=V.highScore||0,s=localStorage.getItem("baseball_username")||"N/A";let r="Web";typeof window.Capacitor<"u"?r=window.Capacitor.isNativePlatform()?"Android_App":"Web_Mobile":/Mobi|Android/i.test(navigator.userAgent)?r="Mobile_Browser":r="PC_Browser";const d="https://docs.google.com/forms/d/e/1FAIpQLSdYRPa0zwJ1ZpBerKdjKKpuLKunedoiuoMTOEgCjCrfIjDSTw/viewform",f=new URLSearchParams({usp:"pp_url","entry.571653272":n,"entry.612925055":s,"entry.1950205778":r}),c=`${d}?${f.toString()}`;window.open(c,"_blank")}),requestAnimationFrame(ls)};document.readyState==="complete"||document.readyState==="interactive"?Ln():window.addEventListener("load",Ln);window.addEventListener("resize",ts);Hi.init();document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"?(Mo.saveProgress(),Eo()):document.visibilityState==="visible"&&zt.fetchServerTime()});window.addEventListener("pagehide",()=>{Mo.saveProgress(),Eo()});export{Be as _};
